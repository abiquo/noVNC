/*! abiquo v:0.0.2 2015-08-11 */
angular.module("abiquo",["pascalprecht.translate","abiquo.controllers","abiquo.services","abiquo.directives","abiquo.filters","ui.bootstrap","ui.utils","ngGrid","ngCookies","ngResource","ngAnimate","angularFileUpload","angulartics","angulartics.google.analytics","ngRoute","angularFileUpload","ngTouch"]).config(["$routeProvider",function(a){a.when("/dashboard",{templateUrl:"modules/dashboard/partials/dashboard.html",controller:"DashboardCtrl"}),a.when("/infrastructure",{controller:"InfrastructureCtrl",templateUrl:"modules/infrastructure/partials/infrastructureview.html"}),a.when("/virtualdatacenters",{controller:"VirtualDatacentersCtrl",templateUrl:"modules/virtualdatacenters/partials/virtualdatacentersview.html"}),a.when("/library",{controller:"LibraryCtrl",templateUrl:"modules/library/partials/libraryview.html"}),a.when("/enterprises",{templateUrl:"modules/enterprises/partials/enterprisesview.html",controller:"EnterprisesCtrl"}),a.when("/pricing",{templateUrl:"modules/pricing/partials/pricing.html",controller:"PricingCtrl"}),a.when("/events",{templateUrl:"modules/events/partials/events.html",controller:"EventsCtrl"}),a.when("/configuration",{templateUrl:"modules/configuration/partials/configurationview.html",controller:"ConfigurationCtrl"}),a.when("/authorize",{templateUrl:"modules/authorize/partials/authorize.html",controller:"AuthorizeCtrl"}),a.otherwise({redirectTo:"/dashboard"})}]).config(["$analyticsProvider",function(a){a.virtualPageviews(!1)}]).config(["$translateProvider",function(a){var b=CONFIG["config.languages"],c=function(){var a={};return angular.forEach(b,function(b){return b.isDefault===!0?void(a=b):void 0}),a.value};a.preferredLanguage(c()),a.useLoader("$translatePartialLoader",{urlTemplate:"lang/lang_{lang}_{part}.json"})}]).config(["$tooltipProvider",function(a){a.options({placement:"top",animation:!0,popupDelay:0,appendToBody:!0})}]).config(["$httpProvider",function(a){delete a.defaults.headers.common["X-Requested-With"]}]).factory("forbiddenInterceptor",["$q","$injector",function(a,b){return{response:function(c){if(!(c instanceof Error)){if(c.config&&c.config.data&&c.config.data.bypassInterceptor===!0)return c;if(403===c.status&&"string"==typeof c.data&&-1!=c.data.indexOf("Full authentication is required to access this resource")){var d=b.get("systemPropertiesMgr"),e=d.getLogoutUrl(),f=b.get("authenticationMgr");return f.logout(e,c.config.flags,!0),a.reject(c)}return c}}}}]).factory("loadingCursorHelper",["$q","$injector",function(a,b){function c(){$("body").attr("class",""),e.setInterfaceBlocked(!1)}var d=0,e=b.get("configMgr");return{request:function(a){return d++,$("body").attr("class","loadingCursor"),e.setInterfaceBlocked(!0),a},response:function(a){return--d||c(),a},responseError:function(a){return--d||c(),a}}}]).config(["$httpProvider",function(a){a.interceptors.push("forbiddenInterceptor"),a.interceptors.push("loadingCursorHelper")}]).config(["uiSelectConfig",function(a){a.theme="select2"}]).config(["toastrConfig",function(a){angular.extend(a,{positionClass:"toast-bottom-right",showDuration:300,hideDuration:100,timeOut:5e3,extendedTimeOut:5e3})}]).run(["$route",function(a){a.reload()}]).controller("AppCtrl",["$scope","$rootScope","$translatePartialLoader","$translate","$filter","navigationMgr","refreshMgr","configMgr",function(a,b,c,d,e,f,g,h){function i(){var a="main.window.application.title",b=e("translate")(a);a!=b&&(document.title=b)}a.__name="AppCtrl",a.navigationMgr=f,a.externaljsloaderurl=h.config["client.external.js.loader.url"],a.timerOptions=g.timerOptions,a.refreshLanguages=function(){c.addPart("labels"),d.refresh(),c.addPart("custom"),d.refresh()},b.$on("$translateRefreshEnd",function(){i()})}]),angular.module("abiquo.controllers",["remoteAccess","main","footer","mainMenu","breadCrumb","login","user","dashboard","infrastructure","virtualDatacenters","library","configuration","enterprises","pricing","authorize","events"]),angular.module("abiquo.directives",[]).directive("appVersion",["configMgr",function(a){return function(b,c){c.text("v. "+a.UI_VERSION)}}]).directive("simpleResourcesGraph",function(){return{replace:!0,restrict:"E",scope:{width:"=",height:"=",colors:"=",max:"=",used:"=",limit:"=",title:"="},template:"<div class=\"graph-container\" data-ng-style=\"{height: height+'px', width: width+'%'}\"><div id=\"graph\" class=\"graph\" data-ng-style=\"{height: height+'px', width: '100%' , float:'right', 'margin-right': '5px'}\"><div class=\"bar\" data-ng-style=\"{height: limit / max * height+'px', bottom:'0px', width:'50%', 'background-color': colors[0]}\"><span data-ng-hide=\"limit == '0' || limit == 0\" data-ng-style=\"{color: colors[0]}\">{{limit}}</span></div><div class=\"bar\" data-ng-style=\"{height: used / max * height+'px', bottom:'0px', width:'50%', 'margin-left':'50%', 'background-color': colors[1]}\"><span data-ng-hide=\"used == '0' || used == 0\" data-ng-style=\"{color: colors[1]}\">{{used}}</span></div></div><div class=\"title-container\" data-ng-style=\"{width: width+'%', 'margin-top': height+'px'}\"><span class=\"title\">{{title}}</span></div></div>"}}).directive("simpleDatacenterResourcesGraph",function(){return{replace:!0,restrict:"E",scope:{width:"=",height:"=",colors:"=",max:"=",stopped:"=",running:"=",title:"="},template:"<div class=\"graph-container\" data-ng-style=\"{height: height+'px', width: width+'%'}\"><div id=\"graph\" class=\"graph\" data-ng-style=\"{height: height+'px', width: '100%' , float:'right', 'margin-right': '5px'}\"><div class=\"bar\" data-ng-style=\"{height: running / max * height+'px', bottom:'0px', width:'50%', 'background-color': colors[2]}\"><span data-ng-hide=\"running == '0' || running == 0\" data-ng-style=\"{color: colors[2]}\">{{running}}</span></div><div class=\"bar\" data-ng-style=\"{height: stopped / max * height+'px', bottom:'0px', width:'50%', 'margin-left':'50%', 'background-color': colors[1]}\"><span data-ng-hide=\"stopped == '0' || stopped == 0\" data-ng-style=\"{color: colors[1]}\">{{stopped}}</span></div></div><div class=\"title-container\" data-ng-style=\"{width: width+'%', 'margin-top': height+'px'}\"><span class=\"title\">{{title}}</span></div></div>"}}).directive("doubleResourcesGraph",function(){return{replace:!0,restrict:"E",scope:{width:"=",height:"=",colors:"=",max:"=",available:"=",used:"=",limit:"=",title:"="},template:"<div class=\"graph-container\" data-ng-style=\"{height: height + 1 +'px', width: width+'%'}\"><div id=\"graph\" class=\"graph\" data-ng-style=\"{height: height+'px', width: '100%', float:'right', 'margin-right': '5px'}\"><div class=\"bar\" data-ng-style=\"{height: limit / max * height+'px', bottom:'0px', width:'33%', 'background-color': colors[0]}\"><span data-ng-hide=\"limit == '0' || limit == 0\" data-ng-style=\"{color: colors[0]}\">{{limit}}</span></div><div class=\"bar\" data-ng-style=\"{height: available / max * height+'px', bottom:'0px', width:'33%','background-color': colors[2], 'margin-left':'33%'}\"><span data-ng-hide=\"available == '0' || available == 0\" data-ng-style=\"{color: colors[2]}\">{{available}}</span></div><div class=\"bar\" data-ng-style=\"{height: used / max * height+'px', bottom:'0px', width:'33%', 'background-color': colors[1], 'margin-left':'66%'}\"><span data-ng-hide=\"used == '0' || used == 0\" data-ng-style=\"{color: colors[1]}\">{{used}}</span></div></div><div class=\"title-container\" data-ng-style=\"{width: width+'%','margin-top':height+'px'}\"><span class=\"title\">{{title}}</span></div></div>"}}).directive("uPopup",["$http","$compile","uModals","utils",function(a,b,c,d){return{restrict:"A",link:function(a,b,c,e){b.bind("click",function(){d.showPopUp(c,a)})}}}]).directive("uAlert",["$compile","$filter","uModals",function(a,b,c){return{restrict:"A",link:function(a,d,e){var f,g,h,i,j,k,l,m;d.bind("click",function(){f=void 0===e.message?"Message":e.message,g=void 0===e.title?"title":e.title,h=void 0===e.confirmLabel?b("translate")("globals.accept"):e.confirmLabel,i=void 0===e.cancelLabel?b("translate")("globals.cancel"):e.cancelLabel,j=void 0===e.showConfirmBtn?!0:"true"==e.showConfirmBtn,k=void 0===e.showCancelBtn?!0:"true"==e.showCancelBtn,l=e.onConfirm,m=e.onCancel,c.showAlert({scope:a,message:f,title:g,confirmLabel:h,cancelLabel:i,showConfirmBtn:j,showCancelBtn:k,confirmFn:l,cancelFn:m})})}}}]).directive("dashboardWidget",function(){return{restrict:"E",replace:!0,template:'<div class="widget-container"><div class="widget-header"><h5>{{title}}</h5></div><div class="widget-content"><data-ng-include src="widgetUrl"/></div></div>',scope:{widgetUrl:"@",title:"@"}}}).directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}).directive("uiResizable",function(){return{restrict:"A",link:function(a,b,c){b.addClass("ui-resizable");var d=void 0===c.uiDirection?"e":c.uiDirection;b.resizable({handles:d})}}}).directive("uiDraggable",["$rootScope",function(a){return{restrict:"A",link:function(b,c,d){c.draggable({appendTo:".body",revert:!0,revertDuration:0,cursor:"move",cursorAt:{top:0,left:0},start:function(b,c){a.$emit("dragStart")},stop:function(b,c){a.$emit("dragStop")}}),c.on("mousedown",function(){void 0!==d.dragHelper&&c.draggable("option","helper",function(a){return $(d.dragHelper)}),c.draggable("option","appendTo","body")}),b.$watch(d.dragEnabled,function(a){c.draggable(a?"enable":"disable"),"userToEnterprise"==d.dragType&&(c[0].style.opacity=1)})}}}]).directive("uiDroppable",function(){return{restrict:"A",link:function(a,b,c){var d;b.droppable({tolerance:"pointer",hoverClass:"drop-active",activeClass:"ui-state-highlight",accept:function(e){e&&e.data&&e.data("$scope")&&(d=e.data("$scope").$eval(e[0].getAttribute("data-drag-object")));var f=a.$eval(c.dropObject),g=a.$eval(c.dropAcceptListener);if(g&&angular.isFunction(g)){var h=e[0].getAttribute("data-drag-type"),i=b[0].getAttribute("data-drop-type");return(h||i)&&h!=i?(console.log("Drop rejected due diferent types: drag-type is",h,"and drop-type is",i),!1):g(e,b,f)}return!1},drop:function(e,f){var g=a.$eval(c.dropObject),h=a.$eval(c.uiDroppable);if(h&&angular.isFunction(h)){var i=angular.element(f.draggable);h(i,b,g,e,d)}}})}}}).directive("selectAllCheckbox",function(){return{replace:!0,restrict:"E",scope:{checkboxes:"=",allselected:"=allSelected",allclear:"=allClear",labelText:"=",change:"&"},template:'<div class="checkbox-inline-container"><input type="checkbox" u-checkbox id="selec-all" data-ng-model="master" data-ng-change="masterChange()"><label class="checkbox inline" for="selec-all"><span></span> {{labelText}}</label></div>',link:function(a,b){a.masterChange=function(){a.master?angular.forEach(a.checkboxes,function(a,b){a.clientData.selected=!0}):angular.forEach(a.checkboxes,function(a,b){a.clientData.selected=!1}),a.change()},a.$watch("checkboxes",function(){var c=!1,d=!1;a.checkboxes&&a.checkboxes.length>0&&(c=!0,d=!0,angular.forEach(a.checkboxes,function(a){a.clientData.selected?d=!1:c=!1})),void 0!==a.allselected&&(a.allselected=c),void 0!==a.allclear&&(a.allclear=d),b.prop("indeterminate",!1),c?a.master=!0:d?a.master=!1:(a.master=!1,b.prop("indeterminate",!0))},!0)}}}).directive("uCheckbox",function(){return{restrict:"A",link:function(a,b){a.$watch(function(){var a=b.is(":checked");return a},function(a){a?b.addClass("checked"):b.removeClass("checked")})}}}).directive("uRadio",function(){return{restrict:"A",link:function(a,b,c,d){function e(){var a=b.closest(".radio-container"),c=a.children("label");c.removeClass("checked"),c.find("input:checked").closest(".radio").addClass("checked")}b.change(e),e()}}}).directive("nbSrc",["$http",function(a){return{priority:0,link:function(a,b,c){c.$observe("nbSrc",function(c){c?b.find("img").error(function(){b.find("img").hide()}).load(function(){b.removeClass("default-cover"),a.$apply(function(){a.loadImage=!0})}).attr("src",c):b.find("img").hide()})}}}]).directive("copyToClipboard",function(){return{link:function(a,b,c){b.zclip({path:"lib/utils/ZeroClipboard.swf",copy:function(){var b=a.$eval(c.copyToClipboard);return angular.toJson(b)}})}}}).directive("uSlider",["safeApply",function(a){return{restrict:"A",scope:{slider:"@",ngModel:"=",min:"=",max:"=",step:"="},link:function(b,c,d){c.slider({change:function(c,d){b.ngModel=d.value,a(b)},min:0}),b.$watch("ngModel",function(a,b){c.slider("option","value",a)}),b.$watch("min",function(a,b){}),b.$watch("max",function(d){c.slider("option","max",d),d<c.slider("option","value")&&(b.ngModel=d,a(b))}),b.$watch("step",function(a){c.slider("option","step",a)})}}}]).directive("focus",["$timeout",function(a){return{link:function(b,c,d,e){a(function(){c[0].focus()},500)}}}]).directive("passwordVerify",function(){return{require:"ngModel",scope:{passwordVerify:"=",passwordCurrent:"="},link:function(a,b,c,d){a.checkPasswords=function(b){return a.passwordCurrent!==a.passwordVerify?(d.$setValidity("passwordCurrent",!1),void d.$setValidity("passwordVerify",!1)):(d.$setValidity("passwordCurrent",!0),d.$setValidity("passwordVerify",!0),b)},a.$watch("passwordVerify",function(b){a.checkPasswords(b)}),a.$watch("passwordCurrent",function(b){a.checkPasswords(b)})}}}).directive("fileUpload",function(){"use strict";return{restrict:"E",transclude:!1,controller:function(a,b,c){var d=c.formName;a[d].formFiles=[],a.saveFiles=function(b,c){angular.forEach(c,function(c){var e=new FileReader,f={name:angular.element(b).attr("name"),file:c};e.onload=function(b){a.$apply(function(){a[d].formFiles.push(f)})},e.readAsDataURL(c)})},a.uploadFile=function(){b.find("[type=file]").click()}},compile:function(){return{pre:function(a,b,c,d){b.find("[type=file]").bind("change",function(b){a.saveFiles(this,b.target.files)})}}}}}).directive("validFile",function(){return{require:"ngModel",link:function(a,b,c,d){d.$render=function(){d.$setViewValue(b.val())},b.bind("change",function(){a.$apply(function(){d.$render()})})}}}).directive("uBlockedElement",["configMgr",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(c){a.userInterface.blocked?(c.stopPropagation(),c.preventDefault()):"input"==c.currentTarget.localName&&"submit"==c.currentTarget.type&&b.onSubmit()}),b.$watch(function(){return a.userInterface.blocked},function(a){c.attr("u-blocked-element-is-blocked",a.toString())})}}}]).directive("tooltipGetFromContent",["$compile",function(a){return{restrict:"A",link:function(b,c,d){c.on("mouseover",function(){!c.attr("data-tooltip")&&c[0].scrollWidth>c[0].offsetWidth&&(c.removeAttr("tooltip-get-from-content"),c.removeAttr("data-tooltip-get-from-content"),c.attr("data-tooltip",c.text()),c.replaceWith(a(c)(b)))})}}}]).directive("uDividerHorizontal",function(){return{restrict:"A",replace:!0,link:function(a,b){b.draggable({axis:"y",containment:"parent",helper:"clone",drag:function(a,c){var d=c.offset.top;b.prev().height(d)}})},template:'<div class="resizable-divider-horizontal"><i class="icon-ellipsis-horizontal"></i></div>'}}).directive("uDividerVertical",["$timeout",function(a){return{restrict:"A",replace:!0,link:function(b,c,d){function e(a){var b;return a&&(b=a[0]&&"none"==a[0].style.display,b=b||a.hasClass("ng-hide")),b}function f(a){for(var b=a.prev();e(b);)b=b.prev();return b}function g(a){for(var b=a.next();e(b);)b=b.next();return b}function h(a){for(var b=a.parent();"DATA-NG-INCLUDE"==b[0].nodeName||"NG-INCLUDE"==b[0].nodeName;)b=b.parent();return b[0]}var i=d.minFirstElementSize?d.minFirstElementSize:100,j=d.minSecondElementSize?d.minSecondElementSize:100;c.draggable({axis:"x",containment:"document",helper:"clone",drag:function(b,d){var e=f(c),k=g(c),l=h(c),m=d.position.left;console.log("position:",d.position.left,d.position.top);var n=l.offsetWidth,o=c[0].offsetWidth,p=n-o-j;console.log("parent width:",n),m>p&&(m=p),i>m&&(m=i),e.css("width",m+"px"),m=e[0].offsetWidth;var q=m+o;k.css("width","calc(100% - "+q+"px)"),k.css("width","-webkit-calc(100% - "+q+"px)"),a(function(){$(window).trigger("resize")},1)}})},template:'<div class="resizable-divider-vertical" data-drag-type="u-directive-vertical"><i class="icon-ellipsis-vertical"></i></div>'}}]).directive("uCollapserHorizontal",["$timeout",function(a){return{restrict:"A",replace:!0,link:function(b,c,d){function e(a){for(var b=a.prev();b&&b[0]&&"none"==b[0].style.display;)b=b.prev();return b}var f=d.expandedSize?d.expandedSize:186;c.bind("click",function(){var b,d=c[0].offsetHeight,g=e(c);c.hasClass("collapser-expanded")?(c.removeClass("collapser-expanded"),c.addClass("collapser-collapsed"),b=d,g.css("height","calc(100% - "+b+"px)"),g.css("height","-webkit-calc(100% - "+b+"px)"),c.next().css("display","none")):(c.removeClass("collapser-collapsed"),c.addClass("collapser-expanded"),b=d+f,g.css("height","calc(100% - "+b+"px)"),g.css("height","-webkit-calc(100% - "+b+"px)"),c.next().css("display","inline-block")),a(function(){$(window).trigger("resize")},1)})},template:'<div class="collapser-horizontal collapser-expanded"><i class="icon-collapse"></i></div>'}}]).directive("uMbInput",["utils",function(a){return{restrict:"A",scope:{isEditable:"=",inputObject:"=",inputObjectParameter:"=",inputInBytes:"="},link:function(b,c,d){function e(){b.inputObject[b.inputObjectParameter]=b.inputValue*f}var f=1;b.inputInBytes&&(f=1048576),b.unitsSelector=angular.copy(a.unitsSelector),b.$watch("inputObject",function(c,d){var e=b.inputObject[b.inputObjectParameter]/f;if(b.inputValue!=e){var g=angular.copy(a.getUnitSelectorForMB(e));b.selectedUnit=g.conversion,b.inputValueFormatted=Math.round(e/g.conversion*100)/100,b.inputValue=e}},!0),b.$watch("inputValueFormatted",function(a,c){a!=c&&(b.inputValue=a*b.selectedUnit,e())}),b.$watch("selectedUnit",function(a,c){a!=c&&(b.inputValue=b.inputValueFormatted*a,e())})},template:'<div class="row-fluid"><span class="span12" data-ng-hide="isEditable">{{ inputObject[inputObjectParameter] | sizeUnit:true }}</span><div class="row-fluid span12" data-ng-show="isEditable"><input class="span7" style="float:left;" data-ng-model="inputValueFormatted"><select class="span5" ui-select2 data-ng-model="selectedUnit"><option data-ng-repeat="unit in unitsSelector" value="{{unit.conversion}}">{{unit.label}}</option></select></div></div>'}}]).directive("numeric",[function(){return{restrict:"A",link:function(a,b,c){b.keypress(function(a){if(console.log(a.charCode),46==a.charCode);else if(a.charCode<48||a.charCode>57)return!1})}}}]).directive("allocationLimitLink",["utils","$timeout",function(a,b){return{restrict:"A",scope:{allocationLimitLink:"=",softLimitParameter:"=",hardLimitParameter:"="},link:function(c,d,e){c.$watch(function(){return c.allocationLimitLink[c.hardLimitParameter]},function(){d[0].value=c.allocationLimitLink[c.hardLimitParameter]}),d[0].onchange=function(d){var e=parseInt(d.currentTarget.value),f=parseInt(c.allocationLimitLink[c.softLimitParameter]);c.allocationLimitLink[c.hardLimitParameter]=e,c.allocationLimitLink?(e>0&&f>e||0==f||isNaN(f))&&b(function(){c.allocationLimitLink[c.softLimitParameter]=e,a.refreshLayout()},100):console.log("WARNING: Directive allocationLimitLink has no value."),a.refreshLayout()}}}}]).directive("uAutocomplete",["utils",function(a){return{restrict:"A",scope:{uAutocompleteData:"=",uAutocompleteDataParameterLabel:"=",uAutocompleteDataParameterValue:"=",uAutocompleteDataParameterId:"=",uAutocompleteShowArrow:"=",uAutocompleteSelect:"&"},link:function(b,c,d){function e(b,c,d,e){for(var f=[],g=0;g<b.length;g++){var h=b[g],i=a.getObjectAttributeValue(h,c),j=a.getObjectAttributeValue(h,d),k=a.getObjectAttributeValue(h,e);f.push({label:i,value:j,id:k,item:h})}return f}function f(){$(this).keydown()}function g(){var d=b.uAutocompleteData;if(b.uAutocompleteData&&b.uAutocompleteData.length>0&&b.uAutocompleteDataParameterLabel&&b.uAutocompleteDataParameterValue&&(d=e(b.uAutocompleteData,b.uAutocompleteDataParameterLabel,b.uAutocompleteDataParameterValue,b.uAutocompleteDataParameterId)),d&&d.length>0){var g={source:d,minLength:0,select:function(c,d){b.uAutocompleteSelect&&(d.item&&d.item.item?b.uAutocompleteSelect({selectedItem:d.item.item}):b.uAutocompleteSelect({selectedItem:d.item})),a.refreshLayout()}};c.autocomplete(g).on("click",f)}}d.hasOwnProperty("uAutocompleteShowArrow")&&c.after('<small class="ui-autocomplete-selector-arrow"></small>'),b.$watch("uAutocompleteData",g),b.$watch("uAutocompleteDataParameterLabel",g),b.$watch("uAutocompleteDataParameterValue",g),b.$watch("uAutocompleteDataParameterId",g)}}}]).directive("uDoubleClick",function(){return{restrict:"A",link:function(a,b,c){function d(){a.$eval(c.uDoubleClick)}function e(b){var c=(new Date).getTime(),e=c-a.uDoubleClick.lastTap;clearTimeout(a.uDoubleClick.timeout),a.uDoubleClick.lastTap>0&&e>0&&500>e?(b.preventDefault(),d()):a.uDoubleClick.timeout=setTimeout(function(){clearTimeout(a.uDoubleClick.timeout)},500),a.uDoubleClick.lastTap=c}a.uDoubleClick||(a.uDoubleClick={}),a.uDoubleClick.lastTap=0,b[0].addEventListener("touchend",function(a){e(a)}),b[0].addEventListener("dblclick",function(a){d()})}}}).directive("dropdownMenu",function(){return{restrict:"CA",link:function(a,b,c){var d=function(a){var b=$(a.target);b.hasClass("dropdown-close-menu-button")||a.stopPropagation()};b.bind("click",d)}}}).directive("uiSelectDropdownFixed",["utils",function(a){return{restrict:"A",link:function(b,c,d){var e=function(b){for(var c,d=0;d<b.childNodes.length;d++){var e=b.childNodes[d];if(a.elementHasClass(e,"select2-drop")){c=e;break}}return c},f=function(a){var b;if(a){var c=a.getBoundingClientRect();b=c.bottom+"px"}return b},g=function(a){var b=e(a);b.style.width=a.clientWidth+"px",b.style.top=f(a)},h=e(c[0]);h.style.position="fixed",b.$watch(function(){return a.elementHasClass(c[0],"select2-dropdown-open")},function(a){a&&g(c[0])})}}}]).directive("uiSelectClearButton",function(){return{restrict:"E",link:function(a,b,c){var d=function(a){a.stopPropagation()};b.bind("click",d)},template:'<i class="icon-remove ui-select-clear-button"></i>'}}).directive("uValidatorEmail",[function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){var e=new RegExp("[a-z0-9A-Z!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9A-Z!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9A-Z](?:[a-z0-9A-Z-]*[a-z0-9A-Z])?\\.)+[a-z0-9A-Z](?:[a-z0-9A-Z-]*[a-z0-9A-Z])?");d.$parsers.unshift(function(a){var b=e.test(a);return d.$setValidity("regexValidate",b),b?a:void 0}),d.$formatters.unshift(function(a){return d.$setValidity("regexValidate",e.test(a)),a})}}}]),angular.module("abiquo.services",["themeMgr","authenticationMgr","userMgr","statisticsMgr","datacentersMgr","storageDevicesMgr","storagePoolsMgr","allocationRulesMgr","remoteServicesMgr","serversMgr","virtualDatacentersMgr","virtualAppliancesMgr","virtualMachinesMgr","virtualMachineTemplatesMgr","layersMgr","networksMgr","volumesMgr","backupsMgr","workflowMgr","eventsMgr","navigationMgr","privilegesMgr","systemPropertiesMgr","commonsMgr","pricingMgr","costCodesMgr","currenciesMgr","enterprisesMgr","usersMgr","rolesMgr","scopesMgr","tiersMgr","notificationsMgr","configMgr","firewallsMgr","loadBalancersMgr","monitoringMgr","stepByStepMgr","loggerMgr","server","modals","utils","urlParametersUtils","gridTemplates","refreshMgr","ui.select","google-maps","paginationHelper","routeParamsHelper","dispatcher","toastr"]),angular.module("abiquo.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]).filter("ceil",function(){return function(a){return Math.ceil(a)}}).filter("ceilPaginator",function(){return function(a){var b=Math.ceil(a);return 1>b&&(b=1),b}}).filter("isGranted",["privilegesMgr",function(a){return function(b){return a.isGranted(b)}}]).filter("selected",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.clientData.selected&&b.push(a)}),b}}).filter("enabled",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.enabled&&b.push(a)}),b}}).filter("name",["utils",function(a){return function(b){var c="All";return!a.isEmptyObject(b)&&b.name&&(c=b.name),c}}]).filter("isNotRead",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.read||b.push(a)}),b}}).filter("hypervisorTypeDiscriminateFilter",["server","utils",function(a,b){return function(c){var d=[];return angular.forEach(c,function(c){var e=a.getLinkByRel(c.links,"regions");b.isEmptyObject(e)&&d.push(c)}),d}}]).filter("vmCategoryFilter",function(){return function(a,b){var c=[];return void 0===b?a:(angular.forEach(a,function(a){a.clientData&&a.clientData.virtualMachineTemplate&&(void 0===a.clientData.virtualMachineTemplate.clientData.category||a.clientData.virtualMachineTemplate.clientData.category.id!==b.id||a.clientData.layer||a.clientData.toBeRemoved||c.push(a))}),c)}}).filter("vmtCategoryFilter",function(){return function(a,b){var c=[];return void 0===b||"0"==b.id?a:(angular.forEach(a,function(a){a.category.id===b.id&&c.push(a)}),c)}}).filter("existingCategoriesFilter",function(){return function(a){var b=[];return angular.forEach(a,function(a){0!=a.id&&b.push(a)}),b}}).filter("vmtMasterFilter",["utils","$filter",function(a,b){return function(c,d){var e=[];return void 0!==c&&angular.forEach(c,function(f){if(a.isEmptyObject(f.clientData.master))(d.failed&&"FAILED"==f.state||d.inProgress&&"IN_PROGRESS"==f.state||d.deletedMasters&&"UNAVAILABLE"==f.state||"DONE"==f.state)&&e.push(f);else{var g=b("getElementByParameter")(c,{element:parseInt(f.clientData.master.id),attribute:"id"});d.deletedMasters||"UNAVAILABLE"!=g.state||e.push(f)}}),e}}]).filter("vmtSlaveFiltersForMaster",["utils",function(a){return function(b,c,d){var e=[];return void 0!==b&&angular.forEach(b,function(b){b.clientData&&!a.isEmptyObject(b.clientData.master)&&b.clientData.master.id==c&&(d.failed&&"FAILED"==b.state||d.inProgress&&"IN_PROGRESS"==b.state||d.deletedMasters&&"UNAVAILABLE"==b.state||"DONE"==b.state)&&e.push(b)}),e}}]).filter("vmLayerFilter",function(){return function(a,b){var c=[];return void 0!==b&&angular.forEach(a,function(a){a.clientData&&a.clientData.layer&&a.clientData.layer.name===b.name&&c.push(a)}),c}}).filter("isValidLayerName",function(){return function(a,b,c){var d=!0;return void 0!==b&&angular.forEach(a,function(a){return a.name===b?d=c&&c===b?!0:!1:void 0}),d}}).filter("vmStateFilter",function(){return function(a,b){var c=[];return void 0!==b&&angular.forEach(a,function(a){a.state&&a.state===b&&c.push(a)}),c}}).filter("vmSearchFilter",["utils",function(a){return function(a,b){var c=[];return angular.forEach(a,function(a){var d=a.name&&-1!=a.name.indexOf(b);d&&c.push(a)}),c}}]).filter("linkCategory",["server","utils",function(a,b){return function(c,d){var e=[];return!d||void 0===d||b.isEmptyObject(d)?e=c:angular.forEach(c,function(b){var c=a.getLinkByRel(b.links,"category");c.title==d&&e.push(b)}),e}}]).filter("userStateFilter",["usersMgr","$filter","utils",function(a,b,c){return function(a,b){var c=[];return"all"==b||"logged"==b?c=a:angular.forEach(a,function(a){"activated"===b?a.active&&c.push(a):"suspend"===b&&(a.active||c.push(a))}),c}}]).filter("userStateLabel",["$filter",function(a){return function(b){return b.active?a("translate")("user.state.active"):a("translate")("user.state.suspended")}}]).filter("sizeUnit",["utils",function(a){return function(b,c,d){return b?a.returnSizeUnit(b,c,d):"-"}}]).filter("MBtoGB",function(){return function(a){var b="0";return a&&(b=(a/1024).toFixed(1).toString()),b}}).filter("BtoGB",function(){return function(a){var b="0";return a&&(b=(a/1073741824).toFixed(1).toString()),b}}).filter("BtoMB",function(){return function(a){var b="0";return a&&(b=(a/1048576).toFixed(1).toString()),b}}).filter("isZero",function(){return function(a){return!0}}).filter("roundToTen",function(){return function(a){return a/10%1===0?a:isNaN(a)?"0":(10*(parseInt(a/10)+1)).toString()}}).filter("isEmptyObject",["utils",function(a){return function(b){return a.isEmptyObject(b)}}]).filter("isEmptyORDone",function(){return function(a){return jQuery.isEmptyObject(a)||"DONE"!=a.state}}).filter("getElementByParameter",["utils",function(a){return function(b,c){var d={};return angular.forEach(b,function(b){var e;e=c.subCollection?b[c.subCollection]:[b],angular.forEach(e,function(e){var f=a.getObjectAttributeValue(e,c.attribute);f===c.element&&(d=b,c.returnedAttribute&&!a.isEmptyObject(a.getObjectAttributeValue(e,c.returnedAttribute))&&(d=a.getObjectAttributeValue(e,c.returnedAttribute)))})}),d}}]).filter("getElementById",["$filter",function(a){return function(b,c){var d=a("getElementByParameter")(b,{element:c,attribute:"id"});return d}}]).filter("arrayContains",["$filter","$filter","utils",function(a,a,b){return function(c,d,e){var f=a("getElementByParameter")(c,{element:d,attribute:e}),g=!b.isEmptyObject(f);return d==a("translate")("virtualmachine.edit.network.unmanagedip")&&(g=!1),g}}]).filter("returnTotalNumber",function(){return function(a,b){var c=0,d=new Date;return angular.forEach(a,function(a){var e=a.expiration.replace(/-/g,"/"),f=new Date(e);f>d?c+=a[b]:a.clientData.expired=!0}),c}}).filter("isLicensed",["$filter","server","utils",function(a,b,c){return function(d,e){var f=!1,g=new Date;return angular.forEach(d,function(d){var h=d.expiration.replace(/-/g,"/"),i=new Date(h);if(i>g)if(d.numcores>0)f=!0;else{var j=d.enabledPlugins.split(",");angular.forEach(j,function(d){var g=a("getElementByParameter")(e,{element:d,attribute:"name"}),h=b.getLinkByRel(g.links,"regions");c.isEmptyObject(h)||(f=!0)})}}),f}}]).filter("returnUnitSizes",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){"MB"===a.label?b&&c.push(a):c.push(a)}),c}}).filter("timestampToString",["utils",function(a){return function(b,c){var d="";return d=c?a.timestampToDateString(b):a.timestampToDateString(1e3*b)}}]).filter("monitoringTimestampToString",["utils",function(a){return function(b,c){var d="",e=a.timestampToDate(b);return d="days"==c?a.dateToString(e):a.dateToTimeString(e)}}]).filter("filterByConversionType",["utils",function(a){return function(b,c){var d=[];return angular.forEach(b,function(b){"master"==c?a.isEmptyObject(b.clientData.master)&&"DONE"==b.state&&d.push(b):"instance"==c&&(a.isEmptyObject(b.clientData.master)||"DONE"!=b.state||d.push(b))}),d}}]).filter("groupMasterWithInstances",["utils","$filter",function(a,b){return function(c){var d=[];return angular.forEach(c,function(e){if(a.isEmptyObject(e.clientData.master)){var f=b("vmtSlaveFiltersForMaster")(c,e.id,{});("DONE"==e.state||f&&f.length>0)&&d.push(e)}}),d}}]).filter("filterPendingTasks",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.clientData&&a.clientData.tasks&&a.clientData.tasks.length>0&&b.push(a)}),b}}).filter("filterCurrentJobInTask",function(){return function(a){var b=[];return a.jobs&&angular.forEach(a.jobs.collection,function(a){"PENDING"!=a.state&&b.push(a)}),b}}).filter("chargingPeriod",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){b?a.id>=2&&c.push(a):c.push(a)}),c}}).filter("available",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.available&&b.push(a)}),b}}).filter("notAvailable",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.available||b.push(a)}),b}}).filter("prohibitedItems",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){var d=!1;angular.forEach(b,function(b){return a.id==b.id?void(d=!0):void 0}),d||c.push(a)}),c}}).filter("prohibitedLimits",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){var d=!1;angular.forEach(b,function(b){return b.clientData&&a.id==b.clientData.datacenter.id?void(d=!0):void 0}),d||c.push(a)}),c}}).filter("availableMachines",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){var d=!1;angular.forEach(b,function(b){return a.id==b.id?void(d=!0):void 0}),d||c.push(a)}),c}}).filter("networkServiceTypesFilter",function(){return function(a){var b=[];return angular.forEach(a,function(a){
0!==a.id&&b.push(a)}),b}}).filter("filterExcludeArrayData",["utils","$filter",function(a,b){return function(c,d,e,f){f||(f=e);var g=[];return angular.forEach(c,function(c){var h=b("getElementByParameter")(d,{element:c[e],attribute:f});a.isEmptyObject(h)&&g.push(c)}),g}}]).filter("filterBy",["utils",function(a){return function(b,c,d){var e=[];return angular.forEach(b,function(b){var f=a.isEmptyObject(c.value),g=a.getObjectAttributeValue(b,c.criteria);f=f||c.value==g,d&&c.value&&g&&"string"==typeof c.value&&(f=-1!=g.toLowerCase().indexOf(c.value.toLowerCase())),f&&e.push(b)}),e}}]).filter("scopeEntityType",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.type==b&&c.push(a)}),c}}).filter("max",function(){return function(a,b){return Math.max(a,b)}}).filter("filterSelected",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.selected&&b.push(a)}),b}}).filter("filterSelectedClientData",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.clientData&&a.clientData.selected&&b.push(a)}),b}}).filter("filterHasSelectedClientData",function(){return function(a){var b=!1;return a&&a.length>0&&a.every(function(a){return a.clientData&&a.clientData.selected?(b=!0,!1):!0}),b}}).filter("filterHasOnlyOneSelectedClientData",["$filter",function(a){return function(b){var c=a("filterSelectedClientData")(b),d=c&&1==c.length;return d}}]).filter("filterIndividualComponents",["$filter",function(a){return function(b,c){var d=[];return angular.forEach(b,function(b){(c||b.clientData.type!=a("translate")("virtualmachine.edit.chef.grid.label.recipe"))&&d.push(b)}),d}}]).filter("filterByHypervisor",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.clientData.virtualDatacenter.hypervisorType==b.type&&c.push(a)}),c}}).filter("filterByTag",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.tag&&a.tag!=b||c.push(a)}),c}}).filter("filterByVirtualMachineCategory",["$filter",function(a){return function(b,c){var d=a("getElementByParameter")(b,{element:"0",attribute:"id"}),e=a("filterBy")(b,{value:c,criteria:"name"},!0);return $.inArray(d,e)&&e.unshift(d),e}}]).filter("iif",function(){return function(a,b,c){return a?b:c}}).filter("iifTranslate",["$filter",function(a){return function(b,c,d){var e=b?c:d;return e?a("translate")(e):""}}]).filter("virtualMachineStatusTaskLang",["utils",function(a){function b(a){var b;return a&&a.forEach(function(a){return!b&&a&&"DONE"!=a.state&&"FAILED"!=a.state?void(b=a):void 0}),b}return function(c,d){var e="globals.void";if(d&&c){var f;if(d.forEach(function(a){return a&&a.ownerId==c.id?void(f=a):void 0}),f){if("QUEUEING"==f.state||"FINISHED_UNSUCCESSFULLY"==f.state||"ABORTED"==f.state)e="virtualappliance.status."+f.state;else if("FINISHED_SUCCESSFULLY"==f.state)e="virtualappliance.type."+f.type;else if(f.jobs){var g=b(f.jobs.collection);e=g?"virtualappliance.status."+g.type:"virtualappliance.FINISHING"}"virtualappliance.status.SCHEDULE"!=e||a.isEmptyObject(c.clientData.hardwareProfile)||(e+=".public")}}return e}}]).filter("virtualMachineHasErrors",function(){function a(a){var b;return a&&a.forEach(function(a){return!b&&a&&"DONE"!=a.state&&"FAILED"!=a.state?void(b=a):void 0}),b}return function(b,c){var d=!1;if(c&&b){var e;if(c.forEach(function(a){return a&&a.ownerId==b.id?void(e=a):void 0}),e){if("FINISHED_UNSUCCESSFULLY"==e.state||"ABORTED"==e.state)d=!0;else if("QUEUEING"==e.state||"FINISHED_SUCCESSFULLY"==e.state)d=!1;else if(e.jobs){var f=a(e.jobs.collection);f&&(d="FINISHED_UNSUCCESSFULLY"==f.state||"ABORTED"==f.state)}d&&(b.clientData.errorTask=e)}}return d}}).filter("filterFirewallRules",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a[b]&&a[b].length>0&&c.push(a)}),c}}).filter("returnRuleDestination",function(){return function(a){var b="",c=a.sources&&a.sources.length>0?a.sources:a.targets;return angular.forEach(c,function(a){b+=" "+a+","}),b.slice(0,b.length-1)}}).filter("filterVolumeIsAvailable",["$filter","utils",function(a,b){return function(c,d){var e=[];return angular.forEach(c,function(c){var f="DETACHED"==c.clientData.temporalState&&!c.clientData.isPersistent;d=a("filterBy")(d,{value:"VOLUME",criteria:"clientData.virtualDiskType"}),f=f&&b.isEmptyObject(a("getElementByParameter")(d,{element:c.id,attribute:"id"})),f&&e.push(c)}),e}}]).filter("filterIpv6Netmasks",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){b?a.index>8&&c.push(a):a.index<=8&&c.push(a)}),c}}).filter("filterPrivateLocations",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){"0"==b?a.clientData.isPublicDatacenter&&c.push(a):"private"==b?a.clientData.datacenter.isPublicDatacenter||c.push(a):c.push(a)}),c}}).filter("operationIsGranted",["commonsMgr",function(a){return function(b,c,d,e){return a.isOperationGranted(b,c,d,e)}}]).filter("filterAddresses",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){b["public"]&&0==a.internal&&c.push(a),b["private"]&&1==a.internal&&c.push(a)}),c}}).filter("filterAttachedVirtualMachines",function(){return function(a,b,c){var d=[];return angular.forEach(a,function(a){var e=!1;angular.forEach(b,function(b){return a.id==b.id?void(e=!0):void 0}),c&&e?d.push(a):c||e||"ON"!=a.state&&"PAUSED"!=a.state||d.push(a)}),d}}).filter("filterExistingObjects",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.clientData&&a.clientData.toBeDeleted||b.push(a)}),b}}).filter("orderPrivilegeGroups",function(){return function(a,b){var c=[];return angular.forEach(b,function(b){c.push(a[b])}),c}}).filter("filterAvailableVirtualMachineMetrics",function(){return function(a,b){var c=[];return angular.forEach(a,function(a){var d=!1;angular.forEach(b,function(b){b.metadata&&b.metadata.metadata["monitoring-metrics"]&&angular.forEach(b.metadata.metadata["monitoring-metrics"],function(b){b.name==a.name&&(d=!0)})}),d&&c.push(a)}),c}}).filter("orderByRecommended",function(){return function(a,b){var c=[],d=[];return angular.forEach(a,function(a){var e=!1;angular.forEach(b,function(b){"hardwareprofile"==b.rel&&b.title==a.providerId&&(c.push(a),e=!0)}),e||d.push(a)}),c.concat(d)}}).filter("isTutorialRunning",["stepByStepMgr",function(a){return function(){return a.tutorialIsRunning()}}]).filter("filterByRestored",function(){return function(a){var b=[];return angular.forEach(a,function(a){if(a.restore){var c=angular.copy(a.restoreInfo);c.restore=a.restore,b.push(c)}}),b}}).filter("filterExistingPcr",["$filter","utils",function(a,b){return function(c,d){var e=[];return angular.forEach(c,function(c){var f=a("getElementByParameter")(d,{element:c.name,attribute:"clientData.providerName"});b.isEmptyObject(f)&&(c.constraints&&"MANDATORY"==c.constraints.endpoint?c.clientData.existingPcr&&e.push(c):e.push(c))}),e}}]).filter("canBackupDoRestore",["utils",function(a){return function(b){var c=!1;return b&&(c=!a.isEmptyObject(b.status)&&("done"===b.status.toLowerCase()||"completed"===b.status.toLowerCase()),c=c&&(a.isEmptyObject(b.restoreInfo)||!a.isEmptyObject(b.restoreInfo.result)&&("success"===b.restoreInfo.result.toLowerCase()||"failed"===b.restoreInfo.result.toLowerCase()))),c}}]).filter("addToFirst",["utils",function(a){return function(b,c){return a.isEmptyObject(b)&&(b=[c]),b.length>0&&!angular.equals(c,b[0])&&b.unshift(c),b}}]).filter("displayWikiLinkHelp",["systemPropertiesMgr",function(a){return function(b){return"client.wiki.defaultURL"==b?a.systemProperties.wikiLinks["client.wiki.defaultURL"].value:"1"==a.systemProperties.wikiLinks[b].value}}]),angular.module("allocationRulesMgr",["server"]).factory("allocationRulesMgr",["server","$filter","utils","dispatcher",function(a,b,c,d){function e(a){angular.copy(a,n)}function f(a){angular.copy(a,o)}function g(a){l(),h(),r=a.id,a.id&&i(a.id)}function h(){p.length=0;var c={type:"application/vnd.abiquo.rules+json",path:"admin/rules/?global=true"};a.get(c,function(c){angular.forEach(c.fitPolicyRules.collection,u),angular.forEach(c.enterpriseExclusionRules.collection,function(c){var d={links:c.links,rel:"enterprise",title:"enterprise1"};a.getByRel(d,function(e){d={links:c.links,rel:"enterprise",title:"enterprise2"},a.getByRel(d,function(a){var d=b("translate")("allocationrules.type.enterpriseexclusionrule"),f=b("translate")("allocationrules.type.enterpriseexclusionrule.description",{enterprise1:e.name,enterprise2:a.name});p.push(new t(c,d,f))})})})},function(a){})}function i(c){q.length=0;var d={type:"application/vnd.abiquo.rules+json",path:"admin/rules?idDatacenter="+c};a.get(d,function(c){angular.forEach(c.fitPolicyRules.collection,v),angular.forEach(c.machineLoadRules.collection,function(c){var d=b("translate")("allocationrules.col.description.racks"),e=b("translate")("allocationrules.col.description.machines"),f=a.getLinkByRel(c.links,"rack");if(""!==f){var g={links:c.links,rel:"rack"};a.getByRel(g,function(b){d=b.name;var f=a.getLinkByRel(c.links,"machine");""!==f?(g={links:c.links,rel:"machine"},a.getByRel(g,function(a){e=a.name,x(c,d,e)})):x(c,d,e)})}else x(c,d,e)})},function(a){})}function j(e,f){var g=function(a){d.dispatch("allocationRule.created",{data:a}),void 0!==f&&f(a),c.toastrSuccess(b("translate")("action.create.success.allocationrule.text"))},h={};switch(e.clientData.ruleType){case b("translate")("allocationrules.type.fitpolicyrule"):h={path:"admin/rules/fitsPolicy",type:"application/vnd.abiquo.fitpolicyrule+json"};break;case b("translate")("allocationrules.type.machineloadrule"):h={path:"admin/rules/machineLoadLevel",type:"application/vnd.abiquo.machineloadrule+json"};break;case b("translate")("allocationrules.type.enterpriseexclusionrule"):h={path:"admin/rules/enterpriseExclusions",type:"application/vnd.abiquo.enterpriseexclusionrule+json"}}a.post(h,e,g)}function k(e,f){var g=function(a){d.dispatch("allocationRule.deleted",{data:a}),void 0!==f&&f(a),c.toastrSuccess(b("translate")("action.delete.success.allocationrule.text"))},h={links:e.links,rel:"edit"};a.removeByRel(h,g)}function l(){c.emptyObject(n),c.emptyObject(o)}var m={},n={},o={},p=[],q=[],r=0,s=[{name:"PERFORMANCE"},{name:"PROGRESSIVE"}],t=function(a,b,c){var d=a;return d.clientData={type:b,description:c},d},u=function(a){w(a,!0)},v=function(a){w(a,!1)},w=function(a,c){var d=b("translate")("allocationrules.type.fitpolicyrule"),e=a.fitPolicy;c?p.push(new t(a,d,e)):q.push(new t(a,d,e))},x=function(a,c,d){var e=b("translate")("allocationrules.type.machineloadrule.description",{racks:c,machines:d,cpu:a.cpuLoadPercentage,ram:a.ramLoadPercentage});q.push(new t(a,b("translate")("allocationrules.type.machineloadrule"),e))};return angular.extend(m,{globalAllocationRules:p,datacenterAllocationRules:q,currentGlobalAllocationRule:n,currentDatacenterAllocationRule:o,loadBalanceTypes:s,addAllocationRule:j,setCurrentGlobalAllocationRule:e,setCurrentDatacenterAllocationRule:f,getAllocationRules:g,deleteAllocationRule:k}),m}]),angular.module("authenticationMgr",[]).factory("authenticationMgr",["server","$cookieStore","$filter","$window","urlParametersUtils","utils",function(a,b,c,d,e,f){var g="4bcl13ntu1",h={credentials:{username:"",password:"",token:"",remember:!1},authenticated:!1,userChoices:{automaticallyOpenServersView:!1,automaticallyOpenVappView:!1,automaticallyOpenTutorials:!0}};return h.getToken=function(){var a=e.getToken();""!==a&&(h.credentials.token=a)},h.getCredentials=function(){if(!h.credentials.password){var a=localStorage.getItem("acredentials");if(a)try{var c=CryptoJS.RC4Drop.decrypt(a,g);h.credentials=JSON.parse(c.toString(CryptoJS.enc.Utf8))}catch(d){console.log("Cannot retrieve the stored credentials.")}}var e=b.get("userChoices");e&&angular.extend(h.userChoices,e)},h.removeCredentials=function(){localStorage.removeItem("acredentials")},h.setCredentials=function(){var a=CryptoJS.RC4Drop.encrypt(JSON.stringify(h.credentials),g).toString();localStorage.setItem("acredentials",a)},h.setUserChoicesCookie=function(){b.put("userChoices",h.userChoices)},h.login=function(b){h.credentials.remember?h.setCredentials():h.removeCredentials();var c={username:h.credentials.username,password:h.credentials.password,token:h.credentials.token,type:"application/vnd.abiquo.login+json",path:"login"};a.login(c,b)},h.logout=function(b,e,f){function g(){document.cookie="auth=;path=/;expires=Thu, 01-Jan-1970 00:00:01 GMT",document.cookie="ABQSESSIONID=;path=/;expires=Thu, 01-Jan-1970 00:00:01 GMT",e&&e.editing||(f&&alert(c("translate")("login.alert.session_expired")),""===b&&h.authenticated?d.location.reload():""!==b&&(d.location.href=b))}a.logout(g)},h.forgetPassword=function(b,d,e,g){var h=function(a){f.toastrSuccess(c("translate")("action.forget.successpassword.text")),void 0!=g&&g()},i={type:"*/*",path:"login/action/newpassword",queryParam:{challenge:b,response:d,user:e}};a.post(i,{},h)},h.resetPassword=function(b,d){var e=function(a){f.toastrSuccess(c("translate")("action.reset.successpassword.text")),void 0!=d&&d()},g={type:"*/*",path:"login/action/reset",queryParam:{resetPasswordToken:b.resetPasswordToken,newPassword:b.newPassword}};a.post(g,{},e)},h.getCredentials(),h}]),angular.module("backupsMgr",[]).factory("backupsMgr",["server","dispatcher","utils","$filter",function(a,b,c,d){function e(a){angular.copy(a,m),b.dispatch("currentBackup.change",{data:m})}function f(b,c){var d=function(b){angular.copy(b.collection,l),l.clientData={},angular.forEach(l,function(b){var c=a.getLinkByRel(b.links,"backup");l.clientData[c.title]=b.attributes.length>0}),void 0!=c&&c()},e={path:"admin/datacenters/"+b+"/backups",type:"application/vnd.abiquo.backups+json"};a.get(e,d)}function g(b){var c=angular.copy(a.getLinkByRel(b.links,"edit"));c.rel="metadata",c.href=c.href+"/metadata",c.type="application/vnd.abiquo.metadata+json";var d={links:[c],rel:"metadata"};a.getByRel(d,r)}function h(a,b){a.hasOwnProperty("defined_hour")&&o[b].push(new p(a.defined_hour,"definedhour",b)),a.hasOwnProperty("hourly")&&o[b].push(new p(a.hourly,"hourly",b)),a.hasOwnProperty("daily")&&o[b].push(new p(a.daily,"daily",b)),a.hasOwnProperty("weekly_planned")&&o[b].push(new p(a.weekly_planned,"weeklyplanned",b)),a.hasOwnProperty("monthly")&&o[b].push(new p(a.monthly,"monthly",b))}function i(b,c,e){var f=function(a){void 0!==e&&e()},g={links:b.links,rel:"metadata"};d("isGranted")("VAPP_DEFINE_BACKUP_INFO")||t(c);var h={links:[],metadata:{backupSchedule:{snapshot:c.snapshot,filesystem:c.filesystem,complete:c.complete},backupResults:{results:c.backupResults}}};a.putByRel(g,h,f)}function j(b,e,f){var g=function(a){s(b,e,f),c.toastrSuccess(d("translate")("backupconfiguration.restore.requested",e))},h={links:b.links,rel:"restorebackup",contentType:"application/vnd.abiquo.restore+json"};a.postByRel(h,e,g)}var k={},l=[],m={},n={},o={snapshot:[],filesystem:[],complete:[]},p=function(a,b,c){var e={type:d("translate")("virtualmachine.edit.backup.create.label."+b),time:a.time,option:d("translate")("virtualmachine.edit.backup.create.filesystem.title")?d("translate")("virtualmachine.edit.backup.create.label.disks"):d("translate")("virtualmachine.edit.backup.create.label.paths"),options:"filesystem"===c?a.paths:a.disks};return e},q=function(a,b,c,d){var e={snapshot:a?a:{},filesystem:b?b:{},complete:c?c:{},backupResults:d?d:[]};return e},r=function(a,b){if(a.metadata){var d=a.metadata.backupSchedule,f=c.getObjectAttributeValue(a,"metadata.backupResults.results");e(new q(d.snapshot,d.filesystem,d.complete,f))}else e(new q({},{},{},[]));o.complete.length=0,o.filesystem.length=0,o.snapshot.length=0,m.hasOwnProperty("snapshot")&&h(m.snapshot,"snapshot"),m.hasOwnProperty("filesystem")&&h(m.filesystem,"filesystem"),m.hasOwnProperty("complete")&&h(m.complete,"complete"),void 0!==b&&b()},s=function(b,e,f){var g=function(a){var b=c.getObjectAttributeValue(a,"metadata.backupResults.results"),g=d("getElementByParameter")(b,{element:e.id,attribute:"id"});angular.copy(g,e),angular.extend(m.backupResults,b),f()},h={links:b.links,rel:"metadata"};a.getByRel(h,g)},t=function(a){a.complete.hasOwnProperty("defined_hour")&&delete a.complete.defined_hour.time,a.complete.hasOwnProperty("hourly")&&delete a.complete.hourly.time,a.complete.hasOwnProperty("daily")&&delete a.complete.daily.time,a.complete.hasOwnProperty("weekly_planned")&&delete a.complete.weekly_planned.time,a.complete.hasOwnProperty("monthly")&&delete a.complete.monthly.time,a.filesystem.hasOwnProperty("defined_hour")&&delete a.filesystem.defined_hour.time,a.filesystem.hasOwnProperty("hourly")&&delete a.filesystem.hourly.time,a.filesystem.hasOwnProperty("daily")&&delete a.filesystem.daily.time,a.filesystem.hasOwnProperty("weekly_planned")&&delete a.filesystem.weekly_planned.time,a.filesystem.hasOwnProperty("monthly")&&delete a.filesystem.monthly.time,a.snapshot.hasOwnProperty("defined_hour")&&delete a.snapshot.defined_hour.time,a.snapshot.hasOwnProperty("hourly")&&delete a.snapshot.hourly.time,a.snapshot.hasOwnProperty("daily")&&delete a.snapshot.daily.time,a.snapshot.hasOwnProperty("weekly_planned")&&delete a.snapshot.weekly_planned.time,a.snapshot.hasOwnProperty("monthly")&&delete a.snapshot.monthly.time};return angular.extend(k,{currentBackup:m,backupOptions:o,backupsSelecteds:n,availableBackupOptions:l,getAvailableBackupOptions:f,getVirtualMachineBackupOptions:g,editVirtualMachineBackupOptions:i,setCurrentBackup:e,restoreBackup:j}),k}]),angular.module("commonsMgr",[]).factory("commonsMgr",["server","utils","$filter","dispatcher",function(a,b,c,d){function e(a){var b=a;return b}function f(b){var c=b;return c.clientData={diskFileFormat:a.getLinkByRel(b.links,"edit").title},c}function g(a){var b=a;return b.clientData={},b}function h(a){var b=a;return b.clientData={},b}function i(){var b=function(a){q.length=0,angular.forEach(a.collection,function(a){var b=new f(a);q.push(b)})},c={path:"config/diskformattypes",type:"application/vnd.abiquo.diskformattypes+json"};a.get(c,b)}function j(){var b=function(a){p.length=0,angular.forEach(a.collection,function(a){var b=new e(a);p.push(b)})},c={path:"config/hypervisortypes",type:"application/vnd.abiquo.hypervisortypes+json"};a.get(c,b)}function k(b){var e=function(a){r.length=0,angular.forEach(a.collection,function(a){a.operations.icloudprovider&&r.push(new g(a))}),angular.extend(r,c("orderBy")(r,"name","false")),d.dispatch("publicproviders.retrieved",{data:a}),void 0!=b&&b()},f={path:"config/hypervisortypes",type:"application/vnd.abiquo.hypervisortypes+json"};a.get(f,e)}function l(b,d,e){var f=function(a){s.length=0,angular.forEach(a.collection,function(a){var b=new h(a);s.push(b)}),angular.extend(s,c("orderBy")(s,"name","false"))},g={links:b.links,rel:"regions"};d&&(g.providerEndpoint=e.clientData.endpoint,g.providerUser=e.clientData.user,g.providerPassword=e.clientData.password),a.getByRel(g,f)}function m(b,c){var d=function(a){t.length=0,angular.forEach(a.collection,function(a){t.push(a)}),void 0!=c&&c()},e={path:"cloud/locations/"+b.clientData.datacenter.id+"/hardwareprofiles",type:"application/vnd.abiquo.hardwareprofiles+json"};a.get(e,d)}function n(a,d,e){var f=c("getElementByParameter")(p,{element:a,attribute:"name"});return b.isEmptyObject(f)?!1:f.operations[d]?e?!f.operations[d][e]:!0:"networking"!=d||f.operations.icloudprovider?!1:!0}var o={},p=[],q=[],r=[],s=[],t=[];return angular.extend(o,{hypervisorTypes:p,diskFormatTypes:q,publicProviders:r,providerRegions:s,hardwareProfiles:t,getHypervisorTypes:j,getDiskFormatTypes:i,getPublicProviders:k,getProviderRegions:l,getHardwareProfiles:m,isOperationGranted:n}),o}]),angular.module("configMgr",[]).factory("configMgr",function(){function a(a){f.blocked=a}function b(a){f.synchronizeVapp=a}var c={},d=CONFIG,e=UIVERSION,f={blocked:!1,synchronizeVapp:!1};return angular.extend(c,{config:d,userInterface:f,UI_VERSION:e,setInterfaceBlocked:a,setSynchronizeVapp:b}),c}),angular.module("costCodesMgr",["server"]).factory("costCodesMgr",["server","$filter","dispatcher","utils",function(a,b,c,d){function e(a){angular.copy(a,n)}function f(c,e,f,g){m.length=0;var h=function(a){angular.forEach(a.collection,function(a){m.push(new q(a))}),c&&d.addFirstItem(m,b("translate")("globals.none")),void 0!==g&&g(a)},i={type:"application/vnd.abiquo.costcodes+json",path:"config/costcodes/",queryParam:{}};angular.extend(i.queryParam,e),angular.extend(i.queryParam,f),a.get(i,h)}function g(e,f){var g=angular.copy(e),h=function(b){j={links:b.links,rel:"currencies"},a.putByRel(j,g.clientData.costCodeCurrencies,i)},i=function(a){void 0!=f&&f(),d.toastrSuccess(b("translate")("action.create.success.costcode.text",{costcode:g.name})),c.dispatch("costcode.created")},j={type:"application/vnd.abiquo.costcode+json",path:"config/costcodes"};a.post(j,e,h)}function h(e,f){var g=angular.copy(e),h=function(b){j={links:b.links,rel:"currencies"},a.putByRel(j,g.clientData.costCodeCurrencies,i)},i=function(a){void 0!=f&&f(),d.toastrSuccess(b("translate")("action.edit.success.costcode.text",{costcode:g.name})),c.dispatch("costcode.edited")},j={links:e.links,rel:"edit"};a.putByRel(j,e,h)}function i(e,f){var g=function(){void 0!=f&&f(),d.toastrSuccess(b("translate")("action.delete.success.costcode.text",{costcode:e.name})),c.dispatch("costcode.deleted")},h={links:e.links,rel:"edit"};a.removeByRel(h,g)}function j(b){r.length=0;var c,d={},e=function(a){r.push(new t(0,a))},f=function(b){var c={links:b.links,rel:"currency"};a.getByRel(c,function(a){r.push(new s(b,a))})};0===b?(d.type="application/vnd.abiquo.currencies+json",d.path="config/currencies",c=e):(d.type="application/vnd.abiquo.costcodecurrencies+json",d.path="config/costcodes/"+b+"/currencies",c=f),a.get(d,function(a){r.length=0,angular.forEach(a.collection,c)},function(a){})}function k(b,c,d){var e=0,f=function(a){0==e&&void 0!=d&&d()};u.length=0;var g={};0===b?(g.type="application/vnd.abiquo.costcodecurrencies+json",g.path="config/costcodes/0/currencies?idCurrency="+c):(g.type="application/vnd.abiquo.pricingcostcodes+json",g.path="config/pricingtemplates/"+b+"/costcodes"),a.get(g,function(b){u.length=0,b.collection&&b.collection.length>0?angular.forEach(b.collection,function(c){var d={rel:"costcode",links:c.links};e++,a.getByRel(d,function(a){u.push(new v(c,a)),e--,f(b)})}):f(b)},function(a){})}var l={},m=[],n={},o=function(){var a={};return a.name="name",a.description="description",a},p=o(),q=function(a){var b=a;return b},r=[],s=function(a,b){var c=a;return c.clientData={currency:b},c},t=function(b,c){var d={links:[],price:b};return d.links.push(a.createLinkByRel(c.links,"edit","currency")),d.clientData={currency:c},d},u=[],v=function(a,b){var c=a;return c.clientData={originalPrice:c.price,costCode:b},c};return angular.extend(l,{costCodes:m,currentCostCode:n,sortMapping:p,pricingCostCodes:u,costCodeCurrencies:r,addCostCode:g,editCostCode:h,setCurrentCostCode:e,getCostCodes:f,deleteCostCode:i,getPricingCostCodes:k,getCostCodeCurrencies:j}),l}]),angular.module("currenciesMgr",["server"]).factory("currenciesMgr",["server","utils","dispatcher","$filter",function(a,b,c,d){function e(a){angular.copy(a,l)}function f(c,d,e){k.length=0,b.emptyObject(l);var f=function(a){angular.forEach(a.collection,function(a){k.push(new o(a))}),void 0!==e&&e(a)},g={type:"application/vnd.abiquo.currencies+json",path:"config/currencies/",queryParam:{}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.get(g,f)}function g(e,f){var g=function(a){void 0!=f&&f(),b.toastrSuccess(d("translate")("action.create.success.currency.text",{currency:e.name})),c.dispatch("currency.created")},h={type:"application/vnd.abiquo.currency+json",path:"config/currencies/"};a.post(h,e,g)}function h(e,f){var g=function(a){void 0!=f&&f(),b.toastrSuccess(d("translate")("action.edit.success.currency.text",{currency:e.name})),c.dispatch("currency.edited")},h={links:e.links,rel:"edit"};a.putByRel(h,e,g)}function i(e,f){var g=function(){void 0!=f&&f(),b.toastrSuccess(d("translate")("action.delete.success.currency.text",{currency:e.name})),c.dispatch("currency.deleted")},h={path:"config/currencies/"+e.id};a.remove(h,g)}var j={},k=[],l={},m=function(){var a={};return a.symbol="symbol",a.name="name",a},n=m(),o=function(a){var b=a;return b};return angular.extend(j,{currencies:k,currentCurrency:l,sortMapping:n,getCurrencies:f,addCurrency:g,editCurrency:h,setCurrentCurrency:e,deleteCurrency:i}),j}]),angular.module("datacentersMgr",["server"]).factory("datacentersMgr",["server","utils","dispatcher","configMgr","authenticationMgr","$filter",function(a,b,c,d,e,f){function g(a){var b=angular.copy(R);angular.copy(a,R),c.dispatch("currentDatacenter.change",{data:R,previousValue:b})}function h(a){angular.copy(a,S),c.dispatch("currentDatacenterRepository.change",{data:S})}function i(b,c,d){L.length=0;var e=0,f=[],g=function(a){e--,angular.forEach(a.collection,function(a){var b=new V(a);f.push(b)}),j(),0==e&&void 0!==d&&d(a)},h=[],i=function(a){e--,angular.forEach(a.collection,function(a){var b=new V(a);h.push(b)}),j(),0==e&&void 0!==d&&d(a)},j=function(){L.length=0,angular.forEach(f,function(a){L.push(a)}),angular.forEach(h,function(a){L.push(a)})},k={type:"application/vnd.abiquo.datacenters+json",path:"admin/datacenters/",queryParam:{}};angular.extend(k.queryParam,b),angular.extend(k.queryParam,c),e++,a.get(k,g);var k={type:"application/vnd.abiquo.publiccloudregions+json",path:"admin/publiccloudregions/",queryParam:{}};angular.extend(k.queryParam,b),angular.extend(k.queryParam,c),e++,a.get(k,i)}function j(b,c,d){L.length=0;var e=function(a){angular.forEach(a.collection,function(a){var b=new V(a);L.push(b)}),void 0!==d&&d(a)},f={type:"application/vnd.abiquo.datacenters+json",path:"admin/datacenters/",queryParam:{}};angular.extend(f.queryParam,b),angular.extend(f.queryParam,c),a.get(f,e)}function k(b,c,d){L.length=0;var e=function(a){angular.forEach(a.collection,function(a){var b=new V(a);L.push(b)}),void 0!==d&&d(a)},f={type:"application/vnd.abiquo.publiccloudregions+json",path:"admin/publiccloudregions/",queryParam:{}};angular.extend(f.queryParam,b),angular.extend(f.queryParam,c),a.get(f,e)}function l(b,c,d){var e=function(a){N.length=0,angular.forEach(a.collection,function(a){var b=new V(a);N.push(b)}),void 0!==d&&d(a)},f={type:"application/vnd.abiquo.datacenters+json",path:"admin/datacenters/",queryParam:{}};angular.extend(f.queryParam,b),angular.extend(f.queryParam,c),a.get(f,e)}function m(b,c,d,e){var f=function(a){c.clientData.repository=new Z(a),R.clientData.repository=new Z(a),void 0!==e&&e(a)},g={type:"application/vnd.abiquo.datacenterrepository+json",path:"admin/enterprises/"+b.id+"/datacenterrepositories/"+c.clientData.datacenter.id,queryParam:{}};d||(g.queryParam.expand="last_task",g.queryParam.usage=!0),a.get(g,f)}function n(a){O.length=0;var b=function(a){angular.forEach(a.collection,function(a){var b=new V(a);O.push(b)}),q(!0,!1,{},{},c)},c=function(b){angular.forEach(b.collection,function(a){var b=new V(a);O.push(b)}),void 0!==a&&a(O)};o({},{},b)}function o(b,c,d){var e=function(a){void 0!==d&&d(a)},f={path:"cloud/locations",type:"application/vnd.abiquo.datacenters+json",queryParam:{}};angular.extend(f.queryParam,b),angular.extend(f.queryParam,c),a.get(f,e)}function p(b,c,d,e,f){b&&(P.length=0);var g=function(a){b&&(P.length=0,angular.forEach(a.collection,function(a){var b=new W(a,"self");P.push(b)})),void 0!==e&&e(a)},h={path:"cloud/locations",type:"application/vnd.abiquo.datacenters+json",queryParam:{inscope:!0}};angular.extend(h.queryParam,c),angular.extend(h.queryParam,d),a.get(h,g,f)}function q(b,c,d,e,f,g){b&&(P.length=0);var h=function(a){b&&(P.length=0,angular.forEach(a.collection,function(a){var b=new W(a,"self");P.push(b)})),void 0!==f&&f(a)},i={path:"cloud/locations",type:"application/vnd.abiquo.publiccloudregions+json",queryParam:{inscope:c}};angular.extend(i.queryParam,d),angular.extend(i.queryParam,e),a.get(i,h,g)}function r(b,c,d,e){var f=function(a){P.length=0,angular.forEach(a.collection,function(a){var b=new W(a,"location");P.push(b)}),void 0!==e&&e(O)},g={rel:"limits",links:b.links,type:"application/vnd.abiquo.limits+json",queryParam:{}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.getByRel(g,f)}function s(b,c,d){P.length=0;var e=function(a){angular.forEach(a.collection,function(a){var b=new W(a,"self");P.push(b)}),t(b,c,d)},f={path:"cloud/locations",type:"application/vnd.abiquo.datacenters+json",queryParam:{}};angular.extend(f.queryParam,b),angular.extend(f.queryParam,c),a.get(f,e)}function t(b,d,e){var f=function(a){angular.forEach(a.collection,function(a){var b=new W(a,"self");P.push(b)}),angular.forEach(P,function(a){a.id==R.id&&c.dispatch("datacenterlimit.changed",{limit:a})}),void 0!==e&&e(P)};serverData={path:"cloud/locations",type:"application/vnd.abiquo.publiccloudregions+json",queryParam:{}},angular.extend(serverData.queryParam,b),angular.extend(serverData.queryParam,d),a.get(serverData,f)}function u(d,e){var g=function(){var g=function(a){d=new W(a,"location"),void 0!==e&&e(d),c.dispatch("datacenter.limit.edited",{data:d}),b.toastrSuccess(f("translate")("action.edit.success.limit.text",{limit:d.name}))},h={links:d.links,rel:"edit"};a.putByRel(h,d,g)},h=a.getLinkByRel(d.links,"default");if(""!==h){var i={path:h.href+"/action/default",type:"application/vnd.abiquo.vlan+json",absolutPath:!0};a.put(i,null,g)}else g()}function v(b,c,d){var e=function(a){c.clientData.refreshDatacenterRepositoryCheck=a,void 0!==d&&d(a)},f={type:"application/vnd.abiquo.acceptedrequest+json",path:"admin/enterprises/"+b.id+"/datacenterrepositories/"+c.id+"/actions/refresh",queryParam:{}};a.put(f,{},e)}function w(b,c){var d=function(a){void 0!==c&&c(a)},e={rel:"status",links:b.clientData.refreshDatacenterRepositoryCheck.links,type:"application/vnd.abiquo.task+json",queryParam:{}};a.getByRel(e,d)}function x(a,b){Q.length=0,angular.forEach(a.links,function(a){"hypervisortype"==a.rel&&Q.push(new X(a))}),void 0!==b&&b(Q)}function y(b,c){var d=function(a){b.clientData.hypervisors.length=0,b.clientData.hypervisorTemplate=!1,b.clientData.hasGenericHypervisor=!1;var d=[],e=[],g={};angular.forEach(a.collection,function(a){a.operations&&a.operations.templates?(g=angular.copy(a),b.clientData.hypervisorTemplate=!0,d.push(a)):b.clientData.hasGenericHypervisor||(b.clientData.hasGenericHypervisor=!0,g={realName:f("translate")("appslibrary.datacenter.label.generic"),operations:[]},e.push(g))}),b.clientData.hypervisors=e.concat(d),void 0!==c&&c(g)},e={links:b.links,rel:"hypervisors",queryParam:{}};a.getByRel(e,d)}function z(d,e){var h=function(a){void 0!==e&&e(),a.remoteServices&&a.remoteServices.configErrors&&a.remoteServices.configErrors.collection.length>0?b.toastrWarning(f("translate")("action.create.success.datacenter.remoteservices.error.text",{dc:d.name})):b.toastrSuccess(f("translate")("action.create.success.datacenter.text",{dc:d.name})),d.clientData.automaticallyOpenServersView&&g(new V(a)),c.dispatch("datacenter.created",{data:a})},i={type:"application/vnd.abiquo.datacenter+json",path:"admin/datacenters"};a.post(i,d,h)}function A(d,e,h){var i=function(a){void 0!==h&&h(a),a.remoteServices&&a.remoteServices.configErrors&&a.remoteServices.configErrors.collection.length>0?b.toastrWarning(f("translate")("action.create.success.datacenter.remoteservices.error.text",{dc:d.name})):b.toastrSuccess(f("translate")("action.create.success.datacenter.text",{dc:d.name})),d.clientData.automaticallyOpenServersView&&g(a),c.dispatch("datacenter.created",{data:a})},j=a.createLinkByRel(e.links,"self","region");d.links.push(j);var k={type:"application/vnd.abiquo.publiccloudregion+json",path:"admin/publiccloudregions"};d.clientData.endpoint&&(k.providerEndpoint=d.clientData.endpoint,k.providerUser=d.clientData.user,k.providerPassword=d.clientData.password),a.post(k,d,i,h)}function B(d,e){var h=function(a){var h=new V(a);g(h),e&&e(),c.dispatch("datacenter.edited",{data:a}),b.toastrSuccess(f("translate")("action.edit.success.datacenter.text",{dc:d.name}))},i={links:d.links,rel:"edit"};a.putByRel(i,d,h)}function C(d,e){
var g=function(a){e&&e(),c.dispatch("datacenter.deleted",{data:a}),b.toastrSuccess(f("translate")("action.delete.success.datacenter.text",{dc:d.name})),b.emptyObject(K.currentDatacenter)},h={links:d.links,rel:"edit"};a.removeByRel(h,g)}function D(b,c){var d=function(a){T.length=0,angular.forEach(a.collection,function(a){var b=new Y(a);T.push(b)}),void 0!==c&&c(a)},e={type:"application/vnd.abiquo.backups+json",path:"admin/datacenters/"+b.id+"/backups",queryParam:{}};a.get(e,d)}function E(d,e,g){var h=function(a){c.dispatch("backupConfiguration.edited",{data:a}),void 0!==g&&g(a),b.toastrSuccess(f("translate")("action.edit.success.datacenter.backupconfiguration.text",{dc:d.name}))},i={links:d.links,rel:"backups",queryParam:{}};a.putByRel(i,e,h)}function F(b,c){U.length=0;var d=function(a){var b={links:[],name:f("translate")("virtualdatacenter.create.generalinfo.privatenetwork.combo.availabilityzone.nopreference")};U.push(b),angular.forEach(a.collection,function(a){U.push(a)}),void 0!==c&&c(a)},e={path:"cloud/locations/"+b.id+"/availabilityzones",type:"application/vnd.abiquo.availabilityzones+json"};a.get(e,d)}function G(c,d){var e={links:[],name:c.name,ramSoftLimitInMb:0,ramHardLimitInMb:0,ramUnits:b.unitsSelector[0],cpuCountSoftLimit:0,cpuCountHardLimit:0,diskSoftLimitInMb:0,diskHardLimitInMb:0,hdUnits:b.unitsSelector[1],storageSoftInMb:0,storageHardInMb:0,storageUnits:b.unitsSelector[1],vlansSoft:0,vlansHard:0,publicIpsSoft:0,publicIpsHard:0,repositorySoftInMb:0,repositoryHardInMb:0,repositoryUnits:b.unitsSelector[1]},f=a.createLinkByRel(c.links,"edit","location");if(e.links.push(f),c.clientData.isPublicDatacenter)e=new W(e,"location"),void 0!==d&&d(e);else{var g=function(b){angular.forEach(b.collection,function(b){if(b.defaultAllowed){var c=a.createLinkByRel(b.links,"edit","tier");e.links.push(c)}}),e=new W(e,"location"),void 0!==d&&d(e)},h={links:c.links,rel:"tiers"};a.getByRel(h,g)}}function H(a){return b.isEmptyObject(a)||a.clientData.isPublicDatacenter?!1:!0}function I(b,c){var d=function(a){M.length=0,angular.forEach(a.collection,function(a){var b=new V(a);b.id=b.idDatacenter,M.push(new V(a))}),J(b,c)},e={path:"admin/datacenters",type:"application/vnd.abiquo.datacenterslight+json",queryParam:{idScope:b}};a.get(e,d)}function J(b,d){var e=function(a){angular.forEach(a.collection,function(a){M.push(new V(a))}),void 0!==d&&d(M),c.dispatch("datacentersLight.got")},f={path:"admin/publiccloudregions",type:"application/vnd.abiquo.publiccloudregions+json",queryParam:{idScope:b}};a.get(f,e)}var K={},L=[],M=[],N=[],O=[],P=[],Q=[],R={},S={},T=[],U=[],V=function(c){var d=c;d.clientData={selected:!1,refreshRepositoryTimer:{},isLimit:!1,automaticallyOpenServersView:e.userChoices.automaticallyOpenServersView};var f=a.getLinkByRel(d.links,"region");b.isEmptyObject(f)||(d.clientData.isPublicDatacenter=!0,d.clientData.provider=a.getClientdataFromLinksByRel(d.links,"hypervisortype"),d.clientData.region=a.getClientdataFromLinksByRel(d.links,"region"));var g=a.getLinkByRel(d.links,"hypervisortype");return b.isEmptyObject(g)||(d.clientData.hypervisorType=a.getClientdataFromLinksByRel(d.links,"hypervisortype").id),d.links||(d.links=[]),d},W=function(b,c){var d=b,e=[];angular.forEach(d.links,function(b){a.isLinkByRel(b,"tier")&&e.push({id:a.getIdInLinkByParameter(b,"tiers"),name:b.title})});var f,g,h=a.getLinkByRel(d.links,"default"),i=a.getLinkByRel(d.links,c);return-1!=i.type.search("publiccloudregion")?(f=!0,g="self"==c?"locations":"publiccloudregions"):(f=!1,g="self"==c?"locations":"datacenters"),d.clientData={isLimit:!0,tiers:e,datacenter:a.getClientdataFromLinksByRel(d.links,c,g),defaultVlan:""==h?{}:a.getClientdataFromLinksByRel(d.links,"default","externalnetworks"),hypervisors:[]},d.clientData.datacenter.isPublicDatacenter=f,d},X=function(b){var c=b,d=a.getClientdataFromLinksByRel([b],"hypervisortype");return c.realName=d.name,c.name=d.id,c},Y=function(a){var b=a;return b.clientData={},b},Z=function(a){var b=a;return b.clientData={},b};return angular.extend(K,{Datacenter:V,datacenters:L,datacentersLight:M,scopeDatacenters:N,allowedDatacenters:O,allowedLimits:P,hypervisors:Q,currentDatacenter:R,currentDatacenterRepository:S,backupsConfiguration:T,availabilityZones:U,getDatacenters:i,getDatacentersPrivate:j,getDatacentersPublic:k,getScopeDatacenters:l,getAllowedLocations:n,getAllowedDatacenters:o,getAllowedPrivate:p,getAllowedPublicCloudRegions:q,getAllowedLimitsByEnterprise:r,getAllowedLimitsByEnterpriseInCloud:s,editDatacenterLimit:u,getDatacenterRepository:m,refreshDatacenterRepository:v,checkDatacenterRepositoryRefresh:w,deleteDatacenter:C,createDatacenter:z,createPublicCloudRegion:A,editDatacenter:B,getHypervisorsByDatacenter:x,getHypervisorsByDatacenterLimit:y,setCurrentDatacenter:g,setCurrentDatacenterRepository:h,getBackupConfiguration:D,editBackupConfiguration:E,getAvailabilityZones:F,createClientLimitByDatacenter:G,isPrivateDatacenter:H,getDatacentersLight:I}),K}]),angular.module("dispatcher",[]).factory("dispatcher",["$rootScope",function(a){var b={},c=function(b,c){"string"==typeof b?a.$broadcast(b,c):b.length>0&&b.forEach(function(b){a.$broadcast(b,c)})},d=function(b,c,d){d||(d=a),"string"==typeof b?d.$on(b,c):b.length>0&&b.forEach(function(a){d.$on(a,c)})};return angular.extend(b,{dispatch:c,on:d}),b}]),angular.module("enterprisesMgr",[]).factory("enterprisesMgr",["server","dispatcher","$filter","utils",function(a,b,c,d){function e(a){angular.copy(a,y)}function f(a){angular.copy(a,D),b.dispatch("currentEnterprise.change",{data:D})}function g(){if(!d.isEmptyObject(D)){var a=c("getElementById")(z,D.id);f(a)}}function h(a){angular.copy(a,F)}function i(c,d){var e=function(a){var c=new G(a);f(c),void 0!==d&&d(c),b.dispatch("enterprise.details.got")},g={rel:"edit",links:c.links,type:"application/vnd.abiquo.enterprisetheme+json"};a.getByRel(g,e)}function j(c,d,e){var f=function(a){z.length=0,angular.forEach(a.collection,function(a){z.push(new G(a))}),void 0!==e&&e(a,z),g(),b.dispatch("enterprises.got")},h={type:"application/vnd.abiquo.enterprises+json",path:"admin/enterprises/",queryParam:{}};angular.extend(h.queryParam,c),angular.extend(h.queryParam,d),c&&c.limit||(h.queryParam.limit=0),a.get(h,f)}function k(b,c,d){var e=function(a){B.length=0,angular.forEach(a.collection,function(a){B.push(new G(a))}),void 0!==d&&d(a)},f={type:"application/vnd.abiquo.enterprises+json",path:"admin/enterprises/",queryParam:{}};angular.extend(f.queryParam,b),angular.extend(f.queryParam,c),a.get(f,e)}function l(b,c){var d=function(a){void 0!==c&&c(a)},e={type:"application/vnd.abiquo.enterprisetheme+json",rel:"edit",links:b.links};a.getByRel(e,d)}function m(b,c,d,e){var f=function(a){z.length=0,angular.forEach(a.collection,function(a){z.push(new G(a))}),void 0!==e&&e(a)},g={rel:"enterprises",links:b.links,queryParam:{network:!0}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.getByRel(g,f)}function n(b,c){var d=function(a){var b=new G(a);e(b),void 0!==c&&c(a)},f={rel:"enterprise",links:b.links,type:"application/vnd.abiquo.enterprisetheme+json"};a.getByRel(f,d)}function o(e,f,g,h,i){var j,k=0;if(h.id>0){var l=a.createLinkByRel(h.links,"edit","pricingtemplate");e.links.push(l)}var m=function(a){k++,k==f.length&&J(j)},n=function(h){void 0!==i&&i(),d.toastrSuccess(c("translate")("action.create.success.enterprise.text",{ent:h.name})),j=h,j.clientData=e.clientData,f.length>0?angular.forEach(f,function(b){var c={type:"application/vnd.abiquo.limit+json",path:"admin/enterprises/"+j.id+"/limits"};a.post(c,b,m)}):J(j),angular.forEach(g,function(b){var c={type:"application/vnd.abiquo.machine+json",path:"admin/enterprises/"+j.id+"/reservedmachines"};a.post(c,b)}),b.dispatch("enterprise.created",{data:j})},o={type:c("isGranted")("USERS_MANAGE_ENTERPRISE_BRANDING")?"application/vnd.abiquo.enterprisetheme+json":"application/vnd.abiquo.enterprise+json",path:"admin/enterprises"};a.post(o,e,n)}function p(e,f,g,h,i,j,k){var l=0;if(j.id>0){if(j.links){var m=a.createLinkByRel(j.links,"edit","pricingtemplate");a.removeLinkByRel(e.links,"pricingtemplate"),e.links.push(m)}}else a.removeLinkByRel(e.links,"pricingtemplate");var n=function(a){l++,l==f.length&&J(e)},o=function(j){f.length>0?angular.forEach(f,function(b){var c={type:"application/vnd.abiquo.limit+json",path:"admin/enterprises/"+j.id+"/limits"};a.post(c,b,n)}):J(e),angular.forEach(g,function(b){var c={type:"application/vnd.abiquo.limit+json",path:"admin/enterprises/"+e.id+"/limits/"+b.id};a.remove(c)}),angular.forEach(h,function(b){var c={type:"application/vnd.abiquo.machine+json",path:"admin/enterprises/"+j.id+"/reservedmachines"};a.post(c,b)}),angular.forEach(i,function(b){var c={type:"application/vnd.abiquo.machine+json",path:"admin/enterprises/"+e.id+"/reservedmachines/"+b.id};a.remove(c)}),void 0!==k&&k(),b.dispatch("enterprise.edited",{data:j}),d.toastrSuccess(c("translate")("action.edit.success.enterprise.text",{ent:e.name}))},p={type:c("isGranted")("USERS_MANAGE_ENTERPRISE_BRANDING")?"application/vnd.abiquo.enterprisetheme+json":"application/vnd.abiquo.enterprise+json",contentType:c("isGranted")("USERS_MANAGE_ENTERPRISE_BRANDING")?"application/vnd.abiquo.enterprisetheme+json":"application/vnd.abiquo.enterprise+json",links:e.links,rel:"edit"};a.putByRel(p,e,o)}function q(e,f){var g=function(a){void 0!==f&&f(),b.dispatch("enterprise.deleted",{data:a}),d.toastrSuccess(c("translate")("action.delete.success.enterprise.text",{ent:e.name})),d.emptyObject(D)},h={links:e.links,rel:"edit"};a.removeByRel(h,g,void 0)}function r(b){var c=function(a){E.length=0,angular.forEach(a.collection,function(a){var b=new H(a);E.push(b)}),h(E[0])},d={rel:"datacenterrepositories",links:b.links};a.getByRel(d,c)}function s(b,c,d,e){var f=function(a){""===a&&void 0!==e&&e(a)},g={type:"application/vnd.abiquo.enterprises+json",path:"admin/enterprises/"+b.id+"/action/requestupload",queryParam:{fileSize:d,datacenterId:c.id}};a.get(g,f)}function t(b,c,d){var e=function(a){c.clientData.provider=b,void 0!=d&&d(a)},f={links:b.links,rel:"checkcredentials"};if(!c.id){var g=a.createLinkByRel(b.links,"self","hypervisortype");c.links=[g]}a.postByRel(f,c,e)}function u(b,e,f){var g=function(a){void 0!=f&&f(a,e),d.toastrSuccess(c("translate")("action.release.success.publicaccount.text"))},h={links:e.links,rel:"edit"};a.removeByRel(h,g)}function v(b,c){var d=function(a){angular.forEach(a.collection,function(a){b.clientData.publicCredentials.push(new I(angular.copy(a)))}),void 0!=c&&c(a)},e=(a.getLinkByRel(b.links,"edit"),{links:b.links,rel:"credentials"});a.getByRel(e,d)}function w(c,d){var e=function(a){A.length=0,angular.forEach(a.collection,function(a){A.push(new G(a))}),void 0!==d&&d(a),b.dispatch("enterprisesLight.got")},f={path:"admin/enterprises",type:"application/vnd.abiquo.enterprises-id-name+json",queryParam:{idScope:c}};a.get(f,e)}var x={},y={},z=[],A=[],B=[],C=[],D={},E=[],F={},G=function(a){var b=a;return b.clientData={virtualDatacenters:[],open:!1,selected:!1,chefEnabled:""!=b.chefClientCertificate&&""!=b.chefValidatorCertificate&&void 0!=b.chefClientCertificate&&void 0!=b.chefValidatorCertificate,publicCredentials:[]},b},H=function(a){var b=a;return b.clientData={},b},I=function(b){var c=b,d=a.getClientdataFromLinksByRel(b.links,"hypervisortype");return c.clientData={providerName:d.name,isValid:!0,isModified:!1},c},J=function(b){angular.forEach(b.clientData.publicCredentials,function(c){if(c.clientData)if(c.id>0){if(c.clientData.isModified){var e={links:c.links,rel:"edit"};a.putByRel(e,c)}}else{var e={links:b.links,rel:"credentials",type:"application/vnd.abiquo.publiccloudcredentials+json",contentType:"application/vnd.abiquo.publiccloudcredentials+json"},f=a.createLinkByRel(c.clientData.provider.links,"self","hypervisortype");c.links=[f];var g=a.getLinkByRel(c.clientData.provider.links,"publiccloudregion");d.isEmptyObject(g)||(c.links=[g]),a.postByRel(e,c)}})};return angular.extend(x,{userEnterprise:y,enterprises:z,enterprisesLight:A,scopeEnterprises:B,allowedEnterprises:C,currentEnterprise:D,datacenterRepositories:E,currentDatacenterRepository:F,getUserEnterprise:n,setUserEnterprise:e,getEnterpriseDetails:i,getEnterprises:j,getScopeEnterprises:k,getExtendedEnterprise:l,createEnterprise:o,editEnterprise:p,deleteEnterprise:q,getEnterprisesWithNetworkInDataCenter:m,setCurrentEnterprise:f,getDatacenterRepositories:r,setCurrentDatacenterRepository:h,requestUpload:s,testPublicAccount:t,releasePublicAccount:u,getEnterpriseCredentials:v,getEnterprisesLight:w}),x}]),angular.module("eventsMgr",["server"]).factory("eventsMgr",["server","$filter",function(a,b){function c(a){angular.copy(a,l)}function d(b,c,d,e){b||(i.length=0);var f=function(a){i.length=0,angular.forEach(a.collection,function(a){i.push(new n(a))}),void 0!==e&&e(a)},g={type:"application/vnd.abiquo.events+json",path:"events/",queryParam:{}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.get(g,f)}function e(c,d,e){j.length=0,k.length=0;var f=function(a){var c=[b("translate")("globals.all")],d=c.concat(a.actions.collection);angular.extend(j,d);var f=[b("translate")("globals.all")],g=f.concat(a.severities.collection);angular.extend(k,g),void 0!==e&&e(a)},g={type:"application/vnd.abiquo.eventtypes+json",path:"events/",queryParam:{}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.get(g,f)}function f(b,c){var d=function(a){b.clientData.events.length=0,angular.forEach(a.collection,function(a){b.clientData.events.push(new n(a))}),void 0!==c&&c(b)},e={type:"application/vnd.abiquo.events+json",path:"events/",queryParam:{virtualMachine:b.name,limit:5}};a.get(e,d)}var g={},h=function(){var a={};return a.severity="SEVERITY",a.actionPerformed="ACTIONPERFORMED",a.performedBy="PERFORMEDBY",a.timestamp="timestamp",a.user="USER",a["clientData.source"]="SOURCE",a},i=[],j=[],k=[],l={},m=h(),n=function(a){var b=a,c=a.enterprise+" / "+a.user+" / "+a.datacenter+" / "+a.rack+" / "+a.physicalMachine+" / "+a.storageSystem+" / "+a.storagePool+" / "+a.volume+" / "+a.virtualDatacenter+" / "+a.virtualApp+" / "+a.virtualmachine+" / "+a.network+" / "+a.subnet+" ",d=/ null /g;return c=c.replace(d,""),d=/ undefined /g,c=c.replace(d,""),d=/\/\//g,c=c.replace(d,""),b.clientData={source:c},b};return angular.extend(g,{sortMapping:m,events:i,eventTypes:j,eventSeverities:k,currentEvent:l,setCurrentEvent:c,getEvents:d,getEventTypes:e,getVirtualMachineEvents:f}),g}]),angular.module("firewallsMgr",[]).factory("firewallsMgr",["server","$filter","dispatcher","utils",function(a,b,c,d){function e(a){angular.copy(a,r),c.dispatch("currentFirewall.change",{data:r})}function f(b,c,d,e){q.length=0;var f=function(a){q.length=0,angular.forEach(a.collection,function(a){q.push(new t(a))}),void 0!==e&&e(a)},g={links:b.links,rel:"firewalls",queryParam:{}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.getByRel(g,f)}function g(b,c,d,e){q.length=0;var f=function(a){q.length=0,angular.forEach(a.collection,function(a){q.push(new t(a))}),void 0!==e&&e(a)},g={links:b.links,rel:"firewalls",queryParam:{}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.getByRel(g,f)}function h(e,f,g){if(0!=f.id){var h=a.createLinkByRel(f.links,"edit","virtualdatacenter");e.links=[],e.links.push(h)}var i=function(a){void 0!==g&&g(a),c.dispatch("firewall.created",{locationId:e.clientData.location.id}),d.toastrSuccess(b("translate")("action.create.success.firewall.text",{firewall:e.name}))},j={links:e.clientData.location.links,rel:"firewalls",type:"application/vnd.abiquo.firewallpolicy+json",contentType:"application/vnd.abiquo.firewallpolicy+json"};a.postByRel(j,e,i)}function i(e,f,g){if(a.removeLinkByRel(e.links,"virtualdatacenter"),0!=f.id){var h=a.createLinkByRel(f.links,"edit","virtualdatacenter");e.links.push(h)}var i=function(a){void 0!==g&&g(a),c.dispatch("firewall.edited"),d.toastrSuccess(b("translate")("action.edit.success.firewall.text",{firewall:e.name}))},j={rel:"edit",links:e.links};a.putByRel(j,e,i)}function j(f,g){var h=function(a){void 0!==g&&g(a),c.dispatch("firewall.deleted"),d.toastrSuccess(b("translate")("action.delete.success.firewall.text",{firewall:f.name})),e(null)},i={rel:"edit",links:f.links};a.removeByRel(i,h)}function k(b,d){var e=function(a){void 0!==d&&d(a),c.dispatch("firewall.edited")},f={links:b.links,rel:"firewalls",queryParam:{source:"remote"}};a.getByRel(f,e)}function l(b,d){var e=function(a){void 0!==d&&d(a),c.dispatch("firewall.edited")},f={links:b.links,rel:"firewalls",queryParam:{source:"remote"}};a.getByRel(f,e)}function m(b,c){var d=function(a){b.clientData.rules.length=0,angular.forEach(a.collection,function(a){new u(a);b.clientData.rules.push(a)}),void 0!==c&&c(a)},e={links:b.links,rel:"rules"};a.getByRel(e,d)}function n(e,f,g){var h={collection:f},i=function(a){void 0!==g&&g(a),c.dispatch("firewallrules.edited"),d.toastrSuccess(b("translate")("action.edit.success.firewallrules.text",{firewall:e.name}))},j={links:e.links,rel:"rules"};a.putByRel(j,h,i)}var o={},p=function(){var a={};return a.symbol="symbol",a.name="name",a},q=[],r={},s=p(),t=function(b){var c=b||{};return c.clientData={location:a.getClientdataFromLinksByRel(c.links,"location"),virtualDatacenter:a.getClientdataFromLinksByRel(c.links,"virtualdatacenter"),rules:[],selected:!1},c.clientData.virtualDatacenter.id||(c.clientData.virtualDatacenter.id=0),c},u=function(a){var b=a||{};return b.clientData={},b};return angular.extend(o,{Firewall:t,sortMapping:s,firewalls:q,currentFirewall:r,getAvailableFirewallsByVdc:f,getAvailableFirewallsByLocation:g,createFirewall:h,editFirewall:i,deleteFirewall:j,setCurrentFirewall:e,synchronizeFirewallsByLocation:k,synchronizeFirewallsByVirtualDatacenter:l,getFirewallRules:m,editFirewallRules:n}),o}]),angular.module("gridTemplates",[]).factory("gridTemplates",["$filter",function(a){var b={},c='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{cursor: col.cursor}" ng-class="{ ngSorted: !noSortVisible }"><div class="ngHeaderText"></div></div>',d='<div class="ngHeaderSortColumn {{col.headerClass}}" ng-style="{cursor: col.cursor}" ng-class="{ ngSorted: !noSortVisible }"><div class="ngHeaderText"></div></div>',e='<div class="ngHeaderSortColumn {{col.headerClass}} selectAllHeaderTemplate" ng-style="{cursor: col.cursor}" ng-class="{ ngSorted: !noSortVisible }"><div class="ngHeaderText"><data-select-all-checkbox checkboxes="data" ></data-select-all-checkbox></div></div>',f='<div><button data-ng-hide="virtualMachine && (virtualMachine.state == \'ON\' || virtualMachine.state == \'PAUSED\')" ng-click="deleteRow(row)" data-tooltip="{{\'globals.delete\' | translate}}"><i class="icon-remove"></i></button></div>',g='<div class="row-fluid span9 checkbox-cell"><input id="entity-{{row.entity.id}}" u-checkbox type="checkbox"  data-ng-model="row.entity.clientData.selected" data-ng-change="afterSelectionChange(row)"> <label class="checkbox inline" for="entity-{{row.entity.id}}"><span></span> </label> </div>',h='<div class="row-fluid span9 checkbox-cell"><input id="entity-{{row.entity.clientData.id}}" u-checkbox type="checkbox"  data-ng-model="row.entity.clientData.selected" data-ng-change="afterSelectionChange(row)"> <label class="checkbox inline" for="entity-{{row.entity.clientData.id}}"><span></span> </label> </div>',i='<div class="row-fluid span9 checkbox-cell"><input id="datastore-{{row.rowIndex}}" u-checkbox type="checkbox"  data-ng-model="row.entity.enabled" data-ng-change="onDatastoreEnableChange()"> <label id="datastore-label-{{row.rowIndex}}" class="checkbox inline" for="datastore-{{row.rowIndex}}"><span id="datastore-span-{{row.rowIndex}}"></span></label> </div>',j='<div class="approve-reject-cell-container" data-ng-mouseover="rowOver = true" data-ng-mouseout="rowOver = false"><a ng-click="approveAction(row)" data-ui-if="\'WORKFLOW_OVERRIDE\' | isGranted">'+a("translate")("globals.approve")+'</a><a ng-click="rejectAction(row)">'+a("translate")("globals.reject")+"</a></div>",k='<div class="ngCellText" ng-class="col.colIndex()"><span class="{{\'severity-\'+COL_FIELD}}" ng-cell-text>{{COL_FIELD}}</span></div>',l='<div class="ngCellText" ng-class="col.colIndex()"><span class="{{\'pvmt-state-\'+COL_FIELD}}" ng-cell-text data-tooltip="{{COL_FIELD}}">{{COL_FIELD}}</span></div>',m='<div class="ngCellText" ng-class="col.colIndex()"><span class="{{\'vm-state-\'+COL_FIELD}}" ng-cell-text>{{COL_FIELD}}</span></div>',n='<div class="ngCellText" ng-class="col.colIndex()"><span class="{{\'pvmt-state-\'+virtualMachineStates[row.entity.idState]}}" ng-cell-text>{{row.entity.state}}</span></div>',o='<div class="ngCellText" ng-class="col.colIndex()"><i data-ng-show="row.entity.protected" class="icon-lock vm-blocked"></i><span data-ng-show="!row.entity.protected"ng-cell-text>-</span></div>',p='<div class="ngCellText centered" ng-class="col.colIndex()"><a data-ui-if="row.entity.type == \'CAPTURED\'" class="ab-release-button-mini" tooltip="{{\'servers.virtualmachine.tooltip.captured\' | translate}}"></a><a data-ui-if="row.entity.type == \'NOT_MANAGED\'" class="icon-warning-sign" tooltip="{{\'servers.virtualmachine.tooltip.notmanaged\' | translate}}"></a></div>',q='<div class="ngCellText" ng-class="col.colIndex()"><span class="{{\'remote-service-state-\'+remoteServiceStates[row.entity.status]}}" ng-cell-text>{{remoteServiceStates[row.entity.status]}}</span></div>',r='<div class="ngCellText ip-cell" ng-class="col.colIndex()"><i data-ui-if="row.entity.clientData.isDefaultGateway" class="gateway-icon"></i><span ng-cell-text>{{COL_FIELD}}</span></div>',s='<div class="ngCellText" ng-class="col.colIndex()"><span class="{{\'conversion-state-\'+row.entity.state}}" ng-cell-text>{{row.entity.state}}</span><a id="edit-vmt-restartconversion-{{row.rowIndex}}" style="margin-left: 10px;" data-ng-show="row.entity.state == \'FAILED\'" data-ng-click="restartConversion(row.entity)">'+a("translate")("virtualmachinetemplate.disks.grid.conversions.button.restartconversion")+"</a></div>",t='<div class="ngCellText" ng-class="col.colIndex()">{{row.getProperty(col.field) | sizeUnit:true}}</div>',u='<div class="ngCellText" ng-class="col.colIndex()">{{row.getProperty(col.field) | sizeUnit:false}}</div>',v="<p>{{row.entity.sequence == 0 && ('virtualmachine.edit.storage.primarydisk' | translate) || (row.getProperty(col.field) && row.getProperty(col.field) || '-')}}</p>",w="<p>{{row.getProperty(\"sequence\")}} {{row.entity.sequence == 0 && ('virtualmachine.edit.storage.primarydisk' | translate) || (row.getProperty('label') && row.getProperty('label') || '-')}} ({{row.getProperty(\"hdRequired\") | sizeUnit:true}})</p>",x='<div class="row-fluid span9"><input id="quarantineCheck{{row.rowIndex}}" u-checkbox type="checkbox"  data-ng-model="row.entity.quarantine" data-ng-change="updateQuarantine(row.entity)" data-ng-disabled="!(\'PHYS_DC_ALLOW_MODIFY_NETWORK\' | isGranted)"> <label class="checkbox inline" for="quarantineCheck{{row.rowIndex}}"><span></span> </label> </div>',y='<div class="row-fluid"><ui-select name="currency" data-ng-model="row.entity.idPricingTemplate"  class="span12"  data-ng-disabled="!(\'PRICING_MANAGE\' | isGranted)"  data-ng-change="changeEnterprisePricingModel(row.entity)"> <ui-select-match placeholder="{{ \'globals.select\' | translate }}">{{$select.selected.name}}</ui-select-match><ui-select-choices repeat="pricingModel.id as pricingModel in pricingModels | filter: $select.search"> <span>{{pricingModel.name}}</span></ui-select-choices></ui-select></div> ',z='<div class="row-fluid span9 checkbox-cell"><input id="entity-{{row.entity.name}}" u-checkbox type="checkbox"  data-ng-model="row.entity.clientData.selected" data-ng-change="updateSelectedStoragePools()"> <label class="checkbox inline" for="entity-{{row.entity.name}}"><span></span> </label> </div>',A='<div class="ngCellText" ng-class="col.colIndex()">{{row.entity.fromPort}} - {{row.entity.toPort}}</div>',B='<div class="ngCellText" ng-class="col.colIndex()">{{row.entity | returnRuleDestination}}</div>',C='<div class="row-fluid span9 checkbox-cell"><input id="selectedItem-{{row.entity.id}}" u-checkbox type="checkbox"  data-ng-model="row.entity.clientData.selected" data-ng-change="onItemEnabledChange(row.entity)"> <label class="checkbox inline" for="selectedItem-{{row.entity.id}}"><span></span> </label> </div>',D='<div class="row-fluid span9 checkbox-cell"><input id="selectedItem-{{row.entity.providerId}}" u-checkbox type="checkbox"  data-ng-model="row.entity.clientData.selected"> <label class="checkbox inline" for="selectedItem-{{row.entity.providerId}}"><span></span> </label> </div>',E='<div class="row-fluid span9 checkbox-cell"><input id="selectedItem-{{row.entity.name}}" u-checkbox type="checkbox"  data-ng-model="row.entity.clientData.selected" data-ng-change="onItemEnabledChange(row.entity)"> <label class="checkbox inline" for="selectedItem-{{row.entity.name}}"><span></span> </label> </div>',F='<div class="ngCellText" ng-class="col.colIndex()">{{ returnName(row.entity) }}</div>',G='<div class="ngCellText centered" data-ng-show="\'VDC_MANAGE_NETWORK\' | isGranted"><a data-u-alert data-on-confirm="releaseNICFromVDC(row.entity)" data-message="{{\'networkgrid.delete.confirm.message\' | translate:row.entity}}" data-title="{{\'networkgrid.delete.confirm.title\' | translate}}">{{"networkgrid.action.releaseip" | translate}}</a></div>',H='<div class="ngCellText centered" data-ng-show="\'VDC_MANAGE_NETWORK\' | isGranted"><a data-u-alert data-on-confirm="purchaseNICforVDC(row.entity)"data-message="{{\'networklist.assign.public.ip.message\' | translate:row.entity }}" data-title="{{\'networklist.assign.public.ip.title\' | translate}}">{{"networkgrid.action.purchaseip" | translate}}</a></div>',I='<div><label style="padding-left: 10px; padding-top: 2px" data-ng-hide="row.entity.clientData.edited">{{row.entity.priority}}</label><button style="position: absolute;top: 0px; right: 0px" data-ng-hide="row.entity.clientData.edited" class="abg-middle" data-ng-click="row.entity.clientData.edited = true"><i class="icon-pencil"></i></button><input data-ng-show="row.entity.clientData.edited" type="input" data-ng-model="row.entity.clientData.priority" class="span1"/> <button data-ng-show="row.entity.clientData.edited" class="abg-middle" data-ng-click="onPriorityClick(row.entity)">ok</button></div>',J='<div><label style="padding-left: 10px; padding-top: 2px" data-ng-hide="row.entity.clientData.sequenceEdited">{{row.entity.sequence}}</label><button style="position: absolute;top: 0px; right: 0px" data-ng-hide="row.entity.clientData.sequenceEdited || row.entity.clientData.sequence == 0 || row.entity.clientData.toBeDeleted || sequenceNotEditable" class="abg-middle" data-ng-click="row.entity.clientData.sequenceEdited = true"><i class="icon-pencil"></i></button><input data-ng-show="row.entity.clientData.sequenceEdited" type="number" data-ng-model="row.entity.clientData.sequence" class="span1" min="0"/> <button data-ng-show="row.entity.clientData.sequenceEdited" class="abg-middle" data-ng-click="row.entity.clientData.sequenceEdited = false; onSequenceClick(row.entity)" data-ng-disabled="!row.entity.clientData.sequence && row.entity.clientData.sequence != 0">ok</button></div>',K='<div><label style="padding-left: 10px; padding-top: 2px" data-ng-hide="row.entity.clientData.sequenceEdited">{{row.entity.sequence}}</label><button style="position: absolute;top: 0px; right: 0px" data-ng-hide="row.entity.clientData.sequenceEdited || nics.length == 1" class="abg-middle" data-ng-click="row.entity.clientData.sequenceEdited = true" data-tooltip="{{\'globals.edit\' | translate}}"><i class="icon-pencil"></i></button><input data-ng-show="row.entity.clientData.sequenceEdited" type="number" data-ng-model="row.entity.clientData.sequence" class="span1" pattern="[0-9]" min="0"/> <button data-ng-show="row.entity.clientData.sequenceEdited" class="abg-middle" data-ng-click="onSequenceClick(row.entity)" data-ng-disabled="((row.entity.clientData.sequence > (nics.length-1)) || !row.entity.clientData.sequence) && row.entity.clientData.sequence != 0">ok</button></div>',L='<div id="serviceType-{{row.rowIndex}}" class="row-fluid"><ui-select name="serviceType" data-ng-model="row.entity.clientData.serviceType.id"  data-ng-init="row.entity.clientData.serviceType.id = row.entity.clientData.serviceType.id" class="span12" data-ng-change="checkServiceTypeValidity(row.entity)"  id="select-{{row.rowIndex}}"><ui-select-match placeholder="{{ \'globals.select\' | translate }}">{{$select.selected.name}} {{$select.selected.defaultNST && ("servers.physicalmachine.form.networkinterfaces.col.servicetype.default" | translate) || ""}}</ui-select-match><ui-select-choices repeat="serviceType.id as serviceType in serviceTypes | filter: $select.search"> <span>{{serviceType.name}} {{serviceType.defaultNST && ("servers.physicalmachine.form.networkinterfaces.col.servicetype.default" | translate) || ""}}</span></ui-select-choices></ui-select>',M='<div class="grid-template-cell-dot-disabled-enabled"><div class="state-dot-disabled-enabled" data-ng-class="{\'dot-enabled\': row.entity[col.field]}"></div></div>',N='<div style="text-align: center"><i class="icon-lock user-locked-icon" data-ng-show="row.entity.locked" title="{{\'user.form.label.userlocked\' | translate }}"></i><label data-ng-hide="row.entity.locked">-</label></div>',O='<div data-ng-init="row.entity.clientData.editGrid = {};"><button data-ng-hide="row.entity.clientData.editGridMode" class="edit-button" data-ng-click="row.entity.clientData.editGridMode = true;" data-tooltip="{{\'globals.edit\' | translate}}"><i class="icon-pencil"></i></button><button data-ng-show="row.entity.clientData.editGridMode" class="edit-button" data-ng-click="row.entity.clientData.editGridMode = false; cancelRow(row.entity);" data-tooltip="{{\'globals.cancel\' | translate}}"><i class="icon-remove"></i></button><button data-ng-show="row.entity.clientData.editGridMode" class="edit-button" data-ng-click="row.entity.clientData.editGridMode = false; saveRow(row.entity);" data-tooltip="{{\'globals.save\' | translate}}"><i class="icon-save"></i></button></div>',P='<div id="{{col.field}}-{{row.rowIndex}}" class="row-fluid" data-ng-init="row.entity.clientData.editGrid[col.field] = row.entity[col.field]"><span class="span12" data-ng-hide="row.entity.clientData.editGridMode">{{row.entity[col.field]}}</span><input id="{{col.field}}-{{row.rowIndex}}-edit" class="span12" data-ng-show="row.entity.clientData.editGridMode" data-ng-model="row.entity.clientData.editGrid[col.field]"></div>',Q='<div id="{{col.field}}-{{row.rowIndex}}" data-ng-init="row.entity.clientData.editGrid[col.field] = row.entity[col.field]"><div data-u-mb-input data-is-editable="row.entity.clientData.editGridMode" data-input-object="row.entity.clientData.editGrid" data-input-object-parameter="col.field" data-input-in-bytes="true"></div></div>',R='<div class="ngCellText" ng-class="col.colIndex()" data-tooltip-placement="top"><span data-ng-hide="row.entity.clientData.isPersistentDisk" data-tooltip="{{row.getProperty(col.field)}}" ng-cell-text>{{row.getProperty(col.field)}}</span><span data-ng-show="row.entity.clientData.isPersistentDisk" ng-cell-text style="font-style: italic;">{{ \'virtualmachinetemplate.disks.grid.value.filename.persistent\' | translate }}</span></div>',S='<div class="ngCellText" ng-class="col.colIndex()" data-tooltip="{{row.getProperty(col.field)}}" data-tooltip-placement="top"><span ng-cell-text>{{row.getProperty(col.field)}}</span></div>',T='<button data-tooltip="{{\'globals.download\' | translate}}" data-ng-show="row.entity.clientData.downloadUrl && row.entity.state == \'DONE\'" data-ng-click="onDownloadClick(row.entity)"><i class="icon-download-alt"></i></button>',U='<div class="row-fluid span9 checkbox-cell"><input id="disk-{{row.entity.clientData.id}}" u-checkbox type="checkbox"  data-ng-disabled="disks.length > 0 && !row.entity.clientData.selected" data-ng-model="row.entity.clientData.selected" data-ng-change="onItemEnabledChange(row.entity)"> <label class="checkbox inline" for="disk-{{row.entity.clientData.id}}"><span></span> </label> </div>',V='<div class="row-fluid span9 checkbox-cell" data-ui-if="row.entity.path && row.entity.path != \'\'"><input id="entity-{{row.entity.clientData.id}}" u-checkbox type="checkbox"  data-ng-model="row.entity.clientData.selected" data-ng-change="afterSelectionChange(row)"> <label class="checkbox inline" for="entity-{{row.entity.clientData.id}}"><span></span> </label> </div>',W='<div class="row-fluid"><ui-select name="storage" ui-select-dropdown-fixed data-ng-model="row.entity.clientData.selectedStorage"  class="span12"  data-ng-disabled="!row.entity.clientData.selected" data-ng-change="changeStorage(row.entity)"> <ui-select-match placeholder="{{ \'globals.select\' | translate }}">{{$select.selected.name}}</ui-select-match><ui-select-choices repeat="storage in storages | filter: $select.search"> '+"<span>{{storage.clientData.classType == 'volume' | iifTranslate:'persistentvirtualmachinetemplate.create.column.storage.type.volume':'persistentvirtualmachinetemplate.create.column.storage.type.tier'}} {{storage.name}}</span></ui-select-choices></ui-select></div> ";
return angular.extend(b,{deleteHeaderTemplate:c,noLabelHeaderTemplate:d,selectAllHeaderTemplate:e,deleteCellTemplate:f,selectedCellTemplate:g,selectedClientCellTemplate:h,datastoreEnabledCellTemplate:i,approveRejectCellTemplate:j,severityCellTemplate:k,stateCellTemplate:l,stateVMCellTemplate:n,blockedVMCellTemplate:o,stateVMStringCellTemplate:m,infoVMCellTemplate:p,stateConversionCellTemplate:s,stateRemoteServiceCellTemplate:q,sizeUnitInBytesCellTemplate:t,sizeUnitCellTemplate:u,primaryDiskCellTemplate:v,diskDescriptionCellTemplate:w,ipCellTemplate:r,quarantineCell:x,pricingModelCellTemplate:y,selectedStoragePoolCellTemplate:z,portRangeCellTemplate:A,destinationCellTemplate:B,selectUpdatedCellTemplate:C,selectUpdatedProviderIdCellTemplate:D,selectUpdatedNameCellTemplate:E,networkServiceTypeNameTemplate:F,releaseNICForVDCTemplate:G,purchaseNICforVDCTemplate:H,reorderPriorityCell:I,reorderSequenceCell:J,reorderNicSequenceCell:K,serviceTypeCell:L,enabledDisabledTypeCell:M,lockedTypeCell:N,editRowButtonsCell:O,editRowTextInputCell:P,editRowBytesInputCell:Q,diskFileNameCellTemplate:R,templateWithTooltip:S,downloadCellTemplate:T,diskCheckboxCellTemplate:U,selectedDiskCellTemplate:V,storageCellTemplate:W}),b}]),angular.module("layersMgr",["server"]).factory("layersMgr",["$filter","utils","server","dispatcher",function(a,b,c,d){function e(a,b){var d=function(c){n(a,c.collection),angular.forEach(c.collection,function(a){m.push(new l(a))}),void 0!==b&&b(m)},e={rel:"layers",links:a.links};c.getByRel(e,d)}function f(a){var b=m.indexOf(a);m.splice(b,1)}function g(a,b){var e=function(c){d.dispatch("layer.deleted"),void 0!==b&&b({result:c,layer:a})},f={links:a.links,rel:"edit"};c.removeByRel(f,e)}function h(b,e,f){var g=function(){d.dispatch("layer.edited"),void 0!==f&&f()};if(b.links){var h={links:b.links,rel:"edit"};c.putByRel(h,b,g)}else{var i=a("getElementByParameter")(m,{element:e,attribute:"name"});i.name=b.name,f()}}function i(a,b,e,f){var g=function(){e.clientData.toBeAdded=!1,d.dispatch("layer.created"),void 0!==f&&f()},h=c.createLinkByRel(b.links,"edit","virtualmachine"),i={name:e.name,links:[h]},j={links:a.links,rel:"layers"};c.postByRel(j,i,g)}function j(a,b){var c={name:a,clientData:{toBeAdded:!0,virtualApplianceId:b.id}};m.push(new l(c))}var k={},l=function(a){var b=a;return b},m=[],n=function(c,d){var e=[];angular.forEach(m,function(f){if(f.clientData&&f.clientData.toBeAdded&&f.clientData.virtualApplianceId==c.id){var g=a("getElementByParameter")(d,{element:f.name,attribute:"name"});b.isEmptyObject(g)&&e.push(f)}}),m.length=0,angular.extend(m,e)};return angular.extend(k,{layers:m,getLayers:e,deleteLayer:g,deleteLayerInVirtualAppliance:f,createLayer:i,editLayer:h,addLayerInVirtualAppliance:j}),k}]),angular.module("loadBalancersMgr",[]).factory("loadBalancersMgr",["server","dispatcher","$filter","utils",function(a,b,c,d){function e(a){angular.copy(a,x),b.dispatch("currentLoadBalancer.change",{data:x})}function f(b,c,d,e){w.length=0;var f=function(a){w.length=0,angular.forEach(a.collection,function(a){w.push(new B(a))}),void 0!==e&&e(a)},g={links:b.links,rel:"loadbalancers",queryParam:{}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.getByRel(g,f)}function g(b,d,e){y.length=0;var f=function(a){angular.forEach(a.collection,function(a){y.push(new C(a))}),void 0!==e&&e(a)},g={links:b.links,rel:"addresses"},h={id:"public",endpoint:c("translate")("loadbalancers.create.type.public.address"),internal:!1};y.push(new C(h));var h={id:"private",endpoint:c("translate")("loadbalancers.create.type.private.address"),internal:!0};y.push(new C(h)),d&&a.getByRel(g,f)}function h(e,f,g,h,i,j,k){var l=function(a){void 0!==k&&k(a),b.dispatch("loadBalancer.created"),d.toastrSuccess(c("translate")("action.create.success.loadBalancer.text",{loadBalancer:e.name}))},m=function(a){e.clientData.attachedNodesEdited?r(a,e.clientData.nodes,null,l):l()},n=a.createLinkByRel(f.links,"edit","virtualdatacenter");e.links.push(n),angular.forEach(h,function(b){if(b.clientData.selected){var c=a.createLinkByRel(b.links,"edit","privatenetwork");e.links.push(c)}}),angular.forEach(i,function(b){if(b.clientData.selected)if(b.id===parseInt(b.id)){var c=a.createLinkByRel(b.links,"edit","loadbalanceraddress");e.links.push(c)}else{e.loadBalancerAddresses||(e.loadBalancerAddresses={collection:[]});var d={internal:b.internal};e.loadBalancerAddresses.collection.push(d)}}),angular.forEach(j,function(b){if(b.clientData.selected){var c=a.createLinkByRel(b.links,"edit","firewall");e.links.push(c)}});var o={links:g.links,rel:"loadbalancers",type:"application/vnd.abiquo.loadbalancer+json",contentType:"application/vnd.abiquo.loadbalancer+json"};a.postByRel(o,e,m)}function i(e,f,g,h,i){var j=function(a){void 0!==i&&i(a),b.dispatch("loadBalancer.edited"),d.toastrSuccess(c("translate")("action.edit.success.loadBalancer.text",{loadBalancer:e.name}))},k=function(){e.clientData.attachedNodesEdited?r(e,e.clientData.nodes,null,j):j()},l=function(){var b=function(){d--,0==d&&m()};if(e.clientData.routingRulesEdited){e.clientData.routingRules=c("orderBy")(e.clientData.routingRules,"links",!0);var d=0;angular.forEach(e.clientData.routingRules,function(c){c.links?c.clientData&&c.clientData.toBeDeleted&&(d++,n={links:c.links,rel:"edit"},a.removeByRel(n,b,b)):(d++,n={links:e.links,rel:"routingrules",type:"application/vnd.abiquo.routingrule+json",contentType:"application/vnd.abiquo.routingrule+json"},a.postByRel(n,c,b,b))})}else m()},m=function(){var b=function(){c--,0==c&&k()};if(e.clientData.healthChecksEdited){var c=0;angular.forEach(e.clientData.healthChecks,function(d){d.links?d.clientData&&d.clientData.toBeDeleted&&(c++,n={links:d.links,rel:"edit"},a.removeByRel(n,b,b)):(c++,n={links:e.links,rel:"healthchecks",type:"application/vnd.abiquo.healthcheck+json",contentType:"application/vnd.abiquo.healthcheck+json"},a.postByRel(n,d,b,b))})}else k()};a.removeAllLinksByRel(e.links,"privatenetwork"),angular.forEach(f,function(b){if(b.clientData.selected){var c=a.createLinkByRel(b.links,"edit","privatenetwork");e.links.push(c)}}),a.removeAllLinksByRel(e.links,"loadbalanceraddress"),angular.forEach(g,function(b){if(b.clientData.selected)if(b.id===parseInt(b.id)){var c=a.createLinkByRel(b.links,"edit","loadbalanceraddress");e.links.push(c)}else{e.loadBalancerAddresses||(e.loadBalancerAddresses={collection:[]});var d={internal:b.internal};e.loadBalancerAddresses.collection.push(d)}}),a.removeAllLinksByRel(e.links,"firewall"),angular.forEach(h,function(b){if(b.clientData.selected){var c=a.createLinkByRel(b.links,"edit","firewall");e.links.push(c)}}),console.log(e);var n={links:e.links,rel:"edit"};a.putByRel(n,e,l)}function j(f,g){var h=function(a){void 0!==g&&g(a),b.dispatch("loadBalancer.deleted"),d.toastrSuccess(c("translate")("action.delete.success.loadBalancer.text",{loadBalancer:f.name})),e(null)},i={rel:"edit",links:f.links};a.removeByRel(i,h)}function k(c,d){var e=function(a){void 0!==d&&d(a),b.dispatch("loadBalancer.edited")},f={links:c.links,rel:"loadbalancers",queryParam:{source:"remote",syncvms:!0}};a.getByRel(f,e)}function l(b,c){var d=function(a){b.clientData.routingRules.length=0,angular.forEach(a.collection,function(a){var c=new D(a);b.clientData.routingRules.push(c)}),void 0!==c&&c(a)},e={links:b.links,rel:"routingrules"};a.getByRel(e,d)}function m(b,c){z.length=0;var d=function(a){angular.forEach(a.collection,function(a){z.push(a)}),void 0!==c&&c(a)},e={links:b.links,rel:"sslcertificates"};a.getByRel(e,d)}function n(b,c){var d=function(a){b.clientData.healthChecks.length=0,angular.forEach(a.collection,function(a){var c=new E(a);b.clientData.healthChecks.push(c)}),void 0!==c&&c(a)},e={links:b.links,rel:"healthchecks"};a.getByRel(e,d)}function o(b,c){b.clientData.extendedFirewalls.length=0;var d=0,e=function(a){d--;var e=new F(a);b.clientData.extendedFirewalls.push(e),0==d&&void 0!=c&&c()};angular.forEach(b.links,function(b){if("firewall"==b.rel){var c={path:b.href,type:b.type,absolutPath:!0};d++,a.get(c,e)}})}function p(b,c){var d=function(a){b.clientData.addresses.length=0,angular.forEach(a.collection,function(a){var c=new C(a,b);b.clientData.addresses.push(c)}),void 0!==c&&c(a)},e={links:b.links,rel:"addresses"};a.getByRel(e,d)}function q(a,c){z.push(a),void 0!=c&&c(),b.dispatch("sslCertificate.created",{certificate:a})}function r(b,c,d,e){var f=function(){void 0!==e&&e()};if(d)var g=d;else{var g={links:[]};angular.forEach(c,function(b){if(b.links){var c=a.createLinkByRel(b.links,"edit","virtualmachine");g.links.push(c)}else g.links.push(b)})}var h={links:b.links,rel:"virtualmachines",type:"*/*",contentType:"application/vnd.abiquo.links+json"};a.putByRel(h,g,f)}function s(b,c){var d=function(a){b.clientData.nodes.length=0,angular.forEach(a.links,function(a){var c=new G(a);b.clientData.nodes.push(c)}),void 0!==c&&c(a)},e={links:b.links,rel:"virtualmachines"};a.getByRel(e,d)}function t(b,c,d,e){var f=function(f){var g=a.createLinkByRel(c.links,"edit","virtualmachine");d?f.links.push(g):a.removeLinkByRel(f.links,"virtualmachine",g.title),r(b,null,f,e)};s(b,f)}var u={},v=function(){var a={};return a.name="name",a},w=[],x={},y=[],z=[],A=v(),B=function(b){var c=b||{};c.clientData={subnets:[],addresses:[],routingRules:[],healthChecks:[],firewalls:[],extendedFirewalls:[],nodes:[]};var d=a.getClientdataFromLinksByRel(b.links,"edit","loadbalancers");return c.id=d.id,H(b),I(b),c},C=function(b,c){var d=b||{};if(d.clientData={},b.links){var e=a.getClientdataFromLinksByRel(b.links,"edit","addresses");d.id=e.id,d.name=e.name}return c&&(d.internal?c.clientData["private"]=!0:c.clientData["public"]=!0),d},D=function(a){var b=a||{};return b.clientData={},b},E=function(a){var b=a||{};return b.clientData={},b},F=function(a){var b=a||{};return b.clientData={},b},G=function(b){var c=b||{},d=a.getClientdataFromLinksByRel([b],"virtualmachine");return c.id=d.id,c.name=d.name,c},H=function(b){angular.forEach(b.links,function(c){if("privatenetwork"==c.rel){var d=a.getClientdataFromLinksByRel([c],"privatenetwork");b.clientData.subnets.push(d)}})},I=function(b){angular.forEach(b.links,function(c){if("firewall"==c.rel){var d=a.getClientdataFromLinksByRel([c],"firewall");b.clientData.firewalls.push(d)}})};return angular.extend(u,{LoadBalancer:B,sortMapping:A,loadBalancers:w,currentLoadBalancer:x,addresses:y,sslCertificates:z,getAvailableLoadBalancersByVdc:f,setCurrentLoadBalancer:e,getAddressesByLocation:g,createLoadBalancer:h,editLoadBalancer:i,deleteLoadBalancer:j,synchronizeLoadBalancersByVirtualDatacenter:k,getLoadBalancerAddresses:p,addSslCertificates:q,getSslCertificatesByLocation:m,getLoadBalancerRoutingRules:l,getLoadBalancerHealthChecks:n,getLoadBalancerFirewalls:o,getLoadBalancerAttachedNodes:s,editLoadBalancerNodes:r,modifyLoadBalancerVirtualMachines:t}),u}]),angular.module("loggerMgr",[]).factory("loggerMgr",["toastr",function(a){function b(a){var b=a.getDate(),d=a.getMonth()+1,e=a.getFullYear(),f=c(a.getHours()),g=c(a.getMinutes()),h=c(a.getSeconds()),i=d+"/"+b+"/"+e+" - "+f+":"+g+":"+h;return i}function c(a){var b=a;return 10>a&&(b="0"+b),b}function d(b,c){g(new k(c,"warning"),i.warnings),b&&a.warning(c)}function e(b,c){g(new k(c,"success"),i.successes),b&&a.success(c)}function f(b,c){g(new k(c,"error"),i.errors),b&&a.error(c,null,{timeOut:36e5})}function g(a,b){b.push(a),b.length>j&&b.shift()}var h={},i={warnings:[],errors:[],successes:[]},j=40,k=function(a,c,d){var e={};return e.message=a,e.type=c,e.date=d?d:new Date,e.dateString=function(){return b(e.date)},e};return angular.extend(h,{logs:i,addWarning:d,addSuccess:e,addError:f}),h}]),angular.module("mockData",["ngMockE2E"]).factory("mockData",function(){var a={};return a.user={links:[{rel:"edit",type:"application/vnd.abiquo.user+xml",href:"http://example.com/api/admin/enterprises/1/enterprises/1"},{rel:"enterprise",type:"application/vnd.abiquo.enterprise+xml",href:"http://example.com/api/admin/enterprises/1"},{rel:"role",type:"application/vnd.abiquo.role+xml",href:"http://example.com/api/admin/roles/1"}],active:!0,authType:"ABIQUO",description:"Main administrator",email:"admin@abiquo.com",id:"1",locale:"en_US",name:"Admin",nick:"admin",password:"c69a39bd64ffb77ea7ee3369dce742f3",surname:"Administrator"},a.role={links:[{rel:"privileges",type:"application/vnd.abiquo.privileges+xml",href:"http://example.com/api/admin/roles/1/action/privileges"},{rel:"edit",type:"application/vnd.abiquo.role+xml",href:"http://example.com/api/admin/roles/1"}],blocked:!1,id:"1",name:"ENTERPRISE_ADMIN"},a.privileges=[{id:"3",name:"ENTERPRISE_RESOURCE_SUMMARY_ENT"},{id:"57",name:"ENTERPRISE_SHOW_STATS_LIMITS"},{id:"12",name:"VDC_ENUMERATE"},{id:"13",name:"VDC_MANAGE"},{id:"14",name:"VDC_MANAGE_VAPP"},{id:"15",name:"VAPP_DEPLOY_UNDEPLOY"},{id:"16",name:"VDC_MANAGE_STORAGE"},{id:"17",name:"PRICING_VIEW"}],a.enterprise={links:[{rel:"externalnetworks",type:"application/vnd.abiquo.vlans+xml",href:"http://example.com/api/admin/enterprises/1/action/externalnetworks"},{rel:"publicnetworks",type:"application/vnd.abiquo.vlans+xml",href:"http://example.com/api/admin/enterprises/1/action/publicnetworks"}],id:"1",name:"Empresa 1"},a.datacenters=[{name:"Datacenter 1",id:"1",hypervisors:[{name:"Hypervisor 1",id:"1"},{name:"HypervigetVirtualDatacenterByEnterprisesor 2",id:"2"}]},{name:"Datacenter 2",id:"2"},{name:"Datacenter 3",id:"3",hypervisors:[{name:"Hypervisor 1",id:"1"}]}],a.virtualDatacenters=[{links:[{href:"http://example.com/api/cloud/virtualdatacenters/1/virtualappliances",rel:"virtualappliances",type:"application/vnd.abiquo.virtualappliances+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/1",rel:"edit",type:"application/vnd.abiquo.virtualdatacenter+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/1/volumes/action/statefulcandidates",rel:"statefulcandidates",type:"application/vnd.abiquo.iscsivolumes+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/1/action/templates",rel:"templates",type:"application/vnd.abiquo.virtualmachinetemplates+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/1/privatenetworks",rel:"privatenetworks",type:"application/vnd.abiquo.vlans+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/1/volumes",rel:"volumes",type:"application/vnd.abiquo.iscsivolumes+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/1/action/defaultvlan",rel:"defaultvlan",title:"GET",type:"application/vnd.abiquo.vlan+xml"}],name:"Virtual Datacenter 1",id:"1",datacenter:{name:"Datacenter 1",id:"1",hypervisors:[{name:"Hypervisor 1",id:"1"},{name:"Hypervisor 2",id:"2"}]},ramHard:200,ramSoft:50,cpuHard:200,cpuSoft:60,hdHard:200,hdSoft:70,storageHardInMb:200,storageSoftInMb:80,vlansHard:200,vlansSoft:90,publicIpsHard:200,publicIpsSoft:100},{links:[{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances",rel:"virtualappliances",type:"application/vnd.abiquo.virtualappliances+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/2",rel:"edit",type:"application/vnd.abiquo.virtualdatacenter+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/2/volumes/action/statefulcandidates",rel:"statefulcandidates",type:"application/vnd.abiquo.iscsivolumes+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/2/action/templates",rel:"templates",type:"application/vnd.abiquo.virtualmachinetemplates+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/2/privatenetworks",rel:"privatenetworks",type:"application/vnd.abiquo.vlans+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/2/volumes",rel:"volumes",type:"application/vnd.abiquo.iscsivolumes+xml"},{href:"http://example.com/api/cloud/virtualdatacenters/2/action/defaultvlan",rel:"defaultvlan",title:"GET",type:"application/vnd.abiquo.vlan+xml"}],name:"Virtual Datacenter 2",id:"2",datacenter:{name:"Datacenter 2",id:"2",hypervisors:[{name:"Hypervisor 3",id:"3"},{name:"Hypervisor 4",id:"4"}]},ramHard:300,ramSoft:50,cpuHard:300,cpuSoft:60,hdHard:300,hdSoft:70,storageHardInMb:300,storageSoftInMb:80,vlansHard:300,vlansSoft:90,publicIpsHard:300,publicIpsSoft:100}],a.defaultVlan1={vlanNetworkId:1},a.defaultVlan2={vlanNetworkId:2},a.virtualAppliances1=[{name:"Virtual Appliance 1",id:"1",error:"0",highDisponibility:"0",publicApp:"0",state:"NOT_DEPLOYED",virtualDatacenter:{id:"1"},links:[{href:"http://example.com/api/cloud/virtualdatacenters/1/virtualappliances/1/action/deploy",type:"application/vnd.abiquo.virtualappliance+xml",rel:"deploy"},{href:"http://example.com/api/cloud/virtualdatacenters/1/virtualappliances/1",type:"application/vnd.abiquo.virtualappliance+xml",rel:"edit"},{href:"http://example.com/api/admin/enterprises/1",type:"application/vnd.abiquo.virtualappliance+xml",rel:"enterprise"},{href:"http://example.com/api/cloud/virtualdatacenters/1/virtualappliances/1/layers",type:"text/plain",rel:"layers"},{href:"http://example.com/api/cloud/virtualdatacenters/1/virtualappliances/1/action/price",type:"application/vnd.abiquo.virtualappliance+xml",rel:"price"},{href:"http://example.com/api/cloud/virtualdatacenters/1/virtualappliances/1/action/state",type:"application/vnd.abiquo.virtualappliance+xml",rel:"state"},{href:"http://example.com/api/cloud/virtualdatacenters/1/virtualdatacenters/1/action/undeploy",type:"application/vnd.abiquo.virtualappliance+xml",rel:"undeploy"},{href:"http://example.com/api/cloud/virtualdatacenters/1/",type:"application/vnd.abiquo.virtualappliance+xml",rel:"virtualdatacenter"},{href:"http://example.com/api/cloud/virtualdatacenters/1/virtualappliances/1/virtualmachines",type:"application/vnd.abiquo.virtualappliance+xml",rel:"virtualmachines"}]}],a.virtualAppliances2=[{name:"Virtual Appliance 2",id:"2",error:"1",highDisponibility:"0",publicApp:"0",state:"NOT_DEPLOYED",virtualDatacenter:{id:"2"},links:[{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/2/action/deploy",type:"application/vnd.abiquo.virtualappliance+xml",rel:"deploy"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/2",type:"application/vnd.abiquo.virtualappliance+xml",rel:"edit"},{href:"http://example.com/api/admin/enterprises/1",type:"application/vnd.abiquo.virtualappliance+xml",rel:"enterprise"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/2/layers",type:"text/plain",rel:"layers"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/2/action/price",type:"application/vnd.abiquo.virtualappliance+xml",rel:"price"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/2/action/state",type:"application/vnd.abiquo.virtualappliance+xml",rel:"state"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualdatacenters/2/action/undeploy",type:"application/vnd.abiquo.virtualappliance+xml",rel:"undeploy"},{href:"http://example.com/api/cloud/virtualdatacenters/2/",type:"application/vnd.abiquo.virtualappliance+xml",rel:"virtualdatacenter"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/2/virtualmachines",type:"application/vnd.abiquo.virtualappliance+xml",rel:"virtualmachines"}]},{name:"Virtual Appliance 3",id:"3",error:"0",highDisponibility:"0",publicApp:"0",state:"LOCKED",virtualDatacenter:{id:"2"},links:[{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/1/action/deploy",type:"application/vnd.abiquo.virtualappliance+xml",rel:"deploy"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/3",type:"application/vnd.abiquo.virtualappliance+xml",rel:"edit"},{href:"http://example.com/api/admin/enterprises/1",type:"application/vnd.abiquo.virtualappliance+xml",rel:"enterprise"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/3/layers",type:"text/plain",rel:"layers"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/3/action/price",type:"application/vnd.abiquo.virtualappliance+xml",rel:"price"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/3/action/state",type:"application/vnd.abiquo.virtualappliance+xml",rel:"state"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualdatacenters/3/action/undeploy",type:"application/vnd.abiquo.virtualappliance+xml",rel:"undeploy"},{href:"http://example.com/api/cloud/virtualdatacenters/2/",type:"application/vnd.abiquo.virtualappliance+xml",rel:"virtualdatacenter"},{href:"http://example.com/api/cloud/virtualdatacenters/2/virtualappliances/3/virtualmachines",type:"application/vnd.abiquo.virtualappliance+xml",rel:"virtualmachines"}]}],a.volumes=[{name:"Volume 1",id:1,state:"DETACHED",sizeInMB:32e3,sequence:0,virtualDatacenter:{name:"Virtual Datacenter 1"},virtualAppliance:{name:"Virtual Appliance 1"},virtualMachine:{name:"Virtual Machine 1"},tier:{name:"Tier 1"},links:[]},{name:"Volume 2",id:2,state:"ATTACHED",sizeInMB:64e3,sequence:1,virtualDatacenter:{name:"Virtual Datacenter 1"},virtualAppliance:{name:"Virtual Appliance 1"},virtualMachine:{name:"Virtual Machine 1"},tier:{name:"Tier 1"},links:[]}],a.allVolumes=[{name:"Volume 1",id:1,state:"DETACHED",sizeInMB:32e3,sequence:0,virtualDatacenter:{name:"Virtual Datacenter 1"},virtualAppliance:{name:"Virtual Appliance 1"},virtualMachine:{name:"Virtual Machine 1"},tier:{name:"Tier 1"},links:[]},{name:"Volume 2",id:2,state:"ATTACHED",sizeInMB:64e3,sequence:1,virtualDatacenter:{name:"Virtual Datacenter 1"},virtualAppliance:{name:"Virtual Appliance 1"},virtualMachine:{name:"Virtual Machine 1"},tier:{name:"Tier 1"},links:[]},{name:"Volume 3",id:2,state:"DETACHED",sizeInMB:16e3,sequence:2,virtualDatacenter:{name:"Virtual Datacenter 2"},virtualAppliance:{name:"Virtual Appliance 1"},virtualMachine:{name:"Virtual Machine 1"},tier:{name:"Tier 1"},links:[]},{name:"Volume 4",id:2,state:"ATTACHED",sizeInMB:8e3,sequence:3,virtualDatacenter:{name:"Virtual Datacenter 2"},virtualAppliance:{name:"Virtual Appliance 1"},virtualMachine:{name:"Virtual Machine 1"},tier:{name:"Tier 1"},links:[]}],a.tiers=[{name:"Default Tier 1",id:1,links:[]},{name:"Default Tier 2",id:2,links:[]},{name:"Default Tier 3",id:3,links:[]},{name:"Default Tier 4",id:4,links:[]}],a.layers1=[{name:"Layer 1"}],a.layers2=[{name:"Layer 2"},{name:"Layer 3"}],a.layers3=[{name:"Layer 4"}],a.privateNetworks=[{name:"DefaultNetwork",id:1,address:"192.168.1.0",mask:"11",type:"INTERNAL",links:[{href:"http://example.com/api/cloud/virtualdatacenters/1/privatenetworks/1/ips",type:"application/vnd.abiquo.privateips+xml",rel:"ips"}]},{name:"DefaultNetwork",id:2,address:"192.168.1.0",mask:"12",type:"INTERNAL",links:[{href:"http://example.com/api/cloud/virtualdatacenters/1/privatenetworks/2/ips",type:"application/vnd.abiquo.privateips+xml",rel:"ips"}]},{name:"DefaultNetwork",id:3,address:"192.168.1.0",mask:"13",type:"INTERNAL",links:[{href:"http://example.com/api/cloud/virtualdatacenters/1/privatenetworks/3/ips",type:"application/vnd.abiquo.privateips+xml",rel:"ips"}]}],a.externalNetworks=[{name:"1234567890123456:000555555550",id:4,address:"192.168.1.0",mask:"14",type:"EXTERNAL"},{name:"1234567890123456:000666666660",id:5,address:"192.168.1.0",mask:"15",type:"EXTERNAL"}],a.publicNetworks=[{name:"1234567890123456:000777777770",id:6,address:"192.168.1.0",mask:"16",type:"PUBLIC"}],a.privateIps1=[{name:"00505611d4a1_host",id:1,ip:"192.168.1.1",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"},{name:"00505611d4a2_host",id:2,ip:"192.168.1.2",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"},{name:"00505611d4a3_host",id:3,ip:"192.168.1.3",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"},{name:"00505611d4a4_host",id:4,ip:"192.168.1.4",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"},{name:"00505611d4a5_host",id:5,ip:"192.168.1.5",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"},{name:"00505611d4a6_host",id:6,ip:"192.168.1.6",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"}],a.privateIps2=[{name:"00505611d4a10_host",id:10,ip:"192.168.1.1",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"},{name:"00505611d4a20_host",id:20,ip:"192.168.1.2",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"},{name:"00505611d4a30_host",id:30,ip:"192.168.1.3",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"},{name:"00505611d4a40_host",id:40,ip:"192.168.1.4",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"},{name:"00505611d4a50_host",id:50,ip:"192.168.1.5",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"}],a.privateIps3=[{name:"00505611d4a200_host",id:100,ip:"192.168.1.1",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"},{name:"00505611d4a300_host",id:200,ip:"192.168.1.2",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"},{name:"00505611d4a400_host",id:300,ip:"192.168.1.3",mac:"00:50:56:11:d4:a2",networkName:"default_network",virtualApplianceName:"Virtual Appliance",virtualMachineName:"Virtual Machine"}],a.virtualMachineTemplates1=[{id:1,name:"Virtual Machine Template 1",description:"Description",osType:"OSType",osVersion:"OS Version",path:"1/rs.bcn.abiquo.com/abiport9000/ovf/53/abiquo-vbox-v2.qcow2",diskFormatType:"Disk Format Type",diskFileSize:1024,cpuRequired:1,ramRequired:512,hdRequired:4294967296,shared:!1,state:"VMTemplateState",creationDate:"013-01-30T17:51:18+01:00",creationUser:"System",chefEnabled:!1,iconUrl:"http://rs.bcn.abiquo.com:9000/public/icons/q.png",loginUser:"user",loginPassword:"password",ethernetDriverType:"EthernetDriverType",diskControllerType:"DiskControllerType",category:{name:"OS",id:"6"}},{id:2,name:"Virtual Machine Template 2",description:"Description",osType:"OSType",osVersion:"OS Version",path:"1/rs.bcn.abiquo.com/abiport9000/ovf/53/abiquo-vbox-v2.qcow2",diskFormatType:"Disk Format Type",diskFileSize:1024,cpuRequired:1,ramRequired:512,hdRequired:4294967296,shared:!1,state:"VMTemplateState",creationDate:"013-01-30T17:51:18+01:00",creationUser:"System",chefEnabled:!1,iconUrl:"http://rs.bcn.abiquo.com:9000/public/icons/q.png",loginUser:"user",loginPassword:"password",ethernetDriverType:"EthernetDriverType",diskControllerType:"DiskControllerType",category:{name:"Firewall",id:"7"}}],a.virtualMachineTemplates2=[{id:3,name:"Virtual Machine Template 3",description:"Description",osType:"OSType",osVersion:"OS Version",path:"1/rs.bcn.abiquo.com/abiport9000/ovf/53/abiquo-vbox-v2.qcow2",diskFormatType:"Disk Format Type",diskFileSize:1024,cpuRequired:1,ramRequired:512,hdRequired:4294967296,shared:!1,state:"VMTemplateState",creationDate:"013-01-30T17:51:18+01:00",creationUser:"System",chefEnabled:!1,iconUrl:"http://rs.bcn.abiquo.com:9000/public/icons/q.png",loginUser:"user",loginPassword:"password",ethernetDriverType:"EthernetDriverType",diskControllerType:"DiskControllerType",category:{name:"OS",id:"6"}},{id:4,name:"Virtual Machine Template 4",description:"Description",osType:"OSType",osVersion:"OS Version",path:"1/rs.bcn.abiquo.com/abiport9000/ovf/53/abiquo-vbox-v2.qcow2",diskFormatType:"Disk Format Type",diskFileSize:1024,cpuRequired:1,ramRequired:512,hdRequired:4294967296,shared:!1,state:"VMTemplateState",creationDate:"013-01-30T17:51:18+01:00",creationUser:"System",chefEnabled:!1,iconUrl:"http://rs.bcn.abiquo.com:9000/public/icons/q.png",loginUser:"user",loginPassword:"password",ethernetDriverType:"EthernetDriverType",diskControllerType:"DiskControllerType",category:{name:"Firewall",id:"7"}}],a.virtualMachinePersistentTemplates=[{name:"Persistent Virtual Machine Template 1",id:1,description:"Description",state:"DONE",sizeInMB:32e3,virtualDatacenter:{name:"Virtual Datacenter 1"},virtualAppliance:{name:"Virtual Appliance 1"},virtualMachine:{name:"Virtual Machine 1"},tier:{name:"Tier 1"},used:!0,master:{name:"Master 1"},iconUrl:"http://rs.bcn.abiquo.com:9000/public/icons/q.png",chefEnabled:!0,diskFormatType:"Disk Format Type",diskFileSize:1024,cpuRequired:1,ramRequired:512,links:[]},{name:"Persistent Virtual Machine Template 2",id:2,description:"Description",state:"DETACHED",sizeInMB:32e3,virtualDatacenter:{name:"Virtual Datacenter 2"},virtualAppliance:{name:"Virtual Appliance 2"},virtualMachine:{name:"Virtual Machine 2"},tier:{name:"Tier 3"},used:!1,master:{name:"Master 2"},iconUrl:"http://rs.bcn.abiquo.com:9000/public/icons/q.png",chefEnabled:!0,diskFormatType:"Disk Format Type",diskFileSize:1024,cpuRequired:3,ramRequired:512,links:[]}],a.allVirtualMachinePersistentTemplates=[{name:"Persistent Virtual Machine Template 1",id:1,description:"Description",state:"DONE",sizeInMB:32e3,virtualDatacenter:{name:"Virtual Datacenter 1"},virtualAppliance:{name:"Virtual Appliance 1"},virtualMachine:{name:"Virtual Machine 1"},tier:{name:"Tier 1"},used:!0,master:{name:"Master 1"},iconUrl:"http://rs.bcn.abiquo.com:9000/public/icons/q.png",chefEnabled:!0,diskFormatType:"Disk Format Type",diskFileSize:1024,cpuRequired:1,ramRequired:512,links:[]},{name:"Persistent Virtual Machine Template 2",id:2,description:"Description",state:"DETACHED",sizeInMB:32e3,virtualDatacenter:{name:"Virtual Datacenter 2"},virtualAppliance:{name:"Virtual Appliance 2"},virtualMachine:{name:"Virtual Machine 2"},tier:{name:"Tier 3"},used:!1,master:{name:"Master 2"},iconUrl:"http://rs.bcn.abiquo.com:9000/public/icons/q.png",chefEnabled:!0,diskFormatType:"Disk Format Type",diskFileSize:1024,cpuRequired:3,ramRequired:512,links:[]},{name:"Persistent Virtual Machine Template 3",id:2,description:"Description",state:"DETACHED",sizeInMB:32e3,virtualDatacenter:{name:"Virtual Datacenter 2"},virtualAppliance:{name:"Virtual Appliance 2"},virtualMachine:{name:"Virtual Machine 2"},tier:{name:"Tier 3"},used:!1,master:{name:"Master 2"},iconUrl:"http://rs.bcn.abiquo.com:9000/public/icons/q.png",chefEnabled:!0,diskFormatType:"Disk Format Type",diskFileSize:1024,cpuRequired:3,ramRequired:512,links:[]},{name:"Persistent Virtual Machine Template 4",id:2,description:"Description",state:"DETACHED",sizeInMB:32e3,virtualDatacenter:{name:"Virtual Datacenter 2"},virtualAppliance:{name:"Virtual Appliance 2"},virtualMachine:{name:"Virtual Machine 2"},tier:{name:"Tier 3"},used:!1,master:{name:"Master 2"},iconUrl:"http://rs.bcn.abiquo.com:9000/public/icons/q.png",chefEnabled:!0,diskFormatType:"Disk Format Type",diskFileSize:1024,cpuRequired:3,ramRequired:512,links:[]}],a.virtualMachineTemplateCategories=[{name:"Others",id:"1"},{name:"Database servers",id:"2"},{name:"Application servers",id:"4"},{name:"Web servers",id:"5"},{name:"OS",id:"6"},{name:"Firewall",id:"7"},{name:"Chef",id:"8"}],a.virtualMachines=[{cpu:"2",layer:null,hdInBytes:"27262976",id:"1",idState:"1",idType:"1",name:"VMachine 1",ram:"128",state:"NOT_ALLOCATED",uuid:"5ca657fa-ed61-4aa4-95b9-cd76d46ed63c",vdrpPort:"0",nodeId:"1",nodeName:"Name node 1",x:"0",y:"0",category:{name:"Others",id:"1"},links:[]},{cpu:"2",layer:null,hdInBytes:"27262976",id:"2",idState:"1",idType:"1",name:"VMachine 2",ram:"128",state:"NOT_ALLOCATED",uuid:"5ca657fa-ed61-4aa4-95b9-cd76d46ed63c",vdrpPort:"0",nodeId:"1",nodeName:"Name node 2",x:"0",y:"0",category:{name:"OS",id:"6"},links:[]},{cpu:"2",layer:null,hdInBytes:"27262976",id:"3",idState:"1",idType:"1",name:"VMachine 3",ram:"128",state:"NOT_ALLOCATED",uuid:"5ca657fa-ed61-4aa4-95b9-cd76d46ed63c",
vdrpPort:"0",nodeId:"1",nodeName:"Name node 3",x:"0",y:"0",category:{name:"OS",id:"6"},links:[]},{cpu:"2",layer:"Layer 1",hdInBytes:"27262976",id:"4",idState:"1",idType:"1",name:"VMachine 4",ram:"128",state:"NOT_ALLOCATED",uuid:"5ca657fa-ed61-4aa4-95b9-cd76d46ed63c",vdrpPort:"0",nodeId:"1",nodeName:"Name node 3",x:"0",y:"0",category:{name:"OS",id:"6"},links:[]},{cpu:"2",layer:"Layer 1",hdInBytes:"27262976",id:"5",idState:"1",idType:"1",name:"VMachine 5",ram:"128",state:"NOT_ALLOCATED",uuid:"5ca657fa-ed61-4aa4-95b9-cd76d46ed63c",vdrpPort:"0",nodeId:"1",nodeName:"Name node 3",x:"0",y:"0",category:{name:"Firewall",id:"7"},links:[]}],a.pricingModels=[{links:[{href:"http://example.com/api/config/pricingtemplates/1/costcodes",rel:"costcodes",type:"application/vnd.abiquo.pricingcostcode+xml"},{href:"http://example.com/api/config/currencies/1",rel:"currency",type:"application/vnd.abiquo.currency+xml"},{href:"http://example.com/api/config/pricingtemplates/1",rel:"edit",type:"application/vnd.abiquo.pricingtemplate+xml"},{href:"http://example.com/api/config/pricingtemplates/1/tiers",rel:"tiers",type:"application/vnd.abiquo.pricingtier+xml"}],chargingPeriod:4,defaultTemplate:"defaultTemplate",description:"description",hdGB:0,id:1,layer:0,memoryGB:0,minimumCharge:3,minimumChargePeriod:0,name:"JC-pt-updated",publicIp:0,showChangesBefore:!0,showMinimumCharge:!1,standingChargePeriod:0,vcpu:0,vlan:0}],a.currency={links:[{href:"http://example.com/api/config/currencies/1",type:"application/vnd.abiquo.currency+xml",rel:"edit"}],digits:2,id:1,name:"Euro",symbol:""},a.events=[{name:"Event 1",id:"1"},{name:"Event 2",id:"2"},{name:"Event 3",id:"3"}],a.systemProperties=[{links:[{href:"http://10.60.20.60:80/api/config/properties/54",rel:"edit",type:"application/vnd.abiquo.systemproperty+xml"}],id:54,name:"client.wiki.vdc.createVapp",value:"http://wiki.abiquo.com/display/ABI24/Basic+operations#BasicOperations-CreatingaNewVirtualAppliance",description:"virtual app creation wiki"},{links:[{href:"http://10.60.20.60:80/api/config/properties/53",rel:"edit",type:"application/vnd.abiquo.systemproperty+xml"}],id:53,name:"client.wiki.vdc.createVdc",value:"http://wiki.abiquo.com/display/ABI24/Manage+Virtual+Datacenters#ManageVirtualDatacenters-CreatingaVirtualDatacenter",description:"virtual datacenter creation wiki"},{links:[{href:"http://10.60.20.60:80/api/config/properties/57",rel:"edit",type:"application/vnd.abiquo.systemproperty+xml"}],id:57,name:"client.wiki.vdc.createVolume",value:"http://wiki.abiquo.com/display/ABI24/Manage+Virtual+Storage#ManageVirtualStorage-CreatingaVolumeofManagedStorage",description:"VDC virtual volume creation wiki"},{links:[{href:"http://10.60.20.60:80/api/config/properties/156",rel:"edit",type:"application/vnd.abiquo.systemproperty+xml"}],id:156,name:"client.network.defaultAddress",value:"192.168.0.0",description:"default private vlan address"},{links:[{href:"http://10.60.20.60:80/api/config/properties/127",rel:"edit",type:"application/vnd.abiquo.systemproperty+xml"}],id:127,name:"client.network.defaultGateway",value:"192.168.0.1",description:"default private vlan gateway"},{links:[{href:"http://10.60.20.60:80/api/config/properties/148",rel:"edit",type:"application/vnd.abiquo.systemproperty+xml"}],id:148,name:"client.network.defaultName",value:"defaulttest",description:"default private vlan name"},{links:[{href:"http://10.60.20.60:80/api/config/properties/178",rel:"edit",type:"application/vnd.abiquo.systemproperty+xml"}],id:178,name:"client.network.defaultNetmask",value:2,description:"index of available netmask"},{links:[{href:"http://10.60.20.60:80/api/config/properties/96",rel:"edit",type:"application/vnd.abiquo.systemproperty+xml"}],id:96,name:"client.network.defaultPrimaryDNS",value:"",description:"default primary DNS"},{links:[{href:"http://10.60.20.60:80/api/config/properties/124",rel:"edit",type:"application/vnd.abiquo.systemproperty+xml"}],id:124,name:"client.network.defaultSecondaryDNS",value:"",description:"default secondary DNS"},{links:[{href:"http://10.60.20.60:80/api/config/properties/108",rel:"edit",type:"application/vnd.abiquo.systemproperty+xml"}],id:108,name:"client.network.defaultSufixDNS",value:"",description:"default sufix DNS"}],a}).run(function(a,b,c,d){c.warn("TO REMOVE: running mockInterceptor");var e=d.config["config.endpoint"];a.whenGET(e+"/login").respond(function(a,c,d){return[200,b.user]}),a.whenGET(e+"/admin/roles/1").respond(function(a,c,d){return[200,b.role]}),a.whenGET(e+"/admin/roles/1/action/privileges").respond(function(a,c,d){var d={collection:b.privileges};return[200,d]}),a.whenGET(e+"/admin/enterprises/1").respond(function(a,c,d){return[200,b.enterprise]}),a.whenPOST(e+"/logout").respond(function(a,b,c){return[200]}),a.whenGET(e+"/admin/datacenters").respond(function(){return[200,b.datacenters]}),a.whenGET(e+"/cloud/virtualdatacenters/1/action/defaultvlan").respond(function(){return[200,b.defaultVlan1]}),a.whenGET(e+"/cloud/virtualdatacenters/2/action/defaultvlan").respond(function(){return[200,b.defaultVlan2]}),a.whenGET(e+"/cloud/virtualdatacenters").respond(function(){var a={collection:b.virtualDatacenters};return[200,a]}),a.whenPOST(e+"/cloud/virtualdatacenters/1").respond(function(){return[200]}),a.whenPOST(e+"/cloud/virtualdatacenters/2").respond(function(){return[200]}),a.whenGET(e+"/cloud/virtualdatacenters/1/volumes").respond(function(){var a={collection:b.volumes};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/2/volumes").respond(function(){var a={collection:b.volumes};return[200,a]}),a.whenGET(e+"/admin/volumes").respond(function(){var a={collection:b.allVolumes};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/9/tiers").respond(function(){var a={collection:b.tiers};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/1/privatenetworks").respond(function(){var a={collection:b.privateNetworks};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/2/privatenetworks").respond(function(){var a={collection:b.privateNetworks};return[200,a]}),a.whenGET(e+"/admin/enterprises/1/action/externalnetworks").respond(function(){var a={collection:b.externalNetworks};return[200,a]}),a.whenGET(e+"/admin/enterprises/1/action/publicnetworks").respond(function(){var a={collection:b.publicNetworks};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/1/privatenetworks/1/ips").respond(function(){var a={collection:b.privateIps1};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/1/privatenetworks/2/ips").respond(function(){var a={collection:b.privateIps2};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/1/privatenetworks/3/ips").respond(function(){var a={collection:b.privateIp3};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/virtualappliances").respond(function(){var a={collection:b.virtualAppliances1.concat(b.virtualAppliances2)};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/1/virtualappliances").respond(function(){var a={collection:b.virtualAppliances1};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/2/virtualappliances").respond(function(){var a={collection:b.virtualAppliances2};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/1/virtualappliances/1/layers").respond(function(){var a={collection:b.layers1};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/2/virtualappliances/2/layers").respond(function(){var a={collection:b.layers2};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/2/virtualappliances/3/layers").respond(function(){var a={collection:b.layers3};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/1/action/templates").respond(function(){var a={collection:b.virtualMachineTemplates1};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/2/action/templates").respond(function(){var a={collection:b.virtualMachineTemplates2};return[200,a]}),a.whenGET(e+"/virtualmachinespersistent/").respond(function(){var a={collection:b.virtualMachinePersistentTemplates};return[200,a]}),a.whenGET(e+"/admin/persistentvirtualmachinetemplates").respond(function(){var a={collection:b.allVirtualMachinePersistentTemplates};return[200,a]}),a.whenGET(e+"/config/categories/").respond(function(){var a={collection:b.virtualMachineTemplateCategories};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/1/virtualappliances/1/virtualmachines").respond(function(){var a={collection:b.virtualMachines};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/2/virtualappliances/2/virtualmachines").respond(function(){var a={collection:b.virtualMachines};return[200,a]}),a.whenGET(e+"/cloud/virtualdatacenters/2/virtualappliances/3/virtualmachines").respond(function(){var a={collection:b.virtualMachines};return[200,a]}),a.whenGET(e+"/cloud/pricingtemplates").respond(function(){var a={collection:b.pricingModels};return[200,a]}),a.whenGET(e+"/config/currencies/1").respond(function(){return[200,b.currency]}),a.whenGET(e+"/events/").respond(function(){return[200,b.events]}),a.whenGET(e+"/config/properties").respond(function(){return[200,b.systemProperties]}),a.whenPOST("data/public").respond(function(a,b,c){return[200,"I have received and processed your data ["+c+"]."]}),a.whenPOST("data/protected").respond(function(a,b,c){return authorized?[200,"This is confidential ["+c+"]."]:[401]}),a.whenGET(/.*/).passThrough()}),angular.module("modals",[]).factory("uModals",["$compile","$http","$timeout","$filter","dispatcher",function(a,b,c,d,e){function f(a){var b=new RegExp("<","g");return a=a.replace(b,"&lt"),b=new RegExp(">","g"),a=a.replace(b,"&gt"),b=new RegExp("&ltbr&gt","g"),a=a.replace(b,"<br>")}function g(a,b){var c=document.getElementById(a);c&&("input"==c.localName?c.value=b:c.innerHTML=b)}function h(a){a.keydown(function(b){if(b.keyCode===$.ui.keyCode.TAB){var c=a.find(":tabbable"),d=c.filter(":first"),e=c.filter(":last");b.target!==e[0]&&b.target!==a[0]||b.shiftKey?b.target!==d[0]&&b.target!==a[0]||!b.shiftKey||(e.focus(1),b.preventDefault()):(d.focus(1),b.preventDefault())}})}var i=function(a){var b=f(a.message);return"warning"==a.messageType&&(b='<p class="danger-confirmation-message"><i class="icon-warning-sign"></i> '+b+"</p>"),'<div class="modal-header"><a id="close.alert.button" class="btn-cross" data-dismiss="modal"><i class="icon-remove"></i></a><h3>'+f(a.title)+'</h3></div><div class="modal-body"> <p>'+b+'</p></div><div class="modal-footer"><button id="alert.button.cancel" data-ng-show="'+a.showCancelBtn+'" class="btn-secondary" data-ng-click="onCancel()" data-dismiss="modal">'+a.cancelLabel+'</button><button id="alert.button.confirm" focus data-ng-show="'+a.showConfirmBtn+'" class="btn-primary" data-ng-click="onConfirm()" data-dismiss="modal">'+a.confirmLabel+"</button></div>"},j=function(a){var b="",c=(d("isTutorialRunning")(),d("displayWikiLinkHelp")("client.wiki.showHelp"));c&&d("displayWikiLinkHelp")("client.wiki.showDefaultHelp")&&(void 0==a.infoUrl||""==a.infoUrl)&&(a.infoUrl=d("displayWikiLinkHelp")("client.wiki.defaultURL"));var b='<div class="modal-header">';if(void 0!==a.infoUrl&&""!==a.infoUrl&&c&&(b+='<a id="popup.abinfo.button" class="ab-info" href="'+a.infoUrl+'" target="_blank"><i class="icon-question"></i></a>'),b+='<a id="popup.close.button" class="btn-cross" data-dismiss="modal" ',b+='u-blocked-element><i class="icon-remove"></i></a>',b+="<h3>"+f(a.title)+"</h3>",b+="</div>",b+="<div ",void 0!==a.contentHeight&&(b+='style="height:'+a.contentHeight+'px;" '),b+='class="modal-body">#BODY#</div>',a.showAcceptBtn||a.showCancelBtn){b+='<div class="modal-footer" data-ng-show="popupScope.showCancelBtn || popupScope.showAcceptBtn">',b+='<button u-blocked-element type="button" id="popup.button.cancel" class="btn-secondary" data-ng-show="popupScope.showCancelBtn" ',a.closeOnCancel||void 0==a.closeOnCancel?(b+='data-dismiss="modal" ',b+='data-ng-click="onCancel(); closePopup();" '):b+='data-ng-click="onCancel()" ',b+=a.scope.cancelLabel?">{{cancelLabel}}</button>":">"+a.cancelLabel+"</button>";var e="popup.button.accept";a.acceptButtonId&&(e=a.acceptButtonId),a.scope.setAcceptLabel=function(a){g(e,a)},a.scope.setCancelLabel=function(a){g("popup.button.cancel",a)},void 0===a.formName?(b+='<button u-blocked-element id="'+e+'" class="btn-primary" data-ng-show="popupScope.showAcceptBtn" ',a.closeOnAccept?(b+='data-dismiss="modal" ',b+='data-ng-click="onAccept(); closePopup();" '):b+='data-ng-click="onAccept()" ',b+=">"+a.acceptLabel+"</button>"):(b+='<input u-blocked-element id="'+e+'" class="btn-primary" data-ng-show="popupScope.showAcceptBtn" ',a.closeOnAccept&&(b+='data-dismiss="modal" ',b+='data-ng-click="closePopup();" '),b+=a.scope.acceptLabel?'value="{{acceptLabel}}" ':'value="'+a.acceptLabel+'" ',b+='type="submit" data-ng-disabled="'+a.formName+'.$invalid || !validExternally" data-ng-init="validExternally=true">'),b+="</div>"}return b},k=function(b){var c=i(b),d=$('<div class="modal modal-alert hide"  id="popup.alert"></div>');d.html(c),d.appendTo("body"),a(d)(b.scope),d.modal("show"),d.on("hidden",function(a){d.remove()}),h(d),void 0!=b.confirmFn&&($.isFunction(b.confirmFn)?b.scope.onConfirm=function(){b.confirmFn()}:b.scope.onConfirm=function(){b.scope.$eval(b.confirmFn)}),void 0!=b.cancelFn&&($.isFunction(b.cancelFn)?b.scope.onCancel=function(){b.cancelFn()}:b.scope.onCancel=function(){b.scope.$eval(b.cancelFn)});var e=document.getElementById("alert.button.confirm");e&&e.focus()},l=function(e){var f=function(a){a.remove(),void 0!=e.scope.onHidden&&e.scope.onHidden()};e.scope.popupScope={},e.scope.popupScope.showAcceptBtn=e.showAcceptBtn,e.scope.popupScope.showCancelBtn=e.showCancelBtn;var g=j(e);b.get(e.popupUrl).success(function(b){var i,j;void 0===e.popupWidth&&(e.popupWidth=560),i=e.popupWidth/2,e.scope.popupData=e.popupData;var k="modal hide";e.popupClass&&(k+=" "+e.popupClass),void 0===e.formName?(j='<div data-ng-cloak style="width:'+e.popupWidth+"px; margin-left:-"+i+'px;" class="'+k+'" ',void 0!==e.controller&&(j+='data-ng-controller="'+e.controller+'"'),j+="></div>"):(j='<form data-ng-cloak id="'+e.formName+'" style="width:'+e.popupWidth+"px; margin-left:-"+i+'px;" novalidate class="'+k+' modal-form" name="'+e.formName+'" ',void 0!==e.controller&&(j+='data-ng-controller="'+e.controller+'"'),j+="></form>");var l=$(j);l.html(g.replace("#BODY#",b)),l=$('<div class="modal-backdrop"></div>').html(l),l.appendTo("body"),e.scope.closePopup=function(a,b){c(function(){f(a?a:l),b&&b()},100)},e.scope.getPopupElement=function(){return l},l.on("hidden",function(a){f(l)}),l.on("shown",function(a){void 0!=e.scope.onShown&&e.scope.onShown()}),a(l)(e.scope),$("#"+e.formName).bind("keypress",function(a){return 13==a.keyCode&&$("#"+e.formName).hasClass("ng-invalid")?!1:void 0}),h(l),l.modal({backdrop:!1,keyboard:!d("isTutorialRunning")(),show:!0})})};return e.on("tutorial.stop",function(){var a=document.getElementById("popup.close.button");a&&a.setAttribute("data-dismiss","modal");var b=document.getElementById("popup.button.cancel");b&&b.setAttribute("data-dismiss","modal")}),{showAlert:k,showPopUp:l}}]),angular.module("monitoringMgr",["server"]).factory("monitoringMgr",["server","utils","$filter","$timeout",function(a,b,c,d){function e(a,b,d){var e=function(){a.clientData.countMetrics<a.metadata.metadata["monitoring-metrics"].length-1?(a.clientData.countMetrics++,g=c("getElementByParameter")(b,{element:a.metadata.metadata["monitoring-metrics"][a.clientData.countMetrics].name,attribute:"name"}),f(a,g,b,e)):void 0!=d&&d(a)};a.clientData.countMetrics=0;var g=c("getElementByParameter")(b,{element:a.metadata.metadata["monitoring-metrics"][a.clientData.countMetrics].name,attribute:"name"});f(a,g,b,e)}function f(b,d,e,f){var g=function(a){var d=c("getElementByParameter")(e,{element:a.name,attribute:"name"});b.clientData.charts[a.name]=r(b,a,d),void 0!=f&&f(a)},h=a.getLinkByRel(b.links,"metrics"),i={path:h.href+"/"+d.name,type:"application/vnd.abiquo.metric+json",queryParam:{startrelative:"PT1H"},absolutPath:!0};d.granularity&&(i.queryParam.granularity=d.granularity),d.statistic&&(i.queryParam.statistic=d.statistic),d.startrelative&&("hours"==d.period?i.queryParam.startrelative="PT"+d.startrelative+"H":i.queryParam.startrelative="P"+d.startrelative+"D"),a.get(i,g)}function g(b,c){var d=function(a){void 0!=c&&c(a.collection)},e={links:b.links,rel:"metricsmetadata"};a.getByRel(e,d)}function h(a,f,g,h){o=0,b.emptyObject(m);var j=function(b){if(o--,angular.forEach(b.metadata.metadata["monitoring-metrics"],function(a){s(b,a.name)}),0==o){void 0!=h&&h(a);var e=g?f:b.metadata.metadata["monitoring-metrics"];angular.forEach(e,function(a){var e=c("getElementByParameter")(f,{element:a.name,attribute:"name"});angular.forEach(m[a.name],function(a){"Time"!=a[0]&&(a[0]=c("monitoringTimestampToString")(a[0],e.period))});try{var h=g?a.unit:b.clientData.charts[a.name].options.vAxis.title,j=google.visualization.arrayToDataTable(m[a.name]),k=angular.copy(q);k.title=a.name,k.vAxis={title:h},k.hAxis={title:i(e,k.hAxis.title),showTextEvery:Math.ceil(m[a.name].length/5)},m[a.name].length<=2&&(k.vAxis.viewWindow={min:0},k.hAxis.viewWindow={min:0}),k.legend.position=g?"top":"none";var l=g?"chart_div_"+a.name:"vm_chart_div_"+a.name,n=new google.visualization.LineChart(document.getElementById(l));n.draw(j,k),d(function(){n.draw(j,k)},100)}catch(o){console.log("Google maps library not available")}})}};angular.forEach(f,function(a){m[a.name]=[["Time"]]}),angular.forEach(a,function(a){a.metadata&&a.metadata.metadata["monitoring-metrics"]&&a.metadata.metadata["monitoring-metrics"].length&&(o++,e(a,f,j))})}function i(a,b){return a.startrelative?"hours"==a.period?"Last "+a.startrelative+" hours":"Last "+a.startrelative+" days":b}function j(b,c){n.length=0;var d=function(a){n.length=0,angular.forEach(a.collection,function(a){n.push(a)}),void 0!=c&&c()},e=a.getLinkByRel(b.links,"self"),f={path:e.href+"/monitoring/levels",type:"application/vnd.abiquo.monitoringlevels+json",absolutPath:!0};a.get(f,d)}var k={},l=[],m={},n=[],o=0,p={type:"LineChart",cssStyle:"height:400px; width:400px;",interpolateNulls:!0,data:{cols:[{id:"month",label:"Month",type:"string",p:{}}],rows:[]},options:{isStacked:"true",fill:20,displayExactValues:!0,vAxis:{title:"",gridlines:{count:6}},hAxis:{title:"Last hour",showTextEvery:1},legend:{position:"none"}},formatters:{},displayed:!0},q={seriesType:"line",interpolateNulls:!0,title:"Default",isStacked:"true",fill:20,displayExactValues:!0,vAxis:{title:"",gridlines:{count:6}},hAxis:{title:"Last hour",showTextEvery:1},legend:{position:"none"},formatters:{},displayed:!0,width:"100%",tooltip:{textStyle:{color:"#000000"},showColorCode:!0}},r=function(a,b,c){var d=angular.copy(p);return d.options.vAxis.title=c.unit,angular.forEach(b.datapoints,function(a){var b={timeStamp:a.timestamp,value:void 0!=a.longValue?a.longValue:a.doubleValue};d.data.rows.push(b)}),d},s=function(a,b){var c=m[b];if(a.clientData.charts[b].data.rows.length>0){c[0].push(a.label+" ("+a.state+")");for(var d=1;d<c.length;d++)c[d].push(null);angular.forEach(a.clientData.charts[b].data.rows,function(a){var b=t(c,a),d=u(c[0].length,a);b[0]?b[b.length-1]=a.value:b==c.length?c.push(d):(c.splice(b,0,d),c.join())})}},t=function(a,b){for(var c=1;c<a.length;c++){if(b.timeStamp==a[c][0])return a[c];if(b.timeStamp<a[c][0])return c}return a.length},u=function(a,b){for(var c=[b.timeStamp],d=1;a-1>d;d++)c.push(null);return c.push(b.value),c};return angular.extend(k,{metrics:l,monitoringLevels:n,metricCharts:m,getVirtualMachineAvailableMonitoringMetric:g,getVirtualMachineMonitoringMetric:f,getVirtualApplianceMonitoringMetrics:h,getHypervisorMonitoringLevels:j}),k}]),angular.module("navigationMgr",[]).factory("navigationMgr",["$rootScope","$location","$window","$filter","$analytics","authenticationMgr",function(a,b,c,d,e,f){function g(a){k.appView=a,j(null,k.nextController,null)}function h(){k.mainMenuCollapsed=!1}function i(){"dashboard"!=k.mainView&&(k.mainMenuCollapsed=!0)}function j(a,c,e){if(1==f.authenticated){e&&"VirtualDatacentersCtrl"==e.$$route.controller&&(k.sectionView="virtualdatacenter");var g=!1;if(c.$$route&&c.$$route.controller)switch(c.$$route.controller){case"InfrastructureCtrl":g=d("isGranted")("PHYS_DC_ENUMERATE");break;case"VirtualDatacentersCtrl":g=d("isGranted")("VDC_ENUMERATE");break;case"LibraryCtrl":g=d("isGranted")("APPLIB_VIEW");break;case"EnterprisesCtrl":g=d("isGranted")("USERS_VIEW");break;case"PricingCtrl":g=d("isGranted")("PRICING_VIEW");break;case"EventsCtrl":g=!0;break;case"ConfigurationCtrl":g=d("isGranted")("SYSCONFIG_VIEW");break;case"AuthorizeCtrl":g=!0;break;default:g=!1}g||b.path("/dashboard")}else k.nextController={$$route:{controller:c.$$route?c.$$route.controller:""}}}var k={appView:"login",mainView:"dashboard",sectionView:"virtualdatacenter",mainMenuCollapsed:!1,nextController:{},breadcrumb:{dashboard:{index:0,label:"Dashboard"},infrastructure:{index:1,label:"Infrastructure"},virtualdatacenters:{index:2,label:"Virtual Datacenters"},library:{index:3,label:"Apps Library"},enterprises:{index:4,label:"Users"},pricing:{index:5,label:"Pricing"},events:{index:6,label:"Events"},configuration:{index:7,label:"Configuration"}}};return a.$on("event:auth-loginRequired",function(){k.appView="login"}),a.$on("event:auth-loginConfirmed",function(){k.appView="main"}),a.$on("$routeChangeStart",function(a,b,c){var d="";c&&(d+=c.templateUrl+"--"),b&&(d+="--"+b.templateUrl),e.eventTrack("pageTransition",{category:"from-to",label:d}),console.log("Google Analytics: Track event ",d),j(a,b,c)}),a.$on("$routeChangeSuccess",function(){k.mainView=b.path().substring(1),"dashboard"!=k.mainView&&(k.mainMenuCollapsed=!1),e.pageTrack(b.path()),console.log("Google Analytics: Track page ",b.path())}),angular.extend(k,{setAppView:g,expand:h,collapse:i}),k}]),angular.module("networksMgr",["server"]).factory("networksMgr",["server","utils","dispatcher","$filter",function(a,b,c,d){function e(a){var b=new da(a);return b.clientData.networkRel="UNMANAGED"==a.type?"unmanagednetwork":"externalnetwork",b}function f(a){var b=new da(a);return b.clientData.networkRel="internalnetwork",b}function g(a){var b=new da(a);return b.clientData.networkRel="publicnetwork",b}function h(a){angular.copy(a,la),c.dispatch("currentNetwork.change",{data:la,type:"change"})}function i(a){angular.copy(a,oa)}function j(a){var b={value:a};angular.copy(b,ma)}function k(b,c){ha.length=0;var d,e,f=function(a,b){angular.forEach(a.collection,function(a){var c=new da(a);c.clientData.networkRel=b,ha.push(c)})},g=function(a){f(a,"internalnetwork")},h=function(a){f(a,"publicnetwork")},i=function(a){f(a,"externalnetwork")},j=function(c){e=c.collection.length,angular.forEach(c.collection,function(c){var e=a.getClientdataFromLinksByRel(c.links,"location","datacenters"),f=a.getClientdataFromLinksByRel(c.links,"enterprise");d.id==e.id&&(l={path:"cloud/virtualdatacenters/"+b+"/privatenetworks",type:"application/vnd.abiquo.vlans+json"},a.get(l,g),l={path:"admin/enterprises/"+f.id+"/action/publicnetworks",type:"application/vnd.abiquo.vlans+json",queryParam:{datacenterId:d.id}},a.get(l,h),l={links:c.links,rel:"externalnetworks"},a.getByRel(l,i))})},k=function(b){d=a.getClientdataFromLinksByRel(b.links,"location");var c=a.getLinkByRel(b.links,"enterprise");l={absolutPath:!0,path:c.href+"/limits",type:"application/vnd.abiquo.limits+json"},a.get(l,j)},l={path:"cloud/virtualdatacenters/"+b,type:"application/vnd.abiquo.virtualdatacenter+json"};a.get(l,k)}function l(b,c,d,e){ha.length=0;var g=function(a){ha.length=0,b.clientData.networks.length=0,angular.forEach(a.collection,function(a){var c=f(a);b.clientData.networks.push(c),ha.push(c)}),void 0!==e&&e(a)},h={rel:"privatenetworks",links:b.links,queryParam:{}};angular.extend(h.queryParam,c),angular.extend(h.queryParam,d),a.getByRel(h,g)}function m(c,d,f,g){var h=0,i=0;ha.length=0;var j=function(d){ha.length=0,angular.forEach(d.collection,function(d){var e=a.getLinkByRel(d.links,"location");if(!b.isEmptyObject(e)){var f=a.getIdInLinkByParameter(e,"datacenters");f==c.clientData.datacenter.id&&k([a.getLinkByRel(d.links,"externalnetworks")])}}),void 0!==g&&g(ha)},k=function(b){b.length>0&&(h++,m={links:b,rel:"externalnetworks"},a.getByRel(m,l))},l=function(a){i++,angular.forEach(a.collection,function(a){ha.push(e(a))}),h==i&&void 0!==g&&g(ha)},m={path:"admin/enterprises/"+c.clientData.enterprise.id+"/limits",type:"application/vnd.abiquo.limits+json",queryParam:{}};angular.extend(m.queryParam,d),angular.extend(m.queryParam,f),a.get(m,j)}function n(b,c,d,f){ha.length=0;var g=function(a){ha.length=0,angular.forEach(a.collection,function(a){ha.push(e(a))}),void 0!=f&&f(a)},h={links:b.links,rel:"network",queryParam:{type:"EXTERNAL_UNMANAGED"}};angular.extend(h.queryParam,c),angular.extend(h.queryParam,d),a.getByRel(h,g)}function o(b,c,d,e){ha.length=0;var f=function(a){b.clientData.networks.length=0,angular.forEach(a.collection,function(a){ha.push(g(a))}),void 0!==e&&e(a)},h={path:"admin/enterprises/"+b.clientData.enterprise.id+"/action/publicnetworks?datacenterId="+b.clientData.datacenter.id,type:"application/vnd.abiquo.vlans+json",queryParam:{}};angular.extend(h.queryParam,c),angular.extend(h.queryParam,d),a.get(h,f)}function p(b,c){ha.length=0;var d=function(a){ha.length=0,angular.forEach(a.collection,function(a){ha.push(e(a))}),void 0!=c&&c(a)},f={links:b.links,rel:"externalnetworks"};a.getByRel(f,d)}function q(b,c,d,e){ha.length=0;var f=function(a){ha.length=0,angular.forEach(a.collection,function(a){ha.push(g(a))}),void 0!=e&&e(a)},h={links:b.links,rel:"network",queryParam:{type:"PUBLIC"}};angular.extend(h.queryParam,c),angular.extend(h.queryParam,d),a.getByRel(h,f)}function r(b,c,d,f){ha.length=0;var g=function(a){ha.length=0,angular.forEach(a.collection,function(a){ha.push(e(a))}),void 0!=f&&f(a)},h={links:b.links,rel:"network",queryParam:{type:"EXTERNAL_UNMANAGED"}};angular.extend(h.queryParam,c),angular.extend(h.queryParam,d),a.getByRel(h,g)}function s(b,c,d){var e=function(a){var e;if(a&&a.collection&&a.collection.length>0){var f=a.collection[0];f.ip==b&&(e=new ea(f,c))}void 0!=d&&d(e)},f={rel:"ips",links:c.links,queryParam:{has:b,limit:1}};a.getByRel(f,e)}function t(b,c,d,e,f){c||(ia.length=0);var g=function(a){ia.length=0,angular.forEach(a.collection,function(a){ia.push(new ea(a,b))}),void 0!==f&&f(a)},h={rel:"ips",links:b.links,queryParam:{}};angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.getByRel(h,g)}function u(b,c,d,e,f){c||(ia.length=0);var g=function(a){ia.length=0,angular.forEach(a.collection,function(a){ia.push(new ea(a,b))}),void 0!==f&&f(a)},h={rel:"infrastructureips",links:b.links,queryParam:{}};angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.getByRel(h,g)}function v(b,c,d){ja.length=0;var e=function(a){ja.length=0,angular.forEach(a.collection,function(a){ja.push(new ea(a,b))}),void 0!==d&&d(ja)},f={rel:c,links:b.links,queryParam:{all:!0,limit:300}};a.getByRel(f,e)}function w(b,c){ja.length=0;var d=function(a){ja.length=0,angular.forEach(a.collection,function(a){ja.push(new ea(a,b))}),void 0!==c&&c(ja)},e={rel:"ips",links:b.links,queryParam:{all:!0,limit:300}};a.getByRel(e,d)}function x(b,c,d,e,f){c||(ia.length=0);var g=function(a){ia.length=0,angular.forEach(a.collection,function(a){ia.push(new ea(a))}),void 0!==f&&f(a)},h={rel:"privateips",links:b.links,queryParam:{}};angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.getByRel(h,g)}function y(b,c,d,e,f){c||(ia.length=0);var g=function(a){ia.length=0,angular.forEach(a.collection,function(a){ia.push(new ea(a))}),void 0!==f&&f(a)},h={rel:"ips",type:"application/vnd.abiquo.privateips+json",links:b.links,queryParam:{}};angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.getByRel(h,g)}function z(b,c,d,e,f){c||(ia.length=0);var g=function(a){ia.length=0,angular.forEach(a.collection,function(a){ia.push(new ea(a))}),void 0!==f&&f(a)},h={rel:"externalips",links:b.links,queryParam:{}};angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.getByRel(h,g)}function A(b,c,d,e,f){c||(ia.length=0);var g=function(a){ia.length=0,angular.forEach(a.collection,function(a){ia.push(new ea(a))}),void 0!==f&&f(a)},h={path:"admin/datacenters/"+b.id+"/network/action/externalips",type:"application/vnd.abiquo.externalips+json",queryParam:{}};angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.get(h,g)}function B(b,c,d,e){ia.length=0;var f=function(a){ia.length=0,angular.forEach(a.collection,function(a){ia.push(new ea(a))}),void 0!==e&&e(a)},g={rel:"purchased",links:b.links,queryParam:{}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.getByRel(g,f)}function C(b,c,d,e,f){c||(ia.length=0);var g=function(a){ia.length=0,angular.forEach(a.collection,function(a){ia.push(new ea(a))}),void 0!==f&&f(a)},h={path:"admin/datacenters/"+b.id+"/network/action/externalips",type:"application/vnd.abiquo.externalips+json",queryParam:{}};angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.get(h,g)}function D(b,c,d,e,f,g){c||(ia.length=0);var h=function(a){ia.length=0,angular.forEach(a.collection,function(a){ia.push(new ea(a))}),void 0!==g&&g(a)},i={links:b.links,rel:"purchased",queryParam:{onlyAvailable:!1}};d&&(i.queryParam.vlanId=d.id),angular.extend(i.queryParam,e),angular.extend(i.queryParam,f),a.getByRel(i,h)}function E(b,c,d,e,f){ka.length=0;var g=function(a){ka.length=0,angular.forEach(a.collection,function(a){ka.push(new ea(a))}),void 0!==f&&f(a)},h={links:b.links,rel:"topurchase",queryParam:{onlyAvailable:!1}};c&&c.id&&(h.queryParam.vlanId=c.id),angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.getByRel(h,g)}function F(b){var d=function(a){c.dispatch("publicip.created",{data:a})},e={path:"cloud/locations/"+b.clientData.datacenter.id+"/ips",type:"application/vnd.abiquo.publicip+json"};a.post(e,{},d)}function G(b,d,e){var f=function(a){c.dispatch("publicip.deleted",{data:a}),void 0!=e&&e(a)},g={path:"cloud/locations/"+b.clientData.datacenter.id+"/ips/"+d.id};a.remove(g,f)}function H(b,d){var e=function(a){c.dispatch("publicip.synchronized",{data:a}),void 0!=d&&d(a)},f=a.getLinkByRel(b.links,"location"),g={path:f.href+"/ips",type:"*/*",queryParam:{source:"remote"},absolutPath:!0};a.get(g,e)}function I(e,f,g){var h=function(a){void 0!==g&&g(a),c.dispatch("nic.purchased",{data:a}),b.toastrSuccess(d("translate")("action.purchase.success.nic.text",{nic:e.ip,vdc:f.name}))},i={rel:"purchase",links:e.links,type:"application/vnd.abiquo.publicip+json",contentType:"application/vnd.abiquo.publicip+json",queryParam:{}};a.putByRel(i,null,h)}function J(e,f){var g=function(a){void 0!==f&&f(a),c.dispatch("nic.release",{data:a}),b.toastrSuccess(d("translate")("action.delete.success.ippurchased.text",e))},h={rel:"release",links:e.links,queryParam:{}};a.putByRel(h,null,g)}function K(b,c,d,e,f){c||(ia.length=0);var g=function(a){ia.length=0,angular.forEach(a.collection,function(a){ia.push(new ea(a))}),void 0!==f&&f(a)},h={path:"admin/datacenters/"+b.id+"/network/action/publicips",type:"application/vnd.abiquo.publicips+json",queryParam:{}};angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.get(h,g)}function L(b,c,d){var e=function(a){void 0!=d&&d(a)},f={path:"admin/datacenters/"+b.id+"/network/action/checkavailability",type:"application/vnd.abiquo.vlantagavailability+json",queryParam:{tag:c}};a.get(f,e)}function M(e,f,g){var h=function(a){angular.extend(qa,a),c.dispatch("networks.created",{data:a}),void 0!=g&&g(a),b.toastrSuccess(d("translate")("action.create.success.network.text",{network:f.name}))},i={links:e.links,rel:"network",type:"application/vnd.abiquo.vlan+json",contentType:"application/vnd.abiquo.vlan+json"};a.postByRel(i,f,h)}function N(e,f,g){var h=function(a){c.dispatch("networks.created",{data:a}),void 0!==g&&g(a),b.toastrSuccess(d("translate")("action.create.success.network.text",{network:e.name}))};if(e.clientData.availabilityZone&&e.clientData.availabilityZone.name&&e.clientData.availabilityZone.name!=d("translate")("virtualdatacenter.create.generalinfo.privatenetwork.combo.availabilityzone.nopreference")){var i=a.createLinkByRel(e.clientData.availabilityZone.links,"self","availabilityzone");
e.links=[i]}var j={type:"application/vnd.abiquo.vlan+json",path:"cloud/virtualdatacenters/"+f.id+"/privatenetworks"};a.post(j,e,h)}function O(b,c,d){var e=function(a){void 0!==d&&d(a)},f={links:c.links,rel:"network",type:"application/vnd.abiquo.vlan+json",ContentType:"application/vnd.abiquo.vlan+json"};a.postByRel(f,b,e)}function P(b,c,d){var e=function(a){void 0!==d&&d(a)},f=a.getLinkByRel(c.links,"enterprise");b.links=[],b.links.push(f);var g={links:c.links,rel:"network",type:"application/vnd.abiquo.vlan+json",ContentType:"application/vnd.abiquo.vlan+json"};a.postByRel(g,b,e)}function Q(b,c,d){var e=function(a){void 0!==d&&d(a)},f=a.getLinkByRel(c.links,"enterprise");b.links=[],b.links.push(f),b.unmanaged=!0;var g={links:c.links,rel:"network",type:"application/vnd.abiquo.vlan+json",ContentType:"application/vnd.abiquo.vlan+json"};a.postByRel(g,b,e)}function R(e,f){var g=function(a){c.dispatch("networks.edited",{data:a}),void 0!=f&&f(a),b.toastrSuccess(d("translate")("action.edit.success.network.text",{network:e.name}))},h={links:e.links,rel:"edit"};a.putByRel(h,e,g)}function S(e,f,g){var h=function(a){c.dispatch("networks.ips.edited",{data:a}),void 0!=g&&g(a),b.toastrSuccess(d("translate")("action.edit.success.networkips.text",{network:e.name}))},i={links:e.links,rel:"infrastructureips"};a.putByRel(i,f,h)}function T(e,f,g){var h=function(a){c.dispatch("networks.ips.edited",{data:a}),void 0!=g&&g(a),b.toastrSuccess(d("translate")("action.edit.success.networkips.text",{network:e.name}))},i={links:e.links,rel:"ips"};a.putByRel(i,f,h)}function U(b,d){var e=function(a){c.dispatch("networks.ips.edited",{data:a}),void 0!=d&&d(a)},f={links:b.links,rel:"self"};a.putByRel(f,b,e)}function V(b,d,e){var f=function(a){var b=[];if(a&&a.collection&&a.collection.length>0)for(var d=0;d<a.collection.length;d++)b.push(new ea(a.collection[d]));c.dispatch("networks.ips.edited",{data:b}),void 0!=e&&e(b)},g="application/vnd.abiquo.",h="ips";switch(d.type){case"PUBLIC":g+="publicips+json";break;case"EXTERNAL":g+="publicips+json",h="infrastructureips";break;case"INTERNAL":g+="privateips+json"}var i={links:d.links,rel:h,type:g,contentType:"application/vnd.abiquo.ipsbulkcreation+json"};a.postByRel(i,b,f)}function W(e,f){var g=function(a){c.dispatch("networks.deleted",{data:a}),void 0!==f&&f(a),b.toastrSuccess(d("translate")("action.delete.success.network.text",{network:e.name}))},h={rel:"edit",links:e.links};a.removeByRel(h,g)}function X(b,c){var d=function(a){pa.length=0,angular.forEach(a.collection,function(a){pa.push(new ga(a))}),void 0!==c&&c()},e={links:b.links,rel:"configurations"};a.getByRel(e,d)}function Y(b,c){i(null);var e=function(a){na.length=0;var b={links:[],id:0,name:d("translate")("servers.physicalmachine.form.networkinterfaces.servicetype.notassigned")};na.push(new fa(b)),angular.forEach(a.collection,function(a){na.push(new fa(a))}),void 0!==c&&c(a)},f={rel:"networkservicetypes",links:b.links,type:"application/vnd.abiquo.networkservicetypes+json"};a.getByRel(f,e)}function Z(e,f,g){var h=function(a){c.dispatch("networkServiceType.created",{data:a}),void 0!=g&&g(a),b.toastrSuccess(d("translate")("action.create.success.servicetype.text",{serviceType:f.name}))},i={links:e.links,rel:"networkservicetypes",type:"application/vnd.abiquo.networkservicetype+json",contentType:"application/vnd.abiquo.networkservicetype+json"};a.postByRel(i,f,h)}function $(e,f){var g=function(a){c.dispatch("networkServiceType.edited",{data:a}),void 0!=f&&f(a),b.toastrSuccess(d("translate")("action.edit.success.servicetype.text",{serviceType:e.name}))},h={links:e.links,rel:"edit"};a.putByRel(h,e,g)}function _(e,f){var g=function(a){c.dispatch("networkServiceType.deleted",{data:a}),void 0!=f&&f(a),b.toastrSuccess(d("translate")("action.delete.success.servicetype.text",{serviceType:e.name}))},h={links:e.links,rel:"edit"};a.removeByRel(h,g)}function aa(){ha.length=0,ia.length=0}var ba={type:{INTERNAL:"network_type.internal",EXTERNAL:"network_type.external",PUBLIC:"network_type.public"}},ca=[{index:0,mask:"255.255.240.0",length:20},{index:1,mask:"255.255.248.0",length:21},{index:2,mask:"255.255.252.0",length:22},{index:3,mask:"255.255.254.0",length:23},{index:4,mask:"255.255.255.0",length:24},{index:5,mask:"255.255.255.128",length:25},{index:6,mask:"255.255.255.192",length:26},{index:7,mask:"255.255.255.224",length:27},{index:8,mask:"255.255.255.240",length:28},{index:9,mask:"255.255.255.248",length:29},{index:10,mask:"255.255.255.252",length:30},{index:11,mask:"FFFF:FFFF:FFFF:FFFF::",length:64},{index:12,mask:"FFFF:FFFF:FFFF:FF::",length:56},{index:13,mask:"FFFF:FFFF:FFFF::",length:48}],da=function(b){var c=b;return c.clientData={enterprise:a.getClientdataFromLinksByRel(c.links,"enterprise"),serviceType:a.getClientdataFromLinksByRel(c.links,"networkservicetype"),availabilityZone:a.getClientdataFromLinksByRel(c.links,"availabilityzone"),networkRel:""},c},ea=function(b,c){var d=b,e=!1;return c&&(e=c.gateway==d.ip&&"?"!=c.gateway),d.clientData={purchaseBy:a.getClientdataFromLinksByRel(d.links,"enterprise"),virtualMachine:a.getClientdataFromLinksByRel(d.links,"virtualmachine"),virtualAppliance:a.getClientdataFromLinksByRel(d.links,"virtualappliance"),isDefaultGateway:e,selected:!1},d},fa=function(a){var b=a;return b.clientData={},b},ga=function(a){var b=a;return b.clientData={},b},ha=[],ia=[],ja=[],ka=[],la={},ma={},na=[],oa={},pa=[],qa={},ra=function(){var a={};return a.ip="ip",a.mac="mac",a.networkName="vlan",a["clientData.virtualAppliance.name"]="virtualappliance",a["clientData.virtualMachine.name"]="virtualmachine",a.quarantine="quarantine",a["clientData.purchaseBy.name"]="lease",a},sa=ra();return angular.extend(ba,{IP:ea,networks:ha,ips:ia,allIps:ja,ipsToPurchase:ka,currentNetwork:la,netmasks:ca,gateways:pa,currentServiceType:oa,currentNetworkType:ma,serviceTypes:na,sortMappping:sa,createdNetwork:qa,cleanData:aa,createNetwork:M,editNetwork:R,createNetworkIp:V,editNetworkIp:U,setCurrentNetwork:h,deleteNetwork:W,getIpByNetwork:s,getIpsByNetwork:t,getAvailableVirtualMachineGateways:X,checkTag:L,getAllNetworksByVirtualDatacenters:k,createPrivateNetwork:N,getPrivateNetworksByVirtualDataCenter:l,getPrivateIpsByVirtualDataCenter:x,getPrivateIpsByEnterprise:y,getExternalNetworksByVirtualDataCenter:m,createExternalNetwork:P,editExternalNetworkIps:S,getExternalNetworksByDC:n,getVlansByLimit:p,getIpsByExternalNetwork:u,getAllIpsByExternalNetwork:v,getExternalIpsByVirtualDataCenter:z,getExternalIpsByDC:A,createPublicNetwork:O,editPublicNetworkIps:T,getPublicNetworksByDC:q,getPublicNetworksByVirtualDataCenter:o,getAllIpsByPublicNetwork:w,getNetworkPoolInfoPurchasedByVDC:D,getNetworkPoolInfoToPurchaseByVDC:E,purchaseNICforVDC:I,releaseNICFromVDC:J,getPublicIpsByDC:K,getPublicNetworkIps:B,createPublicIp:F,deletePublicIp:G,synchronizeFloatingIps:H,createUnmanagedNetwork:Q,getElasticNetworksByDC:r,getElasticIpsByDC:C,createServiceType:Z,editServiceType:$,deleteServiceType:_,setCurrentServiceType:i,setCurrentNetworkType:j,getServiceTypesByDataCenter:Y}),ba}]),angular.module("notificationsMgr",[]).factory("notificationsMgr",function(){var a={},b=[],c=function(){b.length=0,b.push({id:1,text:"This is a notification 1",date:"1357797600",read:!1}),b.push({id:2,text:"This is a long unread notification longer than one line 2",date:"1357787600",read:!1}),b.push({id:3,text:"This is a notification 3",date:"1357777600",read:!0}),b.push({id:4,text:"This is a notification 4",date:"1357767600",read:!1}),b.push({id:5,text:"This is a notification 5",date:"1357757600",read:!0})},d=function(a){a.read=!0},e=function(){angular.forEach(b,function(a){a.read||d(a)})};return angular.extend(a,{notifications:b,getNotifications:c,markAsRead:d,markAllAsRead:e}),a}),angular.module("pricingMgr",["server"]).factory("pricingMgr",["server","dispatcher","utils","$filter",function(a,b,c,d){function e(a){angular.copy(a,s)}function f(b,f,g,h){r.length=0,e(null);var i=function(a){r.length=0,b&&c.addFirstItem(r,d("translate")("globals.none")),angular.forEach(a.collection,function(a){r.push(new w(a))}),void 0!==h&&h(a)},j={type:"application/vnd.abiquo.pricingtemplates+json",path:"config/pricingtemplates/",queryParam:{}};angular.extend(j.queryParam,f),angular.extend(j.queryParam,g),a.get(j,i)}function g(e,f){var g={};angular.copy(e,g);var h,i=function(b){h=b;var c={links:h.links,rel:"costcodes",type:"application/vnd.abiquo.pricingcostcodes+json",contentType:"application/vnd.abiquo.pricingcostcodes+json"},d=m(g.clientData.costCodes);a.postByRel(c,d,j)},j=function(b){var c={links:h.links,rel:"tiers",type:"application/vnd.abiquo.pricingtiers+json",contentType:"application/vnd.abiquo.pricingtiers+json"},d=n(g.clientData.tiers);a.postByRel(c,d,k)},k=function(a){void 0!=f&&f(),c.toastrSuccess(d("translate")("action.create.success.pricingmodel.text",{pricingModel:h.name})),b.dispatch("pricingmodel.created")};e.links.push(a.createLinkByRel(e.clientData.currency.links,"edit","currency"));var l={path:"config/pricingtemplates",type:"application/vnd.abiquo.pricingtemplate+json"};a.post(l,e,i)}function h(e,f){var g={};angular.copy(e,g);var h=function(){var b={links:e.links,rel:"costcodes",type:"application/vnd.abiquo.pricingcostcodes+json",contentType:"application/vnd.abiquo.pricingcostcodes+json"},c=m(g.clientData.costCodes);a.putByRel(b,c,i)},i=function(b){var c={links:e.links,rel:"tiers",type:"application/vnd.abiquo.pricingtiers+json",contentType:"application/vnd.abiquo.pricingtiers+json"},d=n(g.clientData.tiers);a.putByRel(c,d,j)},j=function(a){void 0!=f&&f(),c.toastrSuccess(d("translate")("action.edit.success.pricingmodel.text",{pricingModel:e.name})),b.dispatch("pricingmodel.edited")},k=a.createLinkByRel(e.clientData.currency.links,"edit","currency");a.setLinkByRel(e.links,"currency",k);var l={links:e.links,rel:"edit"};a.putByRel(l,e,h)}function i(e,f){var g=function(a){void 0!=f&&f(),c.toastrSuccess(d("translate")("action.delete.success.pricingmodel.text",{pricingModel:e.name})),b.dispatch("pricingmodel.deleted")},h={links:e.links,rel:"edit"};a.removeByRel(h,g)}function j(b,c){x.length=0;var d,e=0,f=function(a){0==e&&void 0!=c&&c()},g={},h=function(b){b.collection&&b.collection.length>0,angular.forEach(b.collection,function(c){var d={rel:"tier",links:c.links};e++,a.getByRel(d,function(d){var g={name:a.getLinkByRel(d.links,"datacenter").title};x.push(new y(c,g,d)),e--,f(b)})})},i=function(b){angular.forEach(b.collection,function(b){var c={rel:"tiers",links:b.links};e++,a.getByRel(c,function(a){angular.forEach(a.collection,function(c){var d={price:0,links:[]};x.push(new y(d,b,c)),e--,f(a)})})})};0===b?(g.type="application/vnd.abiquo.datacenters+json",g.path="/admin/datacenters/?pricing="+b,d=i):(g.type="application/vnd.abiquo.pricingtiers+json",g.path="config/pricingtemplates/"+b+"/tiers",d=h),a.get(g,d)}function k(b,c,d,e,f){var g,h=function(a){angular.forEach(a.collection,function(a){b||(a.idPricingTemplate=0),g.push(new B(a))}),void 0!=f&&f(a)};g=b?A:z,g.length=0;var i={path:"admin/enterprises?idPricingTemplate="+c+"&included="+b,type:"application/vnd.abiquo.enterprises+json",queryParam:{}};angular.extend(i.queryParam,d),angular.extend(i.queryParam,e),a.get(i,h)}function l(b,c){var d=function(a){void 0!=c&&c()},e={type:"application/vnd.abiquo.enterprise+json",path:"admin/enterprises/"+b.id};o(b),a.put(e,b,d)}function m(b){var c={collection:[]};return angular.forEach(b,function(b){var d={price:b.price,links:[]};d.links.push(a.getLinkByRel(b.links,"costcode")),c.collection.push(d)}),c}function n(b){var c={collection:[]};return angular.forEach(b,function(b){b.links.push(a.createLinkByRel(b.clientData.tier.links,"edit","tier")),c.collection.push(b)}),c}function o(b){var c=a.getLinkByRel(b.links,"pricingtemplate"),d=a.getUrl("config/pricingtemplates/"+b.idPricingTemplate);b.idPricingTemplate&&"undefined"!=b.idPricingTemplate?""!=c?c.href=d:(c={rel:"pricingtemplate",type:"application/vnd.abiquo.pricingtemplate+json",href:d},b.links.push(c)):(delete b.idPricingTemplate,b.links.splice(b.links.indexOf(c),1))}function p(b,c){var d=function(a){void 0!=c&&c(a)},e={links:b.links,rel:"price"};a.getByRel(e,d)}var q={},r=[],s={},t=[{name:d("translate")("pricingmodel.create.generalinfo.period.minute"),id:0},{name:d("translate")("pricingmodel.create.generalinfo.period.hour"),id:1},{name:d("translate")("pricingmodel.create.generalinfo.period.day"),id:2},{name:d("translate")("pricingmodel.create.generalinfo.period.week"),id:3},{name:d("translate")("pricingmodel.create.generalinfo.period.month"),id:4},{name:d("translate")("pricingmodel.create.generalinfo.period.quarter"),id:5},{name:d("translate")("pricingmodel.create.generalinfo.period.year"),id:6}],u=function(){var a={};return a.name="name",a["clientData.currency.name"]="currency",a},v=u(),w=function(b){var c=b;return c.clientData={currency:a.getClientdataFromLinksByRel(c.links,"currency")},c},x=[],y=function(a,b,c){var d=a;return d.clientData={tier:c,datacenter:b,originalPrice:angular.copy(d.price)},d},z=[],A=[],B=function(a){var b=a;return b};return angular.extend(q,{pricingModels:r,currentPricingModel:s,periods:t,sortMapping:v,pricingTiers:x,enterprisesWithoutPricingModel:z,enterprisesWithPricingModel:A,addPricingModel:g,editPricingModel:h,setCurrentPricingModel:e,getPricingModels:f,deletePricingModel:i,getPricingTiers:j,getPricingModelEnterprises:k,updateEnterprisePricingModel:l,getVirtualAppliancePrice:p}),q}]),angular.module("privilegesMgr",[]).factory("privilegesMgr",["server","dispatcher","userMgr",function(a,b,c){function d(a,b){a.clientData.isHome?b.home[a.name]=a:a.clientData.isInfrastructure?b.infrastructure[a.name]=a:a.clientData.isVirtualDatacenter?b.virtualDatacenters[a.name]=a:a.clientData.isVirtualAppliance?b.virtualAppliances[a.name]=a:a.clientData.isAppsLibrary?b.appsLibrary[a.name]=a:a.clientData.isUsers?b.users[a.name]=a:a.clientData.isSystemConfiguration?b.systemConfiguration[a.name]=a:a.clientData.isPricing?b.pricing[a.name]=a:a.clientData.isEvents?b.events[a.name]=a:console.log(a.name+" cannot be assigned")}function e(a){var b=!1;return angular.forEach(c.user.clientData.privileges,function(c){c.name==a&&(b=!0)}),b}function f(a){angular.forEach(a,function(a){var b=new n(a);d(b,k)})}function g(c,d){l.length=0;var e=function(a){angular.forEach(a.collection,function(a){var b=new n(a);l.push(b)}),void 0!=d&&d(a),b.dispatch("privileges.rolePrivileges.changed",{rolePrivileges:l})},f={rel:"privileges",links:c.links};a.getByRel(f,e)}function h(a,b){var c=!1;return angular.forEach(a,function(a){return a.name===b.name?void(c=!0):void 0}),c}function i(a){var b=!1;return angular.forEach(a,function(a){return e(a)?void(b=!0):void 0}),b}var j={},k={home:{},infrastructure:{},virtualDatacenters:{},virtualAppliances:{},appsLibrary:{},users:{},systemConfiguration:{},pricing:{},events:{}},l=[],m=["home","infrastructure","virtualDatacenters","virtualAppliances","appsLibrary","users","systemConfiguration","pricing","events"],n=function(a){var b=a;return b.clientData={isHome:-1!=b.name.indexOf("ENTERPRISE_ENUMERATE")||-1!=b.name.indexOf("ENTERPRISE_SHOW_STATS_LIMITS")||-1!=b.name.indexOf("ENTERPRISE_ADMINISTER_ALL")||-1!=b.name.indexOf("ENTERPRISE_RESOURCE_SUMMARY_ENT"),isInfrastructure:-1!=b.name.indexOf("PHYS_DC_"),isVirtualDatacenter:-1!=b.name.indexOf("VDC_ENUMERATE")||-1!=b.name.indexOf("VDC_MANAGE")||-1!=b.name.indexOf("MANAGE_FIREWALLS")||-1!=b.name.indexOf("MANAGE_LOADBALANCERS")||-1!=b.name.indexOf("MANAGE_FLOATINGIP"),isVirtualAppliance:-1!=b.name.indexOf("VAPP_")||-1!=b.name.indexOf("WORKFLOW_OVERRIDE")||-1!=b.name.indexOf("MANAGE_HARD_DISKS")||-1!=b.name.indexOf("USERS_SHOW_VM_METRICS")||-1!=b.name.indexOf("USERS_ENABLE_DISABLE_VM_METRICS")||-1!=b.name.indexOf("ASSIGN_FIREWALLS")||-1!=b.name.indexOf("ASSIGN_LOADBALANCERS")||-1!=b.name.indexOf("VM"),isAppsLibrary:-1!=b.name.indexOf("APPLIB_ALLOW")||-1!=b.name.indexOf("APPLIB_DOWNLOAD")||-1!=b.name.indexOf("APPLIB_MANAGE")||-1!=b.name.indexOf("APPLIB_UPLOAD")||-1!=b.name.indexOf("APPLIB_SHOW")||-1!=b.name.indexOf("APPLIB_VIEW"),isUsers:-1!=b.name.indexOf("USERS_"),isSystemConfiguration:-1!=b.name.indexOf("SYSCONFIG_"),isPricing:-1!=b.name.indexOf("PRICING_")||-1!=b.name.indexOf("APPLIB_VM_COST_CODE"),isEvents:-1!=b.name.indexOf("EVENTLOG_")},b};return angular.extend(j,{privileges:k,rolePrivileges:l,privilegeGroups:m,isGranted:e,getPrivilegesByRole:g,roleHasPrivilege:h,userHasAtLeastOnPrivilege:i,formatUserPrivilegesList:f}),j}]),angular.module("refreshMgr",[]).factory("refreshMgr",["$timeout","$rootScope","navigationMgr",function(a,b,c){function d(){console.log("refreshMgr initTimer");var e=o.infrastructure;"dashboard"==c.mainView?e=o.dashboard:"infrastructure"==c.mainView?e=o.infrastructure:"virtualdatacenters"==c.mainView?e=o.virtualDatacenter:"events"==c.mainView?e=o.metering:"library"==c.mainView&&(e=o.library),a.cancel(l),m=!0,l=a(function(){console.log("timer"),b.$broadcast("timer"),d()},e)}function e(){console.log("refreshMgr stopTimer"),m=!1,n=!1,a.cancel(l)}function f(a){o.infrastructure=1e3*a.infrastructure["client.infra.InfrastructureUpdateInterval"].value,o.metering=1e3*a.infrastructure["client.metering.meteringUpdateInterval"].value,o.virtualDatacenter=1e3*a.infrastructure["client.virtual.virtualAppliancesUpdateInterval"].value,o.dashboard=1e3*a.dashboard["client.dashboard.dashboardUpdateInterval"].value,o.downloading=1e3*a.infrastructure["client.applibrary.ovfpackagesDownloadingProgressUpdateInterval"].value,o.conversions=1e3*a.infrastructure["client.virtual.virtualImagesRefreshConversionsInterval"].value,o.virtualAppliance=1e3*a.infrastructure["client.virtual.virtualApplianceDeployingUpdateInterval"].value}function g(){o.interval=k}function h(){o.stopped||(e(),b.$broadcast("timer"),d())}function i(){console.log("refreshMgr initVMTimer"),a.cancel(l),b.$broadcast("timerVM"),n=!0,l=a(function(){console.log("timer VM"),b.$broadcast("timerVM"),i()},o.virtualAppliance)}var j={},k=3e4,l={},m=!1,n=!1,o={infrastructure:k,metering:k,virtualDatacenter:k,dashboard:k,downloading:k,conversions:k,virtualAppliance:k,library:1e4},p=!1,q=!1;return b.$on("dragStart",function(){p=m,q=n,e(),console.log("Drag starts: Waiting timer =",p," Waiting VM timer =",q)}),b.$on("dragStop",function(){console.log("Drag ends"),p&&(d(),p=!1,console.log("Restart Timer")),q&&(i(),q=!1,console.log("Restart TimerVM"))}),angular.extend(j,{timerOptions:o,initTimer:d,stopTimer:e,setTimeIntervals:f,resetTimeInterval:g,forceRefresh:h,initVMTimer:i}),j}]),angular.module("remoteServicesMgr",["server"]).factory("remoteServicesMgr",["server","dispatcher","utils",function(a,b,c){function d(a){var b=a;return void 0===b&&(b=""),b}function e(a){var b={};if(a){var c=a.split("://");if(c.length>1){if(b.protocol=c[0]+"://",c=c[1].split("/"),c.length>1){b.path="";for(var d=1;d<c.length;d++)b.path=b.path+"/"+c[d];b.path=b.path.substr(1)}c.length>0&&(c=c[0].split(":"),b.ip=c[0],c.length>1&&(b.port=c[1]))}}return b}function f(a){var b="";return a&&a.links&&a.links.length>0&&a.links.forEach(function(a){!a||"datacenter"!=a.rel&&"publiccloudregion"!=a.rel||(b+=a.title+", ")}),b.length>0&&(b=b.substr(0,b.length-2)),b}function g(a){var b;return a&&a.clientData&&a.clientData.type&&(b=!a.clientData.type.forceOneLocation||!h(a)),b}function h(b){var c;return b&&(c=a.getLinkByRel(b.links,"datacenter")||a.getLinkByRel(b.links,"publiccloudregion")),c}function i(a){angular.copy(a,t)}function j(a){angular.copy(a,u),b.dispatch("currentRemoteServiceType.changed",{data:u})}function k(b,c,d){v.length=0;var e=function(a){v.length=0,angular.forEach(a.collection,function(a){v.push(new z(a))}),void 0!=d&&d(a)},f={path:"admin/remoteservices",type:"application/vnd.abiquo.remoteservices+json",queryParam:{}};angular.extend(f.queryParam,b),angular.extend(f.queryParam,c),a.get(f,e)}function l(b,c){w.length=0;var d=function(a){w.length=0,angular.forEach(a.collection,function(a){w.push(new z(a))}),void 0!=c&&c(a)},e={links:b.links,rel:"remoteservices"};a.getByRel(e,d)}function m(b,c){var d=function(a){b.checked=!0,c&&c(a,b)},e=function(a){b.checked=!1};if(b.checked=void 0,b.dto)n(b.dto,d,e);else{var f={path:"config/action/remoteservicecheck",type:"application/vnd.abiquo.remoteservice+json"};a.post(f,b,d,e)}}function n(b,c,d){var e=function(a){c&&c(a,b)},f=function(a){d(a)},g={rel:"check",links:b.links};a.getByRel(g,e,f)}function o(c,d){var e=function(a){b.dispatch("remoteServices.created",{data:a}),void 0!=d&&d(a)},f={path:"admin/remoteservices",type:"application/vnd.abiquo.remoteservice+json"};a.post(f,c,e)}function p(c,d,e){var f=function(a){b.dispatch("remoteServices.edited",{data:a}),void 0!=e&&e(a)};c.uri=d.defaultProtocol+d.ip+":"+d.defaultPort+"/"+d.serviceMapping;var g={links:c.links,rel:"edit"};a.putByRel(g,c,f)}function q(c,d){var e=function(a){b.dispatch("remoteServices.edited",{data:a}),void 0!=d&&d(a)},f={links:c.links,rel:"edit"};a.putByRel(f,c,e)}function r(c,d){var e=function(a){b.dispatch("remoteServices.deleted",{data:a}),i(null),void 0!=d&&d(a)},f={links:c.links,rel:"edit"};a.removeByRel(f,e)}var s={},t={},u={},v=[],w=[],x={VIRTUAL_FACTORY:{type:"VIRTUAL_FACTORY",name:"virtualizationmanager",defaultProtocol:"http://",serviceMapping:"virtualfactory",defaultPort:8009,hasCheck:!0,hasPath:!0,availableForDatacenter:!0,availableForPublic:!0,forceOneLocation:!1},STORAGE_SYSTEM_MONITOR:{type:"STORAGE_SYSTEM_MONITOR",name:"storagemanager",defaultProtocol:"http://",serviceMapping:"ssm",defaultPort:8009,hasCheck:!0,hasPath:!0,availableForDatacenter:!0,availableForPublic:!1,forceOneLocation:!1},VIRTUAL_SYSTEM_MONITOR:{type:"VIRTUAL_SYSTEM_MONITOR",name:"monitormanager",defaultProtocol:"http://",serviceMapping:"vsm",defaultPort:8009,hasCheck:!0,hasPath:!0,availableForDatacenter:!0,availableForPublic:!0,forceOneLocation:!1},NODE_COLLECTOR:{type:"NODE_COLLECTOR",name:"discoverymanager",defaultProtocol:"http://",serviceMapping:"nodecollector",defaultPort:8009,hasCheck:!0,hasPath:!0,availableForDatacenter:!0,availableForPublic:!0,forceOneLocation:!1},DHCP_SERVICE:{type:"DHCP_SERVICE",name:"dhcpservice",defaultProtocol:"omapi://",serviceMapping:"",defaultPort:7911,hasCheck:!1,hasPath:!1,availableForDatacenter:!0,availableForPublic:!1,forceOneLocation:!1},BPM_SERVICE:{type:"BPM_SERVICE",name:"businessprocessmanager",defaultProtocol:"http://",serviceMapping:"bpm-async",defaultPort:8009,hasCheck:!0,hasPath:!0,availableForDatacenter:!0,availableForPublic:!1,forceOneLocation:!0},APPLIANCE_MANAGER:{type:"APPLIANCE_MANAGER",name:"appliancemanager",defaultProtocol:"http://",serviceMapping:"am",defaultPort:8009,hasCheck:!0,hasPath:!0,availableForDatacenter:!0,availableForPublic:!1,forceOneLocation:!0},DHCPv6:{type:"DHCPv6",name:"dhcpv6",defaultProtocol:"omapi://",serviceMapping:"",defaultPort:7911,hasCheck:!1,hasPath:!1,availableForDatacenter:!0,availableForPublic:!1,forceOneLocation:!1},CLOUD_PROVIDER_PROXY:{type:"CLOUD_PROVIDER_PROXY",name:"cloudproviderproxy",defaultProtocol:"http://",serviceMapping:"cpp",defaultPort:8009,hasCheck:!0,hasPath:!0,availableForDatacenter:!1,availableForPublic:!0,forceOneLocation:!1}},y=c.objectToArray(x);states=["UNAVAILABLE","AVAILABLE"];var z=function(a){var b=a;return b.clientData={splittedUri:e(b.uri),locations:f(b),type:x[b.type]},b.clientData.canBeAssigned=g(b),b.links||(b.links=[]),b.refreshUri=function(){b.uri=d(b.clientData.splittedUri.protocol)+d(b.clientData.splittedUri.ip)+":"+d(b.clientData.splittedUri.port)+"/"+d(b.clientData.splittedUri.path)},b.getLocationLinks=function(){var a=[];return b.links.length>0&&b.links.forEach(function(b){!b||"datacenter"!=b.rel&&"publiccloudregion"!=b.rel||a.push(b)}),a},b};return angular.extend(s,{RemoteService:z,currentRemoteService:t,currentRemoteServiceType:u,remoteServices:w,remoteServicesAll:v,remoteServiceTypes:x,remoteServiceTypesArray:y,states:states,setCurrentRemoteService:i,setCurrentRemoteServiceType:j,getRemoteServicesGlobal:k,getRemoteServices:l,checkRemoteService:m,createRemoteService:o,editRemoteService:p,editRemoteServiceGlobal:q,deleteRemoteService:r}),s}]),angular.module("rolesMgr",[]).factory("rolesMgr",["server","dispatcher","utils","configMgr","$filter",function(a,b,c,d,e){function f(a){angular.copy(a,r),b.dispatch("currentRole.changed")}function g(){if(!c.isEmptyObject(r)){var a=e("getElementById")(q,r.id);f(a)}}function h(b,c,d){var e=function(a){q.length=0,angular.forEach(a.collection,function(a){q.push(new s(a))}),g(),void 0!==d&&d(a)},f={type:"application/vnd.abiquo.roles+json",path:"admin/roles",queryParam:{}};angular.extend(f.queryParam,b),angular.extend(f.queryParam,c),a.get(f,e)}function i(b,c,d,e){var f=function(a){q.length=0,angular.forEach(a.collection,function(a){q.push(new s(a))}),g(),void 0!==e&&e(a)},h={type:"application/vnd.abiquo.roles+json",path:"admin/roles",queryParam:{identerprise:b.id}};angular.extend(h.queryParam,c),angular.extend(h.queryParam,d),a.get(h,f)}function j(d,f,g,h){var i=function(){void 0!==h&&h(),b.dispatch("role.created",{data:d}),c.toastrSuccess(e("translate")("action.create.success.role.text",{role:d.name}))};if(d.links=[],!c.isEmptyObject(f)){var j=a.createLinkByRel(f.links,"edit","enterprise");d.links.push(j)}var k=a.createLinkByRel(g.links,"edit","scope");d.links.push(k);var l={type:"application/vnd.abiquo.role+json",path:"admin/roles"};d.ldap&&""!=d.ldap&&(l.type="application/vnd.abiquo.roleWithLdap+json"),a.post(l,d,i)}function k(d,e,f,g,h){var i=function(a){var b=a;n(b,g,j)},j=function(){void 0!==h&&h(),b.dispatch("role.created",{data:d})},k=a.createLinkByRel(f.links,"edit","scope");a.setLinkByRel(d.links,"scope",k);var l=a.getLinkByRel(d.links,"enterprise");if(c.isEmptyObject(l)){if(!c.isEmptyObject(e)){var m=a.createLinkByRel(e.links,"edit","enterprise");d.links.push(m)}}else if(c.isEmptyObject(e))a.removeLinkByRel(d.links,"enterprise");else{var m=a.createLinkByRel(e.links,"edit","enterprise");a.setLinkByRel(d.links,"enterprise",m)}var o={type:"application/vnd.abiquo.role+json",path:"admin/roles"};d.ldap&&""!=d.ldap&&(o.type="application/vnd.abiquo.roleWithLdap+json"),a.post(o,d,i)}function l(d,e,f,g,h){var i=function(){n(d,g,j)},j=function(){void 0!==h&&h(),b.dispatch("role.edited",{data:d})},k=a.createLinkByRel(f.links,"edit","scope");a.setLinkByRel(d.links,"scope",k);var l=a.getLinkByRel(d.links,"enterprise");if(c.isEmptyObject(l)){if(!c.isEmptyObject(e)){var m=a.createLinkByRel(e.links,"edit","enterprise");d.links.push(m)}}else if(c.isEmptyObject(e))a.removeLinkByRel(d.links,"enterprise");else{var m=a.createLinkByRel(e.links,"edit","enterprise");a.setLinkByRel(d.links,"enterprise",m)}var o={links:d.links,rel:"edit"};d.ldap&&""!=d.ldap&&(o.type="application/vnd.abiquo.roleWithLdap+json",o.contentType="application/vnd.abiquo.roleWithLdap+json"),a.putByRel(o,d,i)}function m(d,f){var g=function(a){void 0!==f&&f(),b.dispatch("role.deleted",{data:d}),c.toastrSuccess(e("translate")("action.delete.success.role.text",{role:d.name})),c.emptyObject(p.currentRole)},h={type:"application/vnd.abiquo.role+json",path:"admin/roles/"+d.id};a.remove(h,g)}function n(d,f,g){for(var h=function(){void 0!==g&&g(),b.dispatch("role.edited",{data:d}),c.toastrSuccess(e("translate")("action.edit.success.role.text",{role:d.name}))},i=a.getLinkByRel(d.links,"privilege");!c.isEmptyObject(i);)a.removeLinkByRel(d.links,"privilege"),i=a.getLinkByRel(d.links,"privilege");angular.forEach(f,function(b){d.links.push(a.getLinkByRel(b.links,"privilege"))});var j={links:d.links,rel:"edit"};a.putByRel(j,d,h)}function o(b,c){var d=function(a){a.collection.length>0&&(b.ldap=a.collection[0].roleLdap),void 0!=c&&c(a)},e={path:"admin/rolesldap",type:"application/vnd.abiquo.rolesldap+json",queryParam:{idRole:b.id}};a.get(e,d)}var p={},q=[],r={},s=function(b){var d=b,e=a.getClientdataFromLinksByRel(d.links,"enterprise"),f=a.getClientdataFromLinksByRel(d.links,"scope");return d.clientData={scope:f,isGlobal:!0},c.isEmptyObject(e)||(d.clientData.enterprise=e,d.clientData.isGlobal=!1),d};return angular.extend(p,{Role:s,roles:q,currentRole:r,getRoles:h,setCurrentRole:f,getRolesByEnterprise:i,createRole:j,cloneRole:k,editRole:l,deleteRole:m,editPrivileges:n,getRoleLdap:o}),p}]),angular.module("scopesMgr",[]).factory("scopesMgr",["server","dispatcher","configMgr","$filter","utils",function(a,b,c,d,e){function f(a){angular.copy(a,o),b.dispatch("currentScope.change",{data:o})}function g(b,c,d){var e=function(a){n.length=0,angular.forEach(a.collection,function(a){n.push(new p(a))}),void 0!==d&&d(a)},f={type:"application/vnd.abiquo.scopes+json",path:"admin/scopes",queryParam:{}};angular.extend(f.queryParam,b),angular.extend(f.queryParam,c),a.get(f,e)}function h(b,c){var d=function(a){angular.copy(new p(a),o),void 0!==c&&c()},e={type:"application/vnd.abiquo.scope+json",path:"admin/scopes/"+b.id};a.get(e,d)}function i(f,g){var h=function(){void 0!==g&&g(),b.dispatch("scope.created",{data:f}),e.toastrSuccess(d("translate")("action.create.success.scope.text",{scope:f.name}))};f.scopeEntities=[];var i=1;for(var j in f.clientData.enterpriseIds)if("length"!==j&&f.clientData.enterpriseIds[j]){var k={id:i,idResource:parseInt(j),type:"ENTERPRISE",links:[{title:f.name,rel:"scope",type:"application/vnd.abiquo.scope+json",href:c.config["config.endpoint"]+"/admin/scopes/"+f.id}]};f.scopeEntities.push(k),i++}i=1;for(var j in f.clientData.datacenterIds)if("length"!==j&&f.clientData.datacenterIds[j]){var k={id:i,idResource:parseInt(j),type:"DATACENTER",links:[{title:f.name,rel:"scope",type:"application/vnd.abiquo.scope+json",href:c.config["config.endpoint"]+"/admin/scopes/"+f.id}]};f.scopeEntities.push(k),i++}var l={type:"application/vnd.abiquo.scope+json",path:"admin/scopes"};a.post(l,f,h)}function j(f,g){var h=function(a){void 0!==g&&g(),b.dispatch("scope.edited",{data:f}),e.toastrSuccess(d("translate")("action.edit.success.scope.text",{scope:f.name}))};f.scopeEntities=[];var i=1;for(var j in f.clientData.enterpriseIds)if("length"!==j&&f.clientData.enterpriseIds[j]){var k={id:i,idResource:parseInt(j),type:"ENTERPRISE",links:[{title:f.name,rel:"scope",type:"application/vnd.abiquo.scope+json",href:c.config["config.endpoint"]+"/admin/scopes/"+f.id}]};f.scopeEntities.push(k),i++}i=1;for(var j in f.clientData.datacenterIds)if("length"!==j&&f.clientData.datacenterIds[j]){var k={id:i,idResource:parseInt(j),type:"DATACENTER",links:[{title:f.name,rel:"scope",type:"application/vnd.abiquo.scope+json",href:c.config["config.endpoint"]+"/admin/scopes/"+f.id}]};f.scopeEntities.push(k),i++}var l={type:"application/vnd.abiquo.scope+json",path:"admin/scopes/"+f.id};a.put(l,f,h)}function k(c,g){var h=function(a){void 0!==g&&g(),b.dispatch("scope.deleted",{data:c}),e.toastrSuccess(d("translate")("action.delete.success.scope.text",{scope:c.name})),f(null)},i={type:"application/vnd.abiquo.scope+json",path:"admin/scopes/"+c.id};a.remove(i,h,void 0)}function l(a,b,c){angular.forEach(b,function(b){angular.forEach(a.scopeEntities,function(a){b.id==a.idResource&&c==a.type&&(a.name=b.name)})})}var m={},n=[],o={},p=function(a){a||(a={});var b=a;return b.clientData={isGlobal:1==b.id||b.name&&"global scope"==b.name.toLowerCase()},b};return angular.extend(m,{Scope:p,scopes:n,currentScope:o,setCurrentScope:f,getScopes:g,getScopeDetails:h,createScope:i,editScope:j,deleteScope:k,updateScopeEntities:l}),m}]),angular.module("server",["limits"]).factory("server",["$http","$rootScope","$filter","utils","configMgr","$cookies","$window",function(a,b,c,d,e,f,g){function h(a,b,c){a&&a.headers&&b&&(a.headers[b]?a.headers[b]+=";":a.headers[b]="",c?a.headers[b]+="version="+c:a.headers[b]+="version="+e.config["api.version"])}function i(a,b){h(a,"Accept",b)}function j(a,b){h(a,"Content-Type",b)}function k(b,c,e,f){if(b.type&&b.path){var g=X(b.type,b.contentType,!0,b);if(b.absolutPath)var h=b.path;else var h=M+"/"+b.path;return b.queryParam&&(h+=Q(b.queryParam,h)),dataCleaned=d.getCopyCleanObjectFromClientData(c),h=I(h),a.put(h,dataCleaned,g).success(function(a,b,c,d){0==b||b>=400?U(a,"put",h,f,e,b,c,d):T(a,e)}).error(function(a){U(a,"put",h,f)})}throw Error("Incorrect type or path");
}function l(b,c,e,f){if(b.links&&b.rel){var g,h=x(b.links,b.rel),i={};i=b.type?b.type:h.type,g=b.contentType?b.contentType:h.type;var j=X(i,g,!0,b),k=h.href;return b.queryParam&&(k+=Q(b.queryParam,k)),dataCleaned=d.getCopyCleanObjectFromClientData(c),k=I(k),a.put(k,dataCleaned,j).success(function(a,b,c,d){0==b||b>=400?U(a,"put",k,f,e,b,c,d):T(a,e)}).error(function(a){U(a,"put",k,f)})}throw Error("Incorrect links or rel")}function m(b,c,e,f){if(b.type&&b.path){var g=X(b.type,b.contentType,!0,b);if(b.absolutPath)var h=b.path;else var h=M+"/"+b.path;return b.queryParam&&(h+=Q(b.queryParam,h)),dataCleaned=d.getCopyCleanObjectFromClientData(c),h=I(h),a.post(h,dataCleaned,g).success(function(a,b,c,d){0==b||b>=400?U(a,"post",h,f,e,b,c,d):T(a,e,c,d)}).error(function(a){U(a,"post",h,f)})}throw Error("Incorrect type or path")}function n(b,c,e,f){if(b.links&&b.rel){var g,h=x(b.links,b.rel),i={},j=!0;i=b.type?b.type:h.type,b.contentType?g=b.contentType:""!==b.contentType?g=h.type:j=!1;var k=X(i,g,j,b),l=h.href;return b.queryParam&&(l+=Q(b.queryParam,l)),dataCleaned=d.getCopyCleanObjectFromClientData(c),l=I(l),a.post(l,dataCleaned,k).success(function(a,b,c,d){0==b||b>=400?U(a,"post",l,f,e,b,c,d):T(a,e,c,d)}).error(function(a){U(a,"post",l,f)})}throw Error("Incorrect links or rel")}function o(b,c,d){if(N=b.username,O=b.password,P=b.token,b.type&&b.path){var e={headers:{Accept:b.type},withCredentials:!0,bypassInterceptor:!0};void 0===f.auth&&(e.headers.Authorization="Basic "+Base64.encode(N+":"+O)),i(e,b.version);var g=M+"/"+b.path;return g=I(g),a.get(g,e).success(function(a,b,e,f){0==b||b>=400?U(a,"get",g,d,c,b,e,f):T(a,c)}).error(function(a){console.log("Fail: ",g),U(a,"get",g,d)})}throw Error("Incorrect type or path")}function p(b,c,d){if(b.type&&b.path){var e=X(b.type,void 0,!1,b);if(b.absolutPath)var f=b.path;else var f=M+"/"+b.path;return b.queryParam&&(f+=Q(b.queryParam,f)),f=I(f),a.get(f,e).success(function(a,b,e,g){0==b||b>=400?U(a,"get",f,d,c,b,e,g):T(a,c)}).error(function(a){U(a,"get",f,d)})}throw Error("Incorrect type or path")}function q(b,c,d,e){var f=X();return b=I(b),a.get(b,f).success(function(a,e,f,g){0==e||e>=400?U(a,"get",b,d,c,e,f,g):T(a,c)}).error(function(a){U(a,"get",b,d)})}function r(b,c,d){if(b.links&&b.rel){var e=x(b.links,"edit"),f=b.rel+e.href+JSON.stringify(b.queryParam);if(Y[f])return;Y[f]=e.href;var g=x(b.links,b.rel,b.title);b.type&&(g.type=b.type);var h=X(g.type,void 0,!1,b),i=g.href;return b.queryParam&&(i+=Q(b.queryParam,i)),i=I(i),a.get(i,h).success(function(a,b,e,g){delete Y[f],0==b||b>=400?U(a,"get",i,d,c,b,e,g):T(a,c)}).error(function(a){delete Y[f],U(a,"get",i,d)})}throw Error("Incorrect links or rel")}function s(b,c,d){if(b.path){var e=X(b.type,void 0,!1,b);if(b.absolutPath)var f=b.path;else var f=M+"/"+b.path;return b.queryParam&&(f+=Q(b.queryParam,f)),f=I(f),a["delete"](f,e).success(function(a,b,e,g){0==b||b>=400?U(a,"delete",f,d,c,b,e,g):T(a,c)}).error(function(a){U(a,"delete",f,d)})}throw Error("Incorrect path")}function t(b,c,d){if(b.links&&b.rel){var e=x(b.links,b.rel),f=X(e.type,void 0,!1,b),g=e.href;return g=I(g),a["delete"](g,f).success(function(a,b,e,f){0==b||b>=400?U(a,"delete",g,d,c,b,e,f):T(a,c)}).error(function(a){U(a,"delete",g,d)})}throw Error("Incorrect links or rel")}function u(a,b){a=a,b=b}function v(){return"Basic "+Base64.encode(N+":"+O)}function w(a,b){var d=c("getElementByParameter")(a,{element:b,attribute:"type"});return d}function x(a,b,c){var d="";return a&&angular.forEach(a,function(a){return a.rel===b?(c?a.title===c&&(d=a):d=a,"costcode"!==a.rel||a.type||(a.type="application/vnd.abiquo.costcode+json"),"currency"!==a.rel||a.type||(a.type="application/vnd.abiquo.currency+json"),"application/vnd.abiquo.enterprise+xml"===a.type&&(a.type="application/vnd.abiquo.enterprise+json"),"application/vnd.abiquo.rack+xml"===a.type&&(a.type="application/vnd.abiquo.rack+json"),"application/vnd.abiquo.machine+xml"===a.type&&(a.type="application/vnd.abiquo.machine+json"),void("application/vnd.abiquo.volumes+xml; version=2.6"===a.type&&(a.type="application/vnd.abiquo.volumes+json"))):void 0}),d}function y(a,b){var c=z(a.href,b);return c}function z(a,b){var c;if(a&&b){var d=a.split(b+"/");if(d.length>1){var e=d[1];d=e.split("/"),d.length>0&&(c=isNaN(d[0])?d[0]:parseInt(d[0]))}}return c}function A(a,b,c){var e={},f=x(a,b);if(!d.isEmptyObject(f)){var g;switch(b){case"currency":g="currencies";break;default:g=b+"s"}e={name:f.title,id:y(f,c?c:g)}}return e}function B(a,b){var c,d=x(a,b);if(d&&d.href)for(var e=d.href.split("/"),f=e.length-1;f>=0;f--)if(isNaN(parseInt(e[f]))){c=e[f];break}return c}function C(a,b,c){var d=angular.extend({},x(a,b));return d.rel=c,d}function D(a,b,c){G(a,b),c.rel=b,a.push(c)}function E(a,b){return a.rel==b}function F(a,b){for(var c=a.length-1;c>=0;c--)a[c].rel==b&&G(a,b,a[c].title)}function G(a,b,c){var e=x(a,b,c);d.isEmptyObject(e)||a.splice(a.indexOf(e),1)}function H(a){return M+"/"+a}function I(a){if(a){var b=new RegExp(/.*virtualmachines\/.*\/metrics\/.*/);b.test(a)||(a+=Q(J(),a))}return a}function J(){return Z++,{cacheStamp:Z}}function K(b){var c={withCredentials:!0,bypassInterceptor:!0,timeout:2e3},d=M+"/logout";return a.post(d,c).success(function(a,c,d,e){b()}).error(function(a,c,d,e){b()})}var L={},M=e.config["config.endpoint"],N="",O="",P="",Q=function(a,b){var c="";return angular.forEach(a,function(a,d){""===c&&-1==b.indexOf("?")?""!==a&&(c+="?"+d+"="+a):""!==a&&(c+="&"+d+"="+a)}),c},R=function(a,b){a&&a.collection&&a.collection.forEach(function(a){var f=a.code,g=a.message,h="server.error."+f,i=c("translate")(h);if(i=h==i?f+": "+g:f+": "+i,"true"===e.config["egg.speak"]&&"speechSynthesis"in window){var j=new SpeechSynthesisUtterance;j.voice=speechSynthesis.getVoices().filter(function(a){return"en-US"==a.lang})[0],j.voiceURI="native",j.volume=1,j.rate=3,j.pitch=2,j.text=i,j.lang="en-US",speechSynthesis.speak(j)}"VIMAGE-10"!=f&&"VIMAGE-7"!=f||void 0==b?"VM-44"==f?b(f):"VM-109"==f?b(f):d.toastrError(i):b(f)}),b&&b()},S=function(a){var b="";a.collection.forEach(function(a){var d=a.code,e=a.message,f=c("translate")("server.error."+d);f=0==f.indexOf("_")?d+": "+e:d+": "+f,b+=f+"<br><br>"}),d.toastrWarning(b)},T=function(a,b,c,d){b&&b(a,c,d)},U=function(a,b,c,f,h,i,j,k){if(401===i||403===i){if(a.collection)var l=a;else{var m=a.search("Too many failed attempts to login");if(-1!=m)var n=a.search("login again")-12,o=a.substr(m,n-m),l={collection:[{code:"401-TooManyAttempts",message:o}]};else if(-1!=a.search("User account is locked"))var p=a.split(" 403 - "),q=p[1].split("</h1>"),l={collection:[{code:"401-UserAccountLocked",message:q[0]}]};else if(-1!=a.search("resetPasswordToken")){var r=a.split(" 403 - "),q=r[1].split("</h1>");g.location.href=q[0]}else if(-1!=a.search("The supplied access token is not valid"))var s=a.split(" 403 - "),q=s[1].split("</h1>"),l={collection:[{code:"403-InvalidToken",message:q[0]}]};else var l={collection:[{code:"401-Unauthorized",message:"Incorrect user/password."}]}}R(l)}else""===a?d.toastrError(b+" error in "+c):i&&j?409==i&&"application/vnd.abiquo.limiterror+json"==j("Content-Type")?e.userInterface.synchronizeVapp?h(a,k):V(a,k,h):R(a,f):f?f():R(a)},V=function(a,e,f){var g={};g=1==a.hardLimit?{scope:b,controller:"HardLimitCtrl",popupUrl:"modules/limit/partials/limitsform.html",formName:"hardlimitsForm",title:c("translate")("limits.hard.title"),closeOnCancel:!0,cancelLabel:c("translate")("globals.close"),showAcceptBtn:!1,showCancelBtn:!0,popupData:{error:a,config:e,successCallback:f}}:{scope:b,controller:"SoftLimitCtrl",popupUrl:"modules/limit/partials/limitsform.html",formName:"softlimitsForm",title:c("translate")("limits.soft.title"),closeOnCancel:!0,closeOnAccept:!0,cancelLabel:c("translate")("globals.no"),acceptLabel:c("translate")("globals.yes"),showAcceptBtn:!0,showCancelBtn:!0,popupData:{error:a,config:e,successCallback:f}},d.showPopUp(g,b)},W=function(a,b){var c={path:a.url,type:a.headers.Accept,contentType:a.headers["Content-Type"],absolutPath:!0,queryParam:{force:!0}};switch(-1!=a.headers["Content-Type"].search("virtualmachinetask")&&delete c.contentType,a.method){case"POST":m(c,a.data,b);break;case"PUT":k(c,a.data,b);break;case"DELETE":s(c,a.data,b);break;case"GET":p(c,a.data,b)}},X=function(a,b,c,d){var c=void 0===c?!1:c,e={};return a?c?(e={headers:{Accept:a,"Content-Type":void 0===b?a:b},withCredentials:!0},i(e,d.version),j(e,d.version)):(e={headers:{Accept:a},withCredentials:!0},i(e,d.version)):e={headers:{},withCredentials:!0},d.user&&d.password&&(e.headers.Authorization="Basic "+Base64.encode(d.user+":"+d.password),e.withCredentials=!1,document.cookie="auth=;path=/api",document.cookie="JSESSIONID=;path=/api",e.flags={editing:!0}),d.providerEndpoint&&(e.headers["X-Abiquo-PCR-Identity"]=d.providerUser,e.headers["X-Abiquo-PCR-Credential"]=d.providerPassword,e.headers["X-Abiquo-PCR-Endpoint"]=d.providerEndpoint),e},Y={},Z=0;return angular.extend(L,{showErrors:R,showWarnings:S,login:o,put:k,putByRel:l,post:m,postByRel:n,get:p,getByRel:r,remove:s,removeByRel:t,setCredentials:u,getAuthorization:v,getLinkByType:w,getLinkByRel:x,createLinkByRel:C,setLinkByRel:D,removeAllLinksByRel:F,removeLinkByRel:G,getIdInLinkByParameter:y,getIdInLinkHrefByParameter:z,getClientdataFromLinksByRel:A,getServiceNameFromLinksByRel:B,isLinkByRel:E,getUrl:H,getByUrl:q,newQueryParamCacheKey:J,forceSoftLimitCall:W,logout:K,checkSoftHardLimits:V}),L}]),angular.module("serversMgr",["server"]).factory("serversMgr",["server","$filter","utils","dispatcher",function(a,b,c,d){function e(a){angular.copy(a,N),d.dispatch("currentDcEnterprise.change",{data:N})}function f(a){angular.copy(a,O),d.dispatch("currentRack.change",{data:O})}function g(a){var b=!1;J.forEach(function(c){c.clientData.machines.forEach(function(d){return d.id==a.id?(f(c),void(b=!0)):void 0}),b})}function h(a){angular.copy(a,P),d.dispatch("currentMachine.change",{data:P})}function i(b,c,d,e,g){angular.copy(J,L),c||(J.length=0);var h=function(a){var b=[];angular.forEach(a.collection,function(a){var d=new S(a,c);b.push(d),O.id==d.id&&f(d)}),angular.copy(b,J),void 0!==g&&g(a)},i={rel:"racks",links:b.links,queryParam:{filter:e?e.has:""}};a.getByRel(i,h)}function j(c,d,e,f){var g=function(a){var d=[];angular.forEach(a.collection,function(a){var b=new T(a);d.push(b),P.id==b.id&&h(b)});var e=b("getElementByParameter")(J,{element:c.id,attribute:"id"});angular.copy(d,e.clientData.machines),void 0!==f&&f(d)},i={rel:"machines",links:c.links,queryParam:{filter:e?e.has:""}};a.getByRel(i,g)}function k(b,c,d,f){c||(K.length=0);var g=function(a){var b=[];angular.forEach(a.collection,function(a){b.push(a),N.id==a.id&&e(a)}),angular.copy(b,K),void 0!==f&&f(a)},h={rel:"enterprises",links:b.links,queryParam:{filter:d?d.has:""}};a.getByRel(h,g)}function l(b,c,d,e,f){c||(Q.length=0);var g=function(a){Q.length=0,angular.forEach(a.collection,function(a){var b=new U(a);Q.push(b)}),void 0!==f&&f(a)},h={rel:"virtualmachines",links:b.links,queryParam:{filter:e.has}};a.getByRel(h,g)}function m(b,c){Q.length=0;var e=function(a){Q.length=0,angular.forEach(a.collection,function(a){var b=new U(a);Q.push(b)}),d.dispatch("virtualmachines.retrieved",{data:a}),void 0!=c&&c(a)},f={links:b.links,rel:"virtualmachines",queryParam:{sync:!0}};a.getByRel(f,e)}function n(b,c){var e=function(a){d.dispatch("virtualmachines.deleted",{data:a}),void 0!=c&&c(a)},f={links:b.links,rel:"virtualmachines",queryParam:{sync:!0}};a.removeByRel(f,e)}function o(b,c,d,e){var f=function(a){M.length=0,angular.forEach(a.collection,function(a){var b=new T(a);M.push(b)}),void 0!==e&&e(M)},g={rel:"reservedmachines",links:b.links,queryParam:{}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.getByRel(g,f)}function p(a,e){var f=function(f){d.dispatch("racks.edited",{data:f}),e&&e(),c.toastrSuccess(b("translate")("action.edited.success.rack.text",{rack:a.name}))},g={rel:"edit",links:a.links};F(g,a,f)}function q(e,f,g){var h=function(a){d.dispatch("racks.created",{data:a}),g&&g(),c.toastrSuccess(b("translate")("action.create.success.rack.text",{rack:e.name}))},i={rel:"racks",links:f.links,type:"application/vnd.abiquo.rack+json",contentType:"application/vnd.abiquo.rack+json"};a.postByRel(i,e,h)}function r(e,f,g){var h=function(a){d.dispatch("racks.created",{data:a}),g&&g(),c.toastrSuccess(b("translate")("action.create.success.rack.text",{rack:e.name}))},i={rel:"racks",links:f.links,type:"application/vnd.abiquo.ucsrack+json",contentType:"application/vnd.abiquo.ucsrack+json"};a.postByRel(i,e,h)}function s(a,e){var f=function(f){d.dispatch("racks.deleted",{data:f,rack:a}),e&&e(f),c.toastrSuccess(b("translate")("action.delete.success.rack.text",{rack:a.name}))},g={rel:"edit",links:a.links};G(g,f)}function t(b,c,e){var f=function(a){R.length=0,d.dispatch("physicalMachine.discovered"),angular.forEach(a.collection,function(a){var c=new T(a);c.user=b.user,c.password=b.password,c.agentUser=b.agentuser,c.agentPassword=b.agentpassword,c.managerUser=b.manageruser,c.managerPassword=b.managerpassword,R.push(c)}),e&&e()},g=angular.copy(b);angular.forEach(g,function(a,b){void 0==g[b]&&delete g[b]});var h={links:c.links,rel:"discover",queryParam:g};a.getByRel(h,f)}function u(d,e,f){var g=function(a){d.state=a.state,d.clientData.checkingState=!1,void 0!=f&&f(a)},h=function(){d.clientData.checkingState=!1},i=function(){if(0==d.links.length)var b={links:e.links,rel:"checkmachinestate",queryParam:{ip:d.ip,hypervisor:d.type,user:d.user,password:d.password,port:d.port?d.port:""}};else var b={links:d.links,rel:"checkstate"};a.getByRel(b,g,h)},j=function(){if(0==d.links.length)var b={links:e.links,rel:"checkmachineipmistate",queryParam:{ip:d.ipmiIP,user:d.ipmiUser,password:d.ipmiPassword,port:d.ipmiPort}};else var b={links:d.links,rel:"checkipmistate",queryParam:{ip:d.ipmiIP,user:d.ipmiUser,password:d.ipmiPassword,port:d.ipmiPort}};a.getByRel(b,k)},k=function(a){"CONFIGURED"==a.state?i():(d.state=a.state,d.clientData.checkingState=!1,c.toastrError(b("translate")("servers.physicalmachine.create.check.error")))};d.ipmiIP&&""!=d.ipmiIP||d.ipmiPort&&""!=d.ipmiPort||d.ipmiUser&&""!=d.ipmiUser.trim()||d.ipmiPassword&&""!=d.ipmiPassword.trim()?j():i()}function v(e,f,g,h){var i,j;angular.forEach(f.networkInterfaces.collection,function(c){c.clientData&&(i=b("getElementByParameter")(g,{element:parseInt(c.clientData.serviceType.id),attribute:"id"}),0!=i.id&&(j=a.createLinkByRel(i.links,"edit","networkservicetype"),c.links=[],c.links.push(j)),delete c.clientData)});var k=function(a){d.dispatch("physicalmachine.created",{data:a}),void 0!=h&&h(a),c.toastrSuccess(b("translate")("action.create.success.physicalmachine.text",{physicalmachine:f.name}))},l={links:e.links,rel:"machines",type:"application/vnd.abiquo.machine+json",contentType:"application/vnd.abiquo.machine+json"};E(l,f,k)}function w(e,f,g){var h,i;angular.forEach(e.networkInterfaces.collection,function(c){h=b("getElementByParameter")(f,{element:parseInt(c.clientData.serviceType.id),attribute:"id"}),0!=h.id?(i=a.createLinkByRel(h.links,"edit","networkservicetype"),c.links=[],c.links.push(i)):c.links=[],delete c.clientData});var j=function(a){d.dispatch("physicalMachine.edited",{data:a}),void 0!=g&&g(a),c.toastrSuccess(b("translate")("action.edit.success.physicalmachine.text",{physicalmachine:e.name}))},k={links:e.links,rel:"edit"};""==e.user&&delete e.user,""==e.password&&delete e.password,""==e.port&&delete e.port,""==e.managerUser&&delete e.managerUser,""==e.managerPassword&&delete e.managerPassword,""==e.managerPort&&delete e.managerPort,""==e.agentUser&&delete e.agentUser,""==e.agentPassword&&delete e.agentPassword,""==e.agentPort&&delete e.agentPort,a.putByRel(k,e,j)}function x(e,f){var g=function(a){h(a,P),d.dispatch("physicalMachines.enabled",{data:a}),void 0!=f&&f(a),c.toastrSuccess(b("translate")("action.enable.success.physicalmachine.text",{physicalmachine:e.name}))},i={links:e.links,rel:"edit"};e.state="MANAGED",a.putByRel(i,e,g)}function y(e,f){var g=function(a){h(a,P),d.dispatch("physicalMachines.enabled",{data:a}),void 0!=f&&f(a),c.toastrSuccess(b("translate")("action.enable.success.physicalmachine.text",{physicalmachine:e.name}))},i={links:e.links,rel:"reenableafterha"};a.getByRel(i,g)}function z(e,f){var g=function(a){c.toastrSuccess(b("translate")("action.disable.success.physicalmachine.text",{physicalmachine:e.name})),h(a,P),d.dispatch("physicalMachines.disabled",{data:a}),void 0!=f&&f(a)},i={links:e.links,rel:"edit"};e.state="HALTED",a.putByRel(i,e,g)}function A(a,b){var c={rel:"edit",links:a.links},e=function(a){d.dispatch("physicalMachine.deleted",{data:a}),b&&b()};D(c,e)}function B(b,c,d){var e=function(a){void 0!=d&&d(a)},f={links:b.links,rel:"sendmail",queryParam:c.clientData};a.postByRel(f,c,e)}function C(b,c,d){var e=function(a){void 0!=d&&d(a)},f=a.getLinkByRel(b.links,"virtualmachine"),g={absolutPath:!0,path:f.href+"/action/sendmail",type:"application/vnd.abiquo.mail+json",queryParam:c.clientData};a.post(g,c,e)}function D(b,c){a.removeByRel(b,c)}function E(b,c,d){a.postByRel(b,c,d)}function F(b,c,d){a.putByRel(b,c,d)}function G(b,c){a.removeByRel(b,c)}function H(b){var c=function(c){e={links:b.links,rel:"datastores"},a.getByRel(e,d)},d=function(a){angular.extend(b.datastores,a)},e={links:b.links,rel:"refresh"};a.getByRel(e,c)}var I={},J=[],K=[],L=[],M=[],N={},O={},P={},Q=[],R=[],S=function(a,b){var c=a;return c.clientData={open:V(a),machines:W(a,b)},X(c),c},T=function(b){var d=b;return d.clientData={incomplete:!0},d.clientData.rack=a.getClientdataFromLinksByRel(b.links,"rack"),Y(d),angular.forEach(d.networkInterfaces.collection,function(b){var d=a.getLinkByRel(b.links,"networkservicetype");c.isEmptyObject(d)||(b.clientData={serviceType:a.getClientdataFromLinksByRel(b.links,"networkservicetype")})}),d},U=function(b){var d=b;d.clientData={owner:a.getClientdataFromLinksByRel(d.links,"user"),enterprise:a.getClientdataFromLinksByRel(d.links,"enterprise"),vmtemplate:a.getClientdataFromLinksByRel(d.links,"virtualmachinetemplate"),nics:[],virtualDisks:[],volumes:[],hardDisks:[],hypervisorType:a.getLinkByRel(d.links,"machine").title,protector:"-"};var e=a.getLinkByRel(d.links,"protector");return c.isEmptyObject(e)||(d.clientData.protector=e.title),d},V=function(a){var b=!1;return angular.forEach(L,function(c){c.id==a.id&&(b=c.clientData.open)}),b},W=function(a,b){var c=[];return b&&angular.forEach(L,function(b){b.id==a.id&&(c=angular.copy(b.clientData.machines))}),c},X=function(a){a.clientData.open&&j(a)},Y=function(b){var c=!1;angular.forEach(b.networkInterfaces.collection,function(b){if(b.links.length>0){c=!0;var d=a.getLinkByRel(b.links,"networkservicetype");b.clientData={serviceType:{id:d.id}}}else b.clientData={serviceType:{id:0}}}),c||b.networkInterfaces&&b.networkInterfaces.collection&&b.networkInterfaces.collection.length>0&&(b.networkInterfaces.collection[0].clientData={serviceType:{id:1}})};return angular.extend(I,{enterprises:K,racks:J,reservedServers:M,virtualMachines:Q,currentEnterprise:N,currentRack:O,currentMachine:P,discoverMachines:R,getEnterprises:k,getRacks:i,getPhysicalMachines:j,getVirtualMachines:l,getVirtualMachinesFromPhysicalMachine:m,deleteRetrievedVirtualMachines:n,getReservedMachinesByEnterprise:o,createRack:q,createUCSRack:r,editRack:p,deleteRack:s,deletePhysicalMachine:A,discover:t,checkPhysicalMachineState:u,createPhysicalMachine:v,editPhysicalMachine:w,enablePhysicalMachines:x,enableAfterHa:y,disablePhysicalMachines:z,sendEmail:B,sendEmailToVirtualMachine:C,setCurrentEnterprise:e,setCurrentRack:f,setCurrentRackByPhysicalMachine:g,setCurrentMachine:h,refreshDatastores:H}),I}]),angular.module("statisticsMgr",["server"]).factory("statisticsMgr",["server","dispatcher","utils","$filter",function(a,b,c,d){var e={},f=function(a){var b=a;return b.clientData={},b},g=function(a){var b=a;return b.clientData={},b},h=[],i=[],j={},k={},l=function(a){a&&!c.isEmptyObject(a)&&m("dashboard",a)},m=function(a,b){"dashboard"==a?(c.drawColumnsGraph(b,"vcpu"),c.drawColumnsGraph(b,"storage"),c.drawColumnsGraph(b,"memory"),c.drawColumnsGraph(b,"extstorage"),c.drawColumnsGraph(b,"vlan"),c.drawColumnsGraph(b,"publicip"),c.drawColumnsGraph(b,"repository")):(c.drawColumnsGraph(b,"server"),c.drawColumnsGraph(b,"datacenterextstorage"),c.drawColumnsGraph(b,"datacenterpublicip"),c.drawColumnsGraph(b,"datacenterrepository"),c.drawColumnsGraph(b,"virtualmachine"),c.drawColumnsGraph(b,"datacentervcpu"),c.drawColumnsGraph(b,"datacenterstorage"),c.drawColumnsGraph(b,"datacentermemory"))},n=function(b){h.length=0;var d={type:"application/vnd.abiquo.virtualappsresources+json",path:"statistics/vappsresources",queryParam:{identerprise:b.id}};c.isEmptyObject(b)||a.get(d,function(a){h.length=0,angular.forEach(a.collection,function(a){h.push(new f(a))})})},o=function(d){i.length=0;var e=function(a){i.length=0,angular.forEach(a.collection,function(a){i.push(new g(a))}),b.dispatch("statistics.virtualDatacenter.retrieved")},f={type:"application/vnd.abiquo.virtualdatacentersresources+json",path:"statistics/vdcsresources",queryParam:{identerprise:d.id}};c.isEmptyObject(d)||a.get(f,e)},p=function(b){var d={type:"application/vnd.abiquo.enterpriseresources+json",path:"statistics/enterpriseresources/"+b.id};c.isEmptyObject(b)||a.get(d,function(a){a.publicIPsUsed||(a.publicIPsUsed=0),j=a,m("dashboard",a)})},q=function(){c.isEmptyObject(j)||m("dashboard",j)},r=function(b){var c={type:"application/vnd.abiquo.cloudusage+json",path:"statistics/cloudusage/"+b.id};a.get(c,function(a){angular.copy(a,k),m("datacenter",a)})},s=function(){var b={type:"application/vnd.abiquo.cloudusage+json",path:"statistics/cloudusage/actions/total"};a.get(b,function(a){angular.copy(a,k),m("datacenter",a)})};return angular.extend(e,{virtualAppliances:h,virtualDatacenters:i,cloudResources:k,setVDCResources:l,getVirtualAppliances:n,getVirtualDatacenters:o,getEnterpriseResources:p,refreshEnterpriseResources:q,getCloudResourcesByDatacenter:r,getAllCloudResources:s}),e}]),angular.module("stepByStepMgr",[]).factory("stepByStepMgr",["utils","$filter",function(a,b){function c(){m.setOptions({showStepNumbers:!1,showBullets:!1,exitOnOverlayClick:!0,exitOnEsc:!0,nextLabel:"<strong>Next</strong>",prevLabel:"<strong>Previous</strong>",skipLabel:"Exit",doneLabel:"Thanks",keyboardNavigation:!0})}function d(c,d){var e="config/tutorials/"+c.name+"/"+d+".json";$.getJSON(e,function(a){o(a.steps,"intro"),angular.extend(k,a.steps),m.setOptions({steps:a.steps}),m.start()}).fail(function(){a.toastrError(b("translate")("tutorials.loading.error"))})}function e(a,c){var d="config/tutorials/"+a.name+"/tutorials.json";$.getJSON(d,function(a){a.translationCodes&&(a.translationCodes.popupTitle&&(a.popupTitle=b("translate")(a.translationCodes.popupTitle)),a.translationCodes.welcomeText&&(a.welcomeText=b("translate")(a.translationCodes.welcomeText))),o(a.tutorials,"name"),angular.extend(l,a),c()}).fail(function(){console.log("Tutorials file not loaded!"),c()})}function f(){m.refreshSteps(),m.refreshCurrentElement(!0)}function g(){return m._options.isRunning}function h(a){n=a}function i(){return n}var j={},k=[],l={},m=introJs(),n=!1,o=function(a,c){angular.forEach(a,function(a){a.translationCode&&(a[c]=b("translate")(a.translationCode))})};return angular.extend(j,{tutorials:l,tutorialContainer:m,setTutorialOptions:c,loadTutorials:e,loadTutorial:d,refreshSteps:f,tutorialIsRunning:g,setPopUpIsOpened:h,isPopUpOpened:i}),j}]),angular.module("storageDevicesMgr",["server"]).factory("storageDevicesMgr",["server","$filter","dispatcher","utils",function(a,b,c,d){function e(a){angular.copy(a,o)}function f(){if(!d.isEmptyObject(o)){var a=b("getElementById")(m,o.id);e(a)}}function g(b,c){var d=function(a){p.length=0,angular.forEach(a.collection,function(a){p.push(new r(a))}),void 0!=c&&c(a)},e={path:"admin/datacenters/"+b.id+"/storage/devices/action/supported",type:"application/vnd.abiquo.storagedevicesmetadata+json"};a.get(e,d)}function h(b,c){var d=function(a){m.length=0,angular.forEach(a.collection,function(a){m.push(new q(a))}),f(),void 0!=c&&c(a)},e={links:b.links,rel:"devices"};a.getByRel(e,d)}function i(e,f,g){var h=function(a){c.dispatch("storageDevices.created",{data:new q(a)}),void 0!=g&&g(a),d.toastrSuccess(b("translate")("action.create.success.storagedevice.text",{storageDevice:f.name}))},i={type:"application/vnd.abiquo.storagedevice+json",path:"admin/datacenters/"+e.id+"/storage/devices"},j=a.createLinkByRel(e.links,"edit","datacenter");f.links.push(j),a.post(i,f,h)}function j(e,f){var g=function(a){c.dispatch("storageDevices.edited",{data:a}),void 0!=f&&f(a),d.toastrSuccess(b("translate")("action.edit.success.storagedevice.text",{storageDevice:e.name}))},h={links:e.links,rel:"edit"};a.putByRel(h,e,g)}function k(e,f){var g=function(a){c.dispatch("storageDevices.deleted",{data:a}),void 0!=f&&f(a),d.toastrSuccess(b("translate")("action.delete.success.storagedevice.text",{storageDevice:e.name}))},h={links:e.links,rel:"edit"};a.removeByRel(h,g)}var l={},m=[],n={},o={},p=[],q=function(a){var b=a;return b.clientData={storagePools:[],open:!1},b},r=function(a){var b=a;return b};return angular.extend(l,{storageTechnologies:p,storageDevices:m,currentDatacenter:n,currentStorageDevice:o,getStorageTechnologies:g,getStorageDevices:h,addStorageDevice:i,editStorageDevice:j,setCurrentStorageDevice:e,deleteStorageDevice:k}),l}]),angular.module("storagePoolsMgr",["server"]).factory("storagePoolsMgr",["server","$filter","utils","dispatcher",function(a,b,c,d){function e(a){angular.copy(a,p)}function f(d,e,f){n.length=0;var g=function(a){angular.forEach(a.collection,function(a){var f=b("getElementByParameter")(d.clientData.storagePools,{element:a.name,attribute:"name"});a=new q(a),a.clientData.storageDevice=d,c.isEmptyObject(f)?a.clientData.tierId=b("enabled")(e)[0].id:(a.clientData.selected=!0,a.clientData.used=!0,a.clientData.tierId=f.clientData.tier.id),n.push(a)}),void 0!=f&&f()},h={links:d.links,rel:"pools",queryParam:{sync:!0}};a.getByRel(h,g)}function g(b,c){e(null);var d=function(a){m.length=0,angular.forEach(a.collection,function(a){m.push(new q(a)),a.clientData.storageDevice=b,b.clientData.storagePools=angular.copy(m)}),void 0!=c&&c()},f={links:b.links,rel:"pools"};a.getByRel(f,d)}function h(b,c){e(null);var d=function(d){m.length=0,angular.forEach(d.collection,function(c){g={links:c.links,rel:"device"},a.getByRel(g,function(a){m.push(new q(c)),c.clientData.storageDevice=a,b.clientData.storagePools=angular.copy(m)})}),void 0!=c&&c()},f=a.getClientdataFromLinksByRel(b.links,"datacenter"),g={path:"admin/datacenters/"+f.id+"/storage/tiers/"+b.id+"/pools",type:"application/vnd.abiquo.storagepools+json"};a.get(g,d)}function i(e,f,g){var h=function(a){d.dispatch("storagePools.created",{data:a}),void 0!=g&&g(),c.toastrSuccess(b("translate")("action.create.success.storagepool.text"))},i={links:e.links,rel:"pools"};a.postByRel(i,f,h)}function j(e,f){var g=function(a){d.dispatch("storagePools.edited",{data:a}),void 0!=f&&f(a),c.toastrSuccess(b("translate")("action.edit.success.storagepool.text",{storagePool:e.name}))},h={links:e.links,rel:"edit"},i=a.getLinkByRel(e.links,"tier"),j=a.getLinkByRel(e.clientData.tier.links,"edit");i.href=j.href,a.putByRel(h,e,g)}function k(e,f){var g=function(a){d.dispatch("storagePools.deleted",{data:a}),void 0!=f&&f(a),c.toastrSuccess(b("translate")("action.delete.success.storagepool.text",{storagePool:e.name}))},h={links:e.links,rel:"edit"};a.removeByRel(h,g)}var l={},m=[],n=[],o={},p={},q=function(b){var c=b;return c.clientData={tier:a.getClientdataFromLinksByRel(b.links,"tier"),selected:!1},c};return angular.extend(l,{storagePools:m,availableStoragePools:n,currentDatacenter:o,currentStoragePool:p,getAvailableStoragePools:f,getStoragePools:g,getStoragePoolsByTier:h,addStoragePools:i,editStoragePool:j,setCurrentStoragePool:e,deleteStoragePool:k}),l}]),angular.module("systemPropertiesMgr",["server"]).factory("systemPropertiesMgr",["$filter","configMgr","server","dispatcher","utils",function(a,b,c,d,e){function f(a){angular.copy(a,r)}function g(a){var b=function(b){A(b,a)},d={type:"application/vnd.abiquo.systemproperties+json",path:"config/properties"};c.get(d,b)}function h(a){var b=parseInt(a.value);isNaN(b)||-1!=a.value.toString().indexOf(".")||B(a)||(a.value=b),a.clientData.isInfrastructureSystemProperty?x.infrastructure[a.name]=a:a.clientData.isNetworkSystemProperty?x.network[a.name]=a:a.clientData.isDashboardSystemProperty?x.dashboard[a.name]=a:a.clientData.isGeneralSystemProperty?x.general[a.name]=a:a.clientData.isWikiLinkSystemProperty?x.wikiLinks[a.name]=a:a.clientData.isCustomSystemProperty?x.custom[a.name]=a:a.clientData.isPasswordSystemProperty?x.password[a.name]=a:x.general[a.name]=a}function i(b,d){var f=function(b){A(b,d),e.toastrSuccess(a("translate")("action.edit.success.systemproperties.text"))},g={path:"config/properties",type:"application/vnd.abiquo.systemproperties+json"};c.put(g,b,f)}function j(){var a="";if(x.general["client.logout.url"]&&x.general["client.logout.url"].value)a=x.general["client.logout.url"].value;else if(b.config["client.backto.url"])a=b.config["client.backto.url"];else if(-1!=x.custom["client.custom.currentUrl"].value.search("resetPasswordToken")){var c=x.custom["client.custom.currentUrl"].value.split("resetPasswordToken"),d=c[1].split("#");a=c[0]+d[1]}return a}function k(){var a={path:"config/licenses",type:"application/vnd.abiquo.licenses+json"};c.get(a,function(a){s.length=0,t=0,angular.forEach(a.collection,function(a){var b=new z(a);s.push(b)})})}function l(b,f){var g=function(b){d.dispatch("licenses.created",{data:b}),void 0!=f&&f(b),e.toastrSuccess(a("translate")("action.create.success.license.text"))},h={path:"config/licenses",type:"application/vnd.abiquo.license+json"};c.post(h,b,g)}function m(b,f){var g=function(b){d.dispatch("licenses.deleted"),void 0!=f&&f(b),e.toastrSuccess(a("translate")("action.delete.success.license.text"))},h={links:b.links,rel:"edit"};c.removeByRel(h,g)}function n(b,f,g){var h=function(b){void 0!=g&&g(b),"true"==b?(d.dispatch("license.requested"),e.toastrSuccess(a("translate")("action.request.success.license.text"))):e.toastrError(a("translate")("action.request.error.license.text",{error:b}))},i={path:b,type:"*/*",absolutPath:!0};c.post(i,f,h)}function o(){var a=e.getArrayConversionToFloats(x.infrastructure["client.storage.volumeMaxSizeValues"].value.split(","));return a}var p={},q=[],r={},s=[],t=0,u=["client.main.disableChangePassword","client.main.allowLogout","client.main.showHardDisk","client.main.showSoftInfo","client.main.showHardInfo","client.main.workflowEnabled","client.main.enableFirewallForPrivateVDC","client.main.enableLoadBalancerForPrivateVD","client.virtual.allowVMRemoteAccess","client.dashboard.allowUsersAccess","client.wiki.showHelp","client.wiki.showDefaultHelp","client.main.passwordComplexity","client.main.passwordRecover","client.main.enableTutorials","client.main.defaultView","client.storage.volumeMaxSizeValues"],v=function(){var a={infrastructure:{},network:{},dashboard:{},general:{},wikiLinks:{},custom:{},password:{}};return a},w=!0,x=new v,y=function(a){var b=a;return b.clientData={isInfrastructureSystemProperty:-1!=b.name.indexOf("client.infra")||-1!=b.name.indexOf("client.applibrary")||-1!=b.name.indexOf("client.storage")||-1!=b.name.indexOf("client.metering.metering")||-1!=b.name.indexOf("client.network.numberIp")||-1!=b.name.indexOf("client.virtual")||-1!=b.name.indexOf("client.main.maxRequestedIps"),isNetworkSystemProperty:-1!=b.name.indexOf("client.network"),isDashboardSystemProperty:-1!=b.name.indexOf("client.dashboard")||-1!=b.name.indexOf("client.metering"),isGeneralSystemProperty:-1!=b.name.indexOf("client.main")&&-1==b.name.indexOf("client.main.password")||-1!=b.name.indexOf("client.logout")||-1!=b.name.indexOf("client.theme")||-1!=b.name.indexOf("client.user"),isWikiLinkSystemProperty:-1!=b.name.indexOf("client.wiki"),isCustomSystemProperty:-1!=b.name.indexOf("client.custom"),isPasswordSystemProperty:-1!=b.name.indexOf("client.main.password")
},b},z=function(a){var b=a;return b.clientData={},b},A=function(a,b){var c=angular.copy(x.custom);angular.extend(x,new v),angular.forEach(a.collection,function(a){var b=new y(a);h(b)}),angular.extend(x.custom,c),b&&b()},B=function(a){var b=!1;return angular.forEach(u,function(c){a.name==c&&(b=!0)}),b};return angular.extend(p,{SystemProperties:v,SystemProperty:y,systemProperties:x,currentSystemPropertiesGroup:q,currentLicense:r,licenses:s,showMenu:w,setCurrentLicense:f,addSystemProperty:h,editSystemProperties:i,getSystemProperties:g,getLogoutUrl:j,getLicenses:k,addLicense:l,deleteLicense:m,requestLicense:n,getVolumeMaxSizes:o}),p}]),angular.module("themeMgr",[]).factory("themeMgr",function(){var a={};return a.loadTheme=function(a){a||(console.log("No theme is defined."),a="abicloudDefault");var b=$("<link rel='stylesheet' type='text/css' href='theme/"+a+"/css/app.min.css'>");$("head").append(b)},a}),angular.module("tiersMgr",["server"]).factory("tiersMgr",["$filter","server","dispatcher","utils",function(a,b,c,d){function e(a){angular.copy(a,n)}function f(a,c){var d=function(a){m.length=0,angular.forEach(a.collection,function(a){m.push(new o(a))}),void 0!=c&&c(a)},e={type:"application/vnd.abiquo.tiers+json",path:"cloud/virtualdatacenters/"+a.id+"/tiers"};b.get(e,d)}function g(a,c){var d=function(a){m.length=0,angular.forEach(a.collection,function(a){var b=new o(a);m.push(b),n&&n.id==b.id&&e(b)}),void 0!=c&&c(a)},f={type:"application/vnd.abiquo.tiers+json",path:"admin/datacenters/"+a.id+"/storage/tiers"};b.get(f,d)}function h(e,f){var g=function(b){c.dispatch("tiers.edited",{data:b}),void 0!==f&&f(),d.toastrSuccess(a("translate")("action.edit.success.tier.text",{tier:e.name}))},h={links:e.links,rel:"edit"};b.putByRel(h,e,g)}function i(a,c,d,e){var f=function(b){a.clientData.enterprises.length=0,angular.forEach(b.collection,function(b){a.clientData.enterprises.push(b)}),void 0!=e&&e(b)},g=b.getClientdataFromLinksByRel(a.links,"datacenter"),h={path:"admin/datacenters/"+g.id+"/storage/tiers/"+a.id+"/enterprises",type:"application/vnd.abiquo.enterprises+json",queryParam:{}};angular.extend(h.queryParam,c),angular.extend(h.queryParam,d),b.get(h,f)}function j(a,d){var e=function(a){c.dispatch("tierEnterprises.changed",{data:a}),void 0!==d&&d(a)},f={links:a.links,rel:"allowallenterprises"};b.putByRel(f,a,e)}function k(a,d){var e=function(a){c.dispatch("tierEnterprises.changed",{data:a}),void 0!==d&&d(a)},f={links:a.links,rel:"restrictallenterprises"};b.putByRel(f,a,e,e)}var l={},m=[],n={},o=function(a){var b=a;return b.clientData={storagePools:[],open:!1,isAllowed:!1,enterprises:[],classType:"tier"},b};return angular.extend(l,{tiers:m,currentTier:n,getTiersByVirtualDatacenter:f,getTiersByDatacenter:g,setCurrentTier:e,editTier:h,getTierEnterprises:i,allowAllEnterprises:j,restrictAllEnterprises:k}),l}]),angular.module("urlParametersUtils",[]).factory("urlParametersUtils",["$location","systemPropertiesMgr","configMgr","$filter","$cookies",function(a,b,c,d,e){function f(){var b="";if(p=e.token,void 0!=p&&""!=p){var d=p.split("&");angular.forEach(d,function(a){var b=a.split("=");o[b[0]]=b[1]})}else{var f=c.UI_VERSION;o=a.search(),a.search("version",f)}return o.hasOwnProperty("auth")&&(b=o.auth),g(),b}function g(){}function h(){q={value:a.$$absUrl,name:"client.custom.currentUrl",clientData:{}},b.addSystemProperty(new b.SystemProperty(q));var c={name:"client.custom.defaultIndexView",value:m(),clientData:{}};b.addSystemProperty(new b.SystemProperty(c))}function i(){var a={};return angular.forEach(CONFIG["config.languages"],function(b){return b.isDefault===!0?void(a=b):void 0}),a.value}function j(){var a={};return o.hasOwnProperty("lang")&&(a=d("getElementByParameter")(CONFIG["config.languages"],{element:o.lang,attribute:"value"})),a.value||(a=i()),a}function k(){var a={};if(-1!=q.value.search("resetPasswordToken")){var b=q.value.split("resetPasswordToken"),c=b[1].split("#");a.resetPasswordToken=c[0].slice(1,c[0].length)}return a}function l(){var a="";return o.hasOwnProperty("oauth_token")&&(a=o.oauth_token),a}function m(){return o.hasOwnProperty("defaultIndexView")?(o.defaultIndexView=Number(o.defaultIndexView),o.defaultIndexView?o.defaultIndexView>6&&(o.defaultIndexView=0):o.defaultIndexView=0):o.defaultIndexView=0,o.defaultIndexView}var n={},o={},p="",q={};return angular.extend(n,{getToken:f,getUrlParameters:h,getDefaultLanguage:i,getLanguage:j,getAuthorization:l,getResetPassword:k}),n}]),angular.module("userMgr",[]).factory("userMgr",["server","$filter","dispatcher","authenticationMgr","systemPropertiesMgr","utils",function(a,b,c,d,e,f){function g(a){a.active=!0,angular.extend(m.user,new o(a))}function h(a){n.email=a.email,n.name=a.name,n.nick=a.nick,n.publicSshKey=a.publicSshKey,n.username=a.username,n.surname=a.surname,n.links=a.links,n.clientData.fullName=a.name+" "+a.surname}function i(g,h){var i=function(a){if(g.password)d.logout(e.getLogoutUrl());else{var i=new o(a);void 0!=h&&h(i),c.dispatch("user.edited",{data:i}),f.toastrSuccess(b("translate")("action.edit.success.user.text",{user:i.name}))}},j={rel:"edit",links:g.links,user:g.nick,password:g.clientData.currentPassword};""==g.publicSshKey&&delete g.publicSshKey,a.putByRel(j,g,i)}function j(b){var c={rel:"role",links:n.links};a.getByRel(c,function(a){n.clientData.role=a,b()})}function k(b){var c={rel:"privileges",links:n.clientData.role.links};return a.getByRel(c,function(a){n.clientData.privileges=a.collection,b()})}function l(b,c){var d=function(a){n.clientData.applications=a.collection,void 0!=c&&c(a)},e={rel:"applications",links:n.links};b&&(e.queryParam=b),a.getByRel(e,d)}var m={},n={},o=function(b){var c=b;return c.clientData={fullName:c.name+" "+c.surname,role:{},privileges:{},enterprise:a.getClientdataFromLinksByRel(c.links,"enterprise")},c};return angular.extend(m,{user:n,setUser:g,updateLoggedUser:h,editUser:i,getRole:j,getPrivileges:k,getApplications:l}),m}]),angular.module("usersMgr",[]).factory("usersMgr",["server","dispatcher","utils","$filter",function(a,b,c,d){function e(b,c,e,f){b||(m.length=0);var g=function(a){m.length=0,angular.forEach(a.collection,function(a){m.push(new o(a))}),angular.extend(m,d("orderBy")(m,["name","surname"],"false")),void 0!==f&&f(a)},h={path:"admin/enterprises/_/users",type:"application/vnd.abiquo.users+json",queryParam:{}};angular.extend(h.queryParam,c),angular.extend(h.queryParam,e),a.get(h,g)}function f(b,c,e,f,g){c||(m.length=0);var h=function(a){m.length=0,angular.forEach(a.collection,function(a){m.push(new o(a))}),angular.extend(m,d("orderBy")(m,["name","surname"],"false")),void 0!==g&&g(a)},i={rel:"users",links:b.links,queryParam:{}};angular.extend(i.queryParam,e),angular.extend(i.queryParam,f),a.getByRel(i,h)}function g(e,f,g,h){var i=function(a){void 0!==h&&h(),b.dispatch("user.created",{data:a}),c.toastrSuccess(d("translate")("action.create.success.user.text",{user:e.name}))},j=a.createLinkByRel(g.links,"edit","role"),k=a.createLinkByRel(f.links,"edit","enterprise");e.links=[],e.links.push(j),e.links.push(k);var l={type:"application/vnd.abiquo.user+json",path:"admin/enterprises/"+f.id+"/users/"},m=angular.copy(e);c.isEmptyObject(m.publicSshKey)&&delete m.publicSshKey,a.post(l,m,i)}function h(e,f,g){var h=function(a){void 0!==g&&g(a),b.dispatch("user.edited",{data:a}),c.toastrSuccess(d("translate")("action.edit.success.user.text",{user:e.name}))};if(!c.isEmptyObject(f)){a.removeLinkByRel(e.links,"role");var i=a.createLinkByRel(f.links,"edit","role");e.links.push(i)}""==e.publicSshKey&&delete e.publicSshKey;var j={links:e.links,rel:"edit"};e.clientData.currentPassword&&(j.user=e.nick,j.password=e.clientData.currentPassword),a.putByRel(j,e,h)}function i(e,f,g){var h=function(a){void 0!==g&&g(a),b.dispatch("user.edited",{data:a}),c.toastrSuccess(d("translate")("action.edit.success.user.enterprise.text",{user:e.name,enterprise:f.name}))},i=angular.copy(a.getLinkByRel(f.links,"edit"));i.rel="enterprise",a.removeLinkByRel(e.links,"enterprise"),e.links.push(i),""==e.publicSshKey&&delete e.publicSshKey;var j={links:e.links,rel:"edit"};a.putByRel(j,e,h)}function j(e,f){var g=function(a){void 0!==f&&f(),b.dispatch("user.deleted",{data:a}),c.toastrSuccess(d("translate")("action.delete.success.user.text",{user:e.name}))},h={links:e.links,rel:"edit"};a.removeByRel(h,g,void 0)}function k(b,c){var d=function(a){void 0!==c&&c()},e={path:"admin/enterprises/_/users/"+b.id,type:"application/vnd.abiquo.user+json"};a.put(e,b,d)}var l={},m=[],n={},o=function(b){var c=b;return c.clientData={role:a.getClientdataFromLinksByRel(c.links,"role"),enterprise:a.getClientdataFromLinksByRel(c.links,"enterprise"),repeatPassword:"",restrict:b.availableVirtualDatacenters&&b.availableVirtualDatacenters.length>0?!0:!1},c},p=function(a){angular.copy(a,n),b.dispatch("user.changed",{data:a})};return angular.extend(l,{users:m,currentUser:n,getAllUsers:e,getUsers:f,setCurrentUser:p,createUser:g,editUser:h,editUserEnterprise:i,deleteUser:j,impersonateUser:k}),l}]),angular.module("utils",[]).factory("safeApply",function(){return function(a,b){var c=a.$root.$$phase;"$apply"==c||"$digest"==c?b&&a.$eval(b):b?a.$apply(b):a.$apply()}}).factory("utils",["$timeout","$filter","uModals","loggerMgr",function(a,b,c,d){function e(a,b,c){return c=c||0==c?c:2,a=parseFloat(a),a=b?a/1048576:a,a=a>0&&1>a?1:a,a/U[2].conversion>=1?(a/U[2].conversion).toFixed(c)+" TB":a/U[1].conversion>=1?(a/U[1].conversion).toFixed(c)+" GB":a.toFixed(c)+" MB"}function f(a){var b={};return b=a/U[2].conversion>=1&&H(a/U[2].conversion)?{size:parseInt(a/U[2].conversion),units:2}:a/U[1].conversion>=1&&H(a/U[1].conversion)?{size:parseInt(a/U[1].conversion),units:1}:0==a?{size:a,units:1}:{size:a,units:0}}function g(a){var b={},c=I(a.ramHardLimitInMb,a.ramSoftLimitInMb);b.ramSoftLimit=parseInt(a.ramSoftLimitInMb/U[c.units].conversion),b.ramHardLimit=parseInt(a.ramHardLimitInMb/U[c.units].conversion),b.ramUnits=angular.copy(U[c.units]);var d=I(a.diskHardLimitInMb,a.diskSoftLimitInMb);b.hdSoftLimit=parseInt(a.diskSoftLimitInMb/U[d.units].conversion),b.hdHardLimit=parseInt(a.diskHardLimitInMb/U[d.units].conversion),b.hdUnits=angular.copy(U[d.units]);var d=I(a.storageHardInMb,a.storageSoftInMb);if(b.storageSoftLimit=parseInt(a.storageSoftInMb/U[d.units].conversion),b.storageHardLimit=parseInt(a.storageHardInMb/U[d.units].conversion),b.storageUnits=angular.copy(U[d.units]),a.hasOwnProperty("repositorySoftInMb")){var e=I(a.repositoryHardInMb,a.repositorySoftInMb);b.repositorySoftLimit=parseInt(a.repositorySoftInMb/U[e.units].conversion),b.repositoryHardLimit=parseInt(a.repositoryHardInMb/U[e.units].conversion),b.repositoryUnits=angular.copy(U[e.units])}return b}function h(a){for(var b=U[0],c=U.length-1;c>=0;c--){var d=U[c];if(a%d.conversion==0)return d}return b}function i(a){angular.forEach(a,function(b,c){delete a[c]})}function j(a){var b="boolean"!=typeof a&&(null===a||jQuery.isEmptyObject(a)||""===a||void 0===a);return b}function k(a,b){var c=new RegExp(a);c.test(b);return c.test(b)}function l(a){var b={},c=a.split("://");return b.protocol=c[0]+"://",c=c[1].split(":"),b.ip=c[0],c=c[1].split("/"),b.port=c[0],b.mapping=c[1],b}function m(a){return a&&(angular.isArray(a)?angular.forEach(a,function(a){delete a.clientData}):(a.hasOwnProperty("collection")&&angular.forEach(a.collection,function(a){delete a.clientData}),delete a.clientData)),a}function n(a){var b=angular.copy(a);return m(b)}function o(a,b){for(var c=!1,d=0;!c;)c=!0,angular.forEach(a,function(a){a[b]==d&&(c=!1,d++)});return d}function p(a){var b=[];return angular.forEach(a,function(a){a.clientData.selected&&b.push(a.id)}),b.toString()}function q(a,b){var c=void 0!==a?a.split(","):"";angular.forEach(c,function(a){angular.forEach(b,function(b){b.id==parseInt(a)&&(b.clientData.selected=!0)})})}function r(a,b){var c=[];return angular.forEach(a,function(a){a.type===b&&(c[a.idResource]=!0)}),c}function s(a){var b=[];return angular.forEach(a,function(a){b.push(parseInt(1024*parseFloat(a)))}),b}function t(a,b){var c=a,d={};if(b&&"string"==typeof b){var e=b.split(".");try{e.forEach(function(a){if(!c||!c.hasOwnProperty(a))throw d;c=c[a]})}catch(f){return null}}return c}function u(){a(function(){$(window).trigger("resize")},1)}function v(a,d){(void 0===a.disabled||a.disabled===!1)&&(a.scope=d,a.popupUrl=void 0===a.popupUrl?a.uPopup:a.popupUrl,a.acceptLabel=void 0===a.acceptLabel?b("translate")("globals.accept"):a.acceptLabel,a.cancelLabel=void 0===a.cancelLabel?b("translate")("globals.cancel"):a.cancelLabel,a.showAcceptBtn=void 0===a.showAcceptBtn?!0:"true"==a.showAcceptBtn||1==a.showAcceptBtn,a.showCancelBtn=void 0===a.showCancelBtn?!0:"true"==a.showCancelBtn||1==a.showCancelBtn,a.closeOnAccept=void 0===a.closeOnAccept?!1:"true"==a.closeOnAccept||1==a.closeOnAccept,a.closeOnCancel=void 0===a.closeOnCancel?!0:"true"==a.closeOnCancel||1==a.closeOnCancel,a.backdrop=void 0===a.backdrop?"static":a.backdrop,c.showPopUp(a))}function w(a){d.addSuccess(!0,a)}function x(a){d.addWarning(!0,a)}function y(a){d.addError(!0,a)}function z(a,c){var d="",e="",f="",g="",h=5,i="",j=b("translate")("datacenter.stats.label.available");switch(c){case"vcpu":d=b("translate")("dashboard.enterpriseresources.graph.virtualcpus"),j=b("translate")("datacenter.stats.label.limit"),e=a.virtualCpuReserved,f=a.virtualCpuUsed,i="0",h=W(a.virtualCpuReserved,a.virtualCpuUsed,0);break;case"datacentervcpu":d=b("translate")("dashboard.enterpriseresources.graph.virtualcpus"),e=a.virtualCpuTotal-a.virtualCpuUsed>0?a.virtualCpuTotal-a.virtualCpuUsed:0,f=a.virtualCpuUsed,g=a.virtualCpuReserved,i="0",h=W(a.virtualCpuUsed,a.virtualCpuReserved,a.virtualCpuTotal);break;case"storage":d=b("translate")("dashboard.enterpriseresources.graph.localstorage"),j=b("translate")("datacenter.stats.label.limit"),e=parseFloat(b("BtoGB")(a.localStorageReserved)),f=parseFloat(b("BtoGB")(a.localStorageUsed));break;case"datacenterstorage":d=b("translate")("dashboard.enterpriseresources.graph.localstorage"),e=a.virtualStorageTotal-a.virtualStorageUsed>0?parseFloat(b("BtoGB")(a.virtualStorageTotal-a.virtualStorageUsed)):0,f=parseFloat(b("BtoGB")(a.virtualStorageUsed)),g=parseFloat(b("BtoGB")(a.virtualStorageReserved));break;case"memory":d=b("translate")("dashboard.enterpriseresources.graph.memory"),j=b("translate")("datacenter.stats.label.limit"),e=parseFloat(b("MBtoGB")(a.memoryReserved)),f=parseFloat(b("MBtoGB")(a.memoryUsed));break;case"datacentermemory":d=b("translate")("dashboard.enterpriseresources.graph.memory"),e=a.virtualMemoryTotal-a.virtualMemoryUsed>0?parseFloat(b("MBtoGB")(a.virtualMemoryTotal-a.virtualMemoryUsed)):0,f=parseFloat(b("MBtoGB")(a.virtualMemoryUsed)),g=parseFloat(b("MBtoGB")(a.virtualMemoryReserved));break;case"extstorage":d=b("translate")("dashboard.enterpriseresources.graph.extstorage"),j=b("translate")("datacenter.stats.label.limit"),e=parseFloat(b("MBtoGB")(a.extStorageReserved)),f=parseFloat(b("MBtoGB")(a.extStorageUsed));break;case"vlan":d=b("translate")("dashboard.enterpriseresources.graph.vlans"),j=b("translate")("datacenter.stats.label.limit"),e=a.vlanReserved,f=a.vlanUsed,i="0",h=W(a.vlanReserved,a.vlanUsed,0);break;case"publicip":d=b("translate")("dashboard.enterpriseresources.graph.publicips"),j=b("translate")("datacenter.stats.label.limit"),e=a.publicIPsReserved,f=a.publicIPsUsed,i="0",h=W(a.publicIPsReserved,a.publicIPsUsed,a.publicIPsLimit?a.publicIPsLimit:0);break;case"datacenterpublicip":d=b("translate")("dashboard.enterpriseresources.graph.publicips"),e=a.publicIPsReserved,f=a.publicIPsUsed,i="0",h=W(a.publicIPsReserved,a.publicIPsUsed,a.publicIPsTotal);break;case"repository":d=b("translate")("dashboard.enterpriseresources.graph.repository"),j=b("translate")("datacenter.stats.label.limit"),e=parseFloat(b("BtoGB")(a.repositoryReserved)),f=parseFloat(b("BtoGB")(a.repositoryUsed));break;case"datacenterrepository":d=b("translate")("dashboard.enterpriseresources.graph.repository"),e=a.repositoryTotal-a.repositoryUsed>0?parseFloat(b("BtoGB")(a.repositoryTotal-a.repositoryUsed)):0,f=parseFloat(b("BtoGB")(a.repositoryUsed)),g=parseFloat(b("BtoGB")(a.repositoryReserved));break;case"server":d=b("translate")("datacenter.stats.servers"),e=a.serversRunning,f=a.serversTotal-a.serversRunning;break;case"virtualmachine":d=b("translate")("datacenter.stats.virtualmachines"),e=a.virtualMachinesRunning,f=a.virtualMachinesTotal-a.virtualMachinesRunning;break;case"datacenterextstorage":d=b("translate")("dashboard.enterpriseresources.graph.extstorage"),e=a.storageTotal-a.storageUsed>0?parseFloat(b("MBtoGB")(a.storageTotal-a.storageUsed)):0,f=parseFloat(b("MBtoGB")(a.storageUsed)),g=parseFloat(b("MBtoGB")(a.storageReserved))}var k=[["Metric",d,{role:"style"}]];e&&e>0&&k.push([j,e,T[2]]),k.push([b("translate")("datacenter.stats.label.used"),f,T[1]]),"publicip"==c?(k=[["Metric",d,{role:"style"}]],a.publicIPsLimit&&a.publicIPsLimit>0&&k.push([j,a.publicIPsLimit,T[2]]),k.push([b("translate")("datacenter.stats.label.used"),f,T[1]]),k.push([b("translate")("datacenter.stats.label.reserved"),e,T[0]])):"datacenterpublicip"==c?k=[["Metric",d,{role:"style"}],[b("translate")("datacenter.stats.label.total"),a.publicIPsTotal,T[2]],[b("translate")("datacenter.stats.label.used"),f,T[1]],[b("translate")("datacenter.stats.label.reserved"),e,T[0]]]:parseInt(g)>0&&(k=[["Metric",d,{role:"style"}]],e>0&&k.push([b("translate")("datacenter.stats.label.available"),e,T[2]]),k.push([b("translate")("datacenter.stats.label.used"),f,T[1]]),k.push([b("translate")("datacenter.stats.label.limit"),g,T[0]]));try{if("server"==c||"virtualmachine"==c){var l=google.visualization.arrayToDataTable([["Metric",d],[b("translate")("datacenter.stats.label.running"),e],[b("translate")("datacenter.stats.label.stopped"),f]]),m={legend:"none",pieSliceText:"value",title:d,slices:{0:{color:"#75993E"},1:{color:"#bd362f"}}};A(c,l,m)}else{var l=google.visualization.arrayToDataTable(k),n=new google.visualization.DataView(l);n.setColumns([0,1,{calc:"stringify",sourceColumn:1,type:"string",role:"annotation"},2]);var m={title:d,legend:"none",vAxis:{minValue:0,viewWindow:{min:0},gridlines:{count:h}}};""!=i&&(m.vAxis.format=i),B(c,n,m)}}catch(o){console.log("Google maps library ot available")}}function A(a,b,c){var d=document.getElementById("chart_"+a);if(d){var e=new google.visualization.PieChart(d);e.draw(b,c)}else console.log("Warning: Cannot draw pie chart in resource chart_"+a)}function B(b,c,d){var e=document.getElementById("chart_"+b);if(e){var f=new google.visualization.ColumnChart(e);a(function(){f.draw(c,d)},10)}else console.log("Warning: Cannot draw column chart in resource chart_"+b)}function C(a){var b="";return ipaddr.IPv4.isValid(a)?b=D(a):ipaddr.IPv6.isValid(a)?b=E(a):console.log("Utils.getNextIP() for ip ",a," is not valid format."),b}function D(a){for(var b=ipaddr.parse(a),c=b.octets.length-1;c>=0;c--){if(b.octets[c]=b.octets[c]+1,ipaddr.IPv4.isValid(b.toString())){var d=b.toString();return d}b.octets[c]=0}return console.log("Utils.getNextIPv4(): There is no next ip for ",a),""}function E(a){for(var b=ipaddr.parse(a),c=b.parts.length-1;c>=0;c--){if(b.parts[c]=b.parts[c]+1,ipaddr.IPv6.isValid(b.toString())){var d=b.toString();return d}b.parts[c]=0}return console.log("Utils.getNextIPv6(): There is no next ip for ",a),""}function F(a){var b=[];for(var c in a){var d=angular.copy(a[c]);"object"==typeof d&&(d.__property=c),b.push(d)}return b}function G(a,b){var c=!1;return a&&b&&(c=(" "+a.className+" ").indexOf(" "+b+" ")>-1),c}function H(a){return a%1===0}function I(a,b){var c=f(a),d=f(b);return c.units>d.units?d:c}function J(a){var b;if(a)if("string"==typeof a){a=a.replace(/ /g,"T"),a=a.replace(/\//g,"-");var c=a.split("-"),d=c[2].split("T"),e=d[1].split(":"),f=K(a),g=e[2].split(".");b=new Date(parseInt(c[0]),parseInt(c[1])-1,parseInt(d[0]),parseInt(e[0])+f,parseInt(e[1]),parseInt(g[0]))}else"number"==typeof a&&(b=new Date(a));return b}function K(a){var b=0;if(a){var c=a.split("+");if(c&&c.length>1)b=parseInt(c[c.length-1])/100;else{var c=a.split("-");c&&c.length>3&&(b=parseInt(c[c.length-1])/-100)}var d=(new Date).getTimezoneOffset()/-60;b=d-b}return b}function L(a){var b=J(a),c=M(b);return c}function M(a){var b="";return a&&(b=N(a)+" "+O(a)),b}function N(a){var b="";return a&&(b=a.toLocaleDateString()),b}function O(a){var b="";return a&&(b=a.toLocaleTimeString()),b}function P(a,b){var c={name:b,id:0,value:0};a.length>=0&&!angular.equals(c,a[0])&&a.unshift(c)}function Q(a){var c=b("translate")(a),d=c!=a;return d}var R={},S={currencyExPattern:/^[0-9.]*$/,ip:/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$|^(?:(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){6})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:::(?:(?:(?:[0-9a-fA-F]{1,4})):){5})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:(?:[0-9a-fA-F]{1,4})):){4})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,1}(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:(?:[0-9a-fA-F]{1,4})):){3})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,2}(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:(?:[0-9a-fA-F]{1,4})):){2})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,3}(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:[0-9a-fA-F]{1,4})):)(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,4}(?:(?:[0-9a-fA-F]{1,4})))?::)(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,5}(?:(?:[0-9a-fA-F]{1,4})))?::)(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,6}(?:(?:[0-9a-fA-F]{1,4})))?::))))$/,ipNoHostnames:/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(?:(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){6})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:::(?:(?:(?:[0-9a-fA-F]{1,4})):){5})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:(?:[0-9a-fA-F]{1,4})):){4})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,1}(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:(?:[0-9a-fA-F]{1,4})):){3})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,2}(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:(?:[0-9a-fA-F]{1,4})):){2})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,3}(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:[0-9a-fA-F]{1,4})):)(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,4}(?:(?:[0-9a-fA-F]{1,4})))?::)(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,5}(?:(?:[0-9a-fA-F]{1,4})))?::)(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,6}(?:(?:[0-9a-fA-F]{1,4})))?::))))$/},T=["#444444","#bd362f ","#75993E"],U=[{label:"MB",conversion:1},{label:"GB",conversion:1024},{label:"TB",conversion:1048576}],V=[{label:"UTC -12:00",value:"-1200"},{label:"UTC -11:00",value:"-1100"},{label:"UTC -10:00",value:"-1000"},{label:"UTC -09:30",value:"-0930"},{label:"UTC -09:00",value:"-0900"},{label:"UTC -08:00",value:"-0800"},{label:"UTC -07:00",value:"-0700"},{label:"UTC -06:00",value:"-0600"},{label:"UTC -05:00",value:"-0500"},{label:"UTC -04:30",value:"-0430"},{label:"UTC -04:00",value:"-0400"},{label:"UTC -03:30",value:"-0330"},{label:"UTC -03:00",value:"-0300"},{label:"UTC -02:30",value:"-0230"},{label:"UTC -02:00",value:"-0200"},{label:"UTC -01:00",value:"-0100"},{label:"UTC +00:00",value:"+0000"},{label:"UTC +01:00",value:"+0100"},{label:"UTC +02:00",value:"+0200"},{label:"UTC +03:00",value:"+0300"},{label:"UTC +03:30",value:"+0330"},{label:"UTC +04:00",value:"+0400"},{label:"UTC +04:30",value:"+0430"},{label:"UTC +05:00",value:"+0500"},{label:"UTC +05:30",value:"+0530"},{label:"UTC +05:45",value:"+0545"},{label:"UTC +06:00",value:"+0600"},{label:"UTC +06:30",value:"+0630"},{label:"UTC +07:00",value:"+0700"},{label:"UTC +08:00",value:"+0800"},{label:"UTC +08:45",value:"+0845"},{label:"UTC +09:00",value:"+0900"},{label:"UTC +09:30",value:"+0930"},{label:"UTC +10:00",value:"+1000"},{label:"UTC +10:30",value:"+1030"},{label:"UTC +11:00",value:"+1100"},{label:"UTC +11:30",value:"+1130"},{label:"UTC +12:00",value:"+1200"},{label:"UTC +12:45",value:"+1245"},{label:"UTC +13:00",value:"+1300"},{label:"UTC +14:00",value:"+1400"}],W=function(a,b,c){var d=Math.max(a,b,c);return 5>d?2:5};return angular.extend(R,{regExPattern:S,unitsSelector:U,timeUTCs:V,validateRegEx:k,emptyObject:i,returnSizeUnit:e,isEmptyObject:j,splitUri:l,getCopyCleanObjectFromClientData:n,formatAllocationElements:g,formatSizeInMb:f,getUnitSelectorForMB:h,returnSequence:o,getIdsStringFromArray:p,setArrayFromIdsStringAndArray:q,getIdResourceArrayByType:r,getObjectAttributeValue:t,getArrayConversionToFloats:s,refreshLayout:u,showPopUp:v,toastrSuccess:w,toastrWarning:x,toastrError:y,drawColumnsGraph:z,getNextIP:C,objectToArray:F,hasTranslate:Q,elementHasClass:G,timestampToDate:J,timestampToDateString:L,dateToString:M,dateToDateString:N,dateToTimeString:O,addFirstItem:P}),R}]),angular.module("virtualAppliancesMgr",["server"]).factory("virtualAppliancesMgr",["server","$filter","uModals","$rootScope","virtualMachinesMgr","authenticationMgr","configMgr","dispatcher","utils",function(a,b,c,d,e,f,g,h,i){function j(a,b){var c={};B&&B.clientData&&angular.extend(c,B.clientData.virtualDatacenter),angular.copy(a,B),a&&a.clientData&&a.clientData.virtualDatacenter.id==c.id&&angular.extend(B.clientData.virtualDatacenter,c),h.dispatch("currentVirtualAppliance.change",{data:B,refresh:b})}function k(b,c,d,e,f){c||(A.length=0);var g=[],h=function(a){angular.forEach(a.collection,function(a){var b=new D(a);b.id===B.id&&j(b,c),g.push(b)}),angular.copy(g,A),void 0!==f&&f(a)},i={rel:"virtualappliances",links:b.links,queryParam:{expand:"last_task"}};angular.extend(i.queryParam,d),angular.extend(i.queryParam,e),a.getByRel(i,h)}function l(b,c,d,e,f){c||(A.length=0);var g=function(a){var b=[];angular.forEach(a.collection,function(a){var d=new D(a);d.id===B.id&&j(d,c),b.push(d)}),angular.copy(b,A),void 0!==f&&f(a)},h={rel:"virtualappliances",links:b.links,queryParam:{expand:"last_task"}};angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.getByRel(h,g)}function m(b,c,d){var e=0,f=0,g=function(b){A.length=0,angular.forEach(b.collection,function(b){var d=a.getClientdataFromLinksByRel(b.links,"location","datacenters");!i.isEmptyObject(d)&&d.id&&d.id==c.id&&(j={links:b.links,rel:"action"},f++,a.getByRel(j,h))})},h=function(b){e++,angular.forEach(b.collection,function(c){var g={links:c.links,rel:"virtualdatacenter"};a.getByRel(g,function(a){var g=new D(c);g.clientData.virtualDatacenter=a,A.push(g),e==f&&void 0!==d&&d(b)})})},j={path:"admin/enterprises/"+b.id+"/limits",type:"application/vnd.abiquo.limits+json"};a.get(j,g)}function n(b){var c=function(a){angular.extend(B,a),E(),void 0!==b&&b(B)},d={rel:"edit",links:B.links,queryParam:{expand:"last_task"}};a.getByRel(d,c)}function o(c,d){var e=function(a){void 0!==d&&d(),h.dispatch("virtualAppliance.deleted",{data:a}),i.toastrSuccess(b("translate")("action.delete.success.virtualappliance.text",{vapp:c.name}))},f={type:"application/vnd.abiquo.virtualappliance+json",path:"cloud/virtualdatacenters/"+c.clientData.virtualDatacenter.id+"/virtualappliances/"+c.id};a.remove(f,e)}function p(c,d,e){var f=function(a){if(c.clientData.automaticallyOpenVappView){var f=new D(a);f.clientData.virtualDatacenter=d,j(f),h.dispatch("virtualAppliance.automaticOpenVapp",{data:a})}void 0!==e&&e(a),h.dispatch("virtualAppliance.created",{data:a}),i.toastrSuccess(b("translate")("action.create.success.virtualappliance.text",{vapp:c.name}))},g={type:"application/vnd.abiquo.virtualappliance+json",path:"cloud/virtualdatacenters/"+d.id+"/virtualappliances"};a.post(g,c,f)}function q(c,d){var e=function(a){void 0!==d&&d(),h.dispatch("virtualAppliance.edited",{data:a}),i.toastrSuccess(b("translate")("action.edit.success.virtualappliance.text",{vapp:c.name}))},f={links:c.links,rel:"edit"};a.putByRel(f,c,e)}function r(c,d){g.setSynchronizeVapp(!1),C=c.state,B.clientData.originalState=B.state,B.state="LOCKED",h.dispatch("virtualappliance.deploy.inprogress",{action:"DEPLOY"});var e=function(a){E(),void 0!==d&&d(),i.toastrSuccess(b("translate")("virtualappliance.deploy.inprogress",{name:c.name}))},f=function(){B.state=C,void 0!==d&&d()},j={rel:"deploy",links:c.links,type:"application/vnd.abiquo.acceptedrequest+json",contentType:"application/vnd.abiquo.virtualmachinetask+json"},k={};a.postByRel(j,k,e,f)}function s(a,e,f){if(g.setSynchronizeVapp(!1),C=B.state,!e){var h=!1;if(angular.forEach(a.clientData.virtualMachines,function(a){"CAPTURED"==a.type&&(h=!0)}),h)return void F(a,f)}c.showAlert({scope:d,message:b("translate")("virtualappliance.undeploy.confirm.message",{vapp:a.name}),title:b("translate")("virtualappliance.undeploy.confirm.title"),confirmLabel:b("translate")("globals.confirm"),cancelLabel:b("translate")("globals.cancel"),showConfirmBtn:!0,showCancelBtn:!0,confirmFn:function(){H(a,e,f)}})}function t(c,d,e,f){var g=function(){void 0!==f&&f(),h.dispatch("virtualAppliance.moved"),i.toastrSuccess(b("translate")("virtualappliance.moved.message",{vapp:c.name,vdcSrc:e.name,vdcTar:d.name}))},j={path:"cloud/virtualdatacenters/"+d.id+"/virtualappliances",type:"application/vnd.abiquo.virtualappliance+json",contentType:"application/vnd.mv-virtualappliance+json"},k={links:[{href:a.getUrl("cloud/virtualdatacenters/"+e.id+"/virtualappliances/"+c.id),rel:"source"}]};a.post(j,k,g)}function u(c,d,e,f){var g=function(){void 0!==f&&f(),h.dispatch("virtualAppliance.copied"),i.toastrSuccess(b("translate")("virtualappliance.copied.message",{vapp:c.name,vdcSrc:e.name,vdcTar:d.name}))},j={path:"cloud/virtualdatacenters/"+d.id+"/virtualappliances",type:"application/vnd.abiquo.virtualappliance+json",contentType:"application/vnd.cp-virtualappliance+json"},k={links:[{href:a.getUrl("cloud/virtualdatacenters/"+e.id+"/virtualappliances/"+c.id),rel:"original"}]};a.post(j,k,g)}function v(c,d){var f=e.virtualMachines.length;angular.forEach(e.virtualMachines,function(e,g){var h={
links:e.links,rel:"tasks"},j=function(a){f===g+1&&(void 0!==d&&d(),i.toastrSuccess(b("translate")("virtualappliance.update.inprogress",{name:c.name})))};a.getByRel(h,j)})}function w(a,b){a.entityName=b.entityName,a.entityType=b.entityType,a.hardLimit=b.hardLimit,"VIRTUALDATACENTER"==b.entityType&&(a.cpu.actual=b.cpu.actual,a.cpu.hard=b.cpu.hard,a.cpu.soft=b.cpu.soft,a.cpu.required+=b.cpu.required,a.cpu.status=b.cpu.status,a.hd.actual=b.hd.actual,a.hd.hard=b.hd.hard,a.hd.soft=b.hd.soft,a.hd.required+=b.hd.required,a.hd.status=b.hd.status,a.ip.actual=b.ip.actual,a.ip.hard=b.ip.hard,a.ip.soft=b.ip.soft,a.ip.required+=b.ip.required,a.ip.status=b.ip.status,a.ram.actual=b.ram.actual,a.ram.hard=b.ram.hard,a.ram.soft=b.ram.soft,a.ram.required+=b.ram.required,a.ram.status=b.ram.status,a.repository.actual=b.repository.actual,a.repository.hard=b.repository.hard,a.repository.soft=b.repository.soft,a.repository.required+=b.repository.required,a.repository.status=b.repository.status,a.storage.actual=b.storage.actual,a.storage.hard=b.storage.hard,a.storage.soft=b.storage.soft,a.storage.required+=b.storage.required,a.storage.status=b.storage.status,a.vlan.actual=b.vlan.actual,a.vlan.hard=b.vlan.hard,a.vlan.soft=b.vlan.soft,a.vlan.required+=b.vlan.required,a.vlan.status=b.vlan.status)}function x(a){if(a.hardLimit&&1==a.hardLimit)return!0;var b=a.cpu.actual+a.cpu.required;if(a.cpu.hard>0&&b>a.cpu.hard)return a.cpu.status="HARD",!0;var c=a.hd.actual+a.hd.required;if(a.hd.hard>0&&c>a.hd.hard)return a.hd.status="HARD",!0;var d=a.ip.actual+a.ip.required;if(a.ip.hard>0&&d>a.ip.hard)return a.ip.status="HARD",!0;var e=a.ram.actual+a.ram.required;if(a.ram.hard>0&&e>a.ram.hard)return a.ram.status="HARD",!0;var f=a.repository.actual+a.repository.required;if(a.repository.hard>0&&f>a.repository.hard)return a.repository.status="HARD",!0;var g=a.storage.actual+a.storage.required;if(a.storage.hard>0&&g>a.storage.hard)return a.storage.status="HARD",!0;var h=a.vlan.actual+a.vlan.required;return a.vlan.hard>0&&h>a.vlan.hard?(a.vlan.status="HARD",!0):!1}function y(b){var c=function(b,c){f--,w(i,b),0==f&&(h=x(i),h?(g.setSynchronizeVapp(!1),i.hardLimit=!0,i.code="LIMITS_EXCEEDED",a.checkSoftHardLimits(i)):(g.setSynchronizeVapp(!1),i.code="SOFT_LIMIT_EXCEEDED",a.checkSoftHardLimits(i)))},d=!1,f=0,h=!1,i={cpu:{actual:0,hard:0,required:0,soft:0},hd:{actual:0,hard:0,required:0,soft:0},ip:{actual:0,hard:0,required:0,soft:0},ram:{actual:0,hard:0,required:0,soft:0},repository:{actual:0,hard:0,required:0,soft:0},storage:{actual:0,hard:0,required:0,soft:0},vlan:{actual:0,hard:0,required:0,soft:0}};angular.forEach(e.virtualMachines,function(a){"NOT_ALLOCATED"===a.state&&(f++,e.deployVirtualMachine(a,b,!0,c),d=!0)}),d&&(B.clientData.originalState=B.state,B.state="LOCKED",E())}var z={},A=[],B={},C="",D=function(b){var c=b||{};return c.clientData={virtualDatacenter:a.getClientdataFromLinksByRel(c.links,"virtualdatacenter"),automaticallyOpenVappView:f.userChoices.automaticallyOpenVappView,virtualMachines:[]},c},E=function(){angular.forEach(A,function(a){a.id==B.id&&(a.state=B.state)})},F=function(a,e){c.showAlert({scope:d,message:b("translate")("virtualmachine.captured.undeploy.message"),title:b("translate")("virtualmachine.captured.undeploy.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:b("translate")("globals.cancel"),confirmLabel:b("translate")("globals.confirm"),confirmFn:function(){H(a,!0,e)},cancelFn:function(){}})},G=function(a,e){c.showAlert({scope:d,message:b("translate")("virtualmachine.withouttemplate.undeploy.message"),title:b("translate")("virtualmachine.withouttemplate.undeploy.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:b("translate")("globals.cancel"),confirmLabel:b("translate")("globals.confirm"),confirmFn:function(){H(a,!0,e)},cancelFn:function(){}})},H=function(c,d,e){B.clientData.originalState=B.state,B.state="LOCKED",h.dispatch("virtualappliance.deploy.inprogress",{action:"UNDEPLOY"});var f=function(){E(),void 0!==e&&e(),i.toastrSuccess(b("translate")("virtualappliance.undeploy.inprogress",{name:c.name}))},g=function(a){B.state=C,"VM-44"==a?F(c,e):"VM-109"==a&&G(c,e),void 0!==e&&e()},j={};d&&(j.forceUndeploy=!0);var k={rel:"undeploy",links:c.links,type:"application/vnd.abiquo.acceptedrequest+json",contentType:"application/vnd.abiquo.virtualmachinetask+json"};a.postByRel(k,j,f,g)};return angular.extend(z,{VirtualAppliance:D,virtualAppliances:A,currentVirtualAppliance:B,setCurrentVirtualAppliance:j,getVirtualAppliancesForVirtualDatacenter:k,getVirtualAppliancesForEnterprise:l,getVirtualAppliancesByEnterpriseAndDatacenter:m,getCurrentVirtualAppliance:n,deleteVirtualAppliance:o,createVirtualAppliance:p,editVirtualAppliance:q,deploy:r,unDeploy:s,moveVirtualApplianceToVirtualDatacenter:t,copyVirtualApplianceToVirtualDatacenter:u,updatePendingTasks:v,updatePendingCurrentVirtualMachines:y}),z}]),angular.module("virtualDatacentersMgr",["server","authenticationMgr"]).factory("virtualDatacentersMgr",["server","authenticationMgr","configMgr","paginationHelper","$filter","utils","dispatcher",function(a,b,c,d,e,f,g){function h(a){angular.copy(a,z),i(z),g.dispatch("currentVirtualDatacenter.change",{data:z})}function i(b){if(!f.isEmptyObject(b)){var c=function(a){b.clientData.location=a},d={links:b.links,rel:"location"};a.getByRel(d,c)}}function j(){if(!f.isEmptyObject(z)){var a=e("getElementById")(x,z.id);h(a)}}function k(b,c,d,e){var f=function(a){x.length=0,angular.forEach(a.collection,function(a){x.push(new A(a))}),j(),void 0!==e&&e(a)};if(b.links){var g={links:b.links,rel:"cloud/virtualdatacenters",queryParam:{}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.getByRel(g,f)}else{var g={path:"admin/enterprises/"+b.id+"/action/virtualdatacenters",type:"application/vnd.abiquo.virtualdatacenters+json",queryParam:{}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.get(g,f)}}function l(b,c){var e=function(a){y.length=0,angular.forEach(a.collection,function(a){y.push(new A(a))}),void 0!==c&&c(y)},f=d.noPagination.param;if(b.links){var g={links:b.links,rel:"cloud/virtualdatacenters",queryParam:{}};angular.extend(g.queryParam,f),a.getByRel(g,e)}else{var g={path:"admin/enterprises/"+b.id+"/action/virtualdatacenters",type:"application/vnd.abiquo.virtualdatacenters+json",queryParam:{}};angular.extend(g.queryParam,f),a.get(g,e)}}function m(b,c,d){var e=function(a){b.clientData.virtualDatacenters.length=0,angular.forEach(a.collection,function(a){b.clientData.virtualDatacenters.push(new A(a))}),void 0!==d&&d(a)},f={path:"cloud/virtualdatacenters",type:"application/vnd.abiquo.virtualdatacenters+json",queryParam:{datacenter:c.id}};a.get(f,e)}function n(b,c,d){var e=function(a){b.clientData.virtualDatacenters.length=0,angular.forEach(a.collection,function(a){b.clientData.virtualDatacenters.push(new A(a))}),void 0!==d&&d(a)},f={path:"cloud/virtualdatacenters",type:"application/vnd.abiquo.virtualdatacenters+json",queryParam:{datacenter:c.id,enterprise:b.id}};a.get(f,e)}function o(b,c,d){var e=function(a){x.length=0,angular.forEach(a.collection,function(a){c?c.type==a.hypervisorType&&x.push(new A(a)):x.push(new A(a))}),j(),void 0!==d&&d(a)},f={path:"cloud/virtualdatacenters",type:"application/vnd.abiquo.virtualdatacenters+json",queryParam:{enterprise:b.id,limit:0}};a.get(f,e)}function p(b,c){var d=function(a){b.clientData.virtualDatacenter=new A(a),b.clientData.virtualDatacenter.isPublic=v(a),void 0!==c&&c(b)},e={links:b.links,rel:"virtualdatacenter"};a.getByRel(e,d,void 0)}function q(b,c){var d=function(a){void 0!==c&&c(),g.dispatch("virtualDatacenter.deleted",{data:b}),f.toastrSuccess(e("translate")("action.delete.success.virtualdatacenter.text",{vdc:b.name})),h(null)},i={type:"application/vnd.abiquo.virtualdatacenter+json",path:"cloud/virtualdatacenters/"+b.id};a.remove(i,d,void 0)}function r(b,c,d,h){b.vlan.type="INTERNAL";var i=a.createLinkByRel(c.links,"self","location"),j=a.createLinkByRel(d.links,"edit","enterprise");if(b.links=[],b.links.push(i),b.links.push(j),b.clientData&&b.clientData.availabilityZone.name&&b.clientData.availabilityZone.name!=e("translate")("virtualdatacenter.create.generalinfo.privatenetwork.combo.availabilityzone.nopreference")){var k=a.createLinkByRel(b.clientData.availabilityZone.links,"self","availabilityzone");b.vlan.links=[k]}var l=function(){void 0!==h&&h(),g.dispatch("virtualDatacenter.created",{data:b}),f.toastrSuccess(e("translate")("action.create.success.virtualdatacenter.text",{vdc:b.name}))},m={type:"application/vnd.abiquo.virtualdatacenter+json",path:"cloud/virtualdatacenters"};a.post(m,b,l)}function s(b,c){var d=function(a){h(a),void 0!==c&&c(),g.dispatch("virtualDatacenter.edited",{data:b}),f.toastrSuccess(e("translate")("action.edit.success.virtualdatacenter.text",{vdc:b.name}))},i={links:b.links,rel:"edit"};a.putByRel(i,b,d)}function t(b,c,d){var e=function(a){c.vlan=b,void 0!==d&&d(a),g.dispatch("defaultNetwork.edited",{data:a})},f=a.getLinkByRel(b.links,"edit"),h={links:[{href:f.href,rel:b.clientData.networkRel}]},i=a.getLinkByRel(c.links,"edit"),j=i.href+"/action/defaultvlan",k={path:j,type:"*/*",contentType:"application/vnd.abiquo.links+json",absolutPath:!0};a.put(k,h,e)}function u(a){var b=0;for(b;b<x.length;b++)if(x[b].id==a)return x[b];return null}function v(b){var c=a.getLinkByRel(b.links,"location");return-1!=c.type.search("publiccloudregion")}var w={},x=[],y=[],z={},A=function(b){var c=b||{};return c.clientData={datacenter:a.getClientdataFromLinksByRel(c.links,"location"),enterprise:a.getClientdataFromLinksByRel(c.links,"enterprise"),isPublic:-1!=a.getLinkByRel(c.links,"location").type.search("publiccloudregion"),networks:[],selected:!1},c};return angular.extend(w,{VirtualDatacenter:A,virtualDatacenters:x,allVirtualDatacenters:y,currentVirtualDatacenter:z,getVirtualDatacenters:k,getAllVirtualDatacenters:l,getVirtualDatacenterInVirtualAppliance:p,getVirtualDataCentersByDataCenter:m,getVirtualDataCentersByEnterprise:o,getVirtualDataCentersByEnterpriseAndDataCenter:n,deleteVirtualDatacenter:q,setCurrentVirtualDatacenter:h,createVirtualDatacenter:r,editVirtualDatacenter:s,getVirtualDatacenterById:u,setDefaultNetwork:t}),w}]),angular.module("virtualMachineTemplatesMgr",[]).factory("virtualMachineTemplatesMgr",["server","configMgr","dispatcher","$upload","utils","$filter","$rootScope","$timeout","uModals","toastr",function(a,b,c,d,e,f,g,h,i,j){function k(a){angular.copy(a,Aa),c.dispatch("currentPersistentVMTemplate.change",{data:Aa})}function l(a){e.emptyObject(Fa),angular.copy(a,Da)}function m(a){angular.extend(Fa,a)}function n(a){angular.copy(a,Ga),c.dispatch("currentVirtualMachineTemplateCategory.change",{data:Ga})}function o(){var a={};angular.forEach(La,function(b){return b.defaultCategory?void(a=b):void 0}),n(a)}function p(a){angular.copy(a,Ha)}function q(a){angular.copy(a,Oa)}function r(a){var b="";if(!e.isEmptyObject(a)){var c=a.split("/");c.length>0&&(c.splice(c.length-1,1),b=c.join("/"))}return b}function s(a){var b="";if(!e.isEmptyObject(a)){var c=a.split("/");c.length>0&&(b=c[c.length-1])}return b}function t(b){var c=a.getLinkByRel(b.links,"templatePath"),d=!e.isEmptyObject(c);return d}function u(b){var c=a.getLinkByRel(b.links,"virtualdatacenter"),d=!e.isEmptyObject(c);return d}function v(a){var b=f("vmtSlaveFiltersForMaster")(Ba,a.id,{});return void 0!==b&&b.length>0}function w(b,c,d){c||(Ea.length=0);var e=[],f=function(a){Ea.length=0,angular.forEach(a.collection,function(a){var b=new ua(a);e.push(b)}),angular.copy(e,Ea),void 0!==d&&d(a)},g={links:b.links,rel:"instances",queryParam:{}};a.getByRel(g,f)}function x(b,c,d,e,f){var g=function(a){pa.loading=!1,Ba.length=0,angular.forEach(a.collection,function(a){var b=new ua(a);Ba.push(b)}),void 0!==f&&f(a)},h=function(){pa.loading=!1},i={links:b.links,rel:"templates",queryParam:{limit:0}};angular.extend(i.queryParam,e),c||(pa.loading=!0),a.getByRel(i,g,h)}function y(b,c,d,g,h,i,k){d||(Ba.length=0);var l=function(a){d||(Ba.length=0),0==a.collection.length&&"remote"==h.source&&j.info(f("translate")("action.get.success.remote.virtualimages.text")),angular.forEach(a.collection,function(a){var b=new ua(a);d||Ba.push(b)}),void 0!==i&&i(a)},m={rel:"virtualmachinetemplates",links:b.links,queryParam:{categoryName:e.isEmptyObject(c)?"":c.name,master:!0,by:"name"}};angular.extend(m.queryParam,g),angular.extend(m.queryParam,h),a.getByRel(m,l,k)}function z(b,c,d,g,h,i){Ca.length=0;var k=function(a){Ca.length=0,0==a.collection.length&&j.info(f("translate")("action.get.success.remote.virtualimages.text")),angular.forEach(a.collection,function(a){var b=new ua(a);Ca.push(b)}),void 0!==h&&h(a)};g.source="remote";var l={rel:"virtualmachinetemplates",links:b.links,queryParam:{categoryName:e.isEmptyObject(c)?"":c.name}};angular.extend(l.queryParam,d),angular.extend(l.queryParam,g),a.getByRel(l,k,i)}function A(b,c,d,e){var f=function(a){Ba.length=0,angular.forEach(a.collection,function(a){var b=new ua(a);Ba.push(b)}),void 0!==e&&e(a)},g=function(b){i={links:b.links,rel:"virtualmachinetemplates",queryParam:{}},angular.extend(i.queryParam,c),angular.extend(i.queryParam,d),i.queryParam.external=!1,a.getByRel(i,f)},h=function(b){i={links:b.links,rel:"datacenterrepository"},a.getByRel(i,g)},i={links:b.links,rel:"location"};a.getByRel(i,h)}function B(b,c,d,e,f){c||(Ia.length=0);var g=function(a){Ia.length=0;var c=[],d=0;angular.forEach(a.collection,function(e){d++,c.push(new ta(e,b)),d==a.collection.length&&(angular.extend(Ia,c),void 0!==f&&f(a))})},h={path:"cloud/virtualdatacenters/"+b.id+"/action/templates",type:"application/vnd.abiquo.virtualmachinetemplates+json",queryParam:{stateful:"ALL"}};angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.get(h,g)}function C(b,c){Ja.length=0;var d=function(a){angular.forEach(a.collection,function(a){Ja.push(new ta(a))}),void 0!==c&&c(a)},e={links:b.links,rel:"templates",queryParam:{stateful:"NOTUSED"}};a.getByRel(e,d)}function D(b,c){var d=function(a){var b={id:"0",name:f("translate")("virtualmachinestemplate.filter.allcategories"),links:[]};La.length=0,La.push(new va(b));var d=f("orderBy")(a.collection,"name","false");angular.forEach(d,function(a){La.push(new va(a))}),void 0!==c&&c()},e={type:"application/vnd.abiquo.categories+json",path:"config/categories",queryParam:{idEnterprise:b.id}};a.get(e,d)}function E(b,d,g){var h=function(a){void 0!==g&&g(a),c.dispatch("category.created",{data:a}),e.toastrSuccess(f("translate")("action.create.success.category.text",{cat:b.name}))};if(!b.clientData.global){var i=a.createLinkByRel(d.links,"edit","enterprise");b.links.push(i)}var j={type:"application/vnd.abiquo.category+json",path:"config/categories"};a.post(j,b,h)}function F(b,d){var g=function(a){void 0!==d&&d(a),c.dispatch("category.deleted",{data:a}),e.toastrSuccess(f("translate")("action.delete.success.category.text",{cat:b.name}))},h={type:"application/vnd.abiquo.category+json",path:"config/categories/"+b.id};a.remove(h,g)}function G(b,d){var g=function(){void 0!==d&&d(),c.dispatch("persistentTemplate.deleted"),e.toastrSuccess(f("translate")("action.delete.success.persistentvirtualmachinetemplate.text",{pvmt:b.name}))},h={rel:"edit",links:b.links};a.removeByRel(h,g)}function H(b,d,g,h,i){var j=function(b){var c=angular.copy(a.getLinkByRel(b.links,"edit"));return c.rel="disk"+b.sequence,c},k=function(b){var c,d=b.clientData.selectedStorage;return"tier"==d.clientData.classType?(c=angular.copy(a.getLinkByRel(d.links,"self")),c.title=b.clientData.volumeName?b.clientData.volumeName:""):c=angular.copy(a.getLinkByRel(d.links,"edit")),c.rel=d.clientData.classType+b.sequence,c},l=[{rel:"virtualmachinetemplate",href:a.getLinkByRel(b.links,"edit").href},{rel:"virtualdatacenter",href:a.getLinkByRel(g.links,"edit").href}];if(h)for(var m=0;m<h.length;m++){var n=h[m];n&&n.clientData&&n.clientData.selectedStorage&&(l.push(j(n)),l.push(k(n)))}var o={links:l,persistentTemplateName:b.name},p=function(a){void 0!==i&&i(a),c.dispatch("persistentTemplate.created"),e.toastrSuccess(f("translate")("action.create.success.persistentvirtualmachinetemplate.text",{pvmt:o.name}))},q={contentType:"application/vnd.abiquo.virtualmachinetemplatepersistent+json",type:"application/vnd.abiquo.acceptedrequest+json",path:"admin/enterprises/"+d.id+"/datacenterrepositories/"+g.clientData.datacenter.id+"/virtualmachinetemplates"};a.post(q,o,p)}function I(b,d,g){var h=function(){void 0!==g&&g(),c.dispatch("persistentTemplate.edited"),e.toastrSuccess(f("translate")("action.edit.success.persistentvirtualmachinetemplate.text",{pvmt:b.name}))},i=function(){var c=angular.copy(a.getLinkByRel(d.links,"edit"));c.type=c.title,c.title=d.name,a.setLinkByRel(b.links,"category",c);var e={rel:"edit",links:b.links};a.putByRel(e,b,h)};if(b.hdRequired/1024/1024!=b.clientData.sizeInMB){var j=angular.copy(b.clientData.volume);j.sizeInMB=b.hdRequired/1024/1024;var k={links:b.clientData.volume.links,rel:"edit",type:"application/vnd.abiquo.acceptedrequest+json"};a.putByRel(k,j,i)}else i()}function J(b,d,g,h){var i=function(a){void 0!==h&&h(),c.dispatch("persistentTemplate.edited"),e.toastrSuccess(f("translate")("action.move.success.persistentvirtualmachinetemplate.text",{pvmt:b.name}))},j={links:b.links,rel:"move",type:"application/vnd.abiquo.virtualmachinetemplate+json"},k={links:[{href:a.getUrl("cloud/virtualdatacenters/"+d.id),rel:"virtualdatacenter"}]};a.putByRel(j,k,i)}function K(b,c,d,e){var f=function(a){Ma.length=0,angular.forEach(a.collection,function(a){var b=new wa(a);Ma.push(b)}),0==a.collection.length&&""!=d?T(b,d,e):void 0!==e&&e(a)},g={rel:"appslib/templateDefinitionLists",links:b.links};a.getByRel(g,f)}function L(a){return new ua(a)}function M(b,c,d){var e=function(a){Na.length=0,angular.forEach(a.collection,function(a){angular.forEach(b.templateDefinitions.collection,function(b){b.url===a.ovfId&&(b.status=a)})}),void 0!==d&&d(a)},f={rel:"repositoryStatus",links:b.links,queryParam:{datacenterId:c.id}};a.getByRel(f,e)}function N(b,g,i,j,k,l,m){var n=a.getLinkByRel(b.clientData.repository.links,"applianceManagerRepositoryUri");if(n){var o=n.href+"/templates",p=k.clientData.file;k.diskFilePath=k.path,delete k.path,k.requiredHDInMB=k.clientData.hdRequiredInMb,delete k.hdRequired,k.diskFileFormat=k.diskFormatType,delete k.diskFormatType,delete k.links,delete k.clientData,d.upload({url:o,method:"POST",headers:{Authorization:a.getAuthorization()},withCredential:!0,data:{diskInfo:{name:g.name,description:g.description,disks:[k],requiredCpu:g.cpuRequired,requiredRamInMB:g.ramRequired,iconUrl:g.iconUrl,categoryName:i.name,osType:g.osType,osVersion:g.osVersion,loginUser:g.loginUser,loginPassword:g.loginPassword,ethernetDriverType:g.ethernetDriverType}},file:p,fileFormDataName:"diskFile"}).progress(function(a){l&&(l.percentLoaded=parseInt(a.loaded/a.total*100),l.status="UPLOADING")}).success(function(b,d,i,j){if(0==d||d>=400){var b={collection:[{code:"CUSTOM-01",message:"Unexpected error while creating the virtual machine template"}]};l&&(l.status="error"),a.showErrors(b)}else h(function(){c.dispatch("virtualimage.created"),l&&(l.status="UPLOADED")},500),void 0!==m&&m(),e.toastrSuccess(f("translate")("action.create.success.virtualimage.text",{vimg:g.name}))}).error(function(a){console.log(a)})}}function O(b,c,e,f){var g=a.getLinkByRel(b.links,"templatePath");if(g){var i=g.href,j=c.clientData.file;c.diskFilePath=c.path,delete c.path,c.requiredHDInMB=c.clientData.hdRequiredInMb,delete c.hdRequired,c.diskFileFormat=c.diskFormatType,delete c.diskFormatType,delete c.links,delete c.clientData,c.virtualMachineTemplateUrl=a.getLinkByRel(b.links,"edit").href,d.upload({url:i,method:"POST",headers:{Authorization:a.getAuthorization()},withCredential:!0,data:{diskInfo:c},file:j,fileFormDataName:"diskFile"}).progress(function(a){e&&(e.percentLoaded=parseInt(a.loaded/a.total*100),e.status="UPLOADING")}).success(function(b,c,d,g){if(0==c||c>=400){var b={collection:[{code:"CUSTOM-01",message:"Unexpected error while creating the virtual machine template"}]};e&&(e.status="error"),a.showErrors(b),void 0!==f&&f()}else h(function(){e&&(e.status="UPLOADED")},500),void 0!==f&&f()}).error(function(a){console.log(a),void 0!==f&&f()})}}function P(b,d,g){var h=function(a){c.dispatch("persistentTemplate.edited"),void 0!==g&&g(a),e.toastrSuccess(f("translate")("action.edit.success.virtualimage.text",{vimg:b.name}))},i=a.getLinkByRel(d.links,"edit");a.setLinkByRel(b.links,"category",angular.copy(i));var j=angular.copy(b);a.removeAllLinksByRel(b.links,"hardwareprofile"),j.clientData.hardwareprofiles.length>0&&angular.forEach(j.clientData.hardwareprofiles,function(c){if(c.clientData&&c.clientData.selected){var d=a.createLinkByRel(c.links,"self","hardwareprofile");b.links.push(d)}});var k={rel:"edit",links:b.links};a.putByRel(k,b,h)}function Q(b,d,h){var j=function(a){c.dispatch("virtualimage.deleted"),void 0!==h&&h(a),e.toastrSuccess(f("translate")("action.delete.success.virtualimage.text",{vimg:b.name}))},k=function(a){("VIMAGE-10"==a||"VIMAGE-7"==a)&&i.showPopUp({scope:g,controller:"VirtualMachineTemplateInUseCtrl",popupUrl:"modules/library/templates/partials/templateinuseform.html",formName:"vmtInUseForm",title:f("translate")("appslibrary.templateinuse.delete.confirm.title"),closeOnCancel:!0,closeOnAccept:!0,cancelLabel:f("translate")("globals.no"),acceptLabel:f("translate")("globals.yes"),showAcceptBtn:!0,showCancelBtn:!0,popupData:b})};if(d){var l=a.getLinkByRel(b.links,"edit"),m={path:l.href+"/action/deletefile",type:"application/vnd.abiquo.virtualmachinetemplate+json",absolutPath:!0};a.post(m,{},j)}else{var m={links:b.links,rel:"edit",queryParam:{force:d}};a.removeByRel(m,j,k)}}function R(b,d,e){var f=function(a){c.dispatch("virtualimage.updated"),void 0!==e&&e(a)},g=a.getLinkByRel(b.links,"edit"),h=a.getIdInLinkByParameter(g,"enterprises"),i=a.getIdInLinkByParameter(g,"datacenterrepositories"),j={path:"admin/enterprises/"+h+"/datacenterrepositories/"+i+"/virtualmachinetemplates",contentType:"application/vnd.abiquo.virtualmachinetemplaterequest+json",type:"application/vnd.abiquo.acceptedrequest+json"},k={links:[a.createLinkByRel(b.links,"edit","virtualmachinetemplate")],promotedName:d};angular.forEach(b.clientData.disks,function(b){if(1==b.clientData.selected){var c=a.createLinkByRel(b.links,"edit","disk"+b.sequence);k.links.push(c)}}),a.post(j,k,f)}function S(b,d,g){var h=function(a){d.clientData.importOnProcess=!0,void 0!=g&&g(a),e.toastrSuccess(f("translate")("action.import.success.template.text",{template:d.name})),c.dispatch("template.imported",{data:a})},i=a.getLinkByRel(b.links,"virtualmachinetemplates"),j={path:i.href,type:"application/vnd.abiquo.virtualmachinetemplate+json",absolutPath:!0};a.post(j,d,h)}function T(b,d,e){var f=function(a){void 0!==e&&e(a),c.dispatch("templateDefinitions.created",{data:a})},g={path:"admin/enterprises/"+b.id+"/appslib/templateDefinitionLists",type:"application/vnd.abiquo.templatedefinitionlist+json",contentType:"text/plain"},h={url:d};a.post(g,h.url,f)}function U(b,d,f){var g=function(a){void 0!==f&&f(a),e.emptyObject(d),e.emptyObject(b),c.dispatch("templateDefinitions.deleted",{data:a})},h={links:b.links,rel:"edit"};a.removeByRel(h,g)}function V(b){var c={path:b,type:"*/*",absolutPath:!0};a.get(c)}function W(b){var c=a.getLinkByRel(b.links,"diskfile");c.href?(location.href=c.href,e.toastrSuccess(f("translate")("action.download.virtualmachine.success.start.text",{name:b.name}))):e.toastrError(f("translate")("action.download.virtualmachine.error.start.text",{name:b.name}))}function X(b,c,d){var e=function(a){void 0!==d&&d(a)};b.status.status="DOWNLOADING",b.clientData.downloadStatus="DOWNLOADING";var f=a.getLinkByRel(b.links,"edit"),g=f.href+"/actions/repositoryInstall",h=a.getLinkByRel(b.links,"enterprise"),i=h.href+"/datacenterrepositories/"+c.id+"/virtualmachinetemplates",b={links:[{rel:"templateDefinition",href:g}]},j={path:i,type:"application/vnd.abiquo.acceptedrequest+json",contentType:"application/vnd.abiquo.virtualmachinetemplaterequest+json",absolutPath:!0};a.post(j,b,e)}function Y(b,c,d,e){var f=function(a){void 0!==e&&e(a)},g=function(c){var e=b.clientData.virtualMachineTemplates[0].id,g=a.getLinkByRel(b.links,"enterprise"),h=g.href+"/datacenterrepositories/"+d.id+"/virtualmachinetemplates/"+e,i={path:h,absolutPath:!0};a.remove(i,f)};Z(c,b,g)}function Z(b,c,d){c.clientData.virtualMachineTemplates=[];var e=function(a){var b=[];angular.forEach(a.collection,function(a){var c=new ua(a);b.push(c)}),c.clientData.virtualMachineTemplates=b,void 0!=d&&d()};if(c.url){var f={rel:"virtualmachinetemplates",links:b.links,queryParam:{ovfId:c.url}};a.getByRel(f,e)}}function $(b,c){var d=function(a){b.clientData.conversions.length=0,a.collection.forEach(function(a){b.clientData.conversions.push(new xa(a))}),void 0!==c&&c(a)},e={links:b.links,rel:"conversions"};a.getByRel(e,d)}function _(b,c,d){var g=function(a){void 0!==d&&d(a),e.toastrSuccess(f("translate")("action.create.success.conversion.text",{format:b}))},h=a.getLinkByRel(c.links,"conversions"),i=h.href+"/"+b,j={targetFormat:b},k={path:i,type:"application/vnd.abiquo.acceptedrequest+json",contentType:"application/vnd.abiquo.conversion+json",absolutPath:!0};a.put(k,j,g)}function aa(b,c){var d=function(a){void 0!==c&&c(a)},e={rel:"conversions",links:b.links};a.postByRel(e,null,d)}function ba(b,c,d){var e=function(a){b.clientData.instancesAndPersistents=[],angular.forEach(a.collection,function(a){b.clientData.instancesAndPersistents.push(new ta(a))}),void 0!==d&&d(a)},f={rel:"instances",links:b.links,queryParam:c};a.getByRel(f,e)}function ca(b,c,d){var e=function(a){c.clientData.hardwareprofiles=a.collection,angular.forEach(c.links,function(b){if("hardwareprofile"==b.rel){var c=f("getElementByParameter")(a.collection,{element:b.title,attribute:"providerId"});c.clientData={selected:!0}}}),void 0!=d&&d()},g={links:b.links,rel:"hardwareprofiles"};a.getByRel(g,e)}function da(){qa.length=0;var b=function(a){angular.extend(qa,a.collection)},c={path:"config/ostypes",type:"application/vnd.abiquo.ostypes+json"};a.get(c,b)}function ea(){ra.length=0;var b=function(a){angular.extend(ra,a.collection)},c={path:"config/ethernetdrivertypes",type:"application/vnd.abiquo.ethernetdrivertypes+json"};a.get(c,b)}function fa(){sa.length=0;var b=function(a){angular.extend(sa,a.collection)},c={path:"config/diskcontrollertypes",type:"application/vnd.abiquo.diskcontrollertypes+json"};a.get(c,b)}function ga(b,c,d,g){b.clientData.disks.length=0;var h=function(h){var i=0;angular.forEach(h.collection,function(j){var k=function(a){i++;var k=new ya(j,b,a);if(c){var l=f("getElementByParameter")(c,{element:k.clientData.id,attribute:"clientData.id"});k.clientData.selected=!e.isEmptyObject(l)}(!d||k.path)&&b.clientData.disks.push(k),i==h.collection.length&&(angular.extend(b.clientData.disks,f("orderBy")(b.clientData.disks,"sequence","false")),void 0!=g&&g(h,b.clientData.disks))},l=a.getLinkByRel(j.links,"volume");if(e.isEmptyObject(l))k();else{var m={rel:"volume",links:j.links};a.getByRel(m,k)}}),b.clientData.templateHasFilesInNFS&&(b.clientData.templateDisksPath=ha(b.clientData.disks))},i={links:b.links,rel:"disks"};a.getByRel(i,h)}function ha(a){var b="";if(!e.isEmptyObject(a)&&a.length>0)for(var c=0;c<a.length;c++){var d=a[c];d.clientData.isPersistentDisk||e.isEmptyObject(d.clientData.filePath)||(b=d.clientData.filePath)}return b}function ia(b,c,d){var e=angular.copy(c),f=function(a){if(e.clientData.copied){var b={rel:"edit",href:a.links[0].href.split("/tasks")[0]};a.links.push(b)}void 0!==d&&(a.sequence=c.sequence,d(a))},g=function(){void 0!==d&&d()},h={links:b.links,rel:"disks",type:c.clientData.copied?"application/vnd.abiquo.acceptedrequest+json":"application/vnd.abiquo.disk+json",contentType:c.clientData.copied?"application/vnd.abiquo.diskrequest+json":"application/vnd.abiquo.disk+json"};a.postByRel(h,c,f,g)}function ja(b,c){var d=function(a){void 0!==c&&c(a,f)},e={links:b.links,rel:"edit"},f=b.clientData.id;a.putByRel(e,b,d)}function ka(b,c){var d=function(a){void 0!==c&&c()},e={links:b.links,rel:"edit"};a.removeByRel(e,d,d)}function la(b,c){var d=function(a){var c=new ua(a);e.isEmptyObject(c)||e.isEmptyObject(b)||angular.copy(c,b)},f={links:b.links,rel:"edit"};a.getByRel(f,d)}var ma=function(){var a={};return a.name="NAME",a["clientData.master.name"]="MASTER",a["clientData.virtualDatacenter.name"]="VIRTUALDATACENTER",a["clientData.virtualAppliance.name"]="VIRTUALAPPLIANCE",a["clientData.virtualMachine.name"]="VIRTUALMACHINE",a["clientData.tier.name"]="TIER",a["clientData.sizeInMB"]="SIZE",a},na={},oa=ma(),pa={loading:!1},qa=[],ra=[],sa=[],ta=function(b,c){var d=new ua(b);return d.clientData.virtualDatacenter=a.getClientdataFromLinksByRel(d.links,"virtualdatacenter"),d.clientData.virtualAppliance=a.getClientdataFromLinksByRel(d.links,"virtualappliance"),d.clientData.virtualMachine=a.getClientdataFromLinksByRel(d.links,"virtualmachine"),c&&e.isEmptyObject(d.clientData.virtualDatacenter)&&(d.clientData.virtualDatacenter=c),d},ua=function(b){var c=b||{},d=a.getLinkByRel(c.links,"instances");return c.clientData={isMaster:!e.isEmptyObject(d),templateHasFilesInNFS:t(c),isPersistentTemplate:u(c),master:a.getClientdataFromLinksByRel(c.links,"master","virtualmachinetemplates"),category:a.getClientdataFromLinksByRel(c.links,"category","categories"),conversions:[],hardwareprofiles:[],disks:[],localDisks:[],numericalCreationDate:new Date(c.creationDate).getTime()},c},va=function(b){var c=b;return c.clientData={enterprise:a.getClientdataFromLinksByRel(b.links,"enterprise")},c.clientData.isGlobalCategory="0"!=c.id&&!c.clientData.enterprise,c},wa=function(a){var b=a;return b.templateDefinitions&&b.templateDefinitions.collection&&b.templateDefinitions.collection.forEach(function(a){a.clientData={downloadStatus:"NOT_DOWNLOAD",diskFileSize:za(a.templateDefinitionDisks,"diskFileSize"),capacity:za(a.templateDefinitionDisks,"hdRequired")}}),b},xa=function(a){var b=a;return b.clientData={},b},ya=function(b,c,d){var g=b,h=a.getLinkByRel(b.links,"diskfile");return g.clientData={template:angular.copy(c),id:c.id+"_"+a.getClientdataFromLinksByRel(g.links,"edit","disks").id,downloadUrl:h.href,sequence:g.sequence,enterprise:a.getClientdataFromLinksByRel(g.links,"edit","enterprises"),conversions:[],volume:a.getClientdataFromLinksByRel(g.links,"volume"),diskFileSize:g.diskFileSize,fileName:s(g.path),filePath:r(g.path)},g.clientData.isPersistentDisk=!e.isEmptyObject(g.clientData.volume),g.path?g.clientData.type=f("translate")("virtualmachinetemplate.disks.option.local"):g.clientData.type=f("translate")("virtualmachinetemplate.disks.option.emptydisk"),d&&angular.extend(g.clientData,{tier:a.getClientdataFromLinksByRel(d.links,"tier"),volume:d,diskFileSize:1024*d.sizeInMB*1024}),g},za=function(a,b){var c=0;return angular.forEach(a,function(a){c+=a[b]}),c},Aa={},Ba=[],Ca=[],Da={},Ea=[],Fa={},Ga={},Ha={},Ia=[],Ja=[],Ka={},La=[],Ma=[],Na=[],Oa={};return angular.extend(na,{VirtualMachineTemplate:ua,virtualMachineTemplates:Ba,virtualMachineTemplatesRemote:Ca,virtualMachineTemplate:Ka,virtualMachineTemplateInstances:Ea,persistentSortMapping:oa,allVirtualMachinePersistentTemplates:Ia,notUsedVirtualMachinePersistentTemplates:Ja,virtualMachineTemplatesCategories:La,currentPersistentVMTemplate:Aa,currentVirtualMachineTemplate:Da,currentVirtualMachineTemplateInstance:Fa,currentVirtualMachineTemplateCategory:Ga,currentVirtualMachineLayer:Ha,currentVirtualMachineTemplateDisk:Oa,templateDefinitions:Ma,repositoryStatus:Na,loadingTemplates:pa,operatingSystems:qa,nicDrives:ra,controllerTypes:sa,getInstancesByTemplate:w,getTemplatesByVirtualDatacenter:x,getTemplatesByDatacenterRepository:y,getTemplatesByDatacenterRepositoryRemote:z,getCandidateTemplatesForPersistent:A,getCategories:D,duplicateVirtualImage:R,createCategory:E,removeCategory:F,getAllPersistentVMTemplates:B,getNotUsedPersistentVMTemplates:C,createOVFPackageList:T,deleteOVFPackageList:U,setCurrentPersistentVMTemplate:k,setCurrentVMTemplate:l,setCurrentVMTemplateInstance:m,setCurrentVMTemplateCategory:n,
setCurrentVMTemplateCategoryToOther:o,setCurrentVMLayer:p,setCurrentVirtualMachineTemplateDisk:q,removePersistentVMTemplate:G,createPersistentVMTemplateFromVMTemplate:H,createVMTemplateFromLocalFile:N,uploadLocalFileInExistingVMTemplate:O,editVirtualImage:P,deleteVirtualImage:Q,editPersistentVMTemplate:I,movePersistentVMTemplateToVDC:J,getTemplateDefinitions:K,getRepositoryStatuses:M,getTemplateFromInstance:L,hasInstances:v,downloadTemplate:V,downloadVirtualMachine:W,installTemplateDefinitionInDatacenter:X,cancelDownloadOVFPackage:Y,getConversions:$,createConversionFormat:_,importVirtualMachineTemplate:S,generateAllMissingConversions:aa,getTemplateInstancesAndPersistents:ba,getTemplateHardwareProfiles:ca,getOperatingSystems:da,getNicDrives:ea,getControllerTypes:fa,getVMTemplateDisks:ga,createEmptyDisk:ia,deleteEmptyDisk:ka,editDisk:ja,refreshVirtualMachineTemplate:la}),na}]),angular.module("virtualMachinesMgr",[]).factory("virtualMachinesMgr",["server","virtualMachineTemplatesMgr","volumesMgr","configMgr","$rootScope","$filter","utils","dispatcher","uModals",function(a,b,c,d,e,f,g,h,i){function j(a){angular.copy(a,ga),h.dispatch("currentVirtualMachine.change",{data:ga})}function k(b,c,d){var e=function(){h.dispatch("instance.created"),void 0!==d&&d(),g.toastrSuccess(f("translate")("action.create.success.instance.text",{vm:b.name}))},i=[],j={rel:"instance",links:b.links,type:"application/vnd.abiquo.acceptedrequest+json",contentType:"application/vnd.abiquo.virtualmachineinstance+json"},k=function(b,c){if(b)for(var d=0;d<b.collection.length;d++){var e=b.collection[d];if(e&&e.clientData&&e.clientData.selected){var f=a.getLinkByType(e.links,c);i.push(f)}}};k(b.disks,"application/vnd.abiquo.harddisk+json"),k(b.volumes,"application/vnd.abiquo.volume+json");var l={instanceName:c,links:i};a.postByRel(j,l,e)}function l(b,c){d.setSynchronizeVapp(!1);var e=function(a){void 0!==c&&c(),g.toastrSuccess(f("translate")("action.edit.success.virtualmachine.text",{vm:b.name}))},h=a.getLinkByRel(b.links,"edit");if(!b.clientData.layerBlocked)if(b.clientData.layer&&b.clientData.layer.links){var i=a.getLinkByRel(b.clientData.layer.links,"edit");a.setLinkByRel(b.links,"layer",i)}else a.removeLinkByRel(b.links,"layer");var j={links:b.links,rel:"edit",type:"application/vnd.abiquo.acceptedrequest+json",contentType:h.type};a.putByRel(j,b,e)}function m(b,c){var d=function(a){void 0!==c&&c(),g.toastrSuccess(f("translate")("action.edit.success.virtualmachine.text",{vm:b.name}))},e={links:b.links,rel:"firewalls",type:"*/*"},h={links:[]};angular.forEach(b.links,function(a){"firewall"==a.rel&&h.links.push(a)}),a.putByRel(e,h,d)}function n(b,c){var d=function(a){angular.forEach(a.collection,function(a){b.clientData.gateway.gateway==a.gateway&&(b.clientData.gateway=a)}),void 0!=c&&c(a)},e={links:b.links,rel:"configurations"};a.getByRel(e,d)}function o(a){ga.state=a;var b=f("getElementByParameter")(ha,{element:ga.id,attribute:"id"});b.state=a}function p(b,c,d){var e={rel:"state",links:b.links,type:"application/vnd.abiquo.acceptedrequest+json",contentType:"application/vnd.abiquo.virtualmachinestate+json"},f={state:c};a.putByRel(e,f,d)}function q(a,b){var c=function(c){void 0!==b&&b(),h.dispatch("virtualMachine.turnedon",{data:c,virtualMachine:a}),g.toastrSuccess(f("translate")("action.play.success.virtualmachine.text",{name:a.name}))};p(a,"ON",c)}function r(a,b){var c=function(c){void 0!==b&&b(),h.dispatch("virtualMachine.turnedoff",{data:c,virtualMachine:a}),g.toastrSuccess(f("translate")("action.stop.success.virtualmachine.text",{name:a.name}))};p(a,"OFF",c)}function s(a,b){var c=function(c){void 0!==b&&b(),h.dispatch("virtualMachine.paused",{data:c,virtualMachine:a}),g.toastrSuccess(f("translate")("action.pause.success.virtualmachine.text",{name:a.name}))};p(a,"PAUSED",c)}function t(b,c){var d=b.state;o("LOCKED");var e=function(a){void 0!==c&&c(),h.dispatch("virtualMachine.reseted",{data:a,virtualMachine:b}),g.toastrSuccess(f("translate")("action.reset.success.virtualmachine.text",{vm:b.nam}))},i=function(){b.state=d,void 0!==c&&c()},j={rel:"reset",links:b.links,type:"application/vnd.abiquo.acceptedrequest+json",contentType:""};a.postByRel(j,null,e,i)}function u(b,c,e,i){d.setSynchronizeVapp(e);var j=b.state;b.state="LOCKED";var k=function(a,c){void 0!=a.hardLimit&&d.userInterface.synchronizeVapp?(b.state=j,i(a,c)):(d.userInterface.synchronizeVapp?h.dispatch("start.vmtimer",{}):void 0!==i&&i(a,c),h.dispatch("virtualMachine.deployed",{data:a,virtualMachine:b}),g.toastrSuccess(f("translate")("action.deploy.success.virtualmachine.text",{vm:b.name})))},l=function(){d.setSynchronizeVapp(!1),b.state=j},m={rel:"deploy",links:b.links,type:"application/vnd.abiquo.acceptedrequest+json",contentType:"application/vnd.abiquo.virtualmachinetask+json"};c===!0&&(m.queryParam={force:!0},delete m.contentType);var n=a.getLinkByRel(b.links,"tasks");n.href+=b.name;a.postByRel(m,b,k,l)}function v(b,c,d){var e=ga.state;ga.state="LOCKED";var i=function(a){void 0!==d&&d(),h.dispatch("virtualMachine.undeployed",{data:a}),g.toastrSuccess(f("translate")("action.undeploy.success.virtualmachine.text",{vm:b.name}))},j=function(a){ga.state=e,"VM-109"==a&&qa(b,d),void 0!==d&&d()};c&&(b.forceUndeploy=!0);var k={rel:"undeploy",links:b.links,type:"application/vnd.abiquo.acceptedrequest+json",contentType:"application/vnd.abiquo.virtualmachinetask+json"};a.postByRel(k,b,i,j)}function w(b,c){var d=function(a){void 0!==c&&c(),h.dispatch("virtualMachine.blocked",{data:a}),g.toastrSuccess(f("translate")("action.blocked.success.virtualmachine.text",{vm:b.name}))},e={rel:"protect",links:b.links,type:"text/plain",contentType:"text/plain"};a.postByRel(e,b.clientData.protectedCause,d)}function x(b,c){var d=function(a){void 0!==c&&c(),h.dispatch("virtualMachine.unblocked",{data:a}),g.toastrSuccess(f("translate")("action.unblocked.success.virtualmachine.text",{vm:b.name}))},e={rel:"unprotect",links:b.links,type:"text/plain",contentType:"text/plain"};a.postByRel(e,{},d)}function y(b,c,d){b&&(ha.length=0),aa=c,ba=d;var e={rel:"virtualmachines",links:c.links,queryParam:{limit:0}};a.getByRel(e,z)}function z(c){ra.length=0,c.collection&&c.collection.length>0?(ca=c.collection.length,da=0,ea=!1,angular.forEach(c.collection,function(c){var d={rel:"virtualmachinetemplate",links:c.links};a.getByRel(d,function(a){var d=new b.VirtualMachineTemplate(a),e=new ja(c,d);ra.push(e),da+=1,e.id===ga.id&&(j(e),ea=!0),da===ca&&(ea||j(null),ha.length=0,aa.clientData.virtualMachines.length=0,angular.forEach(ra,function(a){ha.push(a),aa.clientData.virtualMachines.push(a)}),h.dispatch("virtualappliance.virtualmachines.retrieved",{}),void 0!==ba&&ba(ha))}),d=null})):(ha.length=0,h.dispatch("virtualappliance.virtualmachines.retrieved",{}))}function A(b,c){var d=function(a){var d=new ja(a);d.clientData=b.clientData;var e=angular.extend(b,d);j(e),void 0!==c&&c(a,e)},e={links:b.links,rel:"edit",type:"application/vnd.abiquo.virtualmachineflat+json"};a.getByRel(e,d)}function B(b,c,d,e){var f=function(a){h.dispatch("virtualmachine.imported",{data:a}),void 0!=e&&e(a)},g=function(d){angular.forEach(b.disks.collection,function(a){delete a.clientData}),angular.forEach(b.nics.collection,function(b){var c=a.createLinkByRel(b.clientData.vlan.links,"edit","vlan");b.links.push(c),delete b.clientData});var e=a.createLinkByRel(b.links,"virtualmachine","imported");b.links.push(e),i={links:c.links,rel:"virtualmachines",type:"application/vnd.abiquo.virtualmachineflat+json",contentType:"application/vnd.abiquo.virtualmachineflat+json"},a.postByRel(i,b,f)},i={path:"cloud/virtualdatacenters/"+d.id,type:"application/vnd.abiquo.virtualdatacenter+json"};a.get(i,g)}function C(b,c){var d=function(a){h.dispatch("virtualmachine.released",{data:a}),void 0!=c&&c(a)},e=a.getLinkByRel(b.links,"virtualappliance"),f={path:e.href+"/virtualmachines/"+b.id,absolutPath:!0,queryParam:{release:!0}};a.remove(f,d)}function D(b,c){var d=function(a){void 0!=c&&c(a)},e={links:b.links,rel:"rdpaccess"};a.getByRel(e,d)}function E(a,b,c){var d={};d.name=a.name,d.id=0,d.links=[],d.clientData={virtualMachineTemplate:a},void 0!==b&&(d.clientData.layer=b),c&&(d.clientData.toBeEdited=!0),ha.push(d)}function F(a){if(ha&&a){for(var b=1,c=a.label;sa(c);)c=a.label+" ("+b+")",b++;a.label=c}}function G(b,c,d,e,i){var j=function(a){e&&!e.links?h.dispatch("create.layer",{vm:a,layer:e}):(g.toastrSuccess(f("translate")("action.create.success.virtualmachine.text",{vm:a.name})),h.dispatch("virtualmachine.created",{data:a})),void 0!==i&&i(a)},k=a.createLinkByRel(b.links,"edit","virtualmachinetemplate"),l={label:b.name,links:[],vdrpEnabled:"1"==d};if(l.links.push(k),!g.isEmptyObject(e)&&e.links){var m=a.createLinkByRel(e.links,"edit","layer");l.links.push(m)}F(l);var n=a.getLinkByRel(b.links,"hardwareprofile");g.isEmptyObject(n)||l.links.push(n);var o={type:"application/vnd.abiquo.virtualmachine+json",path:"cloud/virtualdatacenters/"+c.clientData.virtualDatacenter.id+"/virtualappliances/"+c.id+"/virtualmachines"};a.post(o,l,j)}function H(b,c){var d=function(a){j(null);var d={result:a,virtualMachine:b};void 0!==c&&c(d),h.dispatch("virtualMachine.deleted",d)},e={rel:"edit",links:b.links};a.removeByRel(e,d)}function I(b,c){var d=function(a){b.clientData.nics.length=0,angular.forEach(a.collection,function(a){a=new ka(a),b.clientData.nics.push(a)}),void 0!==c&&c()},e={rel:"nics",links:b.links},f=a.getLinkByRel(b.links,"nics");g.isEmptyObject(f)||a.getByRel(e,d)}function J(b,c){var d=function(d){b.clientData.hardDisks.length=0,angular.forEach(d.collection,function(c){var d=new ma(c),e=a.getLinkByRel(d.links,"edit");d.id=a.getIdInLinkByParameter(e,"disks"),b.clientData.virtualDisks.push(d),b.clientData.hardDisks.push(d)}),void 0!==c&&c()},e={rel:"harddisks",links:b.links},f=a.getLinkByRel(b.links,"harddisks");g.isEmptyObject(f)?c():a.getByRel(e,d)}function K(b,d){var e=function(a){b.clientData.volumes.length=0,angular.forEach(a.collection,function(a){a=new c.Volume(a),b.clientData.virtualDisks.push(a),b.clientData.volumes.push(a)}),void 0!==d&&d()},f={rel:"volumes",links:b.links},h=a.getLinkByRel(b.links,"volumes");g.isEmptyObject(h)?void 0!==d&&d():a.getByRel(f,e)}function L(b,c){var d=function(a){var b=[];angular.forEach(a.collection,function(a){var c=new la(a);b.push(new la(c))}),void 0!==c&&c(b)},e=function(){var c={rel:"runlist",links:b.links};a.getByRel(c,d)},f=function(a){a.metadata&&a.metadata.chef&&(b.clientData.metadataChef=a.metadata.chef),e()},g=a.getLinkByRel(b.links,"edit"),h={path:g.href+"/metadata",type:"application/vnd.abiquo.metadata+json",absolutPath:!0};a.get(h,f)}function M(b,c){var d=function(a){a.metadata&&a.metadata&&a.metadata["startup-script"]&&(b.clientData.startupScript=a.metadata["startup-script"]),void 0!==c&&c()},e=a.getLinkByRel(b.links,"edit"),f={path:e.href+"/metadata",type:"application/vnd.abiquo.metadata+json",absolutPath:!0};a.get(f,d)}function N(b,c,d){var e=function(a){void 0!==d&&d(a)},h=function(d){b.metadata=d;var f={rel:"runlist",links:b.links},g={collection:c};a.postByRel(f,g,e)},i=function(c){if(c.metadata){var d=c;delete d.metadata.chef;try{d.metadata.chef=b.clientData.metadataChef}catch(e){return void g.toastrError(f("translate")("virtualmachine.edit.chef.attributes.error"))}}else var d={links:[],metadata:{chef:b.clientData.metadataChef}};a.put(k,d,h)};if(b.clientData.metadataChef&&"NOT_ALLOCATED"==b.state){var j=a.getLinkByRel(b.links,"edit"),k={path:j.href+"/metadata",type:"application/vnd.abiquo.metadata+json",absolutPath:!0};a.get(k,i)}else h()}function O(b,c){var d=function(a){b.metadata=a,void 0!==c&&c(a)},e=function(c){if(c.metadata){var e=c;delete e.metadata["startup-script"],e.metadata["startup-script"]=b.clientData.startupScript}else var e={links:[],metadata:{"startup-script":b.clientData.startupScript}};a.put(g,e,d)},f=a.getLinkByRel(b.links,"edit"),g={path:f.href+"/metadata",type:"application/vnd.abiquo.metadata+json",absolutPath:!0};a.get(g,e)}function P(a,b){var c=function(c){K(a,b)};a.clientData.virtualDisks.length=0,J(a,c)}function Q(b,d){var e=function(e){var g=new ja(e);e.disks&&e.disks.collection&&angular.forEach(e.disks.collection,function(a){var b=new ma(a);g.clientData.virtualDisks.push(b)}),e.volumes&&e.volumes.collection&&angular.forEach(e.volumes.collection,function(a){a=new c.Volume(a),a.clientData.type=f("translate")("virtualmachine.details.storage.type.volume"),g.clientData.virtualDisks.push(a),g.clientData.volumes.push(a)});var h=a.getLinkByRel(g.links,"edit");h.rel="virtualmachine",b.label||(b.label=b.name),j(g),void 0!=d&&d(e)},g={links:b.links,rel:"virtualmachine",type:"application/vnd.abiquo.virtualmachineflat+json",queryParam:{sync:!0}};a.getByRel(g,e)}function R(b,c){b.clientData.nics.push(new ka(c)),c.sequence=g.returnSequence(b.clientData.nics,"sequence"),c.clientData.sequence=c.sequence;var d=a.createLinkByRel(c.links,"self","nic"+c.sequence);b.links.push(d)}function S(a){return a.id>0}function T(b,c){var d=function(a){h.dispatch("virtualMachine.edited",{data:a}),void 0!=c&&c()},e={links:b.clientData.errorTask.links,rel:"acknowledge"};a.postByRel(e,null,d)}function U(b,c,d){var e=function(a){b.clientData.virtualMachines=[],angular.forEach(a.collection,function(a){b.clientData.virtualMachines.push(new ja(a))}),void 0!==d&&d(a)},f={rel:"virtualmachines",links:b.links,queryParam:{allenterprises:c}};a.getByRel(f,e)}function V(b,c){var d=function(a){console.log("getTaskStatusResult",a),void 0!==c&&c(a)},e={rel:"status",links:b.links};a.getByRel(e,d)}function W(b,c){var d=function(a){ha.length=0,angular.forEach(a.collection,function(a){ha.push(new ja(a))}),void 0!==c&&c(a)},e={links:b.links,rel:"virtualmachines",queryParam:{limit:0}};a.getByRel(e,d)}function X(b,c){var d=function(a){b.clientData.loadBalancers.length=0,angular.forEach(a.collection,function(a){b.clientData.loadBalancers.push(new na(a))}),void 0!==c&&c(a)},e={links:b.links,rel:"loadbalancers"};a.getByRel(e,d)}function Y(b,c){var d=function(a){b.metadata=a,void 0!==c&&c(a)},e=function(c){if(c.metadata){var e=c;delete e.metadata["monitoring-metrics"],e.metadata["monitoring-metrics"]=ta(b.clientData.monitoringMetrics)}else var e={links:[],metadata:{"monitoring-metrics":ta(b.clientData.monitoringMetrics)}};a.put(g,e,d)},f=a.getLinkByRel(b.links,"edit"),g={path:f.href+"/metadata",type:"application/vnd.abiquo.metadata+json",absolutPath:!0};a.get(g,e)}function Z(b,c){var d=function(){b.monitoringLevel=b.clientData.monitoringLevel,void 0!=c&&c()},e={name:b.clientData.monitoringLevel},f={links:b.links,rel:"enablemonitoringlevel"};a.postByRel(f,e,d)}function _(b,c){var d=function(){void 0!=c&&c()},e={links:b.links,rel:b.monitored?"enablemonitoring":"disablemonitoring"};a.postByRel(e,{},d)}var aa,ba,ca,da,ea,fa={},ga={},ha=[],ia=["","NOT_ALLOCATED","ALLOCATED","CONFIGURED","ON","PAUSED","OFF","LOCKED","UNKNOWN"],ja=function(b,c){var d=b;d.clientData={virtualMachineTemplate:c,virtualAppliance:a.getClientdataFromLinksByRel(d.links,"virtualappliance"),enterprise:a.getClientdataFromLinksByRel(d.links,"enterprise"),originalGateway:a.getClientdataFromLinksByRel(d.links,"network_configuration","configurations"),gateway:a.getClientdataFromLinksByRel(d.links,"network_configuration","configurations"),nics:[],volumes:[],hardDisks:[],primaryDiskId:void 0,virtualDisks:[],state:"",availableChefComponents:[],firewalls:pa(b),hardwareProfile:a.getClientdataFromLinksByRel(d.links,"hardwareprofile"),isPersistent:"volumes"==a.getServiceNameFromLinksByRel(d.links,"disk0"),hypervisorType:a.getLinkByRel(d.links,"machine").title,user:a.getClientdataFromLinksByRel(d.links,"user"),loadBalancers:[],events:[],monitoringMetrics:[],charts:{},monitoringLevel:b.monitoringLevel,originalMonitoringLevel:b.monitoringLevel,originalMonitored:b.monitored,protector:"-",variables:oa(d.variables)};var e=a.getLinkByRel(d.links,"protector");g.isEmptyObject(e)||(d.clientData.protector=e.title);var f=a.getLinkByRel(d.links,"disk0");f&&(d.clientData.primaryDiskId=a.getIdInLinkByParameter(f,"disks"));var h=a.getLinkByRel(b.links,"layer");return g.isEmptyObject(h)||(d.clientData.layer={name:h.title}),d},ka=function(b){var c=b||{},d={},e="",f=a.getLinkByRel(c.links,"privatenetwork");g.isEmptyObject(f)||(d={name:f.title},e="private");var h=a.getLinkByRel(c.links,"externalnetwork");g.isEmptyObject(h)||(d={name:h.title},e="external");var i=a.getLinkByRel(c.links,"publicnetwork");g.isEmptyObject(i)||(d={name:i.title},e="public");var j=a.getLinkByRel(c.links,"unmanagednetwork");return g.isEmptyObject(j)||(d={name:j.title},e="unmanaged"),c.clientData={network:d,type:e,sequenceEdited:!1,sequence:c.sequence},c},la=function(a){var b=a,c=a.name.split("[");return b.clientData={type:f("translate")("virtualmachine.edit.chef.grid.label."+c[0]),name:c[1].replace("]",""),edited:!1,priority:b.priority},b},ma=function(a){var b=a;return b.clientData={name:f("translate")("virtualmachine.details.storage.type.harddisk"),tier:{},type:f("translate")("virtualmachine.details.storage.type.harddisk"),edited:!1,virtualDiskType:"HARDDISK",sizeInMb:b.sizeInMb,sequence:b.sequence,originalSize:b.sizeInMb},b},na=function(b){var c=b;c.clientData={original:!0,action:"original",nodes:[]};var d=a.getClientdataFromLinksByRel(b.links,"edit","loadbalancers");return c.id=d.id,c},oa=function(a){var b=[];return g.isEmptyObject(a)||$.each(a,function(a,c){var d={key:a,value:c};b.push(d)}),b},pa=function(b){var c=[],d={};return angular.forEach(b.links,function(b){"firewall"==b.rel&&(d=a.getClientdataFromLinksByRel([b],"firewall"),c.push(d))}),c},qa=function(a,b){i.showAlert({scope:e,message:f("translate")("virtualmachine.withouttemplate.undeploy.message"),title:f("translate")("virtualmachine.withouttemplate.undeploy.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:f("translate")("globals.cancel"),confirmLabel:f("translate")("globals.confirm"),confirmFn:function(){v(a,!0,b)},cancelFn:function(){}})},ra=[],sa=function(a){var b=!1;return angular.forEach(ha,function(c){a==c.label&&(b=!0)}),b},ta=function(a){var b=[];return angular.forEach(a,function(a){if(a.clientData&&a.clientData.selected){var c={name:a.name};b.push(c)}}),b};return angular.extend(fa,{HardDisk:ma,virtualMachines:ha,currentVirtualMachine:ga,states:ia,editVirtualMachine:l,editVirtualMachineFirewalls:m,getVirtualMachines:y,getVirtualMachine:A,setCurrentVirtualMachine:j,setVirtualMachineFromTemplate:E,createVirtualMachineFromTemplateForVapp:G,removeVirtualMachine:H,powerOnVirtualMachine:q,powerOffVirtualMachine:r,pauseVirtualMachine:s,resetVirtualMachine:t,deployVirtualMachine:u,undeployVirtualMachine:v,unblockVirtualMachine:x,blockVirtualMachine:w,getVirtualMachineNICS:I,getVirtualMachineVolumes:K,getVirtualMachineHardDisks:J,getVirtualMachineVirtualDisks:P,getVirtualMachineWithResources:Q,addNICToVirtualMachine:R,isRemotelyDefined:S,createInstance:k,getChefAttributes:L,getStartupScript:M,editChefAttributes:N,editStartupScript:O,importVirtualMachine:B,releaseVirtualMachine:C,getRemoteAccessConnectionString:D,getVirtualMachineNetworkConfiguration:n,ackError:T,getTemplateVirtualMachines:U,getVirtualMachinesByVirtualDatacenter:W,getVirtualMachineLoadBalancers:X,getTaskStatus:V,editVirtualMachineMonitoringMetrics:Y,editVirtualMachineMonitoringLevel:Z,editVirtualMachineMonitored:_}),fa}]),angular.module("volumesMgr",[]).factory("volumesMgr",["server","utils","$filter","dispatcher",function(a,b,c,d){function e(a){angular.copy(a,v),d.dispatch("currentVolume.change",{data:v})}function f(){if(!b.isEmptyObject(v)){var a=c("getElementById")(u,v.id);e(a)}}function g(b,c,d,e){u.length=0;var f=function(a){u.length=0,angular.forEach(a.collection,function(a){u.push(new x(a))}),void 0!==e&&e(a)},g={links:b.links,rel:"volumes",queryParam:{persistent:!1}};angular.extend(g.queryParam,c),angular.extend(g.queryParam,d),a.getByRel(g,f)}function h(b,c,d,e,g){c||(u.length=0);var h=function(a){u.length=0,angular.forEach(a.collection,function(a){u.push(new x(a))}),f(),void 0!==g&&g(a)},i={rel:"volumes",links:b.links,queryParam:{persistent:!1}};angular.extend(i.queryParam,d),angular.extend(i.queryParam,e),a.getByRel(i,h)}function i(b,c,d,e,g){c||(u.length=0);var h=function(a){u.length=0,angular.forEach(a.collection,function(a){var a=new x(a);u.push(a)}),f(),void 0!==g&&g(a)},i={rel:"volumes",links:b.links,queryParam:{persistent:!1}};angular.extend(i.queryParam,d),angular.extend(i.queryParam,e),a.getByRel(i,h)}function j(b,c,d,e,g){c||(u.length=0);var h=function(a){u.length=0,angular.forEach(a.collection,function(a){var a=new x(a);u.push(a)}),f(),void 0!==g&&g(a)},i={links:b.links,rel:"volumes",queryParam:{}};angular.extend(i.queryParam,d),angular.extend(i.queryParam,e),a.getByRel(i,h)}function k(e,f){var g=a.createLinkByRel(e.clientData.tier.links,"self","tier");e.links=[],e.links.push(g);var h=function(a){void 0!==f&&f(a),d.dispatch("volume.created",{volume:a}),b.toastrSuccess(c("translate")("action.create.success.volume.text",{vol:e.name}))},i={path:"cloud/virtualdatacenters/"+e.clientData.virtualDatacenter.id+"/volumes",type:"application/vnd.abiquo.volume+json"};a.post(i,e,h)}function l(e,f,g,h){var i=a.createLinkByRel(g.links,"edit","pool");e.links=[],e.links.push(i);var j=function(a){void 0!==h&&h(a),d.dispatch("volume.created",{volume:a}),b.toastrSuccess(c("translate")("action.create.success.volume.text",{vol:e.name}))},k={links:f.links,rel:"volumes",type:"application/vnd.abiquo.iscsivolume+json",contentType:"application/vnd.abiquo.iscsivolume+json"};a.postByRel(k,e,j)}function m(b,c,d){var e=function(a){void 0!==d&&(a.sequence=c.sequence,d(a))},f={links:b.links,rel:"disks",type:"application/vnd.abiquo.harddisk+json",contentType:"application/vnd.abiquo.harddisk+json"};a.postByRel(f,c,e)}function n(e,f){var g=function(a){void 0!==f&&f(a),d.dispatch("volume.edited",{volume:e}),b.toastrSuccess(c("translate")("action.edit.success.volume.text",{vol:e.name}))},h={rel:"edit",links:e.links,type:"application/vnd.abiquo.acceptedrequest+json"};a.putByRel(h,e,g)}function o(e,f){var g=function(a){void 0!==f&&f(a),d.dispatch("volume.deleted",{volume:e}),b.toastrSuccess(c("translate")("action.delete.success.volume.text",{vol:e.name}))},h={rel:"edit",links:e.links};a.removeByRel(h,g)}function p(d,e,f,g){var h=function(){void 0!==g&&g(),b.toastrSuccess(c("translate")("volume.moved.message",{vol:d.name,vdcSrc:f.name,vdcTar:e.name}))},i={path:"cloud/virtualdatacenters/"+f.id+"/volumes/"+d.id+"/action/move",type:"*/*",contentType:"application/vnd.abiquo.links+json"},j={links:[{href:a.getUrl("cloud/virtualdatacenters/"+e.id),rel:"virtualdatacenter"}]};a.post(i,j,h)}function q(b,c){var d=function(a){var b=[];angular.forEach(a.collection,function(a){var a=new x(a);b.push(a)}),void 0!==c&&c(b)},e={links:b.links,rel:"statefulcandidates"};a.getByRel(e,d)}function r(b,c){var d=function(a){b.clientData.initiatorMappings=a.collection,void 0!==c&&c()},e={links:b.links,rel:"initiatormappings"};a.getByRel(e,d)}var s={},t=function(){var a={};return a.name="NAME",a["clientData.virtualDatacenter.name"]="VIRTUALDATACENTER",a["clientData.virtualAppliance.name"]="VIRTUALAPPLIANCE",a["clientData.virtualMachine.name"]="VIRTUALMACHINE",a["clientData.tier.name"]="TIER",a.sizeInMB="TOTALSIZE",a.state="STATE",a},u=[],v={},w=t(),x=function(b){var d=b||{};return d.clientData={virtualDatacenter:a.getClientdataFromLinksByRel(d.links,"virtualdatacenter"),virtualAppliance:a.getClientdataFromLinksByRel(d.links,"virtualappliance"),virtualMachine:a.getClientdataFromLinksByRel(d.links,"virtualmachine"),tier:a.getClientdataFromLinksByRel(d.links,"tier"),sizeInMb:d.sizeInMB,temporalState:d.state,virtualDiskType:"VOLUME",sequence:d.sequence,type:c("translate")("virtualmachine.details.storage.type.volume"),isPersistent:"virtualmachinetemplates"==a.getServiceNameFromLinksByRel(d.links,"virtualmachinetemplate"),classType:"volume"},d};return angular.extend(s,{Volume:x,sortMapping:w,volumes:u,currentVolume:v,getVolumesByVdc:h,getAvailableVolumesByVdc:g,getVolumesByEnterprise:i,getVolumesByStoragePool:j,createVolume:k,createIscsiVolume:l,editVolume:n,deleteVolume:o,createHardDisk:m,moveVolumeToVirtualDatacenter:p,setCurrentVolume:e,getStatefulCandidatesByVdc:q,getVolumeInitiatorMappings:r}),s}]),angular.module("workflowMgr",["server"]).factory("workflowMgr",["server","utils",function(a,b){function c(b,c,d,e,f){c||(k.length=0);var g=function(b){k.length=0,angular.forEach(b.collection,function(b){var c={rel:"parent",links:b.links,type:"application/vnd.abiquo.virtualmachine+json"};a.getByRel(c,function(a){k.push(new i(b,a))})}),void 0!==f&&f(b)},h={rel:"pendingtasks",links:b.links,queryParam:{}};angular.extend(h.queryParam,d),angular.extend(h.queryParam,e),a.getByRel(h,g)}function d(a,b,d,e,f){c(a,b,d,e,f)}function e(a,b,d,e,f){c(a,b,d,e,f)}function f(b,c){var d=function(a){void 0!==c&&c(a)},e={rel:"continue",links:b.links,queryParam:{}},f={};a.postByRel(e,f,d)}function g(b,c){var d=function(a){void 0!==c&&c(a)},e={rel:"cancel",links:b.links,queryParam:{}},f={};a.postByRel(e,f,d)}var h={},i=function(b,c){var d=b;return d.clientData={enterprise:a.getClientdataFromLinksByRel(c.links,"enterprise"),user:a.getClientdataFromLinksByRel(c.links,"user"),virtualDatacenter:a.getClientdataFromLinksByRel(c.links,"virtualdatacenter"),virtualAppliance:a.getClientdataFromLinksByRel(c.links,"virtualappliance"),virtualMachine:c},d},j=function(){var a={};return a.type="TYPE",a.creationTimestamp="CREATIONTIMESTAMP",a},k=[],l=j();return angular.extend(h,{workflows:k,sortMapping:l,getWorkflowsByEnterprise:d,getWorkflowsByUser:e,approveWorkflow:f,rejectWorkflow:g}),h}]),angular.module("paginationHelper",[]).factory("paginationHelper",["systemPropertiesMgr",function(a){var b={maxSize:5,maxSizeMini:1,currentPage:1,limit:a.systemProperties.general["client.user.numberElementsPerPage"].value,startwith:0,totalSize:0},c={has:"",by:"",asc:!0},d=function(a){var d={};return angular.extend(b,a),d.param=angular.copy(b),d.filter=angular.copy(c),d.resetParam=function(){angular.copy(b,d.param)},d.resetFilter=function(){angular.copy(c,d.filter)},d},e=new d;e.param.limit=0;var f={noPagination:e,vdcPaginator:new d,vappPaginator:new d,vmtPaginator:new d,vmtRemotePaginator:new d,vmtPersistentPaginator:new d,dcPaginator:new d,volPaginator:new d,entPaginator:new d,ent2Paginator:new d,userPaginator:new d,ipPaginator:new d,ipPurchasePaginator:new d,wfPaginator:new d,pricingModelPaginator:new d,costCodePaginator:new d,curPaginator:new d,evPaginator:new d,ntwPaginator:new d,licensePaginator:new d,physicalMachinePaginator:new d,virtualMachinePaginator:new d,loadBalancerPaginator:new d,remoteServicesPaginator:new d,rolePaginator:new d,scopePaginator:new d};return f}]),angular.module("routeParamsHelper",[]).factory("routeParamsHelper",["$routeParams","$timeout",function(a,b){function c(){var b={};if(a)for(var c in a)b[c]={},b[c].value=a[c],b[c].isValid=!0;return b.hasValidKey=function(a){return b[a]&&b[a].isValid},b}function d(a,c,d,e){if(a&&c&&d){var f=a[c];f&&f.isValid&&b(function(){e&&(f.isValid=!1),d(f,a)},500)}else console.log("routeParamsHelper: Cannot do action (params, key, functionAction, invalidate) = ("+a+c+d+e+")")}var e={getParams:c,doAction:d};return e}]),angular.module("authorize",[]).controller("AuthorizeCtrl",["$scope","authenticationMgr","privilegesMgr","userMgr","systemPropertiesMgr","urlParametersUtils","server",function(a,b,c,d,e,f,g){a.__name="AuthorizeCtrl",a.privileges=c.privileges,a.privilegeGroups=c.privilegeGroups,a.rolePrivileges=d.user.clientData.privileges,a.oauth_token=f.getAuthorization(),a.action=g.getUrl("oauth/authorize");var h=function(b){b&&b.collection&&(a.application=b.collection[0])},i=function(){e.showMenu=!1,c.formatUserPrivilegesList(d.user.clientData.privileges),d.getApplications(a.oauth_token,h)};a.roleHasPrivilege=function(a,b){return c.roleHasPrivilege(a,b)},a.groupHasPrivileges=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&++b;return 0!=b&&1!=b},i()}]),angular.module("breadCrumb",[]).controller("BreadcrumbCtrl",["$scope","virtualDatacentersMgr","virtualAppliancesMgr","navigationMgr",function(a,b,c,d){a.__name="BreadCrumbCtrl",a.currentVirtualDatacenter=b.currentVirtualDatacenter,a.currentVirtualAppliance=c.currentVirtualAppliance,a.onClick=function(a){"root"==a?(b.setCurrentVirtualDatacenter(null),c.setCurrentVirtualAppliance(null),d.sectionView="virtualdatacenters"):"virtualdatacenter"==a&&(c.setCurrentVirtualAppliance(null),d.sectionView="virtualdatacenters")}}]),angular.module("configuration",["licenses"]).controller("ConfigurationCtrl",["$scope","systemPropertiesMgr","dispatcher",function(a,b,c){a.__name="ConfigurationCtrl",a.systemProperties=b.systemProperties,a.onTabClick=function(b){a.configTab=b},c.on("display.licenses",function(){a.configTab="licenses"},a)}]).controller("SystemPropertiesCtrl",["$scope","systemPropertiesMgr","networksMgr","refreshMgr","$filter","utils",function(a,b,c,d,e,f){a.__name="SystemPropertiesCtrl",a.systemPropertiesGroupView="",a.availableViews=[{index:"0",name:e("translate")("mainmenu.button.home")},{index:"1",name:e("translate")("mainmenu.button.infraestructure")},{index:"2",name:e("translate")("mainmenu.button.virtualdatacenters")},{index:"3",name:e("translate")("mainmenu.button.apps_library")},{index:"4",name:e("translate")("mainmenu.button.pricing")},{index:"5",name:e("translate")("mainmenu.button.events")}],a.netmasks=c.netmasks;var g=function(){d.setTimeIntervals(b.systemProperties),a.closePopup()};a.getNetmaskLabel=function(b){var c="",d=e("getElementByParameter")(a.netmasks,{element:parseInt(b),attribute:"index"});return f.isEmptyObject(d)||(c="/"+d.length+" ("+d.mask+")"),c},a.onShown=function(){a.systemProperties=angular.copy(b.systemProperties)},a.setCurrentSystemPropertiesGroup=function(b){a.systemPropertiesGroupView=b},a.updateMinAge=function(b){b>0&&a.systemProperties.password["client.main.passwordMinAge"].value>b&&(a.systemProperties.password["client.main.passwordMinAge"].value=b)},a.onSubmit=function(){var c=f.objectToArray(a.systemProperties.general),d=f.objectToArray(a.systemProperties.infrastructure),e=f.objectToArray(a.systemProperties.network),h=f.objectToArray(a.systemProperties.dashboard),i=f.objectToArray(a.systemProperties.wikiLinks),j=f.objectToArray(a.systemProperties.password),k={collection:c.concat(d,e,h,i,j)};b.editSystemProperties(k,g)}}]),angular.module("licenseCreate",[]).controller("LicenseCreateCtrl",["$scope","systemPropertiesMgr",function(a,b){a.__name="LicenseCreateCtrl";var c=function(b){a.closePopup()};a.onShown=function(){a.license={links:[]}},a.onSubmit=function(){b.addLicense(a.license,c)}}]),angular.module("licenses",["licenseCreate","licenseRequest"]).controller("LicensesCtrl",["$scope","systemPropertiesMgr","commonsMgr","dispatcher","utils","$filter",function(a,b,c,d,e,f){function g(a){a.selected&&b.setCurrentLicense(a.entity)}a.__name="LicensesCtrl",a.licenses=b.licenses,a.currentLicense=b.currentLicense,a.sortInfo={fields:[""],directions:["asc","desc"]};var h=function(){b.getLicenses()};a.onDeleteLicenseConfirm=function(){b.deleteLicense(b.currentLicense)},a.returnPluginNames=function(a){if(void 0==a)return f("translate")("globals.all");if(""==a)return f("translate")("configuration.license.label.nopluginsupported");var b="",d=a.split(",");return angular.forEach(d,function(a){var d=f("getElementByParameter")(c.hypervisorTypes,{element:a,attribute:"name"});e.isEmptyObject(d)||(b+=d.realName+",")}),b.substr(0,b.length-1)};var i='<div><label style="font-size: 12px">{{returnPluginNames(row.getProperty(col.field))}}</label></div>';a.gridLicenses={data:"licenses",columnDefs:[{field:"code.slice(0,30)",displayName:f("translate")("configuration.license.key")},{field:"enabledPlugins",displayName:f("translate")("configuration.license.enabledPlugins"),cellTemplate:i},{field:"numcores",displayName:f("translate")("configuration.license.availablecores")},{field:"expiration",displayName:f("translate")("configuration.license.expirationdate"),cellTemplate:'<div data-ng-class="{\'incomplete\':row.entity.clientData.expired}"><label style="font-size: 12px">{{row.getProperty(col.field) | timestampToString:true}}</label></div>'
}],useExternalSorting:!0,afterSelectionChange:g},d.on(["licenses.created","licenses.deleted"],h,a),h()}]),angular.module("licenseRequest",[]).controller("LicenseRequestCtrl",["$scope","systemPropertiesMgr","enterprisesMgr",function(a,b,c){a.__name="LicenseCreateCtrl";var d=b.systemProperties,e=function(b){a.closePopup()};a.onShown=function(){a.license={company:c.userEnterprise.name}},a.onSubmit=function(){b.requestLicense(d.dashboard["client.dashboard.licenseUrl"].value,a.license,e)}}]),angular.module("dashboard",["widgets"]).controller("DashboardCtrl",["$scope","$filter","enterprisesMgr",function(a,b,c){a.__name="DashboardCtrl",a.currentEnterprise=c.currentEnterprise;var d=function(){c.setCurrentEnterprise(c.userEnterprise)};d()}]).controller("DashboardEnterprisesListCtrl",["$scope","enterprisesMgr","userMgr","usersMgr","paginationHelper","$filter","server",function(a,b,c,d,e,f,g){function h(){f("isGranted")("ENTERPRISE_ENUMERATE")&&b.getEnterprises(e.entPaginator.param,e.entPaginator.filter,i)}function i(a){e.entPaginator.param.totalSize=a.totalSize}a.__name="DashboardEnterprisesListCtrl",a.enterprises=b.enterprises,a.userEnterprise=b.userEnterprise,a.currentEnterprise=b.currentEnterprise,a.enterpriseFilter=e.entPaginator.filter,a.enterprisePaginationParam=e.entPaginator.param,a.$watch("enterprises.length",function(){a.enterprises.length>0&&(a.enterpriseId=a.enterprises[0].id)}),a.getPage=function(a){e.entPaginator.param.startwith=(a-1)*e.entPaginator.param.limit,h()},a.onEnterpriseFilterSubmit=function(){e.entPaginator.resetParam(),a.getPage(e.entPaginator.param.currentPage)},a.onEnterpriseClick=function(a){b.setCurrentEnterprise(a)},a.onUserEnterpriseClick=function(a){var e=function(){b.setUserEnterprise(a)},f=angular.copy(c.user),h=g.createLinkByRel(a.links,"edit","enterprise");g.setLinkByRel(f.links,"enterprise",h),d.impersonateUser(f,e)},h()}]),angular.module("widgets",[]).controller("EnterpriseResourcesStatisticsCtrl",["$scope","dispatcher","virtualDatacentersMgr","statisticsMgr","enterprisesMgr","configMgr","$filter","utils","$timeout",function(a,b,c,d,e,f,g,h,i){function j(){a.filterByOptions=[],h.emptyObject(a.virtualDatacenter),g("isGranted")("ENTERPRISE_RESOURCE_SUMMARY_ENT")&&(a.filterByOptions.push({value:"enterprise",name:g("translate")("dashboard.enterpriseresources.filterby.enterprise")}),d.getEnterpriseResources(e.currentEnterprise)),a.filterByOptions.push({value:"virtualdatacenter",name:g("translate")("dashboard.enterpriseresources.filterby.virtualdatacenter")}),a.filterBy.value=a.filterByOptions[0].value}a.__name="EnterpriseResourcesStatisticsCtrl",a.filterBy={},a.virtualDatacenters=d.virtualDatacenters,a.options={minimumResultsForSearch:-1},a.colors=["#444444","#bd362f ","#75993E"],a.filterByOptions=[],a.virtualDatacenter={},a.chartsEnabled=1==f.config["client.google.charts.enabled"];var k=function(){g("isGranted")("ENTERPRISE_RESOURCE_SUMMARY_ENT")||a.virtualDatacenters.length>0&&i(function(){a.virtualDatacenter.id=a.virtualDatacenters[0].id,l()})},l=function(){if("virtualdatacenter"==a.filterBy.value){var b=g("getElementByParameter")(a.virtualDatacenters,{element:parseInt(a.virtualDatacenter.id),attribute:"id"});d.setVDCResources(b)}h.refreshLayout()};a.onFilterByChange=function(){"enterprise"==a.filterBy.value?d.getEnterpriseResources(e.currentEnterprise):"virtualdatacenter"==a.filterBy.value&&l()},a.onVirtualDatacenterChange=function(){l()};var m;a.$watch(function(){return window.innerWidth.toString()+window.innerHeight.toString()},function(a){clearTimeout(m),m=setTimeout(d.refreshEnterpriseResources,150)}),b.on("currentEnterprise.change",j,a),b.on("statistics.virtualDatacenter.retrieved",k,a),j()}]).controller("RunningVirtualAppliancesStatisticsCtrl",["$scope","$filter","$location","dispatcher","statisticsMgr","enterprisesMgr",function(a,b,c,d,e,f){function g(){e.getVirtualAppliances(f.currentEnterprise)}a.__name="RunningVirtualAppliancesStatisticsCtrl",a.runningVirtualAppliances=e.virtualAppliances,a.goToVApp=function(a){c.path("/virtualdatacenters/").search("vdc",a.idVirtualDataCenter).search("vapp",a.id)},a.runningVirtualAppliancesGridOptions={data:"runningVirtualAppliances",rowTemplate:'<div data-u-double-click="goToVApp(row.entity)" ng-style="{\'cursor\': row.cursor, \'z-index\': col.zIndex() }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}" ng-cell></div>',columnDefs:[{field:"vappName",displayName:b("translate")("dashboard.virtualappliances.column.title.name"),sortable:!1},{field:"vdcName",displayName:b("translate")("dashboard.virtualappliances.column.title.virtualdatacenter.name"),sortable:!1},{field:"vmCreated",displayName:b("translate")("dashboard.virtualappliances.column.title.virtualmachines.created"),sortable:!1},{field:"vmActive",displayName:b("translate")("dashboard.virtualappliances.column.title.virtualmachines.active"),sortable:!1},{field:"volAttached",displayName:b("translate")("dashboard.virtualappliances.column.title.volumes.attached"),sortable:!1}],multiSelect:!1},d.on("currentEnterprise.change",g,a),g()}]).controller("VirtualDatacentersStatisticsCtrl",["$scope","$filter","$location","dispatcher","statisticsMgr","enterprisesMgr","virtualDatacentersMgr",function(a,b,c,d,e,f,g){function h(){e.getVirtualDatacenters(f.currentEnterprise)}a.__name="VirtualDatacentersStatisticsCtrl",a.virtualDatacenters=e.virtualDatacenters,a.goToVDC=function(a){c.path("/virtualdatacenters/").search("vdc",a.id)},a.virtualDatacentersGridOptions={data:"virtualDatacenters",rowTemplate:'<div data-u-double-click="goToVDC(row.entity)" ng-style="{\'cursor\': row.cursor, \'z-index\': col.zIndex() }" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" class="ngCell {{col.cellClass}}" ng-cell></div>',columnDefs:[{field:"vdcName",displayName:b("translate")("dashboard.virtualdatacenters.column.title.name"),sortable:!1},{field:"vmCreated",displayName:b("translate")("dashboard.virtualdatacenters.column.title.virtualmachines.created"),sortable:!1},{field:"vmActive",displayName:b("translate")("dashboard.virtualdatacenters.column.title.virtualmachines.active"),sortable:!1},{field:"volCreated",displayName:b("translate")("dashboard.virtualdatacenters.column.title.volumes.created"),sortable:!1},{field:"volAttached",displayName:b("translate")("dashboard.virtualdatacenters.column.title.volumes.attached"),sortable:!1}],multiSelect:!1},d.on("currentEnterprise.change",h,a),h()}]).controller("EventsStatisticsCtrl",["$scope","$filter","eventsMgr","enterprisesMgr","gridTemplates","dispatcher","uModals",function(a,b,c,d,e,f,g){function h(){if(d.currentEnterprise.name){var a={enterprise:d.currentEnterprise.name};c.getEvents(null,{},a)}else c.events.length=0}function i(){var a=this;a.$scope=null,a.myGrid=null,a.init=function(b,c,d){a.$scope=b,a.myGrid=c,a.assignEvents()},a.assignEvents=function(){a.myGrid.$viewport.on("dblclick",a.onDoubleClick)},a.onDoubleClick=function(b){a.myGrid.config.dblClickFn(a.$scope.selectedItems[0])}}a.__name="EventsStatisticsCtrl",a.events=c.events;var j=new i;a.onEventDoubleClick=function(d){c.setCurrentEvent(d),g.showPopUp({scope:a,controller:"EventDetailsCtrl",popupUrl:"modules/events/details/partials/eventdetailsform.html",formName:"eventDetailsForm",title:b("translate")("event.details.title"),cancelLabel:b("translate")("globals.close"),showAcceptBtn:!1,showCancelBtn:!0})},a.eventsGridOptions={data:"events",columnDefs:[{field:"clientData.source",displayName:b("translate")("events.list.input.source")},{field:"timestamp",displayName:b("translate")("events.list.input.datetime"),cellFilter:"timestampToString:true"},{field:"actionPerformed",displayName:b("translate")("events.list.input.action"),sortable:!1},{field:"performedBy",displayName:b("translate")("events.list.input.performedby")},{field:"severity",displayName:b("translate")("events.list.input.severity"),cellTemplate:e.severityCellTemplate}],dblClickFn:a.onEventDoubleClick,plugins:[j],multiSelect:!1},f.on("currentEnterprise.change",h,a),h()}]),angular.module("enterpriseCreate",[]).controller("EnterpriseCreateCtrl",["$scope","$filter","datacentersMgr","enterprisesMgr","configMgr","commonsMgr","server","utils",function(a,b,c,d,e,f,g,h){a.__name="EnterpriseCreateCtrl",a.editMode=!1,a.themes=e.config["client.themes"],a.datacenters=c.datacenters,a.publicCredentials={clientData:{}};var i=function(){a.closePopup(a.popupElement)},j=function(){angular.forEach(a.datacenters,function(a){if(a.clientData.isPublicDatacenter){var c=b("getElementByParameter")(f.publicProviders,{element:a.clientData.provider.id,attribute:"name"});if(c.constraints&&"MANDATORY"==c.constraints.endpoint){var d=angular.copy(c);d.clientData.existingPcr=!0,d.realName+=" ("+a.name+")",d.links.push(g.createLinkByRel(a.links,"edit","publiccloudregion")),f.publicProviders.push(d)}}})};a.initPublicCredentials=function(){a.publicCredentials.access="",a.publicCredentials.key="",a.publicCredentials.clientData.providerName=""},a.onShown=function(){a.initPublicCredentials(),a.popupElement=a.getPopupElement(),a.enterprise={links:[],clientData:{publicCredentials:[]},isReservationRestricted:!1},a.chefEnabled=!1,a.pricingModel={id:0},a.enterprise.chefURL="",a.enterprise.chefValidator="",a.enterprise.chefValidatorCertificate="",a.enterprise.chefClient="",a.enterprise.chefClientCertificate="",a.allowedLimits=[],a.reservedServers=[],a.unitsSelector=h.unitsSelector,a.allocationLimits={ramSoftLimitInMb:0,ramHardLimitInMb:0,ramUnits:angular.copy(h.unitsSelector[0]),cpuCountSoftLimit:0,cpuCountHardLimit:0,diskSoftLimitInMb:0,diskHardLimitInMb:0,hdUnits:angular.copy(h.unitsSelector[1]),storageSoftInMb:0,storageHardInMb:0,storageUnits:angular.copy(h.unitsSelector[1]),vlansSoft:0,vlansHard:0,publicIpsSoft:0,publicIpsHard:0,repositorySoftInMb:0,repositoryHardInMb:0,repositoryUnits:angular.copy(h.unitsSelector[1])};var b={limit:0};c.getDatacenters(b,{},j)},a.onSubmit=function(){a.enterprise.ramSoftLimitInMb=a.allocationLimits.ramSoftLimitInMb*a.allocationLimits.ramUnits.conversion,a.enterprise.ramHardLimitInMb=a.allocationLimits.ramHardLimitInMb*a.allocationLimits.ramUnits.conversion,a.enterprise.cpuCountSoftLimit=a.allocationLimits.cpuCountSoftLimit,a.enterprise.cpuCountHardLimit=a.allocationLimits.cpuCountHardLimit,a.enterprise.diskSoftLimitInMb=a.allocationLimits.diskSoftLimitInMb*a.allocationLimits.hdUnits.conversion,a.enterprise.diskHardLimitInMb=a.allocationLimits.diskHardLimitInMb*a.allocationLimits.hdUnits.conversion,a.enterprise.storageSoftInMb=a.allocationLimits.storageSoftInMb*a.allocationLimits.storageUnits.conversion,a.enterprise.storageHardInMb=a.allocationLimits.storageHardInMb*a.allocationLimits.storageUnits.conversion,a.enterprise.vlansSoft=a.allocationLimits.vlansSoft,a.enterprise.vlansHard=a.allocationLimits.vlansHard,a.enterprise.publicIpsSoft=a.allocationLimits.publicIpsSoft,a.enterprise.publicIpsHard=a.allocationLimits.publicIpsHard,a.enterprise.repositorySoftInMb=a.allocationLimits.repositorySoftInMb*a.allocationLimits.repositoryUnits.conversion,a.enterprise.repositoryHardInMb=a.allocationLimits.repositoryHardInMb*a.allocationLimits.repositoryUnits.conversion,a.chefEnabled||(delete a.enterprise.chefURL,delete a.enterprise.chefValidator,delete a.enterprise.chefValidatorCertificate,delete a.enterprise.chefClient,delete a.enterprise.chefClientCertificate),d.createEnterprise(a.enterprise,a.allowedLimits,a.reservedServers,a.pricingModel,i)}}]).controller("EnterpriseGeneralInfoCtrl",["$scope",function(a){a.__name="EnterpriseGeneralInfoCtrl"}]).controller("EnterpriseAllocationLimitsCtrl",["$scope","utils",function(a,b){a.__name="EnterpriseAllocationLimitsCtrl",a.getLabelByConversion=function(a){for(var c=0;c<b.unitsSelector.length;c++)if(b.unitsSelector[c].conversion==a)return b.unitsSelector[c].label}}]).controller("EnterpriseDatacentersCtrl",["$scope","datacentersMgr","systemPropertiesMgr","safeApply","utils",function(a,b,c,d,e){a.__name="EnterpriseDatacentersCtrl",a.datacenters=b.datacenters,a.currentAllowedLimit={},a.systemProperties=c.systemProperties,a.onAllowedLimitClick=function(b){angular.copy(b,a.currentAllowedLimit)},a.dropDatacenterOnProhibitedListener=function(b){if(void 0!==b.data("$scope").allowedLimit){var c=a.allowedLimits.indexOf(b.data("$scope").allowedLimit);a.allowedLimits.splice(c,1),e.emptyObject(a.currentAllowedLimit),d(a)}},a.dropDatacenterOnProhibitedAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").allowedLimit};var f=function(b){a.allowedLimits.push(b),d(a)};a.dropDatacenterOnAllowedListener=function(a){void 0!==a.data("$scope").prohibitedDatacenter&&b.createClientLimitByDatacenter(a.data("$scope").prohibitedDatacenter,f)},a.dropDatacenterOnAllowedAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").prohibitedDatacenter}}]).controller("EnterpriseDatacenterEditCtrl",["$scope","tiersMgr","datacentersMgr","networksMgr","safeApply","utils","configMgr","server","$filter",function(a,b,c,d,e,f,g,h,i){a.__name="EnterpriseDatacenterEditCtrl",a.tiers=b.tiers,a.vlans=d.networks,a.unitsSelector=f.unitsSelector,a.getLabelByConversion=function(a){for(var b=0;b<f.unitsSelector.length;b++)if(f.unitsSelector[b].conversion==a)return f.unitsSelector[b].label};a.onShown=function(){a.currentEditAllowedLimit=angular.copy(a.currentAllowedLimit),a.allowedTiers=a.currentEditAllowedLimit.clientData.tiers,a.currentVlan=a.currentEditAllowedLimit.clientData.defaultVlan;var c=f.formatAllocationElements(a.currentEditAllowedLimit);a.allocationLimits={ramSoftLimitInMb:c.ramSoftLimit,ramHardLimitInMb:c.ramHardLimit,ramUnits:c.ramUnits,cpuCountSoftLimit:a.currentEditAllowedLimit.cpuCountSoftLimit,cpuCountHardLimit:a.currentEditAllowedLimit.cpuCountHardLimit,diskSoftLimitInMb:c.hdSoftLimit,diskHardLimitInMb:c.hdHardLimit,hdUnits:c.hdUnits,storageSoftInMb:c.storageSoftLimit,storageHardInMb:c.storageHardLimit,storageUnits:c.storageUnits,vlansSoft:a.currentEditAllowedLimit.vlansSoft,vlansHard:a.currentEditAllowedLimit.vlansHard,publicIpsSoft:a.currentEditAllowedLimit.publicIpsSoft,publicIpsHard:a.currentEditAllowedLimit.publicIpsHard,repositorySoftInMb:c.repositorySoftLimit,repositoryHardInMb:c.repositoryHardLimit,repositoryUnits:c.repositoryUnits,inPublic:a.currentEditAllowedLimit.inPublic},a.currentAllowedLimit.clientData.datacenter.isPublicDatacenter||(b.getTiersByDatacenter(a.currentEditAllowedLimit.clientData.datacenter),d.getVlansByLimit(a.currentEditAllowedLimit))},a.onDefaultVlanClick=function(){angular.copy(null,a.currentVlan)},a.onVlanClick=function(b){angular.copy(b,a.currentVlan)},a.onAllowedTierClick=function(b){angular.copy(b,a.currentAllowedTier)},a.dropTierOnProhibitedListener=function(b){if(void 0!==b.data("$scope").allowedTier){var c=a.allowedTiers.indexOf(b.data("$scope").allowedTier);a.allowedTiers.splice(c,1),e(a)}},a.dropTierOnProhibitedAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").allowedTier},a.dropTierOnAllowedListener=function(b){void 0!==b.data("$scope").prohibitedTier&&(a.allowedTiers.push(b.data("$scope").prohibitedTier),e(a))},a.dropTierOnAllowedAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").prohibitedTier},a.onSubmit=function(){a.currentEditAllowedLimit.ramSoftLimitInMb=a.allocationLimits.ramSoftLimitInMb*a.allocationLimits.ramUnits.conversion,a.currentEditAllowedLimit.ramHardLimitInMb=a.allocationLimits.ramHardLimitInMb*a.allocationLimits.ramUnits.conversion,a.currentEditAllowedLimit.cpuCountSoftLimit=a.allocationLimits.cpuCountSoftLimit,a.currentEditAllowedLimit.cpuCountHardLimit=a.allocationLimits.cpuCountHardLimit,a.currentEditAllowedLimit.diskSoftLimitInMb=a.allocationLimits.diskSoftLimitInMb*a.allocationLimits.hdUnits.conversion,a.currentEditAllowedLimit.diskHardLimitInMb=a.allocationLimits.diskHardLimitInMb*a.allocationLimits.hdUnits.conversion,a.currentEditAllowedLimit.storageSoftInMb=a.allocationLimits.storageSoftInMb*a.allocationLimits.storageUnits.conversion,a.currentEditAllowedLimit.storageHardInMb=a.allocationLimits.storageHardInMb*a.allocationLimits.storageUnits.conversion,a.currentEditAllowedLimit.vlansSoft=a.allocationLimits.vlansSoft,a.currentEditAllowedLimit.vlansHard=a.allocationLimits.vlansHard,a.currentEditAllowedLimit.publicIpsSoft=a.allocationLimits.publicIpsSoft,a.currentEditAllowedLimit.publicIpsHard=a.allocationLimits.publicIpsHard,a.currentEditAllowedLimit.repositorySoftInMb=a.allocationLimits.repositorySoftInMb*a.allocationLimits.repositoryUnits.conversion,a.currentEditAllowedLimit.repositoryHardInMb=a.allocationLimits.repositoryHardInMb*a.allocationLimits.repositoryUnits.conversion;for(var b=0;b<a.currentEditAllowedLimit.links.length;b++){var d=a.currentEditAllowedLimit.links[b];"tier"==d.rel?(a.currentEditAllowedLimit.links.splice(b,1),b--):"default"==d.rel&&(f.isEmptyObject(a.currentVlan)||a.currentVlan.links)&&(a.currentEditAllowedLimit.links.splice(b,1),b--)}if(angular.forEach(a.currentEditAllowedLimit.clientData.tiers,function(b){var c=i("getElementByParameter")(a.tiers,{element:b.id,attribute:"id"}),d=h.createLinkByRel(c.links,"edit","tier");a.currentEditAllowedLimit.links.push(d)}),a.enterprise.id>0&&a.currentEditAllowedLimit.id>0)if(f.isEmptyObject(a.currentVlan)){var e=h.createLinkByRel(a.currentEditAllowedLimit.links,"externalnetworks","default");a.currentEditAllowedLimit.links.push(e)}else if(a.currentVlan.links){var g=h.createLinkByRel(a.currentVlan.links,"edit","default");a.currentEditAllowedLimit.links.push(g)}var j=function(b){angular.forEach(a.allowedLimits,function(c,d){return c.clientData.datacenter.id==b.clientData.datacenter.id?(a.allowedLimits[d]=b,void angular.extend(a.currentAllowedLimit,b)):void 0}),a.closePopup()},k=function(a){j(a)};a.enterprise.id>0&&a.currentEditAllowedLimit.id>0?c.editDatacenterLimit(a.currentEditAllowedLimit,k):j(a.currentEditAllowedLimit)}}]).controller("EnterpriseReservationsCtrl",["$scope","datacentersMgr","serversMgr","$filter","safeApply","utils",function(a,b,c,d,e,f){a.__name="EnterpriseReservationsCtrl",a.datacenters=b.datacenters,a.currentDatacenter={},a.racks=c.racks,a.currentRack={};var g=function(){c.racks.length=0},h=function(b){var e=d("getElementByParameter")(a.datacenters,{element:b,attribute:"id"});c.getRacks(e,null,null)},i=function(a){f.isEmptyObject(a)||c.getPhysicalMachines(a)};a.onDatacenterChange=function(a){a=parseInt(a),a>0&&h(a)},a.onServerChange=function(b){if(b=parseInt(b),b>0){var c=d("getElementByParameter")(a.racks,{element:b,attribute:"id"});i(c),angular.extend(a.currentRack,c)}},a.dropServerOnAvailableListener=function(b){if(void 0!==b.data("$scope").reservedServer){var c=a.reservedServers.indexOf(b.data("$scope").reservedServer);a.reservedServers.splice(c,1),e(a)}},a.dropServerOnAvailableAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").reservedServer},a.dropServerOnReservedListener=function(b){void 0!==b.data("$scope").availableServer&&(a.reservedServers.push(b.data("$scope").availableServer),e(a))},a.dropServerOnReservedAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").availableServer},g()}]).controller("EnterprisePublicCredentialsCtrl",["$scope","commonsMgr","enterprisesMgr","$filter","utils",function(a,b,c,d,e){function f(b){var c=d("getElementByParameter")(a.publicProviders,{element:b,attribute:"name"});return c}function g(b){var c=angular.copy(a.publicCredentials);a.enterprise.clientData.publicCredentials.push(c),a.initPublicCredentials()}function h(b){var c=d("getElementByParameter")(a.enterprise.clientData.publicCredentials,{element:b.clientData.providerName,attribute:"clientData.providerName"}),e=a.enterprise.clientData.publicCredentials.indexOf(c);a.enterprise.clientData.publicCredentials.splice(e,1)}a.__name="EnterprisePublicCredentialsCtrl",a.publicProviders=b.publicProviders,a.getProviderRealName=function(a){var b="",c=f(a);return e.isEmptyObject(c)||(b=c.realName),b},a.onTestAccountClick=function(){var b=f(a.publicCredentials.clientData.providerName);c.testPublicAccount(b,a.publicCredentials,g)},a.onReleaseAccountClick=function(a){h(a)},b.getPublicProviders()}]).controller("EnterpriseChefCtrl",["$scope",function(a){a.__name="EnterpriseChefCtrl"}]).controller("EnterprisePricingModelEditCtrl",["$scope","pricingMgr","costCodesMgr","currenciesMgr","utils","$filter",function(a,b,c,d,e,f){a.__name="EnterprisePricingModelEditCtrl",a.viewMode=!0,a.pricingModels=b.pricingModels,a.selectedCurrency={},a.periods=b.periods,a.currencies=d.currencies,a.currencyExPattern=e.regExPattern.currencyExPattern,a.variables=["%CHARGEPERIOD%","%MINCHARGE_FORMATTED%","%MINPERIOD%","%CHARGE_FORMATTED%"];var g=function(){f("isGranted")("PRICING_VIEW")&&(h(),i())},h=function(){b.getPricingModels(!0)},i=function(){d.getCurrencies()};a.onPricingModelChange=function(d){if(d=parseInt(d),0!==d){var g=f("getElementByParameter")(a.pricingModels,{element:d,attribute:"id"});angular.extend(a.pricingModel,g),a.selectedCurrency.id=g.clientData.currency.id,c.getPricingCostCodes(a.pricingModel.id,a.pricingModel.clientData.currency.id),b.getPricingTiers(a.pricingModel.id)}else e.emptyObject(a.pricingModel),a.selectedCurrency.id=0};var j='<div class="ngCellText" ng-class="col.colIndex()"><span ng-cell-text>{{ row.entity.clientData.originalPrice}} {{ pricingModel.clientData.currency.symbol }}</span></div>';a.gridImagePrices={data:"pricingModel.clientData.costCodes",columnDefs:[{field:"clientData.costCode.name",displayName:f("translate")("pricingmodel.create.imageprices.col.name")},{field:"clientData.costCode.description",displayName:f("translate")("pricingmodel.create.imageprices.col.description")},{field:"clientData.originalPrice",displayName:f("translate")("pricingmodel.create.imageprices.col.currentprice"),cellTemplate:j},{field:"price",displayName:f("translate")("pricingmodel.create.imageprices.col.newprice")}]},a.gridTieredStorage={data:"pricingModel.clientData.tiers",columnDefs:[{field:"clientData.datacenter.name",displayName:f("translate")("pricingmodel.create.tieredstorage.col.datacenter")},{field:"clientData.tier.name",displayName:f("translate")("pricingmodel.create.tieredstorage.col.tier")},{field:"clientData.originalPrice",displayName:f("translate")("pricingmodel.create.tieredstorage.col.currentprice"),cellTemplate:j},{field:"price",displayName:f("translate")("pricingmodel.create.tieredstorage.col.newprice")}],filterOptions:{filterText:"",useExternalFilter:!1}},g()}]),angular.module("enterpriseEdit",[]).controller("EnterpriseEditCtrl",["$scope","datacentersMgr","enterprisesMgr","serversMgr","commonsMgr","configMgr","utils","server","$filter",function(a,b,c,d,e,f,g,h,i){function j(){a.enterprise=angular.copy(c.currentEnterprise),a.popupElement=a.getPopupElement(),a.unitsSelector=g.unitsSelector;var d=g.formatAllocationElements(a.enterprise);a.allocationLimits||(a.allocationLimits={}),a.allocationLimits.ramSoftLimitInMb=d.ramSoftLimit,a.allocationLimits.ramHardLimitInMb=d.ramHardLimit,a.allocationLimits.ramUnits=d.ramUnits,a.allocationLimits.cpuCountSoftLimit=a.enterprise.cpuCountSoftLimit,a.allocationLimits.cpuCountHardLimit=a.enterprise.cpuCountHardLimit,a.allocationLimits.diskSoftLimitInMb=d.hdSoftLimit,a.allocationLimits.diskHardLimitInMb=d.hdHardLimit,a.allocationLimits.hdUnits=d.hdUnits,a.allocationLimits.storageSoftInMb=d.storageSoftLimit,a.allocationLimits.storageHardInMb=d.storageHardLimit,a.allocationLimits.storageUnits=d.storageUnits,a.allocationLimits.vlansSoft=a.enterprise.vlansSoft,a.allocationLimits.vlansHard=a.enterprise.vlansHard,a.allocationLimits.publicIpsSoft=a.enterprise.publicIpsSoft,a.allocationLimits.publicIpsHard=a.enterprise.publicIpsHard,a.allocationLimits.repositorySoftInMb=d.repositorySoftLimit,a.allocationLimits.repositoryHardInMb=d.repositoryHardLimit,a.allocationLimits.repositoryUnits=d.repositoryUnits,a.allocationLimits.inPublic=a.enterprise.inPublic;var e={limit:30};b.getDatacenters(e),b.getAllowedLimitsByEnterprise(c.currentEnterprise,null,null,m),k(),c.getEnterpriseCredentials(a.enterprise,o),a.enterprise.idPricingTemplate>0&&(a.pricingModel.id=a.enterprise.idPricingTemplate)}function k(){i("isGranted")("USERS_MANAGE_RESERVED_MACHINES")&&d.getReservedMachinesByEnterprise(c.currentEnterprise,null,null,n)}a.__name="EnterpriseEditCtrl",a.enterprise={},a.pricingModel={},a.editMode=!0,a.themes=f.config["client.themes"],a.datacenters=b.datacenters,a.publicCredentials={clientData:{}};var l=function(){a.closePopup(a.popupElement)},m=function(){a.allowedLimits=angular.copy(b.allowedLimits)},n=function(){a.reservedServers=angular.copy(d.reservedServers)},o=function(){e.getPublicProviders(p)},p=function(){angular.forEach(a.datacenters,function(a){if(a.clientData.isPublicDatacenter){var b=i("getElementByParameter")(e.publicProviders,{element:a.clientData.provider.id,attribute:"name"});if(b.constraints&&"MANDATORY"==b.constraints.endpoint){var c=angular.copy(b);c.clientData.existingPcr=!0,c.realName+=" ("+a.name+")",c.links.push(h.createLinkByRel(a.links,"edit","publiccloudregion")),e.publicProviders.push(c)}}})};a.onShown=function(){a.initPublicCredentials(),c.getEnterpriseDetails(c.currentEnterprise,j),a.pricingModel={id:0}},a.initPublicCredentials=function(){a.publicCredentials.access="",a.publicCredentials.key="",a.publicCredentials.clientData.providerName=""},a.onSubmit=function(){a.enterprise.ramSoftLimitInMb=a.allocationLimits.ramSoftLimitInMb*a.allocationLimits.ramUnits.conversion,a.enterprise.ramHardLimitInMb=a.allocationLimits.ramHardLimitInMb*a.allocationLimits.ramUnits.conversion,a.enterprise.cpuCountSoftLimit=a.allocationLimits.cpuCountSoftLimit,a.enterprise.cpuCountHardLimit=a.allocationLimits.cpuCountHardLimit,a.enterprise.diskSoftLimitInMb=a.allocationLimits.diskSoftLimitInMb*a.allocationLimits.hdUnits.conversion,a.enterprise.diskHardLimitInMb=a.allocationLimits.diskHardLimitInMb*a.allocationLimits.hdUnits.conversion,a.enterprise.storageSoftInMb=a.allocationLimits.storageSoftInMb*a.allocationLimits.storageUnits.conversion,a.enterprise.storageHardInMb=a.allocationLimits.storageHardInMb*a.allocationLimits.storageUnits.conversion,a.enterprise.vlansSoft=a.allocationLimits.vlansSoft,a.enterprise.vlansHard=a.allocationLimits.vlansHard,a.enterprise.publicIpsSoft=a.allocationLimits.publicIpsSoft,a.enterprise.publicIpsHard=a.allocationLimits.publicIpsHard,a.enterprise.repositorySoftInMb=a.allocationLimits.repositorySoftInMb*a.allocationLimits.repositoryUnits.conversion,a.enterprise.repositoryHardInMb=a.allocationLimits.repositoryHardInMb*a.allocationLimits.repositoryUnits.conversion,a.enterprise.clientData.chefEnabled||(delete a.enterprise.chefURL,delete a.enterprise.chefValidator,delete a.enterprise.chefValidatorCertificate,delete a.enterprise.chefClient,delete a.enterprise.chefClientCertificate);var e=[],f=[];angular.forEach(b.allowedLimits,function(b){g.isEmptyObject(i("getElementByParameter")(a.allowedLimits,{element:parseInt(b.id),attribute:"id"}))&&f.push(b)}),angular.forEach(a.allowedLimits,function(a){g.isEmptyObject(i("getElementByParameter")(b.allowedLimits,{element:parseInt(a.id),attribute:"id"}))&&e.push(a)});var h=[],j=[];angular.forEach(d.reservedServers,function(b){g.isEmptyObject(i("getElementByParameter")(a.reservedServers,{element:parseInt(b.id),attribute:"id"}))&&j.push(b)}),angular.forEach(a.reservedServers,function(a){g.isEmptyObject(i("getElementByParameter")(d.reservedServers,{element:parseInt(a.id),attribute:"id"}))&&h.push(a)}),c.editEnterprise(a.enterprise,e,f,h,j,a.pricingModel,l)}}]).controller("EnterpriseEditAllocationLimitsCtrl",["$scope","utils",function(a,b){a.__name="EnterpriseAllocationLimitsCtrl",a.getLabelByConversion=function(a){for(var c=0;c<b.unitsSelector.length;c++)if(b.unitsSelector[c].conversion==a)return b.unitsSelector[c].label}}]).controller("EnterpriseEditDatacentersCtrl",["$scope","datacentersMgr","enterprisesMgr","systemPropertiesMgr","safeApply","utils",function(a,b,c,d,e,f){a.__name="EnterpriseDatacentersCtrl",a.datacenters=b.datacenters,a.currentAllowedLimit={},a.systemProperties=d.systemProperties,a.onAllowedLimitClick=function(b){angular.copy(b,a.currentAllowedLimit)},a.dropDatacenterOnProhibitedListener=function(b){if(void 0!==b.data("$scope").allowedLimit){var c=a.allowedLimits.indexOf(b.data("$scope").allowedLimit);a.allowedLimits.splice(c,1),f.emptyObject(a.currentAllowedLimit),e(a)}},a.dropDatacenterOnProhibitedAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").allowedLimit};var g=function(b){a.allowedLimits.push(b),e(a)};a.dropDatacenterOnAllowedListener=function(a){void 0!==a.data("$scope").prohibitedDatacenter&&b.createClientLimitByDatacenter(a.data("$scope").prohibitedDatacenter,g)},a.dropDatacenterOnAllowedAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").prohibitedDatacenter}}]).controller("EnterpriseEditReservationsCtrl",["$scope","datacentersMgr","serversMgr","$filter","safeApply","utils",function(a,b,c,d,e,f){a.__name="EnterpriseReservationsCtrl",a.datacenters=b.datacenters,a.currentDatacenter={},a.racks=c.racks,a.currentRack={};var g=function(b){var e=d("getElementByParameter")(a.datacenters,{element:b,attribute:"id"});c.getRacks(e)},h=function(a){f.isEmptyObject(a)||c.getPhysicalMachines(a)};a.onDatacenterChange=function(a){a=parseInt(a),a>0&&g(a)},a.onServerChange=function(b){if(b=parseInt(b),b>0){var c=d("getElementByParameter")(a.racks,{element:b,attribute:"id"});h(c),angular.extend(a.currentRack,c)}},a.dropServerOnAvailableListener=function(b){if(void 0!==b.data("$scope").reservedServer){var c=a.reservedServers.indexOf(b.data("$scope").reservedServer);a.reservedServers.splice(c,1),e(a)}},a.dropServerOnAvailableAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").reservedServer},a.dropServerOnReservedListener=function(b){void 0!==b.data("$scope").availableServer&&(a.reservedServers.push(b.data("$scope").availableServer),e(a))},a.dropServerOnReservedAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").availableServer}}]).controller("EnterpriseEditPublicCredentialsCtrl",["$scope","commonsMgr","enterprisesMgr","$filter","utils",function(a,b,c,d,e){function f(b){var c=d("getElementByParameter")(a.publicProviders,{element:b,attribute:"name"});return c}function g(b){var c=angular.copy(a.publicCredentials);a.enterprise.clientData.publicCredentials.push(c),a.initPublicCredentials()}function h(a,b){i(b)}function i(b){var c=d("getElementByParameter")(a.enterprise.clientData.publicCredentials,{element:b.clientData.providerName,attribute:"clientData.providerName"}),e=a.enterprise.clientData.publicCredentials.indexOf(c);a.enterprise.clientData.publicCredentials.splice(e,1)}a.__name="EnterpriseEditPublicCredentialsCtrl",a.publicProviders=b.publicProviders,a.getProviderRealName=function(a){var b="",c=f(a);return e.isEmptyObject(c)||(b=c.realName),b},a.onTestAccountClick=function(){var b=f(a.publicCredentials.clientData.providerName);c.testPublicAccount(b,a.publicCredentials,g)},a.onReleaseAccountClick=function(b){b.id?c.releasePublicAccount(a.enterprise,b,h):i(b)}}]).controller("EnterpriseEditPricingModelEditCtrl",["$scope","pricingMgr","costCodesMgr","currenciesMgr","utils","$filter","$timeout",function(a,b,c,d,e,f,g){a.__name="EnterprisePricingModelEditCtrl",a.viewMode=!0,a.pricingModels=b.pricingModels,a.selectedCurrency={},a.periods=b.periods,a.currencies=d.currencies,a.currencyExPattern=e.regExPattern.currencyExPattern,a.variables=["%CHARGEPERIOD%","%MINCHARGE_FORMATTED%","%MINPERIOD%","%CHARGE_FORMATTED%"];var h=function(){f("isGranted")("PRICING_VIEW")&&(j(),k())},i=function(){g(function(){a.pricingModel.id=a.pricingModel.id,a.pricingModel.id>0&&a.onPricingModelChange(a.pricingModel.id)})},j=function(){b.getPricingModels(!0,{},{},i)},k=function(){d.getCurrencies()};a.onPricingModelChange=function(d){if(d=parseInt(d),0!==d){var g=f("getElementByParameter")(a.pricingModels,{
element:d,attribute:"id"});angular.extend(a.pricingModel,g),a.selectedCurrency.id=g.clientData.currency.id,a.enterprise.idPricingTemplate=g.id,c.getPricingCostCodes(a.pricingModel.id,a.pricingModel.clientData.currency.id),b.getPricingTiers(a.pricingModel.id)}else e.emptyObject(a.pricingModel),a.pricingModel.id=0,a.selectedCurrency.id=0};var l='<div class="ngCellText" ng-class="col.colIndex()"><span ng-cell-text>{{ row.entity.clientData.originalPrice}} {{ pricingModel.clientData.currency.symbol }}</span></div>';a.gridImagePrices={data:"pricingModel.clientData.costCodes",columnDefs:[{field:"clientData.costCode.name",displayName:f("translate")("pricingmodel.create.imageprices.col.name")},{field:"clientData.costCode.description",displayName:f("translate")("pricingmodel.create.imageprices.col.description")},{field:"clientData.originalPrice",displayName:f("translate")("pricingmodel.create.imageprices.col.currentprice"),cellTemplate:l},{field:"price",displayName:f("translate")("pricingmodel.create.imageprices.col.newprice")}]},a.gridTieredStorage={data:"pricingModel.clientData.tiers",columnDefs:[{field:"clientData.datacenter.name",displayName:f("translate")("pricingmodel.create.tieredstorage.col.datacenter")},{field:"clientData.tier.name",displayName:f("translate")("pricingmodel.create.tieredstorage.col.tier")},{field:"clientData.originalPrice",displayName:f("translate")("pricingmodel.create.tieredstorage.col.currentprice"),cellTemplate:l},{field:"price",displayName:f("translate")("pricingmodel.create.tieredstorage.col.newprice")}],filterOptions:{filterText:"",useExternalFilter:!1}},h()}]),angular.module("enterprises",["enterpriseCreate","enterpriseEdit","users","roles","scopes"]).controller("EnterprisesCtrl",["$scope",function(a){a.__name="EnterprisesCtrl"}]).controller("EnterprisesListCtrl",["$scope","enterprisesMgr","usersMgr","systemPropertiesMgr","paginationHelper","utils","dispatcher",function(a,b,c,d,e,f,g){a.__name="EnterprisesListCtrl";var h=function(){a.enterprises=b.enterprises,a.currentEnterprise=b.currentEnterprise,a.entFilter=e.entPaginator.filter,a.entPaginationParam=e.entPaginator.param,a.systemProperties=d.systemProperties,b.setCurrentEnterprise(null),j()},i=function(a){e.entPaginator.param.totalSize=a.totalSize},j=function(){b.getEnterprises(e.entPaginator.param,e.entPaginator.filter,i)},k=function(){b.deleteEnterprise(b.currentEnterprise)};a.dropUserOnListListener=function(a,b,d,e,f){c.editUserEnterprise(f,d)},a.dropUserAcceptListener=function(a){return!0},a.onEntFilterSubmit=function(){e.entPaginator.resetParam(),j()},a.onAllEnterprisesClick=function(){a.entFilter.has="",a.onEnterpriseClick(null),a.onEntFilterSubmit()},a.getPage=function(a){e.entPaginator.param.startwith=(a-1)*e.entPaginator.param.limit,b.setCurrentEnterprise(null),j()},a.onEnterpriseClick=function(a){b.setCurrentEnterprise(a)},a.onDeleteEnterpriseConfirm=function(){k()},g.on(["enterprise.created","enterprise.edited","enterprise.deleted"],j,a),h()}]).controller("EnterpriseDetailsCtrl",["$scope",function(a){a.__name="EnterpriseDetailsCtrl"}]),angular.module("roleCreate",[]).controller("RoleCreateCtrl",["$scope","rolesMgr","enterprisesMgr","scopesMgr","utils","$filter","$timeout",function(a,b,c,d,e,f,g){a.__name="RoleCreateCtrl",a.editMode=!1,a.enterprises=c.enterprises,a.scopes=d.scopes;var h=function(){a.closePopup()},i=function(b,d){g(function(){var b=f("getElementById")(d,c.currentEnterprise.id);e.isEmptyObject(b)?a.role.clientData.enterprise=c.userEnterprise:a.role.clientData.enterprise=b})};a.onShown=function(){a.role={links:[],clientData:{scope:{id:""},isGlobal:!1}},f("isGranted")("USERS_MANAGE_ROLES_OTHER_ENTERPRISES")?c.getEnterprises({},{},i):a.role.clientData.enterprise=c.userEnterprise,d.getScopes()},a.onSubmit=function(){var c=a.role.clientData.isGlobal?{}:f("getElementByParameter")(a.enterprises,{element:parseInt(a.role.clientData.enterprise.id),attribute:"id"}),d=f("getElementByParameter")(a.scopes,{element:parseInt(a.role.clientData.scope.id),attribute:"id"});b.createRole(a.role,c,d,h)}}]).controller("RoleCloneCtrl",["$scope","rolesMgr","privilegesMgr","scopesMgr","enterprisesMgr","$filter","$timeout","safeApply",function(a,b,c,d,e,f,g,h){function i(){a.closePopup()}function j(a){k=a.collection}a.__name="RoleCloneCtrl",a.scopes=d.scopes,a.editMode=!1,a.enterprises=e.enterprises;var k=[],l=function(){g(function(){a.role.clientData.scope.id=a.scopeId,h(a)})};a.onShown=function(){a.role=angular.copy(b.currentRole),a.role.name="Copy: "+a.role.name,a.scopeId=a.role.clientData.scope.id,a.role.blocked=!1,c.getPrivilegesByRole(a.role,j),f("isGranted")("USERS_MANAGE_LDAP_GROUP")&&b.getRoleLdap(a.role),d.getScopes(l)},a.onSubmit=function(){var c=a.role.clientData.isGlobal?{}:f("getElementByParameter")(a.enterprises,{element:parseInt(a.role.clientData.enterprise.id),attribute:"id"}),d=f("getElementByParameter")(a.scopes,{element:parseInt(a.role.clientData.scope.id),attribute:"id"});b.cloneRole(a.role,c,d,k,i)}}]),angular.module("roleEdit",[]).controller("RoleEditCtrl",["$scope","rolesMgr","enterprisesMgr","scopesMgr","privilegesMgr","$filter","$timeout","safeApply",function(a,b,c,d,e,f,g,h){function i(b){a.scopePrivileges=b.collection}a.__name="RoleEditCtrl",a.editMode=!0,a.enterprises=c.enterprises,a.scopes=d.scopes;var j=function(){a.closePopup()},k=function(){g(function(){a.role.clientData.scope.id=a.scopeId,h(a)})};a.onShown=function(){a.role=angular.copy(b.currentRole),a.scopeId=a.role.clientData.scope.id,f("isGranted")("USERS_MANAGE_ROLES_OTHER_ENTERPRISES")&&c.getEnterprises(),f("isGranted")("USERS_MANAGE_LDAP_GROUP")&&b.getRoleLdap(a.role),d.getScopes(k),e.getPrivilegesByRole(a.role,i)},a.onSubmit=function(){var c=a.role.clientData.isGlobal?{}:f("getElementByParameter")(a.enterprises,{element:parseInt(a.role.clientData.enterprise.id),attribute:"id"}),d=f("getElementByParameter")(a.scopes,{element:parseInt(a.role.clientData.scope.id),attribute:"id"});b.editRole(a.role,c,d,a.scopePrivileges,j)}}]),angular.module("roles",["roleCreate","roleEdit","privileges"]).controller("RolesCtrl",["$scope",function(a){a.__name="RolesCtrl"}]).controller("RolesListCtrl",["$scope","rolesMgr","privilegesMgr","enterprisesMgr","userMgr","systemPropertiesMgr","dispatcher","utils","paginationHelper","$filter",function(a,b,c,d,e,f,g,h,i,j){a.__name="RolesListCtrl",a.roles=b.roles,a.currentRole=b.currentRole,a.editAllowed=!0,a.systemProperties=f.systemProperties,a.roleFilter=i.rolePaginator.filter,a.rolePaginationParam=i.rolePaginator.param;var k=function(){m()},l=function(a){i.rolePaginator.param.totalSize=a.totalSize},m=function(){a.editAllowed=!0,h.isEmptyObject(d.currentEnterprise)?b.getRoles(a.rolePaginationParam,a.roleFilter,l):b.getRolesByEnterprise(d.currentEnterprise,a.rolePaginationParam,a.roleFilter,l)},n=function(){b.deleteRole(b.currentRole)},o=function(){h.isEmptyObject(b.currentRole)||(b.currentRole.id==e.user.clientData.role.id?a.editAllowed=!1:1==b.currentRole.id?a.editAllowed=!1:a.editAllowed=j("isGranted")("USERS_MANAGE_SYSTEM_ROLES"))};a.onRoleFilterSubmit=function(){i.rolePaginator.resetParam(),m()},a.getPage=function(a){i.rolePaginator.param.startwith=(a-1)*i.rolePaginator.param.limit,b.setCurrentRole(null),m()},a.onRoleClick=function(a){b.setCurrentRole(a)},a.onCloneClick=function(){},a.onDeleteRoleConfirm=function(){n()},g.on(["role.created","role.edited","role.deleted"],m,a),g.on("currentEnterprise.change",m,a),g.on("currentRole.changed",o,a),k()}]).controller("RolesDetailsCtrl",["$scope",function(a){a.__name="RolesDetailsCtrl"}]),angular.module("privileges",[]).controller("PrivilegesCtrl",["$scope","privilegesMgr","rolesMgr","userMgr","dispatcher","$filter","utils",function(a,b,c,d,e,f,g){a.__name="PrivilegesCtrl",a.privileges=b.privileges,a.privilegeGroups=b.privilegeGroups,a.rolePrivileges=b.rolePrivileges,a.currentRole=c.currentRole,a.editAllowed=!1,a.isInPrivilegeView=!0,a.currentPrivilege={};var h=function(){g.isEmptyObject(c.currentRole)||(f("isGranted")("USERS_MANAGE_ROLES")?c.currentRole.id==d.user.clientData.role.id?a.editAllowed=!1:1==c.currentRole.id?a.editAllowed=!1:f("isGranted")("USERS_MANAGE_SYSTEM_ROLES")?a.editAllowed=!0:a.editAllowed=!g.isEmptyObject(c.currentRole)&&!c.currentRole.clientData.isGlobal:a.editAllowed=!1,b.getPrivilegesByRole(c.currentRole))};a.groupHasPrivileges=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&++b;return 0!=b&&1!=b},a.roleHasPrivilege=function(a,c){return b.roleHasPrivilege(a,c)},a.editPrivileges=function(){for(var b in a.privileges){var d=a.privileges[b];angular.forEach(d,function(b){if(b.clientData){var c=f("getElementByParameter")(a.rolePrivileges,{element:b.id,attribute:"id"}),d=a.rolePrivileges.indexOf(c);b.clientData.hasPrivilege?-1==d&&a.rolePrivileges.push(b):d>-1&&a.rolePrivileges.splice(d,1)}})}c.editPrivileges(c.currentRole,a.rolePrivileges)},e.on(["currentRole.changed","role.created","role.edited"],function(){h()},a)}]).controller("PrivilegesEditCtrl",["$scope","rolesMgr","privilegesMgr","$filter","dispatcher","utils",function(a,b,c,d,e,f){function g(){angular.forEach(a.privilegeGroup,function(b){h(b)&&(b.clientData.hasPrivilege=a.roleHasPrivilege(a.rolePrivileges,b))}),a.updateAllPrivileges(!0)}function h(a){return a&&a.id}a.__name="PrivilegesEditCtrl",a.allPrivileges={};var i=function(){var b=!0;return angular.forEach(a.privileges[a.privilegeGroups[a.name]],function(a){a.clientData&&!a.clientData.hasPrivilege&&(b=!1)}),b},j=function(b){angular.forEach(a.privileges[a.privilegeGroups[a.name]],function(a){a.clientData&&(a.clientData.hasPrivilege=b)})};a.roleHasPrivilege=function(b,d){var e=c.roleHasPrivilege(b,d);return e||(a.allPrivileges[a.name]=!1),e},a.onAllPrivilegesClick=function(){j(a.allPrivileges[a.name])},a.updateAllPrivileges=function(b){b?a.allPrivileges[a.name]=i():a.allPrivileges[a.name]=!1},e.on(["privileges.rolePrivileges.changed"],function(){g()},a),a.onRollOverPrivilege=function(b){angular.copy(b,a.currentPrivilege)},a.onRollOutPrivilege=function(b){f.emptyObject(a.currentPrivilege)}}]),angular.module("scopeCreate",[]).controller("ScopeCreateCtrl",["$scope","scopesMgr","enterprisesMgr","datacentersMgr","paginationHelper",function(a,b,c,d,e){a.__name="ScopeCreateCtrl",a.editMode=!1,a.allEnterprises=c.scopeEnterprises,a.allDatacenters=d.datacenters,a.dcFormFilter=e.dcPaginator.filter,a.dcFormPaginationParam=e.dcPaginator.param,a.entFormFilter=e.ent2Paginator.filter,a.entFormPaginationParam=e.ent2Paginator.param;var f=function(){a.closePopup()};a.onShown=function(){a.scope=b.Scope(),a.enterpriseIds=[],a.datacenterIds=[],e.dcPaginator.resetParam(),e.dcPaginator.resetFilter(),h(),j()},a.onSubmit=function(){a.scope.automaticAddEnterprise||(a.scope.clientData.enterpriseIds=a.enterpriseIds),a.scope.automaticAddDatacenter||(a.scope.clientData.datacenterIds=a.datacenterIds),b.createScope(a.scope,f)};var g=function(a){e.dcPaginator.param.totalSize=a.totalSize},h=function(){d.getDatacenters(e.dcPaginator.param,e.dcPaginator.filter,g)},i=function(a){e.ent2Paginator.param.totalSize=a.totalSize},j=function(){c.getScopeEnterprises(e.ent2Paginator.param,e.ent2Paginator.filter,i)};a.onDcFormFilterSubmit=function(){e.dcPaginator.resetParam(),a.getDcFormPage(e.dcPaginator.param.currentPage)},a.getDcFormPage=function(a){e.dcPaginator.param.startwith=(a-1)*e.dcPaginator.param.limit,h()},a.onEntFormFilterSubmit=function(){e.ent2Paginator.resetParam(),a.getEntFormPage(e.ent2Paginator.param.currentPage)},a.getEntFormPage=function(a){e.ent2Paginator.param.startwith=(a-1)*e.ent2Paginator.param.limit,j()}}]),angular.module("scopeEdit",[]).controller("ScopeEditCtrl",["$scope","scopesMgr","enterprisesMgr","datacentersMgr","paginationHelper","utils",function(a,b,c,d,e,f){a.__name="ScopeEditCtrl",a.editMode=!0,a.allEnterprises=c.scopeEnterprises,a.allDatacenters=d.datacenters,a.dcFormFilter=e.dcPaginator.filter,a.dcFormPaginationParam=e.dcPaginator.param,a.entFormFilter=e.ent2Paginator.filter,a.entFormPaginationParam=e.ent2Paginator.param;var g=function(){a.closePopup()};a.onShown=function(){a.scope=angular.copy(b.currentScope),a.enterpriseIds=f.getIdResourceArrayByType(a.scope.scopeEntities,"ENTERPRISE"),a.datacenterIds=f.getIdResourceArrayByType(a.scope.scopeEntities,"DATACENTER"),e.dcPaginator.resetParam(),e.dcPaginator.resetFilter(),i(),k()},a.onSubmit=function(){a.scope.automaticAddEnterprise||(a.scope.clientData.enterpriseIds=a.enterpriseIds),a.scope.automaticAddDatacenter||(a.scope.clientData.datacenterIds=a.datacenterIds),b.editScope(a.scope,g)};var h=function(a){e.dcPaginator.param.totalSize=a.totalSize},i=function(){d.getDatacenters(e.dcPaginator.param,e.dcPaginator.filter,h)},j=function(a){e.ent2Paginator.param.totalSize=a.totalSize},k=function(){c.getScopeEnterprises(e.ent2Paginator.param,e.ent2Paginator.filter,j)};a.onDcFormFilterSubmit=function(){e.dcPaginator.resetParam(),a.getDcFormPage(e.dcPaginator.param.currentPage)},a.getDcFormPage=function(a){e.dcPaginator.param.startwith=(a-1)*e.dcPaginator.param.limit,i()},a.onEntFormFilterSubmit=function(){e.ent2Paginator.resetParam(),a.getEntFormPage(e.ent2Paginator.param.currentPage)},a.getEntFormPage=function(a){e.ent2Paginator.param.startwith=(a-1)*e.ent2Paginator.param.limit,k()}}]),angular.module("scopes",["scopeCreate","scopeEdit"]).controller("ScopesCtrl",["$scope",function(a){a.__name="ScopesCtrl"}]).controller("ScopesListCtrl",["$scope","scopesMgr","systemPropertiesMgr","paginationHelper","dispatcher",function(a,b,c,d,e){a.__name="ScopesListCtrl",a.scopes=b.scopes,a.currentScope=b.currentScope,a.systemProperties=c.systemProperties,a.scopeFilter=d.scopePaginator.filter,a.scopePaginationParam=d.scopePaginator.param;var f=function(){h()},g=function(a){d.scopePaginator.param.totalSize=a.totalSize},h=function(){b.getScopes(a.scopePaginationParam,a.scopeFilter,g)};a.onScopeFilterSubmit=function(){d.scopePaginator.resetParam(),h()},a.getPage=function(a){d.scopePaginator.param.startwith=(a-1)*d.scopePaginator.param.limit,b.setCurrentScope(null),h()};var i=function(){b.deleteScope(b.currentScope)};a.onScopeClick=function(a){b.setCurrentScope(a)},a.onDeleteScopeConfirm=function(){i()},e.on(["scope.created","scope.edited","scope.deleted"],f,a),f()}]).controller("ScopesDetailsCtrl",["$scope","scopesMgr","datacentersMgr","enterprisesMgr","paginationHelper","dispatcher","utils",function(a,b,c,d,e,f,g){a.__name="ScopesDetailsCtrl",a.currentScope=b.currentScope,a.enterprisesLight=d.enterprisesLight,a.datacentersLight=c.datacentersLight;var h=function(c){b.updateScopeEntities(a.currentScope,c.collection,"ENTERPRISE")},i=function(c){b.updateScopeEntities(a.currentScope,c,"DATACENTER")},j=function(){g.isEmptyObject(a.currentScope)||(b.getScopeDetails(b.currentScope),d.getEnterprisesLight(b.currentScope.id,h),c.getDatacentersLight(b.currentScope.id,i))};f.on(["currentScope.change","scope.edited"],j,a)}]),angular.module("userCreate",[]).controller("UserCreateCtrl",["$scope","usersMgr","rolesMgr","virtualDatacentersMgr","enterprisesMgr","privilegesMgr","$filter","gridTemplates","utils",function(a,b,c,d,e,f,g,h,i){a.__name="UserCreateCtrl",a.editMode=!1,a.roles=c.roles,a.currentEnterprise=e.currentEnterprise,a.prohibitVdcRestriction=!1,a.selectedLocale="es_ES",a.locales=["es_ES","ca_ES","en_US"];var j=function(){angular.extend(a.virtualDatacenters,d.virtualDatacenters)},k=function(){d.getVirtualDataCentersByEnterprise(e.currentEnterprise,null,j)},l=function(){a.prohibitVdcRestriction=f.roleHasPrivilege(f.rolePrivileges,{name:"USERS_PROHIBIT_VDC_RESTRICTION"})},m=function(){c.getRolesByEnterprise(a.currentEnterprise,{},{})},n=function(){a.closePopup()};a.onRoleChange=function(){a.selectedRole.id&&(a.role=g("getElementByParameter")(a.roles,{element:parseInt(a.selectedRole.id),attribute:"id"}),f.getPrivilegesByRole(a.role,l))},a.onShown=function(){a.user={locale:"en_US",active:!0},a.selectedRole={},a.enablePassword=!0,a.prohibitVdcRestriction=!1,a.virtualDatacenters=[],k(),m()},a.onSubmit=function(){!a.prohibitVdcRestriction&&a.user.clientData&&a.user.clientData.restrict&&(a.user.availableVirtualDatacenters=i.getIdsStringFromArray(a.virtualDatacenters)),b.createUser(a.user,e.currentEnterprise,a.role,n)},a.refreshGrid=function(){a.user.clientData.restrict&&i.refreshLayout()},a.virtualDatacentersGridOptions={data:"virtualDatacenters",columnDefs:[{field:"",width:60,displayName:g("translate")("globals.select"),cellTemplate:h.selectedCellTemplate},{field:"name",displayName:g("translate")("user.form.input.virtualdatacenter")}],multiSelect:!1,enableRowSelection:!1}}]),angular.module("userEdit",[]).controller("UserEditCtrl",["$scope","usersMgr","rolesMgr","virtualDatacentersMgr","enterprisesMgr","privilegesMgr","userMgr","$filter","gridTemplates","utils","server","refreshMgr","$timeout","safeApply",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.__name="UserEditCtrl",a.editMode=!0,a.roles=c.roles,a.selectedRole={},a.user={},a.locales=["es_ES","ca_ES","en_US"],a.test=function(){a.$setValidity("passwordVerify",!0)};var o=function(){j.setArrayFromIdsStringAndArray(a.user.availableVirtualDatacenters,d.virtualDatacenters),angular.extend(a.virtualDatacenters,d.virtualDatacenters)},p=function(){a.prohibitVdcRestriction=f.roleHasPrivilege(f.rolePrivileges,{name:"USERS_PROHIBIT_VDC_RESTRICTION"})},q=function(){var b={limit:0};d.getVirtualDatacenters(a.currentEnterprise,b,null,o)},r=function(){m(function(){var b=k.getIdInLinkByParameter(k.getLinkByRel(a.user.links,"role"),"roles");a.selectedRole.id=b,n(a),a.onRoleChange()})},s=function(){c.getRolesByEnterprise(a.user.clientData.enterprise,{},{},r)},t=function(b){b.id==g.user.id&&g.updateLoggedUser(b),a.closePopup()};a.onRoleChange=function(){a.selectedRole.id&&(a.role=h("getElementByParameter")(a.roles,{element:parseInt(a.selectedRole.id),attribute:"id"}),f.getPrivilegesByRole(a.role,p))},a.onShown=function(){l.stopTimer(),a.user=angular.copy(b.currentUser),a.enablePassword=!1,a.prohibitVdcRestriction=!0,a.virtualDatacenters=[],a.sameUser=a.user.id==g.user.id,j.isEmptyObject(e.currentEnterprise)?a.currentEnterprise=a.user.clientData.enterprise:a.currentEnterprise=e.currentEnterprise,q(),s()},a.onSubmit=function(){!a.prohibitVdcRestriction&&a.user.clientData.restrict?a.user.availableVirtualDatacenters=j.getIdsStringFromArray(a.virtualDatacenters):delete a.user.availableVirtualDatacenters,""==a.user.password&&delete a.user.password,b.editUser(a.user,a.role,t)},a.onHidden=function(){l.initTimer()},a.onEditPassword=function(){a.enablePassword=!0},a.onPasswordChange=function(){a.user.password!=a.user.clientData.repeatPassword&&(a.validExternally=!1)},a.refreshGrid=function(){a.user.clientData.restrict&&j.refreshLayout()},a.virtualDatacentersGridOptions={data:"virtualDatacenters",columnDefs:[{field:"",width:60,displayName:h("translate")("globals.select"),cellTemplate:i.selectedCellTemplate},{field:"name",displayName:h("translate")("user.form.input.virtualdatacenter")}],multiSelect:!1,enableRowSelection:!1}}]),angular.module("users",["userCreate","userEdit"]).controller("UsersCtrl",["$scope","enterprisesMgr","usersMgr","systemPropertiesMgr","paginationHelper","utils","dispatcher","gridTemplates","$filter",function(a,b,c,d,e,f,g,h,i){function j(b){a.onUserMouseDown(b.entity)}a.__name="UsersCtrl",a.usersTab={value:"all"},a.users=c.users,a.currentUser=c.currentUser,a.userFilter=e.userPaginator.filter,a.userPaginationParam=e.userPaginator.param,a.systemProperties=d.systemProperties,a.showOnlyLogged=!1;var k='<div id="user-{{row.rowIndex}}" name="{{row.entity.nick}}" ng-style="{cursor: row.cursor}" \n                            data-ui-draggable \n                            data-drag-enabled="(\'USERS_MANAGE_ENTERPRISE\' | isGranted) && (\'USERS_MANAGE_OTHER_ENTERPRISES\' | isGranted)" \n                            data-drag-revert="true" \n                            data-drag-helper="<div><span>{{row.entity.name}} {{row.entity.surname}}</span> (<strong>{{row.entity.nick}}</strong>)<div>" \n                            data-drag-object="row.entity" \n                            data-drag-type="userToEnterprise" \n                            ng-repeat="col in renderedColumns" \n                            ng-class="col.colIndex()" \n                            class="ngCell {{col.cellClass}}" \n                            ng-cell></div>';a.usersGridOptions={data:"filteredUsers ",rowTemplate:k,columnDefs:[{field:"nick",displayName:i("translate")("enterprise.user.grid.head.nick")},{field:"surname",displayName:i("translate")("enterprise.user.grid.head.surname")},{field:"name",displayName:i("translate")("enterprise.user.grid.head.name")},{field:"email",displayName:i("translate")("enterprise.user.grid.head.email")},{field:"clientData.role.name",displayName:i("translate")("enterprise.user.grid.head.role")},{field:"active",width:60,displayName:i("translate")("enterprise.user.grid.head.activated"),cellTemplate:h.enabledDisabledTypeCell},{field:"locked",width:60,displayName:i("translate")("enterprise.user.grid.head.locked"),cellTemplate:h.lockedTypeCell}],multiSelect:!1,afterSelectionChange:j};var l=function(){i("isGranted")("USERS_MANAGE_OTHER_ENTERPRISES")||i("isGranted")("USERS_MANAGE_ENTERPRISE")?n():b.setCurrentEnterprise(b.userEnterprise)},m=function(b){a.filteredUsers=i("userStateFilter")(a.users,a.usersTab.value),e.userPaginator.param.totalSize=b.totalSize},n=function(a){f.isEmptyObject(b.currentEnterprise)?c.getAllUsers(a,e.userPaginator.param,e.userPaginator.filter,m):i("isGranted")("USERS_MANAGE_OTHER_ENTERPRISES")?c.getUsers(b.currentEnterprise,a,e.userPaginator.param,e.userPaginator.filter,m):c.getUsers(b.userEnterprise,a,e.userPaginator.param,e.userPaginator.filter,m)},o=function(){c.deleteUser(c.currentUser)};a.getLoggedUsers=function(b,c){a.showOnlyLogged=b,e.userPaginator.filter.connected=b,"activated"==c||"suspend"==c?e.userPaginator.filter.activated="activated"==c:delete e.userPaginator.filter.activated,n()},a.onUserFilterSubmit=function(){e.userPaginator.resetParam(),n()},a.getPage=function(a){e.userPaginator.param.startwith=(a-1)*e.userPaginator.param.limit,c.setCurrentUser(null),n()},a.onUserMouseDown=function(a){c.setCurrentUser(a)},a.onDeleteUserConfirm=function(){o()},g.on(["user.created","user.edited","user.deleted","enterprises.got"],n,a),g.on("currentEnterprise.change",function(){e.userPaginator.resetParam(),n()},a),a.$on("timer",function(){n(!0)}),l()}]),angular.module("eventDetails",[]).controller("EventDetailsCtrl",["$scope","eventsMgr",function(a,b){a.__name="EventsDetailsCtrl",a.currentEvent=b.currentEvent}]),angular.module("events",["eventDetails"]).controller("EventsCtrl",["$scope","eventsMgr","paginationHelper","$timeout","safeApply","gridTemplates","$filter","enterprisesMgr",function(a,b,c,d,e,f,g,h){a.__name="EventsCtrl",a.events=b.events,a.evFilter=c.evPaginator.filter,c.evPaginator.filter.asc=!1,c.evPaginator.filter.severity=g("translate")("globals.all"),c.evPaginator.filter.actionPerformed=g("translate")("globals.all"),a.evPaginationParam=c.evPaginator.param,a.select2Options={minimumResultsForSearch:-1},a.refreshEvents=!1,a.onClickEvent=function(a){console.log(a)};var i=function(){a.getEvents(),b.getEventTypes()},j=function(b){c.evPaginator.param.totalSize=b.totalSize,d(function(){e(a)},100)};a.getEvents=function(d){a.eventFilterCopy=angular.copy(a.evFilter),a.eventFilterCopy.severity==g("translate")("globals.all")&&delete a.eventFilterCopy.severity,a.eventFilterCopy.actionPerformed==g("translate")("globals.all")&&delete a.eventFilterCopy.actionPerformed,g("isGranted")("EVENTLOG_VIEW_ALL")||(a.eventFilterCopy.enterprise=h.userEnterprise.name),b.getEvents(d,c.evPaginator.param,a.eventFilterCopy,j)};var k=function(a){a.selected&&b.setCurrentEvent(a.entity)};a.sortInfo={fields:[""],directions:["asc","desc"]},a.eventsGridOptions={data:"events",columnDefs:[{field:"clientData.source",width:150,displayName:g("translate")("events.list.input.source")},{field:"severity",width:70,displayName:g("translate")("events.list.input.severity"),cellTemplate:f.severityCellTemplate},{field:"actionPerformed",width:230,displayName:g("translate")("events.list.input.action"),sortable:!1},{field:"performedBy",width:80,displayName:g("translate")("events.list.input.performedby")},{field:"timestamp",width:120,displayName:g("translate")("events.list.input.datetime"),cellFilter:"timestampToString:true"},{field:"user",width:70,displayName:g("translate")("events.list.input.user")},{field:"stacktrace",displayName:g("translate")("events.list.input.trace"),sortable:!1}],useExternalSorting:!0,sortInfo:a.sortInfo,afterSelectionChange:k,multiSelect:!1},a.$watch("sortInfo",function(d){if(1==d.fields.length&&""!=d.fields[0]){var e=b.sortMapping[d.fields[0]],f="asc"===d.directions[0]?!0:!1;c.evPaginator.filter.by=e.toLowerCase(),c.evPaginator.filter.asc=f,a.getEvents()}},!0),a.getPage=function(b){c.evPaginator.param.startwith=(b-1)*c.evPaginator.param.limit,a.getEvents()},a.$on("timer",function(){a.refreshEvents&&a.getEvents(!0)}),i()}]).controller("EventsFilterCtrl",["$scope","eventsMgr","utils","enterprisesMgr","$filter",function(a,b,c,d,e){a.__name="EventsFilterCtrl",a.evDateFilter={},a.severities=b.eventSeverities,a.actions=b.eventTypes,a.dateOptions={"year-format":"'yy'","starting-day":1,"show-weeks":!1},a.showWeeks=!1,a.format="yyyy/MM/dd";var f=function(){e("isGranted")("EVENTLOG_VIEW_ALL")||(a.evFilter.enterprise=d.userEnterprise.name)},g=function(a,b){var c=!1;return(a.severity&&a.severity!=e("translate")("globals.all")||a.actionPerformed&&a.actionPerformed!=e("translate")("globals.all")||a.performedBy||b.datefrom||b.dateto||e("isGranted")("EVENTLOG_VIEW_ALL")&&a.enterprise||a.datacenter||a.rack||a.physicalMachine||a.storageSystem||a.storagePool||a.volume||a.network||a.subnet||a.virtualDatacenter||a.virtualApp||a.virtualMachine||a.user||a.component)&&(c=!0),c};a.onResetFilterClick=function(){a.evDateFilter.datefrom=null,a.evDateFilter.dateto=null;var b=a.evFilter.filtered;c.emptyObject(a.evFilter),a.evFilter.filtered=b,e("isGranted")("EVENTLOG_VIEW_ALL")||(a.evFilter.enterprise=d.userEnterprise.name)},a.onSearchClick=function(){delete a.evFilter.datefrom,delete a.evFilter.dateto,a.evFilter.filtered=g(a.evFilter,a.evDateFilter),a.evDateFilter.datefrom&&(a.evFilter.datefrom=a.evDateFilter.datefrom.getTime()/1e3),a.evDateFilter.dateto&&(a.evFilter.dateto=a.evDateFilter.dateto.getTime()/1e3),a.getEvents()},f()}]),angular.module("footer",["logger"]).controller("FooterCtrl",["$scope","$sce","$filter","configMgr","systemPropertiesMgr","stepByStepMgr",function(a,b,c,d,e,f){a.__name="FooterCtrl",a.systemProperties=e.systemProperties,a.hidePoweredBy=1==d.config["client.poweredby.hide"],a.tutorials=f.tutorials,a.about=b.trustAsHtml(c("translate")("about_popup.text")),a.support=b.trustAsHtml(c("translate")("support_popup.text"))}]),angular.module("allocationRuleCreate",[]).controller("GlobalAllocationRuleCreateCtrl",["$scope","allocationRulesMgr","enterprisesMgr","utils","server","$filter",function(a,b,c,d,e,f){a.__name="GlobalAllocationRuleCreateCtrl",a.ruleTypes=[{name:f("translate")("allocationrules.type.fitpolicyrule")},{name:f("translate")("allocationrules.type.enterpriseexclusionrule")}],a.enterprises=c.enterprises;var g=function(){a.closePopup()};a.onShown=function(){a.allocationRule={clientData:{},ruleType:a.ruleTypes[0].name,datacenter:{name:f("translate")("allocationrules.create.text.all")},loadBalanceType:a.loadBalanceTypes[0].name,enterprise1:{},enterprise2:{}},c.getEnterprises()},a.onOptionChange=function(b,c){a.allocationRule[b]=f("getElementByParameter")(a[c],{element:parseInt(a.allocationRule.clientData[b]),attribute:"id"})},a.onSubmit=function(){var c=a.createNewAllocationRule(a.allocationRule);b.addAllocationRule(c,g)}}]).controller("DatacenterAllocationRuleCreateCtrl",["$scope","datacentersMgr","serversMgr","allocationRulesMgr","$filter","utils",function(a,b,c,d,e,f){a.__name="DatacenterAllocationRuleCreateCtrl",a.ruleTypes=[{name:e("translate")("allocationrules.type.fitpolicyrule")},{name:e("translate")("allocationrules.type.machineloadrule")}],a.currentDatacenter=b.currentDatacenter;var g=function(){a.closePopup()},h=function(b){a.machines.length=0,angular.extend(a.machines,b),f.addFirstItem(a.machines,e("translate")("globals.all"))};a.onShown=function(){a.racks=angular.copy(c.racks),f.addFirstItem(a.racks,e("translate")("globals.all")),a.machines=[],f.addFirstItem(a.machines,e("translate")("globals.all")),a.allocationRule={clientData:{rack:0,server:0},ruleType:a.ruleTypes[0].name,datacenter:a.currentDatacenter,loadBalanceType:a.loadBalanceTypes[0].name,rack:{},server:{},ram:"",cpu:""}},a.onRackOptionChange=function(){a.allocationRule.rack=e("getElementByParameter")(a.racks,{element:parseInt(a.allocationRule.clientData.rack),attribute:"id"}),"0"==a.allocationRule.clientData.rack?a.machines.length=0:c.getPhysicalMachines(a.allocationRule.rack,null,null,h)},a.onServerOptionChange=function(){a.allocationRule.server=e("getElementByParameter")(a.machines,{element:parseInt(a.allocationRule.clientData.server),attribute:"id"})},a.onSubmit=function(){var b=a.createNewAllocationRule(a.allocationRule);d.addAllocationRule(b,g)}}]),angular.module("allocationRules",["allocationRuleCreate"]).controller("AllocationRulesCtrl",["$scope","datacentersMgr","allocationRulesMgr","systemPropertiesMgr","utils","server","dispatcher","$filter",function(a,b,c,d,e,f,g,h){a.currentGlobalAllocationRule=c.currentGlobalAllocationRule,a.currentDatacenterAllocationRule=c.currentDatacenterAllocationRule,a.datacenterAllocationRules=c.datacenterAllocationRules,a.globalAllocationRules=c.globalAllocationRules,a.loadBalanceTypes=c.loadBalanceTypes,a.currentDatacenter=b.currentDatacenter,a.systemProperties=d.systemProperties;var i=function(){c.getAllocationRules(a.currentDatacenter)},j=function(a){a.selected&&c.setCurrentGlobalAllocationRule(a.entity)},k=function(a){a.selected&&c.setCurrentDatacenterAllocationRule(a.entity)};a.gridGlobalAllocationRules={data:"globalAllocationRules",columnDefs:[{field:"clientData.type",width:150,displayName:h("translate")("allocationrules.col.type")},{field:"clientData.description",displayName:h("translate")("allocationrules.col.description")}],afterSelectionChange:j},a.gridDatacenterAllocationRules={data:"datacenterAllocationRules",columnDefs:[{field:"clientData.type",width:150,displayName:h("translate")("allocationrules.col.type")},{field:"clientData.description",displayName:h("translate")("allocationrules.col.description")}],afterSelectionChange:k},a.onDeleteAllocationRuleConfirm=function(a){c.deleteAllocationRule(a)},a.getStringTranslated=function(a){return h("translate")(a)},a.createNewAllocationRule=function(a){var b={clientData:{ruleType:a.ruleType}};switch(a.ruleType){case h("translate")("allocationrules.type.fitpolicyrule"):angular.extend(b,{fitPolicy:a.loadBalanceType}),a.datacenter.id&&(b.links=[f.createLinkByRel(a.datacenter.links,"edit","datacenter")]);break;case h("translate")("allocationrules.type.machineloadrule"):angular.extend(b,{links:[],cpuLoadPercentage:a.cpu,ramLoadPercentage:a.ram}),e.isEmptyObject(a.server)?e.isEmptyObject(a.rack)?b.links.push(f.createLinkByRel(a.datacenter.links,"edit","datacenter")):b.links.push(f.createLinkByRel(a.rack.links,"edit","rack")):b.links.push(f.createLinkByRel(a.server.links,"edit","machine"));break;case h("translate")("allocationrules.type.enterpriseexclusionrule"):angular.extend(b,{links:[]});var c=f.createLinkByRel(a.enterprise1.links,"edit","enterprise");c.title="enterprise1";var d=f.createLinkByRel(a.enterprise2.links,"edit","enterprise");d.title="enterprise2",b.links.push(c),b.links.push(d)}return b},g.on(["allocationRule.created","allocationRule.deleted"],i,a),g.on("currentDatacenter.change",function(){a.currentDatacenter.clientData&&!a.currentDatacenter.clientData.isPublicDatacenter&&i()},a),i()}]),angular.module("backupConfiguration",[]).controller("BackupConfigurationCtrl",["$scope","datacentersMgr","configMgr","utils","server","dispatcher","$filter",function(a,b,c,d,e,f,g){
a.__name="BackupConfigurationCtrl",a.backupsConfiguration=b.backupsConfiguration,a.datacenter=b.currentDatacenter,a.currentBackup={},a.currentBackupGroup={},a.enabledBackupConfiguration={value:!1};var h=["defined_hour","hourly","daily","weekly_planned","monthly"],i=[{name:"snapshot",id:1},{name:"filesystem",id:2},{name:"complete",id:3}],j=function(){a.editBackupsConfiguration=[],a.enabledBackupConfiguration.value=!1,i.forEach(function(c){var c={name:c.name,attributes:[]},d=!1;b.backupsConfiguration.forEach(function(b){var f=e.getLinkByRel(b.links,"backup");return f&&f.title==c.name?(c.backupConfiguration=b,h.forEach(function(d){var e=!g("isEmptyObject")(g("getElementByParameter")(b.attributes,{element:d})),f={name:d,checked:e};a.enabledBackupConfiguration.value=a.enabledBackupConfiguration.value||f.checked,c.attributes.push(f)}),void(d=!0)):void 0}),d||h.forEach(function(a){var b={name:a,checked:!1};c.attributes.push(b)}),a.editBackupsConfiguration.push(c)})},k=function(){b.isPrivateDatacenter(b.currentDatacenter)&&b.getBackupConfiguration(b.currentDatacenter,j)};a.onRollOverBackup=function(b,c){angular.copy(c,a.currentBackup),angular.copy(b,a.currentBackupGroup)},a.onRollOutBackup=function(b){d.emptyObject(a.currentBackup),d.emptyObject(a.currentBackupGroup)},a.debug=function(b){console.log(b,a.enabledBackupConfiguration.value)},f.on(["backupConfiguration.edited","currentDatacenter.change"],k,a);var l=function(){k()};a.onAcceptClick=function(){var d={};a.enabledBackupConfiguration.value&&(d.collection=[],a.editBackupsConfiguration.forEach(function(f,h){var j={name:f.name,attributes:[],links:[]};if(f.backupConfiguration)j.id=f.backupConfiguration.id,j.links=f.backupConfiguration.links;else{var k=e.createLinkByRel(b.currentDatacenter.links,"edit","datacenter");j.links.push(k),j.links.push({title:f.name,rel:"template",type:"application/vnd.abiquo.backup+json",href:c.config["config.endpoint"]+"/config/backups/"+g("getElementByParameter")(i,{element:f.name,attribute:"name"}).id})}a.enabledBackupConfiguration.value&&f.attributes.forEach(function(a){a.checked&&j.attributes.push(a.name)}),d.collection.push(j)})),b.editBackupConfiguration(b.currentDatacenter,d)},l()}]),angular.module("datacenterCreate",[]).controller("DatacenterCreateCtrl",["$scope","datacentersMgr","remoteServicesMgr","paginationHelper","utils","server","enterprisesMgr","authenticationMgr","$filter","$timeout",function(a,b,c,d,e,f,g,h,i,j){function k(a,b){if(a&&b)if(a.remoteServices||(a.remoteServices={collection:[]}),b.id&&b.dto){var c=angular.copy(f.getLinkByRel(b.dto.links,"edit"));c.rel="remoteservice",a.links.push(c)}else a.remoteServices.collection.push({type:b.type,uri:s(b)})}function l(a,b,c){e.isEmptyObject(b)||e.isEmptyObject(a)||(b.ip=a.ip,c&&(b.port=a.port))}function m(){var b,c=[a.virtualizationmanager,a.monitormanager,a.appliancemanager,a.discoverymanager,a.storagemanager,a.businessprocessmanager,a.dhcpservice,a.dhcpv6];return c.every(function(a){return e.isEmptyObject(a.ip)?!0:(b=a,!1)}),b}function n(a,b){var c=a.http==b.clientData.splittedUri.protocol;return c=c&&a.ip==b.clientData.splittedUri.ip,c=c&&a.port==b.clientData.splittedUri.port,c=c&&(!b.clientData.splittedUri.path||a.path==b.clientData.splittedUri.path)}function o(a,b){var c;if(a&&b)for(var d=0;d<b.length>0;d++){var e=b[d];if(n(a,e)){c=e;break}}return c}function p(){a.datacenter&&(a.datacenter.remoteServices&&a.datacenter.remoteServices.collection&&(a.datacenter.remoteServices.collection.length=0),a.datacenter.links.length=0),k(a.datacenter,a.virtualizationmanager),k(a.datacenter,a.monitormanager),k(a.datacenter,a.appliancemanager),k(a.datacenter,a.discoverymanager),k(a.datacenter,a.storagemanager),k(a.datacenter,a.businessprocessmanager),k(a.datacenter,a.dhcpservice),k(a.datacenter,a.dhcpv6)}function q(){a.remoteServicesVirtualizationManager=r(a.virtualizationmanager.type),a.remoteServicesMonitorManager=r(a.monitormanager.type),a.remoteServicesApplianceManager=r(a.appliancemanager.type),a.remoteServicesDiscoveryManager=r(a.discoverymanager.type),a.remoteServicesStoreManager=r(a.storagemanager.type),a.remoteServicesBussinessProcessManager=r(a.businessprocessmanager.type),a.remoteServicesDhcpSevice=r(a.dhcpservice.type),a.remoteServicesDhcpv6=r(a.dhcpv6.type)}function r(b){var c=i("filterBy")(a.remoteServices,{value:b,criteria:"type"});return c}function s(a){return t(a.http)+t(a.ip)+":"+t(a.port)+"/"+t(a.path)}function t(a){var b=a;return void 0===b&&(b=""),b}a.__name="DatacenterCreateCtrl",a.isPublic=!1,a.ipRegExPattern=e.regExPattern.ip,a.editMode=!1,a.currentEnterprise=g.userEnterprise,a.remoteServices=c.remoteServicesAll,a.datacenterTab={},a.onChangeInput=function(b,c){var d=o(b,c);a.onRemoteServiceSelected(b,d)},a.onRemoteServiceSelected=function(b,c){e.isEmptyObject(c)?a.onRemoteServiceClean(b):(b.id=c.id,b.http=c.clientData.splittedUri.protocol,b.ip=c.clientData.splittedUri.ip,b.port=c.clientData.splittedUri.port,b.path=c.clientData.splittedUri.path,b.dto=c,b.checked=1==c.status)},a.onRemoteServiceClean=function(a){e.isEmptyObject(a)||(a.id=null,a.uri="",a.dto=null,a.checked=void 0)},a.onSubmit=function(){"generalinfo"==a.datacenterTab.value?(a.datacenterTab.value="remoteservices",a.setAcceptLabel(i("translate")("globals.save")),a.setCancelLabel(i("translate")("globals.back")),e.refreshLayout()):(p(),b.createDatacenter(a.datacenter,u))};var u=function(){a.closePopup()};a.onCancel=function(){"remoteservices"==a.datacenterTab.value?(a.datacenterTab.value="generalinfo",a.setAcceptLabel(i("translate")("globals.next")),a.setCancelLabel(i("translate")("globals.cancel")),e.refreshLayout()):a.closePopup()},a.onShown=function(){a.datacenter=new b.Datacenter({}),a.datacenterTab.value="generalinfo",i("isGranted")("PHYS_DC_RETRIEVE_DETAILS")||(a.datacenter.clientData.automaticallyOpenServersView=!1),a.virtualizationmanager={type:"VIRTUAL_FACTORY",checked:void 0,ip:""},a.monitormanager={type:"VIRTUAL_SYSTEM_MONITOR",checked:void 0,ip:""},a.appliancemanager={type:"APPLIANCE_MANAGER",checked:void 0,ip:""},a.discoverymanager={type:"NODE_COLLECTOR",checked:void 0,ip:""},a.storagemanager={type:"STORAGE_SYSTEM_MONITOR",checked:void 0,ip:""},a.businessprocessmanager={type:"BPM_SERVICE",checked:void 0,ip:""},a.dhcpservice={type:"DHCP_SERVICE",checked:void 0,ip:""},a.dhcpv6={type:"DHCPv6",checked:void 0,ip:""},c.getRemoteServicesGlobal(d.noPagination.param,null,q)},a.duplicateIps=function(){var b=m();b&&(l(b,a.virtualizationmanager,!0),l(b,a.monitormanager,!0),l(b,a.appliancemanager,!0),l(b,a.discoverymanager,!0),l(b,a.storagemanager,!0),l(b,a.businessprocessmanager,!0),l(b,a.dhcpservice,!1),l(b,a.dhcpv6,!1),a.onChangeInput(a.virtualizationmanager,a.remoteServicesVirtualizationManager),a.onChangeInput(a.monitormanager,a.remoteServicesMonitorManager),a.onChangeInput(a.appliancemanager,a.remoteServicesApplianceManager),a.onChangeInput(a.discoverymanager,a.remoteServicesDiscoveryManager),a.onChangeInput(a.storagemanager,a.remoteServicesStoreManager),a.onChangeInput(a.businessprocessmanager,a.remoteServicesBussinessProcessManager),a.onChangeInput(a.dhcpservice,a.remoteServicesDhcpSevice),a.onChangeInput(a.dhcpv6,a.remoteServicesDhcpv6))},a.check=function(a){a.uri=s(a),a.checked=!1,c.checkRemoteService(a)},a.checkAll=function(){a.check(a.virtualizationmanager),a.check(a.monitormanager),a.check(a.appliancemanager),a.check(a.discoverymanager),a.check(a.storagemanager),a.check(a.businessprocessmanager),a.check(a.dhcpv6)},a.onAutomaticOpenDatacenterChange=function(a){h.userChoices.automaticallyOpenServersView=a,h.setUserChoicesCookie()}}]).controller("PublicDatacenterCreateCtrl",["$scope","datacentersMgr","commonsMgr","remoteServicesMgr","authenticationMgr","paginationHelper","uModals","utils","server","gridTemplates","$filter",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){if(a&&b)if(a.remoteServices||(a.remoteServices={collection:[]}),b.id&&b.dto){var c=angular.copy(i.getLinkByRel(b.dto.links,"edit"));c.rel="remoteservice",a.links.push(c)}else a.remoteServices.collection.push({type:b.type,uri:t(b)})}function m(a,b,c){h.isEmptyObject(b)||h.isEmptyObject(a)||(b.ip=a.ip,c&&(b.port=a.port))}function n(){var b,c=[a.virtualizationmanager,a.monitormanager,a.discoverymanager,a.cloudproviderproxy];return c.every(function(a){return h.isEmptyObject(a.ip)?!0:(b=a,!1)}),b}function o(a,b){var c=a.http==b.clientData.splittedUri.protocol;return c=c&&a.ip==b.clientData.splittedUri.ip,c=c&&a.port==b.clientData.splittedUri.port,c=c&&(!b.clientData.splittedUri.path||a.path==b.clientData.splittedUri.path)}function p(a,b){var c;if(a&&b)for(var d=0;d<b.length>0;d++){var e=b[d];if(o(a,e)){c=e;break}}return c}function q(){a.datacenter&&(a.datacenter.remoteServices&&a.datacenter.remoteServices.collection&&(a.datacenter.remoteServices.collection.length=0),a.datacenter.links.length=0),l(a.datacenter,a.virtualizationmanager),l(a.datacenter,a.monitormanager),l(a.datacenter,a.discoverymanager),l(a.datacenter,a.cloudproviderproxy)}function r(){a.remoteServicesVirtualizationManager=s(a.virtualizationmanager.type),a.remoteServicesMonitorManager=s(a.monitormanager.type),a.remoteServicesDiscoveryManager=s(a.discoverymanager.type),a.remoteServicesCloudProviderProxy=s(a.cloudproviderproxy.type)}function s(b){var c=k("filterBy")(a.remoteServices,{value:b,criteria:"type"});return c}function t(a){return u(a.http)+u(a.ip)+":"+u(a.port)+"/"+u(a.path)}function u(a){var b=a;return void 0===b&&(b=""),b}a.__name="PublicDatacenterCreateCtrl",a.isPublic=!0,a.editMode=!1,a.regionNeedsCredentials=!1,a.publicProviders=c.publicProviders,a.providerRegions=c.providerRegions,a.ipRegExPattern=h.regExPattern.ip,a.remoteServices=d.remoteServicesAll,a.firstPcrName="",a.datacenterTab={},a.onChangeInput=function(b,c){var d=p(b,c);a.onRemoteServiceSelected(b,d)},a.onRemoteServiceSelected=function(b,c){h.isEmptyObject(c)?a.onRemoteServiceClean(b):(b.id=c.id,b.http=c.clientData.splittedUri.protocol,b.ip=c.clientData.splittedUri.ip,b.port=c.clientData.splittedUri.port,b.path=c.clientData.splittedUri.path,b.dto=c,b.checked=1==c.status)},a.onRemoteServiceClean=function(a){a.id=null,a.uri="",a.dto=null,a.checked=void 0};var v=function(){var c=function(b){if(a.createdPcr++,b){if(i.removeAllLinksByRel(a.datacenter.links,"remoteservice"),a.datacenter.name=a.firstPcrName+"_"+a.createdPcr,angular.forEach(b.remoteServices.collection,function(b){var c=i.createLinkByRel(b.links,"edit","remoteservice");a.datacenter.links.push(c)}),b.remoteServices.configErrors){var c=[];angular.forEach(a.datacenter.remoteServices.collection,function(a){var d=!0;angular.forEach(b.remoteServices.collection,function(b){a.type==b.type&&(d=!0)}),d&&c.push(a)}),a.datacenter.remoteServices.collection=c}else a.datacenter.remoteServices.collection=[];v()}else a.closePopup()};if(a.createdPcr==a.pcrToBeCreated.length)a.closePopup();else{var d=angular.copy(a.datacenter);b.createPublicCloudRegion(d,a.pcrToBeCreated[a.createdPcr],c)}};a.onSubmit=function(){"generalinfo"==a.datacenterTab.value?(a.datacenterTab.value="remoteservices",a.setAcceptLabel(k("translate")("globals.save")),a.setCancelLabel(k("translate")("globals.back")),h.refreshLayout()):(a.createdPcr=0,a.pcrToBeCreated=[],a.firstPcrName=a.datacenter.name,angular.forEach(a.providerRegions,function(b){b.clientData.selected&&(0==a.pcrToBeCreated.length&&q(),a.pcrToBeCreated.push(b))}),0==a.pcrToBeCreated.length?g.showAlert({scope:a,message:k("translate")("datacenter.create.public.missingregion.message"),title:k("translate")("datacenter.create.public.missingregion.title"),showCancelBtn:!1,showConfirmBtn:!0,confirmLabel:k("translate")("globals.close")}):v())},a.onCancel=function(){"remoteservices"==a.datacenterTab.value?(a.datacenterTab.value="generalinfo",a.setAcceptLabel(k("translate")("globals.next")),a.setCancelLabel(k("translate")("globals.cancel")),h.refreshLayout()):a.closePopup()},a.onShown=function(){a.datacenterTab.value="generalinfo",a.regionNeedsCredentials=!1,c.providerRegions.length=0,a.datacenter=new b.Datacenter({}),k("isGranted")("PHYS_DC_RETRIEVE_DETAILS")||(a.datacenter.clientData.automaticallyOpenServersView=!1),a.virtualizationmanager={type:"VIRTUAL_FACTORY",checked:void 0,ip:""},a.monitormanager={type:"VIRTUAL_SYSTEM_MONITOR",checked:void 0,ip:""},a.discoverymanager={type:"NODE_COLLECTOR",checked:void 0,ip:""},a.cloudproviderproxy={type:"CLOUD_PROVIDER_PROXY",checked:void 0,ip:""},c.getPublicProviders(),d.getRemoteServicesGlobal(f.noPagination.param,null,r)},a.duplicateIps=function(){var b=n();b&&(m(b,a.virtualizationmanager,!0),m(b,a.monitormanager,!0),m(b,a.discoverymanager,!0),m(b,a.cloudproviderproxy,!0),a.onChangeInput(a.virtualizationmanager,a.remoteServicesVirtualizationManager),a.onChangeInput(a.monitormanager,a.remoteServicesMonitorManager),a.onChangeInput(a.discoverymanager,a.remoteServicesDiscoveryManager),a.onChangeInput(a.cloudproviderproxy,a.remoteServicesCloudProviderProxy))},a.check=function(a){a.uri=t(a),a.checked=!1,d.checkRemoteService(a)},a.checkAll=function(){a.check(a.virtualizationmanager),a.check(a.monitormanager),a.check(a.discoverymanager),a.check(a.cloudproviderproxy)},a.onAutomaticOpenDatacenterChange=function(a){e.userChoices.automaticallyOpenServersView=a,e.setUserChoicesCookie()},a.onProviderChange=function(){a.datacenter&&""!=a.datacenter.provider&&(a.provider=k("getElementByParameter")(a.publicProviders,{element:a.datacenter.provider,attribute:"name"}),a.provider.constraints&&"MANDATORY"==a.provider.constraints.endpoint?(a.regionNeedsCredentials=!0,c.providerRegions.length=0):(a.regionNeedsCredentials=!1,a.retrieveProviderRegions()))},a.retrieveProviderRegions=function(b){c.getProviderRegions(a.provider,b,a.datacenter)},a.regionsGridOptions={data:"providerRegions",enableRowSelection:!1,columnDefs:[{field:"enabled",displayName:k("translate")("datacenter.create.public.generalinfo.col.selected"),cellTemplate:j.selectUpdatedNameCellTemplate,width:50},{field:"name",displayName:k("translate")("datacenter.create.public.generalinfo.col.name")}],multiSelect:!1}}]),angular.module("datacenterEdit",["remoteServiceSelector"]).controller("DatacenterEditCtrl",["$scope","$filter","datacentersMgr","remoteServicesMgr","paginationHelper","gridTemplates","utils","dispatcher","server",function(a,b,c,d,e,f,g,h,i){function j(c){var d={type:c},e=i.getLinkByRel(a.datacenter.links,"remoteservice",k(c));return d.id=i.getIdInLinkByParameter(e,"remoteservices"),d.dto=b("getElementById")(a.remoteServices,d.id),d.checked=1==d.dto.status,d}function k(a){var b="";if(a){var c=new RegExp("_","g");b=a.replace(c,"")}return b}function l(){m(),a.remoteServicesVirtualizationManager=n(a.virtualizationmanager.type),a.remoteServicesMonitorManager=n(a.monitormanager.type),a.remoteServicesDiscoveryManager=n(a.discoverymanager.type),a.isPublic?a.remoteServicesCloudProviderProxy=n(a.cloudproviderproxy.type):(a.remoteServicesStoreManager=n(a.storagemanager.type),a.remoteServicesDhcpSevice=n(a.dhcpservice.type),a.remoteServicesDhcpv6=n(a.dhcpv6.type))}function m(){a.virtualizationmanager=j("VIRTUAL_FACTORY"),a.monitormanager=j("VIRTUAL_SYSTEM_MONITOR"),a.discoverymanager=j("NODE_COLLECTOR"),a.isPublic?a.cloudproviderproxy=j("CLOUD_PROVIDER_PROXY"):(a.appliancemanager=j("APPLIANCE_MANAGER"),a.storagemanager=j("STORAGE_SYSTEM_MONITOR"),a.businessprocessmanager=j("BPM_SERVICE"),a.dhcpservice=j("DHCP_SERVICE"),a.dhcpv6=j("DHCPv6"))}function n(c){var d=b("filterBy")(a.remoteServices,{value:c,criteria:"type"});return d=b("filterBy")(d,{value:!0,criteria:"clientData.canBeAssigned"})}function o(a,b){if(!g.isEmptyObject(a)&&!g.isEmptyObject(b)){var c=angular.copy(i.getLinkByRel(b.links,"edit"));c.rel="remoteservice",c.title=b.type,a.links.push(c)}}function p(a,b){i.removeLinkByRel(a.links,"remoteservice",b.type),i.removeLinkByRel(a.links,"remoteservice",k(b.type))}a.__name="DatacenterEditCtrl",a.datacenter={},a.isPublic=!1,a.remoteServices=d.remoteServicesAll,a.editMode=!0,a.editDatacenterMode=!0;var q=function(){a.closePopup(a.popupElement)};a.onSubmit=function(){c.editDatacenter(a.datacenter,q)},a.onShown=function(){a.popupElement=a.getPopupElement(),a.datacenter=angular.copy(c.currentDatacenter),a.isPublic=a.datacenter.clientData.isPublicDatacenter,d.getRemoteServicesGlobal(e.noPagination.param,null,l)},a.onChangeRemoteService=function(c){p(a.datacenter,c);var d=b("getElementById")(a.remoteServices,c.id);c.dto=d,c.checked=1==d.status,o(a.datacenter,d)},a.check=function(a){d.checkRemoteService(a)},a.clearRemoteService=function(b){b.id=void 0,b.dto=void 0,b.checked=!1,p(a.datacenter,b)}}]),angular.module("datacenters",["datacenterCreate","datacenterEdit","servers","datacenterNetwork","storage","allocationRules","backupConfiguration"]).controller("DatacentersCtrl",["$scope",function(a){a.__name="DatacentersCtrl"}]).controller("DatacenterListCtrl",["$scope","systemPropertiesMgr","datacentersMgr","storageDevicesMgr","allocationRulesMgr","tiersMgr","serversMgr","paginationHelper","dispatcher",function(a,b,c,d,e,f,g,h,i){a.__name="DatacenterListCtrl",a.currentDatacenter=c.currentDatacenter,a.datacenters=c.datacenters,a.dcFilter=h.dcPaginator.filter,a.dcPaginationParam=h.dcPaginator.param,a.systemProperties=b.systemProperties;var j=function(){a.onDcFilterSubmit()},k=function(a){h.dcPaginator.param.totalSize=a.totalSize},l=function(){"datacenters"==a.infrastructureViewTab.value?c.getDatacentersPrivate(h.dcPaginator.param,h.dcPaginator.filter,k):"publiccloudregions"==a.infrastructureViewTab.value&&c.getDatacentersPublic(h.dcPaginator.param,h.dcPaginator.filter,k)},m=function(){c.deleteDatacenter(c.currentDatacenter)};a.onAllDatacenterClick=function(){a.dcFilter.has="",a.onDatacenterClick(null),a.onDcFilterSubmit()},a.onDcFilterSubmit=function(){h.dcPaginator.resetParam(),a.getPage(h.dcPaginator.param.currentPage)},a.getPage=function(a){h.dcPaginator.param.startwith=(a-1)*h.dcPaginator.param.limit,c.setCurrentDatacenter(null),l()},i.on(["datacenter.created","datacenter.edited","datacenter.deleted"],l,a),a.onDatacenterClick=function(a){c.setCurrentDatacenter(a)},a.onDeleteDatacenterConfirm=function(){m()},j()}]).controller("DatacenterDetailCtrl",["$scope","datacentersMgr","configMgr","dispatcher","$filter","utils",function(a,b,c,d,e,f){function g(){e("isGranted")("PHYS_DC_RETRIEVE_DETAILS")&&(a.dcViewTab="data",a.isPrivateDatacenter(a.currentDatacenter)&&(a.dcTab.value="servers"))}a.__name="DatacenterDetailCtrl",a.currentDatacenter=b.currentDatacenter,a.dcTab={value:"servers"},a.mapEnabled=c.config["client.google.maps.enabled"],a.dcViewTab=a.mapEnabled?"map":"stats",a.chartsEnabled=1==c.config["client.google.charts.enabled"],d.on("currentDatacenter.change",function(b,c){f.isEmptyObject(a.currentDatacenter)?a.dcViewTab=a.mapEnabled?"map":"stats":f.isEmptyObject(c.previousValue)&&g()},a),d.on("datacenter.deleted",function(){b.isPrivateDatacenter(a.currentDatacenter)?"data"==a.dcViewTab&&(a.dcViewTab=a.mapEnabled?"map":"stats"):a.dcViewTab=a.mapEnabled?"map":"stats"},a),a.onTabClick=function(b){a.dcViewTab=b},a.isPrivateDatacenter=function(a){return b.isPrivateDatacenter(a)}}]).controller("MapCtrl",["$scope","$filter","datacentersMgr","systemPropertiesMgr","configMgr","utils",function(a,b,c,d,e,f){a.__name="MapCtrl",a.datacenters=c.datacenters,a.systemProperties=d.systemProperties;try{a.googleMapsEnabled=!0;var g=new google.maps.Geocoder}catch(h){a.googleMapsEnabled=!1}angular.extend(a,{center:{latitude:parseInt(a.systemProperties.infrastructure["client.infra.googleMapsDefaultLatitude"].value),longitude:parseInt(a.systemProperties.infrastructure["client.infra.googleMapsDefaultLongitude"].value)},markers:[],zoom:parseInt(a.systemProperties.infrastructure["client.infra.googleMapsDefaultZoom"].value)}),a.$watch("datacenters.length",function(){var b=0;a.markers.length=0,angular.forEach(a.datacenters,function(c){g&&c.location&&g.geocode({address:c.location},function(c,d){if(d==google.maps.GeocoderStatus.OK){var e={latitude:c[0].geometry.location.lat(),longitude:c[0].geometry.location.lng(),icon:"theme/abicloudDefault/img/map-marker.png"};a.markers.push(e),b+=1,b==a.datacenters.length&&a.markers.length<=1&&angular.copy(e,a.center),f.refreshLayout()}else d==google.maps.GeocoderStatus.ZERO_RESULTS})})})}]).controller("StatsCtrl",["$scope","datacentersMgr","statisticsMgr","dispatcher","utils",function(a,b,c,d,e){a.__name="StatsCtrl",a.currentDatacenter=b.currentDatacenter,a.cloudResources=c.cloudResources,a.colors=["#444444","#cc6666 ","#75993E"];var f=function(){g()},g=function(){e.isEmptyObject(a.currentDatacenter)?c.getAllCloudResources():c.getCloudResourcesByDatacenter(b.currentDatacenter)};d.on("currentDatacenter.change",g,a),f()}]),angular.module("elasticNetwork",[]).controller("ElasticNetworkListCtrl",["$scope","datacentersMgr","virtualDatacentersMgr","networksMgr","paginationHelper","utils","dispatcher",function(a,b,c,d,e,f,g){a.__name="ElasticNetworkListCtrl",a.currentDatacenter=b.currentDatacenter,a.currentVirtualDatacenter=c.currentVirtualDatacenter,a.currentNetwork=d.currentNetwork,a.networks=d.networks,a.ntwFilter=e.ntwPaginator.filter,a.ntwPaginationParam=e.ntwPaginator.param;var h=function(){d.getServiceTypesByDataCenter(a.currentDatacenter),i(a.currentDatacenter)},i=function(b){f.emptyObject(d.currentNetwork),f.isEmptyObject(b)||d.getElasticNetworksByDC(b,a.ntwPaginationParam,a.ntwFilter)};a.onNtwFilterSubmit=function(){e.ntwPaginator.resetParam(),i(a.currentDatacenter)},a.onNetworkClick=function(a){d.setCurrentNetwork(a)},a.onDeleteNetworkConfirm=function(){d.deleteNetwork(a.currentNetwork)},g.on(["currentdatacenter.change","currentNetwork.change"],function(b,c){e.ntwPaginator.resetParam(),("currentNetwork.change"!=b.name||f.isEmptyObject(c.data))&&i(a.currentDatacenter)},a),a.getPage=function(b){e.ntwPaginator.param.startwith=(b-1)*e.ntwPaginator.param.limit,i(a.currentDatacenter)},h()}]).controller("ElasticNetworkDetailCtrl",["$scope","$filter","networksMgr","paginationHelper","dispatcher","utils","gridTemplates","uModals","$timeout","safeApply",function(a,b,c,d,e,f,g,h,i,j){a.__name="ElasticNetworkDetailCtrl";var k=new ngGridLayoutPlugin;a.ips=c.ips,a.ipFilter=d.ipPaginator.filter,a.ipPaginationParam=d.ipPaginator.param,a.sortInfo={fields:[""],directions:["asc","desc"]};var l=function(){n()},m=function(b){d.ipPaginator.param.totalSize=b.totalSize,i(function(){j(a)},100)},n=function(b){f.isEmptyObject(c.currentNetwork)?c.getElasticIpsByDC(a.currentDatacenter,b,d.ipPaginator.param,d.ipPaginator.filter,m):c.getIpsByNetwork(c.currentNetwork,b,d.ipPaginator.param,d.ipPaginator.filter,m)};a.updateQuarantine=function(d){h.showAlert({scope:a,message:d.quarantine?b("translate")("network.quarantine.confirm.message"):b("translate")("network.quarantine.release.confirm.message"),title:d.quarantine?b("translate")("network.quarantine.confirm.title"):b("translate")("network.quarantine.release.confirm.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:b("translate")("globals.cancel"),confirmLabel:b("translate")("globals.confirm"),confirmFn:function(){c.editNetworkIp(d)},cancelFn:function(){d.quarantine=!d.quarantine}})},a.ipsGridOptions={data:"ips",plugins:[k],sortInfo:a.sortInfo,columnDefs:[{field:"ip",displayName:b("translate")("networkgrid.heading.ipaddress"),width:280,cellTemplate:g.ipCellTemplate},{field:"mac",displayName:b("translate")("networkgrid.heading.mac")},{field:"networkName",displayName:b("translate")("networkgrid.heading.vlan")},{field:"clientData.virtualAppliance.name",displayName:b("translate")("networkgrid.heading.virtualappliance")},{field:"clientData.virtualMachine.name",displayName:b("translate")("networkgrid.heading.virtualmachine")},{field:"quarantine",displayName:b("translate")("networkgrid.heading.quarantine"),cellTemplate:g.quarantineCell,width:65}],useExternalSorting:!0,multiSelect:!1},a.updateLayout=function(){k.updateGridLayout()},a.onIpFilterSubmit=function(){d.ipPaginator.resetParam(),n()},a.getPage=function(a){d.ipPaginator.param.startwith=(a-1)*d.ipPaginator.param.limit,n()},a.$on("timer",function(){n(!0)}),e.on(["currentNetwork.change"],function(a,b){d.ipPaginator.resetParam(),n()},a),a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var b=c.sortMappping[a.fields[0]],e="asc"===a.directions[0]?!0:!1;d.ipPaginator.filter.by=b,d.ipPaginator.filter.asc=e,getIps()}},!0),l()}]),angular.module("externalNetworkCreate",[]).controller("ExternalNetworkCreateCtrl",["$scope","networksMgr","enterprisesMgr","datacentersMgr","gridTemplates","utils","server","$filter","$timeout",function(a,b,c,d,e,f,g,h,i){a.__name="ExternalNetworkCreateCtrl",a.netmasks=b.netmasks,a.serviceTypes=b.serviceTypes,a.enterprises=c.enterprises,a.currentDatacenter=d.currentDatacenter,a.ipRegExPattern=f.regExPattern.ip,a.ipNoHostnamesRegExPattern=f.regExPattern.ipNoHostnames,a.isInfrastructure=!0,a.isExternal=!0;var j;a.onShown=function(){j=a.getPopupElement(),a.tagStatus="",a.staticRoute={},a.network={links:[],mask:b.netmasks[2].length,dhcpOptions:{collection:[]},type:"EXTERNAL"},a.staticRoutes=[],c.getEnterprises()},a.onIpv6Click=function(){i(function(){a.network.mask=a.network.ipv6?b.netmasks[11].length:b.netmasks[2].length,a.network.ipv6||(a.network.strict=!1)})},a.addStaticRoute=function(){a.staticRoutes.push(angular.copy(a.staticRoute))},a.deleteRow=function(b){a.staticRoutes.splice(b.rowIndex,1)};var k=function(b){a.closePopup(j)};a.onSubmit=function(){var d=h("getElementByParameter")(c.enterprises,{element:parseInt(a.network.clientData.enterprise.id),attribute:"id"}),e=g.createLinkByRel(d.links,"edit","enterprise");a.network.links.push(e);var f=h("getElementByParameter")(b.serviceTypes,{element:parseInt(a.network.clientData.serviceType.id),attribute:"id"}),i=g.createLinkByRel(f.links,"edit","networkservicetype");a.network.links.push(i),a.network.dhcpOptions.collection=a.staticRoutes,b.createNetwork(a.currentDatacenter,a.network,k)},a.isInvalidStaticRoute=function(b){var c=!f.validateRegEx(a.ipRegExPattern,b.networkAddress)||!f.validateRegEx(a.ipRegExPattern,b.netmask)||!f.validateRegEx(a.ipRegExPattern,b.gateway);return c};var l=function(b){a.tagStatus=b.available};a.checkTag=function(c){b.checkTag(a.currentDatacenter,c,l)},a.staticRoutesGridOptions={data:"staticRoutes",columnDefs:[{field:"id",displayName:"",width:50,headerCellTemplate:e.deleteHeaderTemplate,cellTemplate:e.deleteCellTemplate},{field:"networkAddress",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.netAddress")},{field:"netmask",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.mask")},{field:"gateway",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.gateway")}],multiSelect:!1},a.staticRoutesChange=function(a){a&&f.refreshLayout()}}]),angular.module("externalNetworkEdit",[]).controller("ExternalNetworkEditCtrl",["$scope","networksMgr","enterprisesMgr","datacentersMgr","gridTemplates","utils","server","$filter",function(a,b,c,d,e,f,g,h){a.__name="ExternalNetworkEditCtrl",a.networktype="external",a.netmasks=b.netmasks,a.serviceTypes=b.serviceTypes,a.enterprises=c.enterprises,a.currentDatacenter=d.currentDatacenter,a.ipRegExPattern=f.regExPattern.ip,a.ipNoHostnamesRegExPattern=f.regExPattern.ipNoHostnames,a.isInfrastructure=!0,a.isExternal=!0,a.editMode=!0,a.onShown=function(){a.tagStatus="",a.staticRoute={},a.network=angular.copy(b.currentNetwork),a.network.dhcpOptions.collection||(a.network.dhcpOptions.collection=[]),a.staticRoutes=a.network.dhcpOptions.collection,a.staticRoutesCB=a.staticRoutes.length>0,c.getEnterprises()},a.addStaticRoute=function(){a.network.dhcpOptions.collection.push(angular.copy(a.staticRoute))},a.deleteRow=function(b){a.network.dhcpOptions.collection.splice(b.rowIndex,1)};var i=function(b){a.closePopup()};a.onSubmit=function(){if(b.currentNetwork.clientData.enterprise.id!=a.network.clientData.enterprise.id){g.removeLinkByRel(a.network.links,"enterprise");var d=h("getElementByParameter")(c.enterprises,{element:parseInt(a.network.clientData.enterprise.id),attribute:"id"}),e=g.createLinkByRel(d.links,"edit","enterprise");a.network.links.push(e)}if(b.currentNetwork.clientData.serviceType.id!=a.network.clientData.serviceType.idd){g.removeLinkByRel(a.network.links,"networkservicetype");var f=h("getElementByParameter")(b.serviceTypes,{element:parseInt(a.network.clientData.serviceType.id),attribute:"id"}),j=g.createLinkByRel(f.links,"edit","networkservicetype");a.network.links.push(j)}b.editNetwork(a.network,i)};var j=function(c){"USED"==c.available&&a.network.tag==b.currentNetwork.tag?a.tagStatus="AVAILABLE":a.tagStatus=c.available};a.checkTag=function(c){b.checkTag(a.currentDatacenter,c,j)},a.staticRoutesGridOptions={data:"staticRoutes",columnDefs:[{field:"id",displayName:"",width:50,headerCellTemplate:e.deleteHeaderTemplate,cellTemplate:e.deleteCellTemplate},{field:"networkAddress",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.netAddress")},{field:"netmask",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.mask")},{field:"gateway",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.gateway")}],multiSelect:!1},a.staticRoutesChange=function(a){a&&f.refreshLayout()}}]),angular.module("externalNetwork",["externalNetworkCreate","externalNetworkEdit","ips","ipCreate"]).controller("ExternalNetworkListCtrl",["$scope","$filter","systemPropertiesMgr","enterprisesMgr","datacentersMgr","virtualDatacentersMgr","networksMgr","paginationHelper","utils","dispatcher","server",function(a,b,c,d,e,f,g,h,i,j,k){function l(){i.isEmptyObject(a.currentNetwork)||a.currentNetwork.ipv6||a.currentNetwork.unmanaged||i.showPopUp({controller:"IpsCtrl",popupUrl:"modules/infrastructure/datacenters/network/ips/partials/ipsform.html",formName:"editIpsForm",title:b("translate")("networklist.edit.title"),acceptLabel:b("translate")("globals.save"),closeOnAccept:!1,infoUrl:c.systemProperties.wikiLinks["client.wiki.network.externalVlan"].value},a)}function m(){i.isEmptyObject(a.currentDatacenter)||i.isEmptyObject(a.currentNetwork)||a.currentNetwork.unmanaged||i.showPopUp({controller:"IpCreateCtrl",popupUrl:"modules/infrastructure/datacenters/network/ips/commons/partials/ipform.html",formName:"createIPForm",title:b("translate")("networklist.ip.create.title"),closeOnAccept:!1},a)}function n(a){var c=b("getElementById")(a.collection,o.id);g.setCurrentNetwork(c),m()}a.__name="ExternalNetworkListCtrl",a.enterprises=d.enterprises,a.currentEnterprise=d.currentEnterprise,a.currentDatacenter=e.currentDatacenter,a.currentNetwork=g.currentNetwork,a.networks=g.networks,a.systemProperties=c.systemProperties,a.ntwFilter=h.ntwPaginator.filter,a.ntwPaginationParam=h.ntwPaginator.param;var o,p=function(){g.getServiceTypesByDataCenter(a.currentDatacenter),q(a.currentDatacenter)},q=function(b,c){i.emptyObject(g.currentNetwork),i.isEmptyObject(b)||g.getExternalNetworksByDC(b,a.ntwPaginationParam,a.ntwFilter,c)};a.onNtwFilterSubmit=function(){h.ntwPaginator.resetParam(),q(a.currentDatacenter)},a.onDeleteNetworkConfirm=function(){g.deleteNetwork(a.currentNetwork)},a.onNetworkClick=function(a){g.setCurrentNetwork(a)},j.on(["currentDatacenter.change","currentNetwork.change","networks.edited","networks.deleted"],function(a,b){("currentNetwork.change"!=a.name||i.isEmptyObject(b.data))&&p()},a),j.on("networks.created",function(b,c){o=c.data,q(a.currentDatacenter,n)},a),j.on("networks.ips.edited",function(a,b){var c=b.data.length&&b.data.length>0?b.data[0].links:b.data.links,d=k.getLinkByRel(c,"externalnetwork");if(o){var e=k.getLinkByRel(o.links,"edit");d.href==e.href&&(l(),o=null)}},a),a.getPage=function(b){h.ntwPaginator.param.startwith=(b-1)*h.ntwPaginator.param.limit,q(a.currentDatacenter)},p()}]).controller("ExternalNetworkDetailCtrl",["$scope","$filter","networksMgr","datacentersMgr","systemPropertiesMgr","paginationHelper","dispatcher","utils","uModals","gridTemplates","$timeout","safeApply",function(a,b,c,d,e,f,g,h,i,j,k,l){
a.__name="ExternalNetworkDetailCtrl";var m=new ngGridLayoutPlugin;a.ips=c.ips,a.ipFilter=f.ipPaginator.filter,a.ipPaginator=f.ipPaginator,a.currentDatacenter=d.currentDatacenter,a.currentNetwork=c.currentNetwork,a.systemProperties=e.systemProperties,a.sortInfo={fields:[""],directions:["asc","desc"]};var n=function(){p()},o=function(b){f.ipPaginator.param.totalSize=b.totalSize,k(function(){l(a)},100)},p=function(b){h.isEmptyObject(c.currentNetwork)?c.getExternalIpsByDC(a.currentDatacenter,b,f.ipPaginator.param,f.ipPaginator.filter,o):c.getIpsByExternalNetwork(c.currentNetwork,b,f.ipPaginator.param,f.ipPaginator.filter,o)};a.updateQuarantine=function(d){i.showAlert({scope:a,message:d.quarantine?b("translate")("network.quarantine.confirm.message"):b("translate")("network.quarantine.release.confirm.message"),title:d.quarantine?b("translate")("network.quarantine.confirm.title"):b("translate")("network.quarantine.release.confirm.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:b("translate")("globals.cancel"),confirmLabel:b("translate")("globals.confirm"),confirmFn:function(){c.editNetworkIp(d)},cancelFn:function(){d.quarantine=!d.quarantine}})},a.ipsGridOptions={data:"ips",plugins:[m],sortInfo:a.sortInfo,columnDefs:[{field:"ip",displayName:b("translate")("networkgrid.heading.ipaddress"),width:280,cellTemplate:j.ipCellTemplate},{field:"mac",displayName:b("translate")("networkgrid.heading.mac")},{field:"networkName",displayName:b("translate")("networkgrid.heading.vlan")},{field:"clientData.virtualAppliance.name",displayName:b("translate")("networkgrid.heading.virtualappliance")},{field:"clientData.virtualMachine.name",displayName:b("translate")("networkgrid.heading.virtualmachine")},{field:"quarantine",displayName:b("translate")("networkgrid.heading.quarantine"),cellTemplate:j.quarantineCell,width:65}],useExternalSorting:!0,multiSelect:!1},a.updateLayout=function(){m.updateGridLayout()},a.onIpFilterSubmit=function(){f.ipPaginator.resetParam(),p()},a.getPage=function(a){f.ipPaginator.param.startwith=(a-1)*f.ipPaginator.param.limit,p()},g.on(["currentNetwork.change","networks.ips.edited","networks.deleted"],function(){f.ipPaginator.resetParam(),p()},a),a.$on("timer",function(){p(!0)});var q={};a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var b=c.sortMappping[a.fields[0]],d="asc"===a.directions[0]?!0:!1;(q.orderBy!=b||q.asc!=d)&&(q.orderBy=b,q.asc=d,f.ipPaginator.filter.by=b,f.ipPaginator.filter.asc=d,p())}},!0),n()}]),angular.module("ipCreate",[]).controller("IpCreateCtrl",["$scope","$filter","networksMgr","utils","systemPropertiesMgr",function(a,b,c,d,e){function f(){a.closePopup(i)}function g(){c.createNetworkIp(a.ip,c.currentNetwork,f)}function h(){a.ip={ipv6:a.currentNetwork.ipv6,available:!0,quarantine:!1,numips:1}}a.__name="IpCreateCtrl",a.currentNetwork=c.currentNetwork,a.ipRegExp=d.regExPattern.ip,a.maxRequestedIps=e.systemProperties.infrastructure["client.main.maxRequestedIps"].value;var i;a.onShown=function(){h()},a.onSubmit=function(){a.ip.numips<=a.maxRequestedIps?g():d.toastrError(b("translate")("networklist.ip.create.maxcount.error",{maxRequestedIps:a.maxRequestedIps}))},a.onHidden=function(){},h()}]),angular.module("ips",[]).controller("IpsCtrl",["$scope","datacentersMgr","networksMgr","safeApply","utils","dispatcher",function(a,b,c,d,e,f){a.__name="IpsCtrl",a.datacenters=b.datacenters,a.ips=c.allIps,a.selectedNotAvailableIp={},a.selectedAvailableIp={};var g=function(){a.network=c.currentNetwork,e.isEmptyObject(c.currentNetwork)&&(e.isEmptyObject(c.createdNetwork)||(a.network=c.createdNetwork)),e.isEmptyObject(a.network)||("EXTERNAL"==a.network.type?c.getAllIpsByExternalNetwork(a.network,"infrastructureips"):c.getAllIpsByPublicNetwork(a.network))},h=function(b){a.closePopup()};a.onAvailableIpClick=function(b){angular.copy(b,a.currentAvailableIp)},a.dropIpOnNotAvailableAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").ip&&a.data("$scope").ip.available},a.dropIpOnNotAvailableListener=function(b){void 0!==b.data("$scope").ip&&(b.data("$scope").ip.available=!1,d(a))},a.dropIpOnAvailableAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").ip&&!a.data("$scope").ip.available},a.dropIpOnAvailableListener=function(b){void 0!==b.data("$scope").ip&&(b.data("$scope").ip.available=!0,d(a))},a.onSubmit=function(){var b={collection:a.ips};"EXTERNAL"==a.network.type?c.editExternalNetworkIps(a.network,b,h):c.editPublicNetworkIps(a.network,b,h)},a.onShown=function(){g()},a.onHidden=function(){},a.makeAllIpNotAvailable=function(){a.ips.forEach(function(a){a.available=!1}),angular.copy(null,a.selectedAvailableIp)},a.makeAllIpAvailable=function(){a.ips.forEach(function(a){a.available=!0}),angular.copy(null,a.selectedNotAvailableIp)},a.makeIpNotAvailable=function(){a.ips.forEach(function(b){a.selectedAvailableIp.id===b.id&&(b.available=!1)}),angular.copy(null,a.selectedAvailableIp)},a.makeIpAvailable=function(){a.ips.forEach(function(b){a.selectedNotAvailableIp.id===b.id&&(b.available=!0)}),angular.copy(null,a.selectedNotAvailableIp)},a.onAvailableClick=function(b){angular.copy(b,a.selectedAvailableIp)},a.onNotAvailableClick=function(b){angular.copy(b,a.selectedNotAvailableIp)},g(),f.on(["networks.ips.edited"],g,a)}]),angular.module("datacenterNetwork",["privateNetwork","externalNetwork","elasticNetwork","publicNetwork","serviceTypes"]).controller("DatacenterNetworkCtrl",["$scope","datacentersMgr","networksMgr",function(a,b,c){function d(){c.setCurrentNetwork({}),c.createdNetwork={}}a.__name="DatacenterNetworkCtrl",a.currentDatacenter=b.currentDatacenter,a.networkTab={value:"internal"},d()}]),angular.module("privateNetwork",["ipCreate"]).controller("PrivateNetworkListCtrl",["$scope","enterprisesMgr","datacentersMgr","virtualDatacentersMgr","networksMgr","paginationHelper","utils","dispatcher",function(a,b,c,d,e,f,g,h){function i(){e.setCurrentNetwork(null),k()}a.__name="PrivateNetworkListCtrl",a.enterprises=b.enterprises,a.currentEnterprise=b.currentEnterprise,a.currentDatacenter=c.currentDatacenter,a.currentVirtualDatacenter=d.currentVirtualDatacenter,a.currentNetwork=e.currentNetwork,a.entFilter=f.entPaginator.filter,a.entPaginationParam=f.entPaginator.param;var j=function(a){f.entPaginator.param.totalSize=a.totalSize},k=function(){c.isPrivateDatacenter(c.currentDatacenter)&&b.getEnterprisesWithNetworkInDataCenter(c.currentDatacenter,f.entPaginator.param,f.entPaginator.filter,j)},l=function(a){c.isPrivateDatacenter(c.currentDatacenter)&&d.getVirtualDataCentersByEnterpriseAndDataCenter(a,c.currentDatacenter)},m=function(a){g.isEmptyObject(a)||e.getPrivateNetworksByVirtualDataCenter(a)};a.onEntFilterSubmit=function(){f.entPaginator.resetParam(),k()},a.onOpenCloseEnterpriseClick=function(a){a.clientData.open&&l(a),a.clientData.open=!a.clientData.open},a.onEnterpriseClick=function(a){b.setCurrentEnterprise(a),d.setCurrentVirtualDatacenter(null),e.setCurrentNetwork(null),l(a),h.dispatch("datacenters.privatenetwork.selection.change",{data:a,type:"change"})},a.onOpenCloseVirtualDatacenterClick=function(a){a.clientData.open=!a.clientData.open},a.onVirtualDatacenterClick=function(a){e.setCurrentNetwork(null),b.setCurrentEnterprise(null),d.setCurrentVirtualDatacenter(a),m(a),h.dispatch("datacenters.privatenetwork.selection.change",{data:a,type:"change"})},a.onNetworkClick=function(a){d.setCurrentVirtualDatacenter(null),b.setCurrentEnterprise(null),e.setCurrentNetwork(a),h.dispatch("datacenters.privatenetwork.selection.change",{data:a,type:"change"})},h.on("currentDatacenter.change",k,a),a.getPage=function(a){f.entPaginator.param.startwith=(a-1)*f.entPaginator.param.limit,k()},i()}]).controller("PrivateNetworkDetailCtrl",["$scope","$filter","networksMgr","virtualDatacentersMgr","enterprisesMgr","systemPropertiesMgr","paginationHelper","utils","dispatcher","gridTemplates",function(a,b,c,d,e,f,g,h,i,j){a.__name="PrivateNetworkDetailCtrl";var k=new ngGridLayoutPlugin;a.ips=c.ips,a.currentNetwork=c.currentNetwork,a.currentVirtualDatacenter=d.currentVirtualDatacenter,a.currentEnterprise=e.currentEnterprise,a.systemProperties=f.systemProperties,a.ipFilter=g.ipPaginator.filter,a.ipPaginator=g.ipPaginator,a.sortInfo={fields:[""],directions:["asc","desc"]};var l=function(){q()},m=function(a){g.ipPaginator.param.totalSize=a.totalSize},n=function(a,b){c.getIpsByNetwork(a,b,g.ipPaginator.param,g.ipPaginator.filter,m)},o=function(a,b){c.getPrivateIpsByVirtualDataCenter(a,b,g.ipPaginator.param,g.ipPaginator.filter,m)},p=function(a,b){c.getPrivateIpsByEnterprise(a,b,g.ipPaginator.param,g.ipPaginator.filter,m)},q=function(a){h.isEmptyObject(c.currentNetwork)?h.isEmptyObject(d.currentVirtualDatacenter)?h.isEmptyObject(e.currentEnterprise)||p(e.currentEnterprise,a):o(d.currentVirtualDatacenter,a):n(c.currentNetwork,a)};a.ipsGridOptions={data:"ips",plugins:[k],sortInfo:a.sortInfo,columnDefs:[{field:"ip",displayName:b("translate")("networkgrid.heading.ipaddress"),width:280,cellTemplate:j.ipCellTemplate},{field:"mac",displayName:b("translate")("networkgrid.heading.mac")},{field:"networkName",displayName:b("translate")("networkgrid.heading.vlan")},{field:"clientData.virtualAppliance.name",displayName:b("translate")("networkgrid.heading.virtualappliance")},{field:"clientData.virtualMachine.name",displayName:b("translate")("networkgrid.heading.virtualmachine")}],useExternalSorting:!0,multiSelect:!1},a.updateLayout=function(){k.updateGridLayout()},a.onIpFilterSubmit=function(){g.ipPaginator.resetParam(),q()},a.getPage=function(a){g.ipPaginator.param.startwith=(a-1)*g.ipPaginator.param.limit,q()},i.on(["datacenters.privatenetwork.selection.change","networks.ips.edited"],function(){g.ipPaginator.resetParam(),q()},a),a.$on("timer",function(){q(!0)});var r={};a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var b=c.sortMappping[a.fields[0]],d="asc"===a.directions[0]?!0:!1;(r.orderBy!=b||r.asc!=d)&&(r.orderBy=b,r.asc=d,g.ipPaginator.filter.by=b,g.ipPaginator.filter.asc=d,q())}},!0),l()}]),angular.module("publicNetworkCreate",[]).controller("PublicNetworkCreateCtrl",["$scope","networksMgr","enterprisesMgr","datacentersMgr","gridTemplates","utils","server","$filter","$timeout",function(a,b,c,d,e,f,g,h,i){a.__name="PublicNetworkCreateCtrl",a.netmasks=b.netmasks,a.serviceTypes=b.serviceTypes,a.currentDatacenter=d.currentDatacenter,a.ipRegExPattern=f.regExPattern.ip,a.ipNoHostnamesRegExPattern=f.regExPattern.ipNoHostnames,a.isInfrastructure=!0,a.onShown=function(){a.tagStatus="",a.staticRoute={},a.network={links:[],mask:b.netmasks[2].length,dhcpOptions:{collection:[]},type:"PUBLIC"},a.staticRoutes=[]},a.onIpv6Click=function(){i(function(){a.network.mask=a.network.ipv6?b.netmasks[11].length:b.netmasks[2].length,a.network.ipv6||(a.network.strict=!1)})},a.addStaticRoute=function(){a.staticRoutes.push(angular.copy(a.staticRoute))},a.deleteRow=function(b){a.staticRoutes.splice(b.rowIndex,1)};var j=function(b){a.closePopup()};a.onSubmit=function(){var c=h("getElementByParameter")(b.serviceTypes,{element:parseInt(a.network.clientData.serviceType.id),attribute:"id"}),d=g.createLinkByRel(c.links,"edit","networkservicetype");a.network.links.push(d),a.network.dhcpOptions.collection=a.staticRoutes,b.createNetwork(a.currentDatacenter,a.network,j)};var k=function(b){a.tagStatus=b.available};a.checkTag=function(c){b.checkTag(a.currentDatacenter,c,k)},a.staticRoutesGridOptions={data:"staticRoutes",columnDefs:[{field:"id",displayName:"",width:50,headerCellTemplate:e.deleteHeaderTemplate,cellTemplate:e.deleteCellTemplate},{field:"networkAddress",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.netAddress")},{field:"netmask",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.mask")},{field:"gateway",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.gateway")}],multiSelect:!1}}]),angular.module("publicNetworkEdit",[]).controller("PublicNetworkEditCtrl",["$scope","networksMgr","enterprisesMgr","datacentersMgr","gridTemplates","utils","server","$filter",function(a,b,c,d,e,f,g,h){a.__name="PublicNetworkEditCtrl",a.networktype="public",a.netmasks=b.netmasks,a.serviceTypes=b.serviceTypes,a.enterprises=c.enterprises,a.currentDatacenter=d.currentDatacenter,a.ipRegExPattern=f.regExPattern.ip,a.ipNoHostnamesRegExPattern=f.regExPattern.ipNoHostnames,a.isInfrastructure=!0,a.editMode=!0,a.onShown=function(){a.tagStatus="",a.staticRoute={},a.network=angular.copy(b.currentNetwork),a.network.dhcpOptions.collection||(a.network.dhcpOptions.collection=[]),a.staticRoutes=a.network.dhcpOptions.collection,a.staticRoutesCB=a.staticRoutes.length>0},a.addStaticRoute=function(){a.network.dhcpOptions.collection.push(angular.copy(a.staticRoute))},a.deleteRow=function(b){a.network.dhcpOptions.collection.splice(b.rowIndex,1)};var i=function(b){a.closePopup()};a.onSubmit=function(){if(b.currentNetwork.clientData.serviceType.id!=a.network.clientData.serviceType.id){g.removeLinkByRel(a.network.links,"networkservicetype");var c=h("getElementByParameter")(b.serviceTypes,{element:parseInt(a.network.clientData.serviceType.id),attribute:"id"}),d=g.createLinkByRel(c.links,"edit","networkservicetype");a.network.links.push(d)}b.editNetwork(a.network,i)};var j=function(c){"USED"==c.available&&a.network.tag==b.currentNetwork.tag?a.tagStatus="AVAILABLE":a.tagStatus=c.available};a.checkTag=function(c){b.checkTag(a.currentDatacenter,c,j)},a.staticRoutesGridOptions={data:"staticRoutes",columnDefs:[{field:"id",displayName:"",width:50,headerCellTemplate:e.deleteHeaderTemplate,cellTemplate:e.deleteCellTemplate},{field:"networkAddress",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.netAddress")},{field:"mask",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.mask")},{field:"gateway",displayName:h("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.gateway")}],multiSelect:!1}}]),angular.module("publicNetwork",["publicNetworkCreate","publicNetworkEdit","ipCreate"]).controller("PublicNetworkListCtrl",["$scope","$filter","server","enterprisesMgr","datacentersMgr","virtualDatacentersMgr","networksMgr","paginationHelper","utils","dispatcher","systemPropertiesMgr",function(a,b,c,d,e,f,g,h,i,j,k){function l(){a.currentNetwork.ipv6||i.showPopUp({controller:"IpsCtrl",popupUrl:"modules/infrastructure/datacenters/network/ips/partials/ipsform.html",formName:"editIpsForm",title:b("translate")("networklist.edit.title"),acceptLabel:b("translate")("globals.save"),closeOnAccept:!1,infoUrl:k.systemProperties.wikiLinks["client.wiki.network.publicVlan"].value},a)}function m(){i.isEmptyObject(a.currentDatacenter)||i.isEmptyObject(a.currentNetwork)||a.currentNetwork.unmanaged||i.showPopUp({controller:"IpCreateCtrl",popupUrl:"modules/infrastructure/datacenters/network/ips/commons/partials/ipform.html",formName:"createIPForm",title:b("translate")("networklist.ip.create.title"),closeOnAccept:!1},a)}function n(a){var c=b("getElementById")(a.collection,o.id);g.setCurrentNetwork(c),m()}a.__name="PublicNetworkListCtrl",a.currentDatacenter=e.currentDatacenter,a.currentVirtualDatacenter=f.currentVirtualDatacenter,a.currentNetwork=g.currentNetwork,a.networks=g.networks,a.systemProperties=k.systemProperties,a.ntwFilter=h.ntwPaginator.filter,a.ntwPaginationParam=h.ntwPaginator.param;var o,p=function(){g.getServiceTypesByDataCenter(a.currentDatacenter),s(a.currentDatacenter)},q=function(a){h.ntwPaginator.param.totalSize=a.totalSize},r=function(){e.isPrivateDatacenter(e.currentDatacenter)&&d.getEnterprisesWithNetworkInDataCenter(e.currentDatacenter,h.ntwPaginator.param,h.ntwPaginator.filter,q)},s=function(b,c){i.emptyObject(g.currentNetwork),i.isEmptyObject(b)||g.getPublicNetworksByDC(b,a.ntwPaginationParam,a.ntwFilter,c)};a.onEnterpriseClick=function(a){d.setCurrentEnterprise(a),f.setCurrentVirtualDatacenter(null),g.setCurrentNetwork(null),s(a)},a.onNtwFilterSubmit=function(){h.ntwPaginator.resetParam(),s(a.currentDatacenter)},a.onDeleteNetworkConfirm=function(){g.deleteNetwork(a.currentNetwork)},a.onNetworkClick=function(a){g.setCurrentNetwork(a)},j.on(["currentDatacenter.change","currentNetwork.change","networks.edited","networks.deleted"],function(a,b){("currentNetwork.change"!=a.name||i.isEmptyObject(b.data))&&p()},a),j.on("networks.created",function(b,c){o=c.data,s(a.currentDatacenter,n)},a),j.on("networks.ips.edited",function(a,b){var d=b.data.length&&b.data.length>0?b.data[0].links:b.data.links,e=c.getLinkByRel(d,"publicnetwork");if(o){var f=c.getLinkByRel(o.links,"edit");e.href==f.href&&(l(),o=null)}},a),a.getPage=function(a){h.ntwPaginator.param.startwith=(a-1)*h.ntwPaginator.param.limit,r()},p()}]).controller("PublicNetworkDetailCtrl",["$scope","$filter","networksMgr","datacentersMgr","systemPropertiesMgr","paginationHelper","utils","dispatcher","$timeout","safeApply","uModals","gridTemplates",function(a,b,c,d,e,f,g,h,i,j,k,l){a.__name="PublicNetworkDetailCtrl";var m=new ngGridLayoutPlugin;a.ips=c.ips,a.currentDatacenter=d.currentDatacenter,a.currentNetwork=c.currentNetwork,a.ipFilter=f.ipPaginator.filter,a.ipPaginationParam=f.ipPaginator.param,a.systemProperties=e.systemProperties,a.sortInfo={fields:[""],directions:["asc","desc"]};var n=function(){p()},o=function(b){f.ipPaginator.param.totalSize=b.totalSize,i(function(){j(a)},100)},p=function(b){g.isEmptyObject(c.currentNetwork)?c.getPublicIpsByDC(a.currentDatacenter,b,f.ipPaginator.param,f.ipPaginator.filter,o):c.getIpsByNetwork(c.currentNetwork,b,f.ipPaginator.param,f.ipPaginator.filter,o)};a.updateQuarantine=function(d){k.showAlert({scope:a,message:d.quarantine?b("translate")("network.quarantine.confirm.message"):b("translate")("network.quarantine.release.confirm.message"),title:d.quarantine?b("translate")("network.quarantine.confirm.title"):b("translate")("network.quarantine.release.confirm.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:b("translate")("globals.cancel"),confirmLabel:b("translate")("globals.confirm"),confirmFn:function(){c.editNetworkIp(d)},cancelFn:function(){d.quarantine=!d.quarantine}})},a.ipsGridOptions={data:"ips",plugins:[m],sortInfo:a.sortInfo,columnDefs:[{field:"ip",displayName:b("translate")("networkgrid.heading.ipaddress"),width:280,cellTemplate:l.ipCellTemplate},{field:"mac",displayName:b("translate")("networkgrid.heading.mac")},{field:"networkName",displayName:b("translate")("networkgrid.heading.vlan")},{field:"clientData.purchaseBy.name",displayName:b("translate")("networkgrid.heading.purchasedby")},{field:"clientData.virtualAppliance.name",displayName:b("translate")("networkgrid.heading.virtualappliance")},{field:"clientData.virtualMachine.name",displayName:b("translate")("networkgrid.heading.virtualmachine")},{field:"quarantine",displayName:b("translate")("networkgrid.heading.quarantine"),cellTemplate:l.quarantineCell,width:65}],useExternalSorting:!0,multiSelect:!1},a.updateLayout=function(){m.updateGridLayout()},a.onIpFilterSubmit=function(){f.ipPaginator.resetParam(),p()},a.getPage=function(a){f.ipPaginator.param.startwith=(a-1)*f.ipPaginator.param.limit,p()},h.on(["currentNetwork.change","networks.ips.edited","networks.deleted"],function(){f.ipPaginator.resetParam(),p()},a),a.$on("timer",function(){p(!0)});var q={};a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var b=c.sortMappping[a.fields[0]],d="asc"===a.directions[0]?!0:!1;(q.orderBy!=b||q.asc!=d)&&(q.orderBy=b,q.asc=d,f.ipPaginator.filter.by=b,f.ipPaginator.filter.asc=d,console.log("sortInfo",q),p())}},!0),n()}]),angular.module("serviceTypeCreate",[]).controller("ServiceTypeCreateCtrl",["$scope","datacentersMgr","networksMgr",function(a,b,c){a.__name="ServiceTypeCreateCtrl";var d=function(b){a.closePopup()};a.onShown=function(){a.serviceType={}},a.onSubmit=function(){c.createServiceType(b.currentDatacenter,a.serviceType,d)}}]),angular.module("serviceTypeEdit",[]).controller("ServiceTypeEditCtrl",["$scope","datacentersMgr","networksMgr",function(a,b,c){a.__name="ServiceTypeEditCtrl";var d=function(b){a.closePopup()};a.onShown=function(){a.serviceType=angular.copy(c.currentServiceType)},a.onSubmit=function(){c.editServiceType(a.serviceType,d)}}]),angular.module("serviceTypes",["serviceTypeCreate","serviceTypeEdit"]).controller("ServiceTypesCtrl",["$scope","networksMgr","datacentersMgr","utils","gridTemplates","$filter","dispatcher",function(a,b,c,d,e,f,g){a.__name="ServiceTypesCtrl",a.serviceTypes=b.serviceTypes,a.currentDatacenter=c.currentDatacenter,a.currentServiceType=b.currentServiceType;var h=function(){c.isPrivateDatacenter(c.currentDatacenter)&&b.getServiceTypesByDataCenter(c.currentDatacenter)},i=function(){h()};a.returnName=function(a){var b=a.name;return b+=1==a.defaultNST?" ("+f("translate")("servicetype.list.label.default")+")":" "},a.onDeleteServiceTypeConfirm=function(){b.deleteServiceType(a.currentServiceType)};var j=function(a){a.selected&&b.setCurrentServiceType(a.entity)};a.serviceTypesGridOptions={data:"filteredServiceTypes",columnDefs:[{field:"name",displayName:f("translate")("servicetype.grid.column.name"),sortable:!0,cellTemplate:e.networkServiceTypeNameTemplate}],afterSelectionChange:j,multiSelect:!1},a.$watch("serviceTypes",function(){a.filteredServiceTypes=f("networkServiceTypesFilter")(a.serviceTypes)},!0),g.on(["networkServiceType.created","networkServiceType.edited","networkServiceType.deleted","currentDatacenter.change"],h,a),i()}]),angular.module("remoteServiceSelector",[]).controller("RemoteServiceSelectorCtrl",["$scope","$filter","remoteServicesMgr","paginationHelper","utils","gridTemplates","dispatcher",function(a,b,c,d,e,f,g){function h(){c.setCurrentRemoteService(null),a.remoteServiceType&&"all"!=a.remoteServiceType?d.remoteServicesPaginator.filter.type=i(a.remoteServiceType):delete d.remoteServicesPaginator.filter.type,c.getRemoteServicesGlobal(d.remoteServicesPaginator.param,d.remoteServicesPaginator.filter),a.formIsValid()}function i(a){var b="";if(a){var c=new RegExp("_","g");b=a.replace(c,"")}return b}function j(b){b.selected&&c.setCurrentRemoteService(b.entity),a.formIsValid()}a.__name="RemoteServiceSelectorCtrl",a.remoteServiceTypes=c.remoteServiceTypesArray,a.remoteServices=c.remoteServicesAll,a.remoteServicesPaginationParam=d.remoteServicesPaginator.param,a.remoteServicesPaginationFilter=d.remoteServicesPaginator.filter,a.remoteServiceType="all",a.onFilterSubmit=function(){h()},a.onRemoteServiceTypeChange=function(b){a.remoteServiceType=b,h()},a.onShown=function(){h(),a.validExternally=!1},a.onSubmit=function(){g.dispatch("remoteServices.added",{data:c.currentRemoteService}),a.closePopup()},a.onHidden=function(){},a.formIsValid=function(){var b=!e.isEmptyObject(c.currentRemoteService)&&c.currentRemoteService.clientData.canBeAssigned;a.validExternally=b},a.isNotValidRow=function(a){var b=!1;if(a){var c=a.entity;b=e.isEmptyObject(c)||!c.clientData.canBeAssigned}return b},a.getDataTooltipForRow=function(c){var d="";return a.isNotValidRow(c)&&(d=b("translate")("remoteservicesview.grid.tooltip.notassignable")),d};var k='<div ng-repeat="col in renderedColumns" ng-class="{\'notassignable\':isNotValidRow(row)}" class="{{loadData[$index].CssClass}} ngCell {{columnClass($index)}} col{{$index}} {{col.cellClass}}" data-tooltip="{{getDataTooltipForRow(row)}}" ng-cell ></div>';a.gridRemoteServices={data:"remoteServices",columnDefs:[{field:"clientData.splittedUri.protocol",displayName:b("translate")("remoteservicesview.grid.title.column.protocol"),sortable:!1,width:50},{field:"clientData.splittedUri.ip",displayName:b("translate")("remoteservicesview.grid.title.column.ip"),sortable:!1},{field:"clientData.splittedUri.port",displayName:b("translate")("remoteservicesview.grid.title.column.port"),sortable:!1,width:50},{field:"clientData.splittedUri.path",displayName:b("translate")("remoteservicesview.grid.title.column.path"),sortable:!1},{field:"type",displayName:b("translate")("remoteservicesview.grid.title.column.type"),sortable:!1},{field:"status",displayName:b("translate")("remoteservicesview.grid.title.column.status"),sortable:!1,width:150,cellTemplate:f.stateRemoteServiceCellTemplate,width:90}],multiSelect:!1,afterSelectionChange:j,rowTemplate:k}}]),angular.module("captureVirtualMachine",[]).controller("CaptureVirtualMachine",["$scope","virtualMachinesMgr","virtualAppliancesMgr","enterprisesMgr","datacentersMgr","virtualDatacentersMgr","dispatcher","uModals","systemPropertiesMgr","navigationMgr","serversMgr","$filter","utils",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){h.showPopUp({scope:a,controller:"CaptureVirtualMachineInfo",popupUrl:"modules/infrastructure/datacenters/servers/capture/partials/capturevirtualmachineinfo.html",formName:"captureVirtualMachineInfoForm",title:l("translate")("servers.virtualmachine.capture.title"),acceptLabel:l("translate")("globals.accept"),cancelLabel:l("translate")("globals.cancel"),showAcceptBtn:!0,showCancelBtn:!0,infoUrl:i.systemProperties.wikiLinks["client.wiki.vm.captureVirtualMachine"].value})}a.__name="CaptureVirtualMachine",a.currentVirtualMachine=b.currentVirtualMachine,a.virtualAppliances=c.virtualAppliances,a.currentEnterprise=d.userEnterprise,a.currentDatacenter=e.currentDatacenter,a.currentMachine=k.currentMachine,a.ipRegExPattern=m.regExPattern.ip;var o,p=function(a){f.virtualDatacenters.length>0&&f.setCurrentVirtualDatacenter(f.virtualDatacenters[0])},q=function(b){a.virtualAppliances=l("filterByHypervisor")(c.virtualAppliances,k.currentMachine)},r=function(b){a.closePopup(o,n)},s=function(b){b.selected&&(c.setCurrentVirtualAppliance(b.entity),a.validExternally=!0)};a.compatibleVirtualAppliancesGrid={data:"virtualAppliances",columnDefs:[{field:"clientData.virtualDatacenter.name",displayName:l("translate")("servers.virtualmachine.capture.col.virtualdatacenter")},{field:"name",displayName:l("translate")("servers.virtualmachine.capture.col.name")},{field:"state",displayName:""}],afterSelectionChange:s,multiSelect:!1},a.onShown=function(){o=a.getPopupElement(),a.validExternally=!1,c.getVirtualAppliancesByEnterpriseAndDatacenter(a.currentEnterprise,a.currentDatacenter,q),f.getVirtualDataCentersByEnterprise(a.currentEnterprise,a.currentMachine,p)},a.onSubmit=function(){m.isEmptyObject(c.currentVirtualAppliance)||b.getVirtualMachineWithResources(a.currentVirtualMachine,r)},a.onHidden=function(){},g.on("virtualAppliance.created",function(){"infrastructure"==j.mainView&&a.onShown()},a)}]).controller("CaptureVirtualMachineInfo",["$scope","virtualMachinesMgr","virtualAppliancesMgr","networksMgr","$filter","configMgr","utils",function(a,b,c,d,e,f,g){a.__name="CaptureVirtualMachineInfo",a.isInfrastructure=!0,a.virtualAppliance=c.currentVirtualAppliance,a.networks=d.networks;var h;a.ramUnitSelector={conversion:void 0},a.ramUnits=g.unitsSelector,a.keyMaps=f.config["config.keymaps"];var i=function(){a.virtualMachine=angular.copy(b.currentVirtualMachine),a.currentVirtualMachine=angular.copy(b.currentVirtualMachine),a.validExternally=!1,d.getAllNetworksByVirtualDatacenters(a.virtualAppliance.clientData.virtualDatacenter.id)},j=function(){a.closePopup()},k=function(a){h.clientData.ip="",a.collection?h.clientData.ips=a.collection:h.clientData.ips=a};a.formIsValid=function(){var b=!0;g.isEmptyObject(a.currentVirtualMachine)?b=!1:angular.forEach(a.currentVirtualMachine.nics.collection,function(a){a.clientData&&a.clientData.vlan.id?a.ip||(b=!1):b=!1}),a.validExternally=b},a.virtualMachineVolumesGridOptions={data:"currentVirtualMachine.clientData.virtualDisks",columnDefs:[{field:"sequence",displayName:e("translate")("virtualmachine.details.storage.attachmentorder")},{field:"name",displayName:e("translate")("virtualmachine.details.storage.name")},{field:"clientData.tier.name",displayName:e("translate")("virtualmachine.details.storage.tier")},{field:"sizeInMb",displayName:e("translate")("virtualmachine.details.storage.totalsize"),cellTemplate:"<p>{{row.getProperty(col.field) | sizeUnit}}</p>"},{field:"clientData.type",displayName:e("translate")("virtualmachine.details.storage.type")}],multiSelect:!1},a.onChangeVlan=function(b){if(h=b,h.ip=null,h&&h.clientData&&h.clientData.vlan)switch(h.clientData.vlan=angular.copy(e("getElementByParameter")(a.networks,{element:parseInt(h.clientData.vlan.id),attribute:"id"})),h.clientData.vlan.type){case"INTERNAL":d.getIpsByNetwork(h.clientData.vlan,null,{},{},k);break;case"PUBLIC":d.getAllIpsByPublicNetwork(h.clientData.vlan,k);break;case"EXTERNAL":d.getAllIpsByExternalNetwork(h.clientData.vlan,"ips",k)}a.formIsValid()},a.onShown=function(){var b=g.formatSizeInMb(a.virtualMachine.ram);a.ramUnitSelector.conversion=g.unitsSelector[b.units].conversion,a.virtualMachine.ram=b.size},a.onSubmit=function(){b.importVirtualMachine(angular.copy(a.currentVirtualMachine),a.virtualAppliance,a.virtualAppliance.clientData.virtualDatacenter,j)},a.$watch("vmTab",function(){a.formIsValid()}),i()}]),angular.module("physicalMachineCreate",[]).controller("PhysicalMachineValidateCreateCtrl",["$scope","serversMgr","datacentersMgr","systemPropertiesMgr","commonsMgr","networksMgr","$filter","utils",function(a,b,c,d,e,f,g,h){function i(){a.closePopup(null,function(){h.showPopUp({scope:a,controller:"PhysicalMachineCreateCtrl",popupUrl:"modules/infrastructure/datacenters/servers/create/partials/physicalmachinecreate.html",formName:"newPhysicalMachineForm",title:g("translate")("servers.physicalmachine.create.title"),closeOnAccept:!1,closeOnCancel:!1,showAcceptBtn:!0,showCancelBtn:!0,infoUrl:d.systemProperties.wikiLinks["client.wiki.infra.createPhysicalMachine"].value,popupWidth:750},a)})}a.__name="PhysicalMachineValidateCreateCtrl",a.hypervisorType={},a.hypervisorTypes=e.hypervisorTypes,a.hypervisorTypeName={selected:null},a.ipRegExPattern=h.regExPattern.ip;var j=function(){c.isPrivateDatacenter(c.currentDatacenter)&&f.getServiceTypesByDataCenter(c.currentDatacenter)},k=function(){a.hypervisorType=g("orderBy")(g("hypervisorTypeDiscriminateFilter")(a.hypervisorTypes),"realName")[0],a.hypervisorTypeName.selected=a.hypervisorType.name,a.machine={user:d.systemProperties.infrastructure["client.infra.defaultHypervisorUser"].value,password:d.systemProperties.infrastructure["client.infra.defaultHypervisorPassword"].value,port:""!=d.systemProperties.infrastructure["client.infra.defaultHypervisorPort"].value?parseInt(d.systemProperties.infrastructure["client.infra.defaultHypervisorPort"].value):"",hypervisor:a.hypervisorTypeName.selected},a.showIpService=a.machine.ipService,j()};a.onSubmit=function(){(a.hypervisorType.constraints.discover_through_manager||"NO_APPLICABLE"==a.hypervisorType.constraints.host_ip)&&(a.machine.ip=""),"NO_APPLICABLE"==a.hypervisorType.constraints.agent_ip&&(a.machine.agentip=""),"NO_APPLICABLE"==a.hypervisorType.constraints.manager_ip&&(a.machine.managerip=""),"NO_APPLICABLE"==a.hypervisorType.constraints.host_credentials&&(a.machine.user=""),"NO_APPLICABLE"==a.hypervisorType.constraints.agent_credentials&&(a.machine.agentuser=""),"NO_APPLICABLE"==a.hypervisorType.constraints.manager_credentials&&(a.machine.manageruser=""),"NO_APPLICABLE"==a.hypervisorType.constraints.host_credentials&&(a.machine.password=""),"NO_APPLICABLE"==a.hypervisorType.constraints.agent_credentials&&(a.machine.agentuser=""),"NO_APPLICABLE"==a.hypervisorType.constraints.manager_credentials&&(a.machine.managerpassword=""),(a.hypervisorType.constraints.discover_through_manager||"NO_APPLICABLE"==a.hypervisorType.constraints.host_port)&&(a.machine.port=""),"NO_APPLICABLE"==a.hypervisorType.constraints.agent_port&&(a.machine.agentport=""),"NO_APPLICABLE"==a.hypervisorType.constraints.manager_port&&(a.machine.managerport=""),b.discover(a.machine,c.currentDatacenter,i)},a.onShown=function(){k()},a.onHidden=function(){},a.onHypervisorChange=function(){a.hypervisorType=g("getElementByParameter")(a.hypervisorTypes,{element:a.hypervisorTypeName.selected,attribute:"name"}),a.machine.hypervisor=a.hypervisorType.name;
},k()}]).controller("PhysicalMachineCreateCtrl",["$scope","serversMgr","uModals","systemPropertiesMgr","commonsMgr","datacentersMgr","networksMgr","server","utils","gridTemplates","$timeout","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){a.showDetails=1==b.discoverMachines.length,a.machine.clientData.retrieveVirtualMachines=!0,a.rack=i.isEmptyObject(b.currentRack)?b.racks[0]:angular.copy(b.currentRack),w()}function n(a){var b=[];return angular.forEach(a,function(a){var c=h.getLinkByRel(a.links,"edit");-1===c.type.indexOf("ucs")&&b.push(a)}),b}function o(b){var c={};return angular.forEach(a.hypervisorTypes,function(a){a.name===b&&(c=angular.copy(a))}),c}function p(b,c){var d=function(e){a.createdMachinesCount++,a.createdMachinesCount==b.length?c():q(b[a.createdMachinesCount],d)};q(b[a.createdMachinesCount],d)}function q(c,d){var e=l("getElementByParameter")(a.racks,{element:parseInt(a.rack.id),attribute:"id"});b.createPhysicalMachine(e,angular.copy(c),a.serviceTypes,d)}function r(a,b){var c=i.getObjectAttributeValue(a,"clientData.editGrid."+b);null!=c?a[b]=c:console.log("save property skip:",b)}function s(a,b){var c=i.getObjectAttributeValue(a,"clientData.editGrid."+b);null!=c?a.clientData.editGrid[b]=a[b]:console.log("cancel property skip:",b)}function t(a){var b=[{field:"enabled",displayName:l("translate")("servers.physicalmachine.form.datastores.col.enabled"),cellTemplate:j.datastoreEnabledCellTemplate,width:50},{field:"rootPath",displayName:l("translate")("servers.physicalmachine.form.datastores.col.rootpath")},{field:"directory",displayName:l("translate")("servers.physicalmachine.form.datastores.col.directory")},{field:"size",displayName:l("translate")("servers.physicalmachine.form.datastores.col.size"),cellTemplate:j.sizeUnitInBytesCellTemplate},{field:"usedSize",displayName:l("translate")("servers.physicalmachine.form.datastores.col.used"),cellTemplate:j.sizeUnitInBytesCellTemplate}];return a&&("KVM"==a.type?b=[{cellTemplate:j.editRowButtonsCell,sortable:!1,width:50},{field:"enabled",displayName:l("translate")("servers.physicalmachine.form.datastores.col.enabled"),cellTemplate:j.datastoreEnabledCellTemplate,width:50},{field:"rootPath",displayName:l("translate")("servers.physicalmachine.form.datastores.col.rootpath")},{field:"directory",displayName:l("translate")("servers.physicalmachine.form.datastores.col.directory"),cellTemplate:j.editRowTextInputCell},{field:"size",displayName:l("translate")("servers.physicalmachine.form.datastores.col.size"),cellTemplate:j.editRowBytesInputCell},{field:"usedSize",displayName:l("translate")("servers.physicalmachine.form.datastores.col.used"),cellTemplate:j.editRowBytesInputCell}]:"HYPER-V"==a.type&&(b=[{cellTemplate:j.editRowButtonsCell,sortable:!1,width:50},{field:"enabled",displayName:l("translate")("servers.physicalmachine.form.datastores.col.enabled"),cellTemplate:j.datastoreEnabledCellTemplate,width:50},{field:"rootPath",displayName:l("translate")("servers.physicalmachine.form.datastores.col.rootpath"),cellTemplate:j.editRowTextInputCell},{field:"directory",displayName:l("translate")("servers.physicalmachine.form.datastores.col.directory"),cellTemplate:j.editRowTextInputCell},{field:"size",displayName:l("translate")("servers.physicalmachine.form.datastores.col.size"),cellTemplate:j.editRowBytesInputCell},{field:"usedSize",displayName:l("translate")("servers.physicalmachine.form.datastores.col.used"),cellTemplate:j.editRowBytesInputCell}])),b}a.__name="PhysicalMachineCreateCtrl",a.machine=b.discoverMachines[0],a.machines=b.discoverMachines,a.racks=n(angular.copy(b.racks)),a.hypervisorTypes=e.hypervisorTypes,a.serviceTypes=g.serviceTypes,a.machine&&(a.hypervisorType=o(a.machine.type)),a.physicalMachineStates=b.states,a.ipRegExPattern=i.regExPattern.ip,a.currentDatacenter=f.currentDatacenter,a.ipRegExPattern=i.regExPattern.ip,a.onShown=function(){},a.onHidden=function(){};var u=function(){a.closePopup()},v=function(c){"ORACLE_VM"!=a.hypervisorType.name&&a.machine.clientData.retrieveVirtualMachines?b.getVirtualMachinesFromPhysicalMachine(c,u):a.closePopup()};a.checkState=function(){a.machine.state="",a.machine.clientData.checkingState=!0,b.checkPhysicalMachineState(a.machine,a.currentDatacenter)},a.onSubmit=function(){if(a.machines.length>1)if(a.showDetails)a.showDetails=!1;else{var b=[];angular.forEach(a.machines,function(a){a.clientData.enabled&&b.push(a)}),a.createdMachinesCount=0,p(b,v)}else q(a.machine,v)},a.onCancel=function(){a.machines.length>1&&a.showDetails?(a.showDetails=!1,angular.extend(a.machine,a.originalPhysicalMachine),w()):a.closePopup()},a.checkServiceTypeValidity=function(b){b.hasOwnProperty("clientData")||(b.clientData={serviceType:{id:0}}),b.clientData.serviceType.id||(b.clientData.serviceType.id=0);var c=parseInt(b.clientData.serviceType.id),d=b.mac;angular.forEach(a.machine.networkInterfaces.collection,function(a){a.hasOwnProperty("clientData")&&c===parseInt(a.clientData.serviceType.id)&&d!=a.mac&&0!=c&&(b.clientData.serviceType.id=0)}),w()},a.editPhysicalMachine=function(b){a.originalPhysicalMachine=angular.copy(b),a.machine=b,a.showDetails=!0,w()};var w=function(){var b=!1;a.someDatastoreEnabled=!1;var c=!1;a.showDetails?(b=!0,a.machine.clientData.incomplete=!0,a.machine.datastores.collection.forEach(function(b){return b.enabled?void(a.someDatastoreEnabled=!0):void 0}),a.machine.networkInterfaces.collection.forEach(function(a){return a.clientData&&0!==parseInt(a.clientData.serviceType.id)?void(c=!0):void 0}),a.machine.clientData.incomplete=!1):a.machines.forEach(function(d){if(d.clientData.enabled){if(b=!0,a.someDatastoreEnabled=!1,c=!1,d.clientData.incomplete=!0,d.datastores.collection.forEach(function(b){return b.enabled?void(a.someDatastoreEnabled=!0):void 0}),!a.someDatastoreEnabled)return;if(a.machine.networkInterfaces.collection.forEach(function(a){return a.clientData&&0!==parseInt(a.clientData.serviceType.id)?void(c=!0):void 0}),!c)return;d.clientData.incomplete=!1}}),k(function(){a.validExternally=b&&a.someDatastoreEnabled&&c})};a.onMachineEnableChange=function(){w()};var x='<div><input type="button" data-ng-disabled="!row.entity.clientData.enabled" class="grid-btn-primary btn-primary btn-block" value="'+l("translate")("globals.edit")+'" data-ng-click="editPhysicalMachine(row.entity)"/></div> ',y='<div class="row-fluid span9"><input id="enablePhysicalMachine{{row.entity.initiatorIQN}}" u-checkbox type="checkbox"  data-ng-model="row.entity.clientData.enabled" data-ng-change="onMachineEnableChange()"> <label id="datastore-{{$index}}" class="checkbox inline" for="enablePhysicalMachine{{row.entity.initiatorIQN}}"><span></span> </label><div class="incomplete"><label data-ng-show="row.entity.clientData.enabled && row.entity.clientData.incomplete">'+l("translate")("servers.physicalmachine.form.incomplete")+"</label></div></div>";a.multiPhysicalMachineGrid={data:"machines",columnDefs:[{field:"",displayName:"",cellTemplate:x},{field:"ip",displayName:l("translate")("servers.physicalmachine.form.generalinfo.input.ip")},{field:"name",displayName:l("translate")("servers.physicalmachine.form.generalinfo.input.name")},{field:"type",displayName:l("translate")("servers.physicalmachine.form.generalinfo.input.hypervisortype")},{field:"",displayName:"",cellTemplate:y}],multiSelect:!1},a.networkInterfacesGridOptions={data:"machine.networkInterfaces.collection",filterOptions:{filterText:"",useExternalFilter:!1},columnDefs:[{field:"name",displayName:l("translate")("servers.physicalmachine.form.networkinterfaces.col.interface")},{field:"virtualMachine.name",displayName:l("translate")("servers.physicalmachine.form.networkinterfaces.col.servicetype"),cellTemplate:j.serviceTypeCell}],enableRowSelection:!1},a.onDatastoreEnableChange=function(){w()},a.saveRow=function(a){r(a,"rootPath"),r(a,"directory"),r(a,"size"),r(a,"usedSize")},a.cancelRow=function(a){s(a,"rootPath"),s(a,"directory"),s(a,"size"),s(a,"usedSize")},a.dataStoresGridOptions={data:"machine.datastores.collection",filterOptions:{filterText:"",useExternalFilter:!1},enableRowSelection:!1,columnDefs:t(a.machine),multiSelect:!1},m()}]),angular.module("rackCreate",[]).controller("RackCreateCtrl",["$scope","serversMgr","datacentersMgr","systemPropertiesMgr","$filter","uModals",function(a,b,c,d,e,f){function g(){a.closePopup(null,h)}function h(){a.rack.clientData&&a.rack.clientData.automaticallyOpenServerForm&&f.showPopUp({scope:a,controller:"PhysicalMachineValidateCreateCtrl",popupUrl:"modules/infrastructure/datacenters/servers/create/partials/physicalmachinevalidatecreate.html",formName:"validatePhysicalMachineForm",title:e("translate")("servers.physicalmachine.create.title"),closeOnAccept:!1,acceptLabel:e("translate")("globals.next"),cancelLabel:e("translate")("globals.cancel"),showAcceptBtn:!0,showCancelBtn:!0,infoUrl:d.systemProperties.wikiLinks["client.wiki.infra.createPhysicalMachine"].value})}a.__name="RackCreateCtrl",a.systemProperties=d.systemProperties,a.currentRackType={},a.editMode=!1,a.rackTypes=[{name:e("translate")("servers.rack.create.standard.title")},{name:e("translate")("servers.rack.create.ucs.title")}],a.onSubmit=function(){a.rackType.name===e("translate")("servers.rack.create.ucs.title")?b.createUCSRack(a.rack,c.currentDatacenter,g):(delete a.rack.ip,delete a.rack.user,delete a.rack.password,delete a.rack.port,delete a.rack.maxMachinesOn,b.createRack(angular.copy(a.rack),c.currentDatacenter,g))},a.onValidForm=function(){console.log("Rack create: Validate (rack name = ",a.rack.name,")"),!a.rack.name||""==a.rack.name.trim()||a.rack.vlanIdMin<parseInt(a.systemProperties.infrastructure["client.infra.vlanIdMin"].value)||a.rack.vlanIdMax>parseInt(a.systemProperties.infrastructure["client.infra.vlanIdMax"].value)||a.rack.vlanIdMin>=a.rack.vlanIdMax?a.validExternally=!1:a.validExternally=!0},a.onShown=function(){a.rackType=angular.copy(a.rackTypes[0]),a.rack={vlanIdMin:parseInt(a.systemProperties.infrastructure["client.infra.vlanIdMin"].value),vlanIdMax:parseInt(a.systemProperties.infrastructure["client.infra.vlanIdMax"].value),vlanPerVdcReserved:1,nrsq:10}}}]),angular.module("physicalMachineDetails",[]).controller("PhysicalMachineDetailsCtrl",["$scope","serversMgr","dispatcher",function(a,b,c){function d(){var c=0,d=0;if(b.currentMachine){var e=b.currentMachine.datastores;e&&e.collection&&angular.forEach(e.collection,function(a){a.enabled&&(c+=a.size,d+=a.usedSize)})}a.hardDisk=c,a.hardDiskUsed=d}a.__name="PhysicalMachineDetailsCtrl",a.currentMachine=b.currentMachine,a.onPlayClick=function(){},a.onPauseClick=function(){},a.onStopClick=function(){},a.onResetClick=function(){},c.on(["currentMachine.change"],d,a)}]).controller("PhysicalMachineDetailsGeneralCtrl",["$scope","commonsMgr",function(a,b){a.__name="PhysicalMachineDetailsGeneralCtrl",a.hypervisorTypes=b.hypervisorTypes,a.hypervisorName=function(){var b={};return a.currentMachine&&a.hypervisorTypes&&angular.forEach(a.hypervisorTypes,function(c){c.name===a.currentMachine.type&&(b=angular.copy(c))}),b.realName}}]).controller("PhysicalMachineDetailsDescriptionCtrl",["$scope",function(a){a.__name="PhysicalMachineDetailsDescriptionCtrl"}]).controller("PhysicalMachineDetailsNetworkInterfacesCtrl",["$scope","$filter","networksMgr","utils",function(a,b,c,d){a.__name="PhysicalMachineDetailsNetworkInterfacesCtrl";var e='<div class="ngCellText" ng-class="col.colIndex()"><span>{{getServiceTypeLabel(row.entity.clientData.serviceType.id)}}</span></div>';a.getServiceTypeLabel=function(a){var e="",f=b("getElementById")(c.serviceTypes,a);return d.isEmptyObject(f)||(e=f.name,f.defaultNST&&(e+=" "+b("translate")("servers.physicalmachine.form.networkinterfaces.col.servicetype.default"))),e},a.networkInterfacesGridOptions={data:"currentMachine.networkInterfaces.collection",columnDefs:[{field:"name",displayName:b("translate")("servers.physicalmachine.form.networkinterfaces.col.interface")},{field:"row.entity.clientData.serviceType.id",displayName:b("translate")("servers.physicalmachine.form.networkinterfaces.col.servicetype"),cellTemplate:e}],enableRowSelection:!1}}]).controller("PhysicalMachineDetailsStateCtrl",["$scope",function(a){a.__name="PhysicalMachineDetailsStateCtrl",a.colors=["#75993E","#bd362f"]}]),angular.module("physicalMachineEdit",[]).controller("PhysicalMachineEditCtrl",["$scope","serversMgr","$filter","commonsMgr","datacentersMgr","networksMgr","server","utils","gridTemplates",function(a,b,c,d,e,f,g,h,i){function j(b){var c={};return angular.forEach(a.hypervisorTypes,function(a){a.name===b&&(c=angular.copy(a))}),c}a.__name="PhysicalMachineEditCtrl",a.hypervisorTypes=d.hypervisorTypes,a.serviceTypes=f.serviceTypes,a.showDetails=!0,a.ipRegExPattern=h.regExPattern.ip,a.currentDatacenter=e.currentDatacenter,a.onShown=function(){f.getServiceTypesByDataCenter(e.currentDatacenter),a.machine=angular.copy(b.currentMachine),a.hypervisorType=j(a.machine.type),a.editMode=!0,a.showIpService=a.machine.ipService,l()};var k=function(){a.closePopup()};a.checkState=function(){a.machine.state="",a.machine.clientData.checkingState=!0,b.checkPhysicalMachineState(a.machine,a.currentDatacenter)},a.onSubmit=function(){b.editPhysicalMachine(angular.copy(a.machine),a.serviceTypes,k)},a.checkServiceTypeValidity=function(b){b.hasOwnProperty("clientData")||(b.clientData={serviceType:{id:0}}),b.clientData.serviceType.id||(b.clientData.serviceType.id=0);var c=parseInt(b.clientData.serviceType.id),d=b.mac;angular.forEach(a.machine.networkInterfaces.collection,function(a){a.hasOwnProperty("clientData")&&c===parseInt(a.clientData.serviceType.id)&&d!=a.mac&&0!=c&&(b.clientData.serviceType.id=0)}),l()};var l=function(){a.someDatastoreEnabled=!1;var b=!1;a.machine.datastores.collection.forEach(function(b){return b.enabled?void(a.someDatastoreEnabled=!0):void 0}),a.machine.networkInterfaces.collection.forEach(function(a){return a.clientData&&0!==parseInt(a.clientData.serviceType.id)?void(b=!0):void 0}),a.validExternally=a.someDatastoreEnabled&&b};a.multiPhysicalMachineGrid={},a.networkInterfacesGridOptions={data:"machine.networkInterfaces.collection",columnDefs:[{field:"name",displayName:c("translate")("servers.physicalmachine.form.networkinterfaces.col.interface")},{field:"",displayName:c("translate")("servers.physicalmachine.form.networkinterfaces.col.servicetype"),cellTemplate:i.serviceTypeCell}],enableRowSelection:!1},a.onDatastoreEnableChange=function(){l()},a.onUpdateDatastoresClick=function(){b.refreshDatastores(a.machine)},a.$watch("machine.datastores.collection",function(a,b){h.refreshLayout()}),a.dataStoresGridOptions={data:"machine.datastores.collection",columnDefs:[{field:"enabled",displayName:c("translate")("servers.physicalmachine.form.datastores.col.enabled"),cellTemplate:i.datastoreEnabledCellTemplate,width:50},{field:"rootPath",displayName:c("translate")("servers.physicalmachine.form.datastores.col.rootpath")},{field:"directory",displayName:c("translate")("servers.physicalmachine.form.datastores.col.directory")},{field:"size",displayName:c("translate")("servers.physicalmachine.form.datastores.col.size"),cellTemplate:i.sizeUnitInBytesCellTemplate},{field:"usedSize",displayName:c("translate")("servers.physicalmachine.form.datastores.col.used"),cellTemplate:i.sizeUnitInBytesCellTemplate}],multiSelect:!1}}]),angular.module("rackEdit",[]).controller("RackEditCtrl",["$scope","$filter","serversMgr",function(a,b,c){function d(){a.closePopup()}a.__name="RackEditCtrl",a.currentRackType={},a.rackTypes=[{name:b("translate")("servers.rack.create.standard.title")},{name:b("translate")("servers.rack.create.ucs.title")}],a.editMode=!0,a.onSubmit=function(){c.editRack(a.rack,d)},a.onValidForm=function(){a.rack.vlanIdMin<parseInt(a.systemProperties.infrastructure["client.infra.vlanIdMin"].value)||a.rack.vlanIdMax>parseInt(a.systemProperties.infrastructure["client.infra.vlanIdMax"].value)||a.rack.vlanIdMin>=a.rack.vlanIdMax||""==a.rack.name.trim()?a.validExternally=!1:a.validExternally=!0},a.onShown=function(){a.rack=angular.copy(c.currentRack),delete a.rack.clientData,void 0!==a.rack.ip?a.rackType=angular.copy(a.rackTypes[1]):a.rackType=angular.copy(a.rackTypes[0])}}]),angular.module("servers",["rackCreate","rackEdit","physicalMachineCreate","physicalMachineEdit","physicalMachineDetails","captureVirtualMachine"]).controller("ServersListCtrl",["$scope","serversMgr","datacentersMgr","virtualMachinesMgr","systemPropertiesMgr","paginationHelper","utils","dispatcher",function(a,b,c,d,e,f,g,h){function i(){b.setCurrentMachine(null),l()}a.__name="ServersListCtrl",a.currentEnterprise=b.currentEnterprise,a.currentRack=b.currentRack,a.currentMachine=b.currentMachine,a.currentDatacenter=c.currentDatacenter,a.racks=b.racks,a.enterprises=b.enterprises,a.systemProperties=e.systemProperties,a.physicalMachineFilter=f.physicalMachinePaginator.filter,a.physicalMachinePaginationParam=f.physicalMachinePaginator.param,a.isInInfrastructure=!0;var j=function(a){g.isEmptyObject(a)||b.getPhysicalMachines(a,f.physicalMachinePaginator.param,f.physicalMachinePaginator.filter)},k=function(){b.racks.forEach(function(a){return b.currentRack.id==a.id?void j(a):void 0})},l=function(e){e||(b.setCurrentMachine(null),b.setCurrentRack(null),b.setCurrentEnterprise(null),d.setCurrentVirtualMachine(null)),g.isEmptyObject(a.currentDatacenter)||(c.isPrivateDatacenter(a.currentDatacenter)?b.getRacks(a.currentDatacenter,e,f.physicalMachinePaginator.param,f.physicalMachinePaginator.filter):b.getEnterprises(a.currentDatacenter,e,f.physicalMachinePaginator.filter))};a.onRackClick=function(a){b.setCurrentMachine(null),b.setCurrentRack(a),b.setCurrentEnterprise(null),d.setCurrentVirtualMachine(null),a.clientData.open=!a.clientData.open,a.clientData.open&&j(a)},a.onEnterpriseClick=function(a){b.setCurrentMachine(null),b.setCurrentRack(null),b.setCurrentEnterprise(a),d.setCurrentVirtualMachine(null)},a.onMachineClick=function(a){b.setCurrentRackByPhysicalMachine(a),d.setCurrentVirtualMachine(null),b.setCurrentMachine(a)},a.onDeleteRackConfirm=function(){b.deleteRack(a.currentRack)},a.onDeleteMachineConfirm=function(){b.deletePhysicalMachine(a.currentMachine,i)},a.onServerFilterSubmit=function(){l()},h.on(["currentDatacenter.change","racks.created","racks.edited","racks.deleted","physicalmachine.created","physicalmachine.edited","physicalmachine.deleted"],l,a),h.on(["physicalMachines.enabled","physicalMachines.disabled"],k,a),a.$on("timer",function(){l(!0)}),l()}]).controller("ServerVirtualMachinesListCtrl",["$scope","$filter","refreshMgr","serversMgr","datacentersMgr","virtualMachinesMgr","gridTemplates","dispatcher","paginationHelper","utils",function(a,b,c,d,e,f,g,h,i,j){function k(){for(var a=0;a<p.length;a++){var b=p[a];f.getTaskStatus(b.data,function(a){if("FINISHED_SUCCESSFULLY"==a.state||"FINISHED_UNSUCCESSFULLY"==a.state){var c=p.indexOf(b);c>-1&&p.splice(c,1),o()}})}}a.__name="ServerVirtualMachinesListCtrl",a.virtualMachines=d.virtualMachines,a.currentEnterprise=d.currentEnterprise,a.currentRack=d.currentRack,a.currentMachine=d.currentMachine,a.currentVirtualMachine=f.currentVirtualMachine,a.isInInfrastructure=!0,a.virtualMachineStates=f.states,a.virtualMachinePaginationParam=i.virtualMachinePaginator.param,a.virtualMachineFilter=i.virtualMachinePaginator.filter,a.filteredVirtualMachines=[];var l=function(a){a.selected&&f.setCurrentVirtualMachine(a.entity)};a.virtualMachinesGridOptions={data:"filteredVirtualMachines",columnDefs:[{field:"name",displayName:b("translate")("servers.virtualmachine.col.name")},{field:"clientData.owner.name",displayName:b("translate")("servers.virtualmachine.col.owner")},{field:"clientData.enterprise.name",displayName:b("translate")("servers.virtualmachine.col.enterprise")},{field:"clientData.vmtemplate.name",displayName:b("translate")("servers.virtualmachine.col.vmtemplate")},{field:"cpu",displayName:b("translate")("servers.virtualmachine.col.cpu"),width:40},{field:"ram",displayName:b("translate")("servers.virtualmachine.col.ram"),width:80},{field:"idState",displayName:b("translate")("servers.virtualmachine.col.state"),cellTemplate:g.stateVMCellTemplate,width:40},{field:"protected",displayName:b("translate")("servers.virtualmachine.col.blocked"),cellTemplate:g.blockedVMCellTemplate,width:50},{field:"",displayName:"",cellTemplate:g.infoVMCellTemplate,width:30}],multiSelect:!1,enableColumnResize:!0,maintainColumnRatios:!0,afterSelectionChange:l},a.retrieveVirtualMachines=function(){j.isEmptyObject(d.currentMachine)||d.getVirtualMachinesFromPhysicalMachine(d.currentMachine)},a.deleteRetrievedVirtualMachines=function(){d.deleteRetrievedVirtualMachines(d.currentMachine)},a.onFilterSubmit=function(){a.filteredVirtualMachines=b("vmSearchFilter")(d.virtualMachines,i.virtualMachinePaginator.filter.has);var c=null;angular.forEach(a.filteredVirtualMachines,function(b){b.name==a.currentVirtualMachine.name&&(c=b)}),f.setCurrentVirtualMachine(c)};var m=function(b){a.onFilterSubmit()},n=function(b){!j.isEmptyObject(a.currentEnterprise)&&a.currentDatacenter.clientData.isPublicDatacenter&&a.onFilterSubmit()},o=function(b){var c;b&&"currentMachine.change"==b.name&&(c=!0),a.filteredVirtualMachines.length=0,j.isEmptyObject(d.currentMachine)?!j.isEmptyObject(a.currentEnterprise)&&a.currentDatacenter.clientData.isPublicDatacenter&&d.getVirtualMachines(a.currentEnterprise,c,i.virtualMachinePaginator.param,i.virtualMachinePaginator.filter,n):d.getVirtualMachines(d.currentMachine,c,i.virtualMachinePaginator.param,i.virtualMachinePaginator.filter,m)};a.onEnableDisablePhysicalMachine=function(a){"DISABLED_FOR_HA"==a.state?d.enableAfterHa(a):"HALTED"==a.state?d.enablePhysicalMachines(a):d.disablePhysicalMachines(a)},h.on(["currentDcEnterprise.change","currentMachine.change","virtualmachines.deleted","virtualmachine.imported","virtualmachine.released","virtualmachines.retrieved","virtualMachine.undeployed","virtualMachine.blocked","virtualMachine.unblocked"],o,a);var p=[];h.on(["virtualMachine.turnedon","virtualMachine.turnedoff","virtualMachine.paused","virtualMachine.reseted"],function(c,d){p.push(d);var e=b("getElementById")(a.filteredVirtualMachines,d.virtualMachine.id);j.isEmptyObject(e)||(e.idState=6,e.state=b("translate")("virtualmachine.status.onprocess"),console.log("item",e))},a),a.$on("timerVM",function(){k()}),a.captureVirtualMachine=function(a){}}]).controller("PhysicalMachineSendMailCtrl",["$scope","serversMgr","systemPropertiesMgr",function(a,b,c){a.__name="PhysicalMachineSendMailCtrl",a.currentMachine=b.currentMachine,a.systemProperties=c.systemProperties;var d=function(b){a.closePopup()};a.onShown=function(){a.email={clientData:{}}},a.onSubmit=function(){b.sendEmail(a.currentMachine,a.email,d)}}]),angular.module("storage",["storageDevices","tiers"]).controller("StorageCtrl",["$scope","virtualDatacentersMgr","volumesMgr",function(a,b,c){a.__name="StorageCtrl",a.isInfrastructure=!0;var d=function(){b.setCurrentVirtualDatacenter(null),c.volumes.length=0};d()}]),angular.module("storageDeviceCreate",[]).controller("StorageDeviceCreateCtrl",["$scope","storageDevicesMgr","datacentersMgr","$filter","utils",function(a,b,c,d,e){a.__name="StorageDeviceCreateCtrl",a.datacenter=c.currentDatacenter,a.ipRegExPattern=e.regExPattern.ip;var f,g=function(){a.closePopup(f)};a.onShown=function(){f=a.getPopupElement(),a.storageDevice={links:[],clientData:{datacenter:a.datacenter}}},a.onSubmit=function(){b.addStorageDevice(a.datacenter,a.storageDevice,g)},a.onStorageTechnologyChanged=function(){a.storageTechnology=d("getElementByParameter")(a.storageTechnologies,{element:a.storageDevice.storageTechnology,attribute:"type"}),a.storageDevice.managementPort=a.storageTechnology.defaultManagementPort,a.storageDevice.servicePort=a.storageTechnology.defaultServicePort}}]),angular.module("storageDeviceEdit",[]).controller("StorageDeviceEditCtrl",["$scope","storageDevicesMgr","datacentersMgr","$filter","utils","uModals",function(a,b,c,d,e,f){a.__name="StorageDeviceEditCtrl",a.datacenter=c.currentDatacenter,a.ipRegExPattern=e.regExPattern.ip,a.editMode=!0;var g=function(b){a.closePopup(a.popupElement)};a.onShown=function(){a.popupElement=a.getPopupElement(),a.storageDevice=angular.copy(b.currentStorageDevice),a.storageTechnology=d("getElementByParameter")(a.storageTechnologies,{element:a.storageDevice.storageTechnology,attribute:"type"})},a.onSubmit=function(){f.showAlert({scope:a,message:d("translate")("storage.devices.edit.warning.message"),title:d("translate")("storage.devices.edit.warning.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:d("translate")("globals.cancel"),confirmLabel:d("translate")("globals.confirm"),confirmFn:function(){b.editStorageDevice(a.storageDevice,g)}})}}]),angular.module("storageDevices",["storageDeviceCreate","storageDeviceEdit","storagePools"]).controller("StorageDevicesCtrl",["$scope","$filter","datacentersMgr","storageDevicesMgr","storagePoolsMgr","tiersMgr","volumesMgr","utils","dispatcher","uModals",function(a,b,c,d,e,f,g,h,i,j){a.__name="StorageDevicesCtrl",a.storageTechnologies=d.storageTechnologies,a.currentDatacenter=c.currentDatacenter,a.storageDevices=d.storageDevices,a.currentStorageDevice=d.currentStorageDevice,a.currentStoragePool=e.currentStoragePool;var k=function(){f.getTiersByDatacenter(a.currentDatacenter),l()},l=function(b){c.isPrivateDatacenter(a.currentDatacenter)&&(d.getStorageDevices(a.currentDatacenter,b),d.getStorageTechnologies(a.currentDatacenter))},m=function(){c.isPrivateDatacenter(a.currentDatacenter)&&f.getTiersByDatacenter(a.currentDatacenter)},n=function(){j.showPopUp({controller:"StoragePoolCreateCtrl",scope:a,popupUrl:"modules/infrastructure/datacenters/storage/storagepools/create/partials/storagepoolcreate.html",formName:"newStoragePoolCreatedDeviceForm",title:b("translate")("storage.storagepools.create.title"),closeOnAccept:!0,closeOnCancel:!0,acceptLabel:b("translate")("globals.save"),cancelLabel:b("translate")("globals.cancel"),showAcceptBtn:!0,showCancelBtn:!0,infoUrl:"",backdrop:"static"})};a.onStorageDeviceClick=function(a){g.volumes.length=0,a.clientData.open=!a.clientData.open,h.emptyObject(e.currentStoragePool),h.emptyObject(g.currentVolume),d.setCurrentStorageDevice(a),a.clientData.open&&e.getStoragePools(a)},a.onStoragePoolClick=function(a){h.emptyObject(d.currentStorageDevice),h.emptyObject(g.currentVolume),e.setCurrentStoragePool(a),g.getVolumesByStoragePool(a)},a.onDeleteStorageDeviceConfirm=function(){d.deleteStorageDevice(a.currentStorageDevice)},a.onDeleteStoragePoolConfirm=function(){e.deleteStoragePool(a.currentStoragePool)},i.on(["currentDatacenter.change","storageDevices.edited","storageDevices.deleted","storagePools.created","storagePools.edited","storagePools.deleted"],function(){l(),m()},a),i.on(["storageDevices.created"],function(a,b){d.setCurrentStorageDevice(b.data),l(n)},a),k()}]),angular.module("storagePoolCreate",[]).controller("StoragePoolCreateCtrl",["$scope","datacentersMgr","storageDevicesMgr","storagePoolsMgr","tiersMgr","server","$filter","gridTemplates","utils",function(a,b,c,d,e,f,g,h,i){function j(b){var c,d={collection:[]};return angular.forEach(b,function(b){b.clientData.selected&&!b.clientData.used&&(b=angular.extend({links:[]},b),c=g("getElementByParameter")(a.tiers,{element:parseInt(b.clientData.tierId),attribute:"id"}),b.links.push(f.createLinkByRel(c.links,"edit","tier")),d.collection.push(b))}),d}a.__name="StoragePoolCreateCtrl",a.storagePools=d.storagePools,a.availableStoragePools=d.availableStoragePools,a.currentDatacenter=b.currentDatacenter,a.storageDeviceId={selected:null},a.tiers=e.tiers;var k='<div><ui-select name="tier" data-ng-model="row.entity.clientData.tierId" class="span12" search-enabled="false"><ui-select-match placeholder="{{ \'globals.select\' | translate }}">{{$select.selected.name}}</ui-select-match><ui-select-choices repeat="tier.id as tier in tiers | enabled | filter: $select.search"><span>{{tier.name}}</span></ui-select-choices></ui-select> </div> ',l='<div ng-style="{cursor: row.cursor}" \n                            data-ng-disabled="row.entity.clientData.used" ng-repeat="col in renderedColumns" ng-class="col.colIndex()" \n                            class="ngCell {{col.cellClass}}" ng-cell></div>';a.gridStoragePools={data:"availableStoragePools",rowTemplate:l,columnDefs:[{field:"name",displayName:g("translate")("storage.storagepools.create.col.storagepool")},{field:"totalSizeInMb",width:90,displayName:g("translate")("storage.storagepools.create.col.totalsize"),cellTemplate:"<p>{{row.getProperty(col.field) | sizeUnit:false}}</p>"},{field:"tier.name",width:200,displayName:g("translate")("storage.storagepools.create.col.tier"),cellTemplate:k},{field:"clientData.selected",width:55,displayName:g("translate")("storage.storagepools.create.col.selected"),cellTemplate:h.selectedStoragePoolCellTemplate}],enableRowSelection:!1},a.updateSelectedStoragePools=function(){a.validExternally=!1,angular.forEach(a.availableStoragePools,function(b){b.clientData.selected&&!b.clientData.used&&(a.validExternally=!0)})},a.onShown=function(){a.storageDevice=c.currentStorageDevice,a.storageDeviceId.selected=a.storageDevice.id,a.validExternally=!1,a.onStorageDeviceChanged()},a.onSubmit=function(){var b=function(){a.closePopup()},c=j(a.availableStoragePools);d.addStoragePools(a.storageDevice,c,b)},a.onStorageDeviceChanged=function(){var b=a.storageDeviceId.selected;if(b){a.storageDevice=g("getElementByParameter")(a.storageDevices,{element:parseInt(b),attribute:"id"});var c=function(){d.getAvailableStoragePools(a.storageDevice,a.tiers,a.updateSelectedStoragePools)};d.getStoragePools(a.storageDevice,c)}a.updateSelectedStoragePools(),i.refreshLayout()},a.onShown()}]),angular.module("storagePoolEdit",[]).controller("StoragePoolEditCtrl",["$scope","storagePoolsMgr","tiersMgr","datacentersMgr","server","$filter","$timeout",function(a,b,c,d,e,f,g){a.__name="StoragePoolEditCtrl",a.tiers=c.tiers;var h=function(b){a.closePopup()};a.onShown=function(){a.storagePool=angular.copy(b.currentStoragePool),a.storagePool.clientData.tierId=a.storagePool.clientData.tier.id,a.onTierChanged()},a.onTierChanged=function(){if(a.storagePool.clientData.tierId){var b=f("getElementByParameter")(a.tiers,{element:parseInt(a.storagePool.clientData.tierId),attribute:"id"});a.storagePool.clientData.tier=b}},a.onSubmit=function(){b.editStoragePool(a.storagePool,h)}}]),angular.module("storagePools",["storagePoolCreate","storagePoolEdit"]).controller("StoragePoolsCtrl",["$scope","storagePoolsMgr","storageDevicesMgr",function(a,b,c){a.__name="StoragePoolsCtrl",a.storageDevices=c.storageDevices,a.currentDatacenter=b.currentDatacenter,a.storagePools=b.storagePools,a.currentStoragePool=b.currentStoragePool,a.currentStoragePool=b.currentStoragePool,a.onStoragePoolClick=function(a){b.setCurrentStoragePool(a)}}]),angular.module("tierEdit",[]).controller("TierEditCtrl",["$scope","tiersMgr","allocationRulesMgr",function(a,b,c){a.__name="TierEditCtrl",a.datacenter=b.currentDatacenter,a.loadBalanceTypes=c.loadBalanceTypes;var d=function(b){a.closePopup()};a.onShown=function(){a.tier=angular.copy(b.currentTier)},a.onSubmit=function(){b.editTier(a.tier,d)}}]).controller("TierEnterpriseAccessCtrl",["$scope","tiersMgr","paginationHelper","dispatcher",function(a,b,c,d){a.__name="TierEnterpriseAccessCtrl",a.enterprises=b.currentTier.clientData.enterprises,a.entFilter=c.entPaginator.filter,a.entPaginationParam=c.entPaginator.param;var e=function(){g(),c.entPaginator.resetParam()},f=function(a){c.entPaginator.param.totalSize=a.totalSize},g=function(){b.getTierEnterprises(a.tier,c.entPaginator.param,c.entPaginator.filter,f)},h=function(a){};a.allowAllEnterprises=function(){b.allowAllEnterprises(angular.copy(a.tier),h)},a.restrictAllEnterprises=function(){b.restrictAllEnterprises(angular.copy(a.tier),h)},a.onEntFilterSubmit=function(){c.entPaginator.resetParam(),g()},a.getPage=function(a){c.entPaginator.param.startwith=(a-1)*c.entPaginator.param.limit,g()},d.on("tierEnterprises.changed",g,a),e()}]),angular.module("tiers",["tierEdit","storagePools"]).controller("TiersCtrl",["$scope","datacentersMgr","tiersMgr","storagePoolsMgr","volumesMgr","systemPropertiesMgr","utils","dispatcher",function(a,b,c,d,e,f,g,h){
a.__name="TiersCtrl",a.currentDatacenter=b.currentDatacenter,a.tiers=c.tiers,a.currentTier=c.currentTier,a.currentStoragePool=d.currentStoragePool,a.systemProperties=f.systemProperties;var i=function(){d.setCurrentStoragePool(null),b.isPrivateDatacenter(a.currentDatacenter)&&c.getTiersByDatacenter(a.currentDatacenter)};a.onTierClick=function(a){e.volumes.length=0,g.emptyObject(e.currentVolume),a.clientData.open=!a.clientData.open,d.setCurrentStoragePool(null),c.setCurrentTier(a),a.clientData.open&&d.getStoragePoolsByTier(a)},a.onStoragePoolClick=function(a){g.emptyObject(c.currentTier),d.setCurrentStoragePool(a),e.getVolumesByStoragePool(a)},a.onDeleteStoragePoolConfirm=function(){d.deleteStoragePool(a.currentStoragePool)},h.on(["currentDatacenter.change","tiers.edited"],function(){i()},a),i()}]),angular.module("infrastructure",["datacenters","remoteservices"]).controller("InfrastructureCtrl",["$scope",function(a){a.__name="InfrastructureCtrl",a.infrastructureViewTab={value:"datacenters"}}]),angular.module("addlocation",[]).controller("AddLocationCtrl",["$scope","$filter","datacentersMgr","utils","server",function(a,b,c,d,e){function f(a){var b;if(a){var c=a.split("+");c.length>0&&(c=c[0].split("."),c.length>0&&(b=c[c.length-1]))}return b}function g(a,c){if(!d.isEmptyObject(a)&&!d.isEmptyObject(c)&&a.links){var g=e.getLinkByRel(a.links,"edit");if(!d.isEmptyObject(g)){var h={title:g.title,rel:f(g.type),type:g.type,href:g.href},i=b("getElementByParameter")(c.links,{element:h.href,attribute:"href"});d.isEmptyObject(i)&&c.links.push(h)}}}function h(c){var f;f=d.isEmptyObject(c.collection)?c:c.collection;for(var g=[],h=0;h<f.length;h++){var i=e.getLinkByRel(f[h].links,"edit"),j=b("getElementByParameter")(a.remoteService.links,{element:i.href,attribute:"href"});d.isEmptyObject(j)&&g.push(f[h])}a.locations=g}function i(){d.isEmptyObject(a.selectedRemoteServiceType)||(a.selectedRemoteServiceType.availableForDatacenter&&a.selectedRemoteServiceType.availableForPublic?c.getAllowedLocations(h):a.selectedRemoteServiceType.availableForDatacenter?c.getAllowedDatacenters(!0,null,h):a.selectedRemoteServiceType.availableForPublic&&c.getAllowedPublicCloudRegions(!0,!1,null,null,h))}a.__name="AddLocationCtrl",a.location={selected:null};var j;a.onShown=function(){j=a.getPopupElement(),i()},a.onSubmit=function(){var c=b("getElementById")(a.locations,parseInt(a.location.selected));g(c,a.remoteService),a.closePopup(j)},a.onHidden=function(){}}]),angular.module("remoteServiceCreate",["addlocation"]).controller("RemoteServiceCreateCtrl",["$scope","$filter","remoteServicesMgr","utils",function(a,b,c,d){function e(){a.closePopup(g)}function f(){var c=!0;if(a.selectedRemoteServiceType.forceOneLocation){var e=a.remoteService.getLocationLinks();c=1==e.length,c||(d.toastrError(b("translate")("remoteservices.form.input.location.error.forceonelocation",{remoteService:b("translate")("remoteservices.type."+a.selectedRemoteServiceType.type)})),d.refreshLayout())}return c}a.__name="RemoteServiceCreateCtrl",a.editMode=!1,a.selectedRemoteServiceType={},a.remoteServiceTypes=c.remoteServiceTypesArray,a.options={minimumResultsForSearch:-1};var g;a.removeLocation=function(b){if(b&&a.remoteService&&a.remoteService.links&&a.remoteService.links.length>0){var c=a.remoteService.links.indexOf(b);-1!=c&&a.remoteService.links.splice(c,1)}},a.onRemoteServiceTypeChange=function(d){a.selectedRemoteServiceType=b("getElementByParameter")(c.remoteServiceTypesArray,{element:d,attribute:"type"}),a.selectedRemoteServiceType&&(a.remoteService.clientData.splittedUri.protocol=a.selectedRemoteServiceType.defaultProtocol,a.remoteService.clientData.splittedUri.port=a.selectedRemoteServiceType.defaultPort,a.remoteService.clientData.splittedUri.path=a.selectedRemoteServiceType.serviceMapping)},a.check=function(a){a.refreshUri(),a.checked=!1,c.checkRemoteService(a)},a.onShown=function(){g=a.getPopupElement(),a.remoteService=new c.RemoteService({})},a.onSubmit=function(){(a.editDatacenterMode||f())&&(a.remoteService.refreshUri(),c.createRemoteService(a.remoteService,e))},a.onHidden=function(){}}]),angular.module("remoteServiceEdit",["addlocation"]).controller("RemoteServiceEditCtrl",["$scope","$filter","remoteServicesMgr","utils",function(a,b,c,d){function e(){a.closePopup(g)}function f(){var c=!0;if(a.selectedRemoteServiceType.forceOneLocation){var e=a.remoteService.getLocationLinks();c=1==e.length,c||d.toastrError(b("translate")("remoteservices.form.input.location.error.forceonelocation",{remoteService:b("translate")("remoteservices.type."+a.selectedRemoteServiceType.type)}))}return c}a.__name="RemoteServiceEditCtrl",a.editMode=!0,a.remoteServiceTypes=c.remoteServiceTypesArray;var g;a.removeLocation=function(b){if(b&&a.remoteService&&a.remoteService.links&&a.remoteService.links.length>0){var c=a.remoteService.links.indexOf(b);-1!=c&&a.remoteService.links.splice(c,1)}},a.onRemoteServiceTypeChange=function(d){a.selectedRemoteServiceType=b("getElementByParameter")(c.remoteServiceTypesArray,{element:d,attribute:"type"}),a.selectedRemoteServiceType&&(a.remoteService.clientData.splittedUri.protocol=a.selectedRemoteServiceType.defaultProtocol,a.remoteService.clientData.splittedUri.port=a.selectedRemoteServiceType.defaultPort,a.remoteService.clientData.splittedUri.path=a.selectedRemoteServiceType.serviceMapping)},a.check=function(b){a.remoteService.refreshUri(),a.remoteService.checked=!1,c.checkRemoteService(b)},a.onShown=function(){g=a.getPopupElement(),a.remoteService=new c.RemoteService(c.currentRemoteService),a.selectedRemoteServiceType=b("getElementByParameter")(c.remoteServiceTypesArray,{element:a.remoteService.type,attribute:"type"})},a.onSubmit=function(){f()&&(a.remoteService.refreshUri(),c.editRemoteServiceGlobal(a.remoteService,e))},a.onHidden=function(){}}]),angular.module("remoteservices",["remoteServiceCreate","remoteServiceEdit"]).controller("RemoteServicesCtrl",["$scope",function(a){a.__name="RemoteServicesCtrl"}]).controller("RemoteServicesListCtrl",["$scope","remoteServicesMgr",function(a,b){a.__name="RemoteServicesListCtrl",a.currentRemoteServiceType=b.currentRemoteServiceType,a.remoteServiceTypes=b.remoteServiceTypes,a.onAllRemoteServicesClick=function(){b.setCurrentRemoteServiceType(null)},a.onRemoteServiceTypeClick=function(a){b.setCurrentRemoteServiceType(a)}}]).controller("RemoteServicesDetailCtrl",["$scope","$filter","remoteServicesMgr","systemPropertiesMgr","paginationHelper","gridTemplates","dispatcher","utils",function(a,b,c,d,e,f,g,h){function i(){if(o&&o.length>0){var a=o.pop();c.deleteRemoteService(a,i)}else k()}function j(){e.remoteServicesPaginator.resetParam(),k()}function k(){c.setCurrentRemoteService(null),h.isEmptyObject(c.currentRemoteServiceType)?delete e.remoteServicesPaginator.filter.type:e.remoteServicesPaginator.filter.type=m(c.currentRemoteServiceType.type),c.getRemoteServicesGlobal(e.remoteServicesPaginator.param,e.remoteServicesPaginator.filter,l)}function l(a){e.remoteServicesPaginator.param.totalSize=a.totalSize}function m(a){var b="";if(a){var c=new RegExp("_","g");b=a.replace(c,"")}return b}function n(){var d=b("filterSelectedClientData")(a.remoteServices);d&&1==d.length?c.setCurrentRemoteService(d[0]):c.setCurrentRemoteService(null)}a.__name="RemoteServicesDetailCtrl",a.remoteServices=c.remoteServicesAll,a.remoteServiceStates=c.states,a.remoteServicesFilter=e.remoteServicesPaginator.filter,a.remoteServicesPaginationParam=e.remoteServicesPaginator.param,a.data=a.remoteServices,a.systemProperties=d.systemProperties,a.currentRemoteService=c.currentRemoteService,a.currentRemoteServiceType=c.currentRemoteServiceType;var o;a.onDeleteRemoteServiceConfirm=function(){o=b("filterSelectedClientData")(a.remoteServices),i()},a.onRemoteServicesFilterSubmit=function(){e.remoteServicesPaginator.resetParam(),a.getPage(e.remoteServicesPaginator.param.currentPage)},a.getPage=function(a){e.remoteServicesPaginator.param.startwith=(a-1)*e.remoteServicesPaginator.param.limit,c.setCurrentRemoteService(null),k()},a.afterSelectionChange=function(a){n()},a.gridRemoteServices={data:"remoteServices",columnDefs:[{field:"clientData.splittedUri.protocol",displayName:b("translate")("remoteservicesview.grid.title.column.protocol"),sortable:!1,width:50},{field:"clientData.splittedUri.ip",displayName:b("translate")("remoteservicesview.grid.title.column.ip"),sortable:!1},{field:"clientData.splittedUri.port",displayName:b("translate")("remoteservicesview.grid.title.column.port"),sortable:!1,width:50},{field:"clientData.splittedUri.path",displayName:b("translate")("remoteservicesview.grid.title.column.path"),sortable:!1},{field:"clientData.locations",displayName:b("translate")("remoteservicesview.grid.title.column.locations"),sortable:!1,width:250},{field:"status",displayName:b("translate")("remoteservicesview.grid.title.column.status"),sortable:!1,width:150,cellTemplate:f.stateRemoteServiceCellTemplate}],showSelectionCheckbox:b("isGranted")("PHYS_DC_MANAGE"),selectWithCheckboxOnly:!0,checkboxCellTemplate:f.selectedCellTemplate,checkboxHeaderTemplate:f.selectAllHeaderTemplate},g.on(["remoteServices.created","remoteServices.edited","currentRemoteServiceType.changed"],k,a),j()}]),angular.module("library",["libraryTemplates"]).controller("LibraryCtrl",["$scope",function(a){a.__name="LibraryCtrl",a.datacentersInitialization={datacentersCountPrivate:0,datacentersCountPublic:0,readyPrivate:!1,readyPublic:!1,viewTabInitialized:!1},a.libraryViewTab={value:"datacenters"}}]).controller("AppsLibraryDatacenterListCtrl",["$scope","$timeout","$filter","datacentersMgr","enterprisesMgr","paginationHelper","dispatcher","utils",function(a,b,c,d,e,f,g,h){function i(){k(!1),l(!1)}a.__name="AppsLibraryDatacenterListCtrl",a.datacenters=d.allowedLimits,a.currentDatacenter=d.currentDatacenter,a.dcFilter=f.dcPaginator.filter,a.dcPaginationParam=f.dcPaginator.param,a.selectedHypervisor={name:c("translate")("appslibrary.datacenter.label.generic")};var j=function(){f.dcPaginator.param.limit=0,"datacenters"==a.libraryViewTab.value?k(!0):l(!0)},k=function(a){d.getAllowedPrivate(a,f.dcPaginator.param,f.dcPaginator.filter,o,m)},l=function(a){d.getAllowedPublicCloudRegions(a,!0,f.dcPaginator.param,f.dcPaginator.filter,p,n)},m=function(b){a.datacentersInitialization.datacentersCountPrivate=0,a.datacentersInitialization.readyPrivate=!0,r()},n=function(b){a.datacentersInitialization.datacentersCountPublic=0,a.datacentersInitialization.readyPublic=!0,r()},o=function(b){a.datacentersInitialization.datacentersCountPrivate=b.totalSize,a.datacentersInitialization.readyPrivate=!0,q(b)},p=function(b){a.datacentersInitialization.datacentersCountPublic=b.totalSize,a.datacentersInitialization.readyPublic=!0,q(b)},q=function(b){f.dcPaginator.param.totalSize=b.totalSize,d.allowedLimits&&d.allowedLimits.length>0?a.onDatacenterClick(d.allowedLimits[0]):d.setCurrentDatacenter(null),r()},r=function(){a.datacentersInitialization.viewTabInitialized||a.datacentersInitialization.readyPrivate&&a.datacentersInitialization.readyPublic&&(a.datacentersInitialization.viewTabInitialized=!0,a.datacentersInitialization.datacentersCountPublic>0&&0==a.datacentersInitialization.datacentersCountPrivate?a.libraryViewTab.value="publiccloudregion":a.libraryViewTab.value="datacenters")},s=function(a,b){d.getDatacenterRepository(e.userEnterprise,a,b,t)},t=function(a){d.setCurrentDatacenterRepository(a)},u=function(a){var b={running:!1,timer:{},interval:5e3};a.clientData.refreshRepositoryTimer=b,v(a)},v=function(a){a.clientData.refreshRepositoryTimer.running=!0,a.clientData.refreshRepositoryTimer.timer=b(function(){d.checkDatacenterRepositoryRefresh(a,function(b){"FINISHED_SUCCESSFULLY"!=b.state?v(a):(w(a),s(a,!1))})},a.clientData.refreshRepositoryTimer.interval)},w=function(a){a.clientData.refreshRepositoryTimer.running=!1};a.onDcFilterSubmit=function(){f.dcPaginator.resetParam(),a.getPage(f.dcPaginator.param.currentPage)},a.getPage=function(a){f.dcPaginator.param.startwith=(a-1)*f.dcPaginator.param.limit,d.setCurrentDatacenter(null),j()},a.onDatacenterClick=function(b){d.setCurrentDatacenter(b),s(b,b.clientData.datacenter.isPublicDatacenter),d.getHypervisorsByDatacenterLimit(b,a.onHypervisorClick)},a.onHypervisorClick=function(b){a.selectedHypervisor.name=b.name,a.currentDatacenter.clientData.hypervisorTemplate=b.name,a.currentDatacenter.clientData.datacenter.isPublicDatacenter=b.operations.hasOwnProperty("templates")},a.refreshDatacenterRepository=function(a){d.refreshDatacenterRepository(e.userEnterprise,a,function(b){u(a)})},a.$watch("libraryViewTab.value",function(a){j()}),g.on("datacenterlimit.changed",function(b,c){a.onDatacenterClick(c.limit)},a),i()}]).controller("AppsLibraryDatacenterDetailCtrl",["$scope",function(a){a.__name="AppsLibraryDatacenterDetailCtrl"}]),angular.module("category",[]).controller("CategoryCreateCtrl",["$scope","virtualMachineTemplatesMgr","enterprisesMgr",function(a,b,c){a.__name="CategoryCreateCtrl",a.enterprise=c.userEnterprise;var d=function(){a.closePopup()};a.onShown=function(){a.category={clientData:{global:!1},erasable:!0,links:[]}},a.onSubmit=function(){b.createCategory(a.category,a.enterprise,d)}}]),angular.module("virtualMachineTemplateDisks",[]).controller("LocalDiskCtrl",["$scope","$filter","virtualMachineTemplatesMgr","utils",function(a,b,c,d){a.__name="LocalDiskCtrl",a.controllerTypes=c.controllerTypes,a.onFileSelect=function(b){a.selectedDisk.clientData.file=b[0],a.selectedDisk.clientData.size=b[0].size,a.selectedDisk.path=b[0].name},a.onShown=function(){a.editMode=!1,a.isLocalFile=!0,a.selectedDisk={links:[],clientData:{type:b("translate")("virtualmachinetemplate.disks.option.local")},diskFormatType:a.diskFormatTypes[0].clientData.diskFileFormat}},a.onHidden=function(){},a.onSubmit=function(){a.selectedDisk.sequence=a.selectedDisk.clientData.sequence=d.returnSequence(a.template.clientData.disks,"sequence"),a.selectedDisk.hdRequired=a.selectedDisk.clientData.capacity*a.hdConversion.value*a.bytesToMbObject.value,a.selectedDisk.clientData.hdRequiredInMb=a.selectedDisk.clientData.capacity*a.hdConversion.value,a.selectedDisk.diskFileSize=a.selectedDisk.clientData.size,a.template.clientData.disks.push(a.selectedDisk),a.template.clientData.localDisks.push(a.selectedDisk),a.closePopup()}}]).controller("EmptyDiskCtrl",["$scope","$filter","virtualMachineTemplatesMgr","utils",function(a,b,c,d){a.__name="EmptyDiskCtrl",a.controllerTypes=c.controllerTypes,a.onShown=function(){a.editMode=!1,a.selectedDisk={clientData:{type:b("translate")("virtualmachinetemplate.disks.option.emptydisk")},links:[],diskFileSize:0}},a.onHidden=function(){},a.onSubmit=function(){a.selectedDisk.sequence=a.selectedDisk.clientData.sequence=d.returnSequence(a.template.clientData.disks,"sequence"),a.selectedDisk.hdRequired=a.selectedDisk.clientData.capacity*a.hdConversion.value*a.bytesToMbObject.value,a.template.clientData.disks.push(a.selectedDisk),a.closePopup()}}]).controller("DiskEditCtrl",["$scope","$filter","utils","virtualMachineTemplatesMgr",function(a,b,c,d){a.__name="DiskEditCtrl",a.controllerTypes=d.controllerTypes;var e=function(c,e){var g=b("getElementByParameter")(a.template.clientData.disks,{element:e,attribute:"clientData.id"});d.currentVirtualMachineTemplateDisk.hdRequired=g.hdRequired=c.hdRequired,d.currentVirtualMachineTemplateDisk.diskController=g.diskController=c.diskController,d.currentVirtualMachineTemplateDisk.diskControllerType=g.diskControllerType=c.diskControllerType,f()},f=function(){a.closePopup()};a.onShown=function(){a.selectedDisk.links&&a.selectedDisk.links.length>0?a.selectedDisk=angular.copy(d.currentVirtualMachineTemplateDisk):a.selectedDisk=d.currentVirtualMachineTemplateDisk,a.hdConversion.value=angular.copy(c.getUnitSelectorForMB(a.selectedDisk.hdRequired/a.bytesToMbObject.value)).conversion,a.selectedDisk.clientData.capacity=a.selectedDisk.hdRequired/a.bytesToMbObject.value/a.hdConversion.value,a.editMode=!0,a.selectedDisk.path?a.isLocalFile=!0:a.isLocalFile=!1},a.onHidden=function(){},a.onSubmit=function(){a.selectedDisk.hdRequired=a.selectedDisk.clientData.capacity*a.hdConversion.value*a.bytesToMbObject.value,a.selectedDisk.links.length>0&&!a.selectedDisk.clientData.copied?d.editDisk(a.selectedDisk,e):(a.selectedDisk.clientData.edited=!0,f())}}]).controller("TemplateDiskCtrl",["$scope","$filter","gridTemplates","utils","server","virtualMachineTemplatesMgr","datacentersMgr",function(a,b,c,d,e,f,g){a.__name="TemplateDiskCtrl",a.templates=[],a.selectedTemplate={},a.templateDisks=[],a.disks=[];var h=function(b){b.selected&&(a.selectedTemplate=b.entity,f.getVMTemplateDisks(b.entity,a.disks,!0))},i=function(b){a.param.totalSize=b.totalSize,a.templates=b.collection};a.templatesGrid={data:"templates",columnDefs:[{field:"name",width:100,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.name"),cellTemplate:c.templateWithTooltip},{field:"description",displayName:b("translate")("virtualmachinetemplate.disks.grid.title.description"),cellTemplate:c.templateWithTooltip}],multiSelect:!1,afterSelectionChange:h},a.templateDisksGrid={data:"selectedTemplate.clientData.disks",columnDefs:[{field:"",width:30,displayName:"",cellTemplate:c.diskCheckboxCellTemplate},{field:"sequence",width:60,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.sequence")},{field:"clientData.type",width:80,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.type")},{field:"path",displayName:b("translate")("virtualmachinetemplate.disks.grid.title.file"),cellTemplate:c.templateWithTooltip},{field:"state",width:100,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.state")}],multiSelect:!1,enableRowSelection:!1},a.disksGrid={data:"disks",columnDefs:[{field:"",width:30,displayName:"",cellTemplate:c.diskCheckboxCellTemplate},{field:"clientData.type",width:80,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.type")},{field:"clientData.template.name",displayName:b("translate")("virtualmachinetemplate.disks.grid.title.template"),cellTemplate:c.templateWithTooltip},{field:"path",displayName:b("translate")("virtualmachinetemplate.disks.grid.title.file"),cellTemplate:c.templateWithTooltip},{field:"diskFileSize",width:80,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.filesize"),cellTemplate:c.sizeUnitInBytesCellTemplate},{field:"hdRequired",displayName:b("translate")("virtualmachinetemplate.disks.grid.title.hd"),cellTemplate:c.sizeUnitInBytesCellTemplate},{field:"state",width:80,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.state")}],multiSelect:!1,enableRowSelection:!1},a.onItemEnabledChange=function(c){if(c.clientData.selected)a.disks.push(c);else{var d=b("getElementByParameter")(a.disks,{element:c.clientData.id,attribute:"clientData.id"});a.disks.splice(a.disks.indexOf(d),1)}},a.getVirtualImageByCategory=function(){a.selectedTemplate={},a.filter.states="DONE",a.filter.external=!1,f.getTemplatesByDatacenterRepository(a.datacenterRepository,{},!0,a.param,a.filter,i)},a.getPage=function(b){a.param.startwith=5*(b-1),a.getVirtualImageByCategory()},a.onHidden=function(){},a.onShown=function(){if(a.templates=[],a.selectedTemplate={},a.templateDisks=[],a.disks=[],a.datacenterRepository={},a.param={maxSize:5,maxSizeMini:1,currentPage:1,limit:5,startwith:0,totalSize:0},a.filter={has:""},"persistent"==a.popupData){var b={links:a.template.links,rel:"datacenterrepository"};e.getByRel(b,function(b){a.datacenterRepository=b,a.getVirtualImageByCategory()})}else a.datacenterRepository=g.currentDatacenterRepository,a.getVirtualImageByCategory()},a.onSubmit=function(){var b=angular.copy(a.disks);angular.forEach(b,function(b){b.sequence=b.newSequence=b.clientData.sequence=d.returnSequence(a.template.clientData.disks,"sequence"),b.clientData.copied=!0,delete b.state}),a.template.clientData.disks=a.template.clientData.disks.concat(b),a.closePopup()}}]).controller("DiskSelectorCtrl",["$scope","$filter","virtualMachinesMgr","utils","gridTemplates","dispatcher",function(a,b,c,d,e,f){function g(a,b){k.disks=b.disks,k.volumes=b.volumes,h()}function h(){a.storageDisks.length=0,l.length=0,m.length=0,i(l,k.disks.collection,"harddisk"),i(m,k.volumes.collection,"volume")}function i(b,c,e){if(!d.isEmptyObject(c))for(var f=0;f<c.length;f++){var g=j(c[f],e);a.storageDisks.push(g),b.push(g)}}function j(a,b){var c=angular.copy(a);return c.clientData||(c.clientData={},c.clientData.selected=!0,c.clientData.diskType=b,"volume"==b?c.clientData.sizeInMB=c.sizeInMB:c.clientData.sizeInMB=c.sizeInMb),c}a.__name="DiskSelectorCtrl";var k,l=[],m=[];a.storageDisks=[],a.storageGridData={data:"storageDisks",columnDefs:[{field:"",displayName:"",cellTemplate:e.selectedCellTemplate,width:50},{field:"sequence",displayName:b("translate")("virtualmachine.details.storage.sequence"),width:70},{field:"name",displayName:b("translate")("virtualmachine.details.storage.name"),cellTemplate:e.primaryDiskCellTemplate},{field:"clientData.sizeInMB",displayName:b("translate")("virtualmachine.details.storage.totalsize"),cellTemplate:"<p>{{row.getProperty(col.field) | sizeUnit:false}}</p>",width:150},{field:"clientData.diskType",displayName:b("translate")("virtualmachine.details.storage.type"),cellTemplate:'<p>{{ "virtualmachine.details.storage.type." + row.getProperty(col.field) | translate }}</p>',width:100}],selectWithCheckboxOnly:!0,checkboxCellTemplate:e.selectedCellTemplate,checkboxHeaderTemplate:e.selectAllHeaderTemplate,enableRowSelection:!1},a.onShown=function(){k=b("getElementById")(c.virtualMachines,parseInt(a.popupData)),!d.isEmptyObject(k.disks)&&k.disks.collection.length>0?h():(a.storageDisks.length=0,c.getVirtualMachine(k,g))},a.onSubmit=function(){k.disks.collection=angular.copy(l),k.volumes.collection=angular.copy(m),f.dispatch("diskSelector.submit",{virtualMachine:k}),a.closePopup()},a.onHidden=function(){}}]),angular.module("templateCreate",[]).controller("LocalTemplateCreateCtrl",["$scope","$filter","virtualMachineTemplatesMgr","enterprisesMgr","datacentersMgr","commonsMgr","costCodesMgr","utils","uModals",function(a,b,c,d,e,f,g,h,i){a.__name="LocalTemplateCreateCtrl",a.editMode=!1,a.isEditionGranted=!0,a.ramUnits=h.unitsSelector,a.hdUnits=h.unitsSelector,a.selectedDiskFormatType={diskFormatType:null},a.virtualMachineTemplatesCategories=c.virtualMachineTemplatesCategories,a.diskFormatTypes=f.diskFormatTypes,a.costCodes=g.costCodes;var j;a.options={minimumResultsForSearch:-1},a.fileName="";var k=0;a.bytesToMbObject={value:1048576};var l=function(){f.getDiskFormatTypes()},m=function(){a.template.ramRequired=a.ramInput.value*parseInt(a.ramConversion.value),a.category=b("getElementByParameter")(a.virtualMachineTemplatesCategories,{element:parseInt(a.selectedCategory.id),attribute:"id"}),n()},n=function(){if(k==a.template.clientData.localDisks.length)a.closePopup();else{j=a.template.clientData.localDisks[k];var d=b("getElementByParameter")(a.diskFormatTypes,{element:j.diskFormatType,attribute:"clientData.diskFileFormat"});c.createVMTemplateFromLocalFile(e.currentDatacenter,a.template,a.category,d,j,a.uploadProgress,n),k++}};a.onShown=function(){k=0,a.hdInput={},a.ramInput={},a.template={clientData:{disks:[],localDisks:[],templateHasFilesInNFS:!0},cpuRequired:1},a.hdConversion={value:a.hdUnits[1].conversion},a.ramConversion={value:a.ramUnits[1].conversion},a.selectedCategory={},a.selectedDiskFormatType.diskFormatType=null,a.uploadProgress={},b("isGranted")("APPLIB_VM_COST_CODE")&&g.getCostCodes(!0,{},{}),c.getOperatingSystems(),c.getNicDrives(),c.getControllerTypes()},a.onSubmit=function(){if(0==a.template.clientData.localDisks.length)i.showAlert({scope:a,message:b("translate")("virtualmachinetemplate.form.localdisk.message"),title:b("translate")("virtualmachinetemplate.form.localdisk.title"),showCancelBtn:!1,showConfirmBtn:!0,confirmLabel:b("translate")("globals.close")});else{var c=0;angular.forEach(a.template.clientData.localDisks,function(a){c+=a.clientData.size}),d.requestUpload(d.userEnterprise,e.currentDatacenter,c,m)}},l()}]).controller("VirtualMachineTemplateGeneralInfoCtrl",["$scope","utils","$http",function(a,b,c){a.__name="VirtualMachineTemplateGeneralInfoCtrl",a.onValidateIconClick=function(){c.get(a.template.iconUrl).success(function(b){toastr.success(a.template.iconUrl+" validated")}).error(function(c){b.toastrError(a.template.iconUrl+" doesn't exist")})}}]).controller("VirtualMachineTemplateDisksCtrl",["$scope","virtualMachineTemplatesMgr","gridTemplates","$filter",function(a,b,c,d){a.__name="VirtualMachineTemplateDisksCtrl",a.selectedDisk=b.currentVirtualMachineTemplateDisk;var e=function(){b.setCurrentVirtualMachineTemplateDisk({})},f=function(a){a.selected&&b.setCurrentVirtualMachineTemplateDisk(a.entity)};a.disksGrid={data:"template.clientData.disks",columnDefs:[{field:"sequence",width:80,displayName:d("translate")("virtualmachinetemplate.disks.grid.title.sequence"),cellTemplate:c.reorderSequenceCell},{field:"clientData.type",width:100,displayName:d("translate")("virtualmachinetemplate.disks.grid.title.type")},{field:"path",displayName:d("translate")("virtualmachinetemplate.disks.grid.title.file"),cellTemplate:c.templateWithTooltip},{field:"diskFileSize",displayName:d("translate")("virtualmachinetemplate.disks.grid.title.filesize"),cellTemplate:c.sizeUnitInBytesCellTemplate},{field:"hdRequired",displayName:d("translate")("virtualmachinetemplate.disks.grid.title.hd"),cellTemplate:c.sizeUnitInBytesCellTemplate}],multiSelect:!1,afterSelectionChange:f},e()}]).controller("VirtualMachineTemplateAdvancedCtrl",["$scope","$filter","virtualMachineTemplatesMgr","gridTemplates",function(a,b,c,d){a.__name="VirtualMachineTemplateAdvancedCtrl",a.operatingSystems=c.operatingSystems,a.nicDrives=c.nicDrives,a.gridHardwareProfiles={data:"template.clientData.hardwareprofiles",columnDefs:[{field:"clientData.selected",width:85,displayName:b("translate")("virtualmachinetemplate.edit.grid.hardwareprofiles.title.recommended"),cellTemplate:d.selectUpdatedProviderIdCellTemplate},{field:"providerId",displayName:b("translate")("virtualmachinetemplate.edit.grid.hardwareprofiles.title.name")},{field:"cpu",displayName:b("translate")("virtualmachine.create.hardwareprofile.cpu")},{field:"ramInMb",displayName:b("translate")("virtualmachine.create.hardwareprofile.ramInMb"),cellFilter:"sizeUnit"}]}}]).controller("RemoteTemplateDownloadCtrl",["$scope","dispatcher","datacentersMgr","virtualMachineTemplatesMgr","enterprisesMgr","systemPropertiesMgr","$timeout","$filter","server","utils",function(a,b,c,d,e,f,g,h,i,j){function k(){j.emptyObject(a.repositoryCategories),angular.forEach(a.currentRemoteRepository.templateDefinitions.collection,function(b){var c=i.getLinkByRel(b.links,"category");void 0==a.repositoryCategories[c.title]&&(a.repositoryCategories[c.title]=c.title)})}a.__name="RemoteTemplateDownloadCtrl",a.remoteTemplateDefinitions=d.templateDefinitions,a.currentRemoteRepository={},a.repositoryCategories={},a.currentCategory={},a.systemProperties=f.systemProperties;var l=function(){d.getTemplateDefinitions(e.userEnterprise,c.currentDatacenterRepository,a.defaultTemplateRepository)};a.onRepositoryClick=function(b){a.currentRemoteRepository=b,a.currentCategory=null,k(),d.getRepositoryStatuses(b,c.currentDatacenter)},a.onCategoryClick=function(b){a.currentCategory=b},a.onDownloadClick=function(){a.currentRemoteRepository.templateDefinitions.collection.forEach(function(b){"TO_DOWNLOAD"==b.clientData.downloadStatus&&d.installTemplateDefinitionInDatacenter(b,c.currentDatacenter,a.onRefreshClick)})},a.onRefreshClick=function(){n()},a.onDownloadCancelClick=function(b){d.cancelDownloadOVFPackage(b,c.currentDatacenterRepository,c.currentDatacenter,a.onRefreshClick)};var m;a.refreshStatuses=function(){m=g(a.refreshStatuses,1e3*parseInt(a.systemProperties.infrastructure["client.applibrary.ovfpackagesDownloadingProgressUpdateInterval"].value)),n()};var n=function(){a.currentRemoteRepository&&a.currentRemoteRepository.id&&d.getRepositoryStatuses(a.currentRemoteRepository,c.currentDatacenter)};a.onShown=function(){a.currentRemoteRepository=null,a.currentCategory=null,j.emptyObject(a.repositoryCategories),a.defaultTemplateRepository=a.systemProperties.infrastructure["client.applibrary.defaultTemplateRepository"]?a.systemProperties.infrastructure["client.applibrary.defaultTemplateRepository"].value:"",l(),m=g(a.refreshStatuses,1e3*parseInt(a.systemProperties.infrastructure["client.applibrary.ovfpackagesDownloadingProgressUpdateInterval"].value))},a.onHidden=function(){b.dispatch("virtualimage.updated"),g.cancel(m)},a.onSubmit=function(){console.log("remote template created")},a.onDeleteTemplateDefinitionConfirm=function(){d.deleteOVFPackageList(a.currentRemoteRepository,a.repositoryCategories)},b.on(["templateDefinitions.created","templateDefinitions.deleted"],l,a)}]).controller("RemoteTemplateRepositoryCreateCtrl",["$scope","enterprisesMgr","virtualMachineTemplatesMgr",function(a,b,c){a.__name="RemoteTemplateRepositoryCreateCtrl";var d=function(){a.closePopup()},e=function(){c.createOVFPackageList(b.userEnterprise,a.remoteRepository.uri,d)};a.onShown=function(){a.remoteRepository={}},a.onSubmit=function(){e()},a.onHidden=function(){}}]),angular.module("templateEdit",["virtualMachineTemplateDisks"]).controller("VirtualMachineTemplateEditCtrl",["$scope","$filter","virtualMachineTemplatesMgr","commonsMgr","costCodesMgr","enterprisesMgr","datacentersMgr","refreshMgr","utils","server","dispatcher","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){var b=0;angular.forEach(a.template.clientData.localDisks,function(a){b+=a.clientData.size}),b>0?f.requestUpload(f.userEnterprise,g.currentDatacenter,b,n):n()}function n(){a.editionObject.inProgress=!0,a.popupScope.showAcceptBtn=!1,a.popupScope.showCancelBtn=!1;var d=b("getElementByParameter")(a.virtualMachineTemplatesCategories,{element:parseInt(a.selectedCategory.id),attribute:"id"});a.editionObject.basicInfo="inprogress",""==a.template.loginUser&&delete a.template.loginUser,""==a.template.loginPassword&&delete a.template.loginPassword,c.editVirtualImage(a.template,d,t)}function o(){a.costCode.id=a.template.costCode?a.template.costCode:0}a.__name="VirtualMachineTemplateEditCtrl",a.editMode=!0,a.ramUnits=i.unitsSelector,a.ramConversion={},a.hdUnits=i.unitsSelector,a.bytesToMbObject={value:1048576},a.hdConversion={},a.selectedCategory={},a.selectedDiskFormatType={},a.hdInput={},a.ramInput={},a.virtualMachineTemplatesCategories=c.virtualMachineTemplatesCategories,a.currentDatacenter=g.currentDatacenter,a.compatibleVirtualMachineTemplate=!0,a.isHardDiskLocked=!0,a.isEditionGranted=!0,a.downloadAllowed=!1,a.options={minimumResultsForSearch:-1};var p,q,r,s,t=function(){a.editionObject.basicInfo="complete",r=0,s=0,a.editionObject.deleteEmptyDisks="inprogress",angular.forEach(a.template.clientData.disks,function(b){b.links.length>=0&&b.clientData.toBeDeleted&&(r++,a.editionObject.emptyDisksToBeDeleted++,c.deleteEmptyDisk(b,u))}),0===r&&v()},u=function(){s++,a.editionObject.emptyDisksDeleted++,r===s&&v()},v=function(){a.editionObject.deleteEmptyDisks="complete",p=0,q=0,a.editionObject.createEmptyDisks="inprogress",angular.forEach(a.template.clientData.disks,function(d){0===d.links.length&&void 0===d.id&&d.clientData.type==b("translate")("virtualmachinetemplate.disks.option.emptydisk")&&(p++,a.editionObject.emptyDisksToBeCreated++,c.createEmptyDisk(a.template,d,w))}),0===p&&x()},w=function(){q++,a.editionObject.emptyDisksCreated++,q===p&&x()},x=function(){a.editionObject.createEmptyDisks="complete",p=0,q=0,a.editionObject.uploadLocalFile="inprogress",angular.forEach(a.template.clientData.disks,function(d){0===d.links.length&&void 0===d.id&&d.clientData.type==b("translate")("virtualmachinetemplate.disks.option.local")&&(p++,c.uploadLocalFileInExistingVMTemplate(a.template,d,a.uploadProgress,y))}),0===p&&z()},y=function(){q++,q===p&&z()},z=function(){a.editionObject.uploadLocalFile="complete",p=0,q=0,a.editionObject.copyDisks="inprogress",angular.forEach(a.template.clientData.disks,function(b){
b.clientData&&b.clientData.copied&&(p++,a.editionObject.disksToBeCopied++,c.createEmptyDisk(a.template,b,A))}),0===p&&B()},A=function(){q++,a.editionObject.disksCopied++,q===p&&B()},B=function(){a.editionObject.copyDisks="complete",i.isEmptyObject(a.template.clientData.master)?k.dispatch("virtualimage.edited"):k.dispatch("virtualimageinstance.edited"),a.closePopup()},C=function(c,d){if(!a.isPersistent){var e=a.template.clientData.disks[0].clientData.enterprise.id;a.template.shared?(a.downloadAllowed=!0,b("isGranted")("ENTERPRISE_ADMINISTER_ALL")||(a.isEditionGranted=!1)):f.userEnterprise.id==e&&(a.downloadAllowed=!0)}};a.onSubmit=function(){a.template.ramRequired=a.ramInput.value*parseInt(a.ramConversion.value),a.isHardDiskLocked||(a.template.hdRequired=a.hdInput.value*parseInt(a.hdConversion.value)),a.template.costCode=a.costCode.id,m()},a.onShown=function(){a.editionObject={inProgress:!1,basicInfo:"pending",createEmptyDisks:"pending",emptyDisksToBeCreated:0,emptyDisksCreated:0,deleteEmptyDisks:"pending",emptyDisksToBeDeleted:0,emptyDisksDeleted:0,uploadLocalFile:"pending",copyDisks:"pending",disksToBeCopied:0,disksCopied:0},a.costCode={},h.stopTimer(),"persistent"==a.popupData?(a.isPersistent=!0,a.template=angular.copy(c.currentPersistentVMTemplate)):(a.isPersistent=!1,i.isEmptyObject(c.currentVirtualMachineTemplateInstance)?a.template=angular.copy(c.currentVirtualMachineTemplate):a.template=angular.copy(c.currentVirtualMachineTemplateInstance)),c.getVMTemplateDisks(a.template,null,!1,C),a.selectedCategory=angular.copy(a.template.clientData.category),d.getDiskFormatTypes(),a.selectedDiskFormatType.diskFormatType=a.template.diskFormatType,a.compatibleVirtualMachineTemplate=!g.currentDatacenter.provider,a.uploadProgress={},b("isGranted")("APPLIB_VM_COST_CODE")?e.getCostCodes(!0,{},{},o):a.costCode.id=a.template.costCode?a.template.costCode:0;var f=angular.copy(i.getUnitSelectorForMB(a.template.ramRequired));a.ramConversion.value=f.conversion,a.ramInput.value=a.template.ramRequired/a.ramConversion.value;var j=1048576,k=angular.copy(i.getUnitSelectorForMB(a.template.hdRequired/j));a.hdConversion.value=k.conversion,a.hdInput.value=a.template.hdRequired/a.hdConversion.value/j,i.isEmptyObject(a.currentDatacenter)||i.isEmptyObject(a.currentDatacenter.clientData.datacenter)||!a.currentDatacenter.clientData.datacenter.isPublicDatacenter||c.getTemplateHardwareProfiles(g.currentDatacenter,a.template),c.getOperatingSystems(),c.getNicDrives(),c.getControllerTypes()},a.onHidden=function(){k.dispatch("refreshConversionsTimer.stop"),h.initTimer()}}]).controller("VirtualMachineTemplateEditGeneralInfoCtrl",["$scope","utils","$http",function(a,b,c){a.__name="VirtualMachineTemplateGeneralInfoCtrl",a.onValidateIconClick=function(){c.get(a.template.iconUrl).success(function(b){toastr.success(a.template.iconUrl+" validated")}).error(function(c){b.toastrError(a.template.iconUrl+" doesn't exist")})}}]).controller("VirtualMachineTemplateEditDisksCtrl",["$scope","virtualMachineTemplatesMgr","refreshMgr","commonsMgr","utils","gridTemplates","server","dispatcher","$filter",function(a,b,c,d,e,f,g,h,i){function j(a,b){var c=i("getElementByParameter")(a,{element:b,attribute:"field"});if(!e.isEmptyObject(c)){var d=a.indexOf(c);-1!=d&&a.splice(d,1)}}function k(a,b){var c=i("getElementByParameter")(a,{element:b,attribute:"field"});e.isEmptyObject(c)||delete c.width}function l(b){var c=i("getElementByParameter")(b,{element:a.selectedDisk.sequence,attribute:"sequence"}),d=b.indexOf(c);e.isEmptyObject(c)||(c.links.length>0?c.clientData.toBeDeleted=!0:b.splice(d,1))}a.__name="VirtualMachineTemplateEditDisksCtrl",a.diskFormatTypes=d.diskFormatTypes,a.selectedDisk=b.currentVirtualMachineTemplateDisk;var m=function(){b.setCurrentVirtualMachineTemplateDisk({}),a.selectedDiskId=""},n=function(){e.isEmptyObject(a.selectedDisk)||b.getConversions(a.selectedDisk)},o=function(){a.refreshConversionsTimeout=setInterval(n,c.timerOptions.conversions)},p=function(c){c.selected&&a.selectedDiskId!=c.entity.clientData.id&&(a.selectedDiskId=c.entity.clientData.id,b.setCurrentVirtualMachineTemplateDisk(c.entity),n(),clearInterval(a.refreshConversionsTimeout),o())},q='<div ng-repeat="col in renderedColumns" ng-class="{\'notassignable\':(row.entity.clientData.toBeDeleted)}" class="{{loadData[$index].CssClass}} ngCell {{columnClass($index)}} col{{$index}} {{col.cellClass}}" data-tooltip="{{row.entity.clientData.toBeDeleted && (\'virtualmachinetemplate.disks.grid.tooltipe.tobedeleted\' | translate) || \'\' }}" ng-cell ></div>',r=[{field:"sequence",width:80,displayName:i("translate")("virtualmachinetemplate.disks.grid.title.sequence"),cellTemplate:f.reorderSequenceCell},{field:"clientData.type",width:70,displayName:i("translate")("virtualmachinetemplate.disks.grid.title.type")},{field:"clientData.fileName",displayName:i("translate")("virtualmachinetemplate.disks.grid.title.filename"),cellTemplate:f.diskFileNameCellTemplate},{field:"diskFileSize",width:70,displayName:i("translate")("virtualmachinetemplate.disks.grid.title.filesize"),cellTemplate:f.sizeUnitInBytesCellTemplate},{field:"hdRequired",width:70,displayName:i("translate")("virtualmachinetemplate.disks.grid.title.hd"),cellTemplate:f.sizeUnitInBytesCellTemplate},{field:"state",width:60,displayName:i("translate")("virtualmachinetemplate.disks.grid.title.state"),cellTemplate:f.stateCellTemplate},{field:"",width:25,displayName:"",cellTemplate:f.downloadCellTemplate}],s=[{field:"sequence",width:80,displayName:i("translate")("virtualmachinetemplate.disks.grid.title.sequence"),cellTemplate:f.reorderSequenceCell},{field:"clientData.type",width:70,displayName:i("translate")("virtualmachinetemplate.disks.grid.title.type")},{field:"clientData.fileName",displayName:i("translate")("virtualmachinetemplate.disks.grid.title.filename"),cellTemplate:f.diskFileNameCellTemplate},{field:"clientData.diskFileSize",width:70,displayName:i("translate")("virtualmachinetemplate.disks.grid.title.filesize"),cellTemplate:f.sizeUnitInBytesCellTemplate},{field:"hdRequired",width:60,displayName:i("translate")("virtualmachinetemplate.disks.grid.title.hd"),cellTemplate:f.sizeUnitInBytesCellTemplate},{field:"state",width:60,displayName:i("translate")("virtualmachinetemplate.disks.grid.title.state"),cellTemplate:f.stateCellTemplate},{field:"clientData.volume.name",width:80,displayName:i("translate")("virtualmachinetemplate.disks.grid.title.volume"),cellTemplate:f.templateWithTooltip},{field:"",width:25,displayName:"",cellTemplate:f.downloadCellTemplate}];a.template.clientData.templateHasFilesInNFS||(j(r,"clientData.fileName"),j(s,"clientData.fileName"),k(r,"clientData.type"),k(s,"clientData.type")),a.disksGrid={data:"template.clientData.disks",columnDefs:r,multiSelect:!1,afterSelectionChange:p,rowTemplate:q},a.persistentDisksGrid={data:"template.clientData.disks",columnDefs:s,multiSelect:!1,afterSelectionChange:p,rowTemplate:q},a.gridConversions={data:"selectedDisk.clientData.conversions",columnDefs:[{field:"targetFormat",displayName:i("translate")("virtualmachinetemplate.disks.grid.conversions.title.targetformat")},{field:"startTimestamp",displayName:i("translate")("virtualmachinetemplate.disks.grid.conversions.title.date"),cellFilter:"timestampToString:true"},{field:"",displayName:i("translate")("virtualmachinetemplate.disks.grid.conversions.title.state"),cellTemplate:f.stateConversionCellTemplate}],multiSelect:!1,enableRowSelection:!1},a.onDownloadClick=function(a){var c=document.getElementById("viDownloadIframe");c.src=a.clientData.downloadUrl,b.downloadTemplate(a.clientData.downloadUrl)},a.restartConversion=function(c){b.createConversionFormat(c.targetFormat,a.selectedDisk)},a.generateMissingConversions=function(){b.generateAllMissingConversions(a.selectedDisk)},a.deleteDisk=function(){l(a.template.clientData.disks),l(a.template.clientData.localDisks),b.setCurrentVirtualMachineTemplateDisk({})},a.onSequenceClick=function(b){if(0!=b.clientData.sequence||b.clientData.type!=i("translate")("virtualmachinetemplate.disks.option.emptydisk")){var c=g.getLinkByRel(a.template.links,"disk"+b.sequence);angular.forEach(a.template.clientData.disks,function(c){if(c.sequence==b.clientData.sequence){var d=g.getLinkByRel(a.template.links,"disk"+c.sequence);c.sequence=c.clientData.sequence=b.sequence,d.rel="disk"+c.sequence}}),b.sequence=b.clientData.sequence,b.newSequence&&(b.newSequence=b.sequence),c.rel="disk"+b.sequence}else b.clientData.sequence=b.sequence;b.clientData.sequenceEdited=!1},m(),h.on("refreshConversionsTimer.stop",function(){clearInterval(a.refreshConversionsTimeout)},a)}]).controller("VirtualMachineTemplateEditAdvancedCtrl",["$scope","$filter","virtualMachineTemplatesMgr","costCodesMgr","gridTemplates",function(a,b,c,d,e){a.__name="VirtualMachineTemplateEditAdvancedCtrl",a.operatingSystems=c.operatingSystems,a.nicDrives=c.nicDrives,a.costCodes=d.costCodes,a.gridHardwareProfiles={data:"template.clientData.hardwareprofiles",columnDefs:[{field:"clientData.selected",width:85,displayName:b("translate")("virtualmachinetemplate.disks.grid.hardwareprofiles.title.recommended"),cellTemplate:e.selectUpdatedProviderIdCellTemplate},{field:"providerId",displayName:b("translate")("virtualmachinetemplate.disks.grid.hardwareprofiles.title.name")},{field:"cpu",displayName:b("translate")("virtualmachine.create.hardwareprofile.cpu")},{field:"ramInMb",displayName:b("translate")("virtualmachine.create.hardwareprofile.ramInMb"),cellFilter:"sizeUnit"}]}}]),angular.module("templateImport",[]).controller("libraryTemplatesImportCtrl",["$scope","$filter","virtualMachineTemplatesMgr","datacentersMgr","refreshMgr","paginationHelper",function(a,b,c,d,e,f){function g(){var b={};if(a.vmtPublicFilter.path&&(b.path=a.vmtPublicFilter.path),a.vmtPublicFilter.name&&(b.name=a.vmtPublicFilter.name),a.currentDatacenter.clientData.hypervisorTemplate?b.plugin=a.currentDatacenter.clientData.hypervisorTemplate:delete b.plugin,a.vmtPublicFilter["private"]!=a.vmtPublicFilter["public"]&&(b["public"]=a.vmtPublicFilter["public"]),a.vmtPublicFilter.ostype){var c=[];a.vmtPublicFilter["32bits"]&&c.push(a.vmtPublicFilter.ostype),a.vmtPublicFilter["64bits"]&&c.push(a.vmtPublicFilter.ostype+"_64"),b.ostype=c.join()}else a.vmtPublicFilter["32bits"]!=a.vmtPublicFilter["64bits"]&&(b["64bits"]=a.vmtPublicFilter["64bits"]);return b}function h(){var c;return a.vmtPublicFilter.category&&a.vmtPublicFilter.category!=b("translate")("virtualmachinestemplate.filter.allcategories")&&(c={name:a.vmtPublicFilter.category}),c}function i(){if(d.currentDatacenterRepository&&d.currentDatacenterRepository.links){var b=h(),e=g();a.getVirtualImageByCategoryLoading=!0,c.getTemplatesByDatacenterRepositoryRemote(d.currentDatacenterRepository,b,f.vmtRemotePaginator.param,e,j,k)}else console.log("getVirtualImageByCategory() needs a currentDatacenterRepository")}function j(b){f.vmtRemotePaginator.param.totalSize=b.totalSize,a.getVirtualImageByCategoryLoading=!1}function k(b){a.getVirtualImageByCategoryLoading=!1}a.__name="libraryTemplatesImportCtrl",a.virtualMachineTemplatesRemote=c.virtualMachineTemplatesRemote,a.virtualMachineTemplatesCategories=c.virtualMachineTemplatesCategories,a.currentDatacenter=d.currentDatacenter,a.vmtPublicFilter={"32bits":!0,"64bits":!0,path:"",name:"","private":!0,"public":!0,category:b("translate")("virtualmachinestemplate.filter.allcategories"),ostype:""},a.vmtRemotePaginatorParam=f.vmtRemotePaginator.param,a.getVirtualImageByCategoryLoading=!1,a.onPublicPrivateChange=function(b){a.vmtPublicFilter["private"]||a.vmtPublicFilter["public"]||(a.vmtPublicFilter[b]=!0)},a.onArchitectureChange=function(b){a.vmtPublicFilter["32bits"]||a.vmtPublicFilter["64bits"]||(a.vmtPublicFilter[b]=!0)},a.onImportTemplate=function(b){c.importVirtualMachineTemplate(a.currentDatacenter.clientData.repository,b)},a.onFilterSubmit=function(){f.vmtRemotePaginator.resetParam(),i()},a.getPage=function(a){f.vmtRemotePaginator.param.startwith=(a-1)*f.entPaginator.param.limit,i()},a.onShown=function(){a.virtualMachineTemplatesRemote.length=0,e.stopTimer()},a.onHidden=function(){e.initTimer()}}]),angular.module("libraryTemplates",["category","templateCreate","templateEdit","templateImport"]).controller("AppsLibraryCategoriesListCtrl",["$scope","dispatcher","utils","virtualMachineTemplatesMgr","datacentersMgr","enterprisesMgr",function(a,b,c,d,e,f){a.__name="AppsLibraryCategoriesListCtrl",a.catFilter={},a.virtualMachineTemplatesCategories=d.virtualMachineTemplatesCategories,a.currentVirtualMachineTemplateCategory=d.currentVirtualMachineTemplateCategory,a.currentDatacenter=e.currentDatacenter;var g=function(){i()},h=function(){var b=d.virtualMachineTemplatesCategories;if(b&&b.length>0){var c=b[0];a.currentVirtualMachineTemplateCategory&&a.currentVirtualMachineTemplateCategory.id==c.id||d.setCurrentVMTemplateCategory(c)}},i=function(){d.getCategories(f.userEnterprise,h)},j=function(a){d.removeCategory(a)};b.on(["category.created","category.deleted"],i,a),a.onCategoryClick=function(b){(c.isEmptyObject(b)||"0"==b.id)&&(a.catFilter.has=""),d.setCurrentVMTemplateCategory(b)},a.onDeleteCategoryConfirm=function(){j(d.currentVirtualMachineTemplateCategory)},g()}]).controller("AppsLibraryTemplatesListCtrl",["$scope","uModals","dispatcher","paginationHelper","utils","$filter","datacentersMgr","virtualMachineTemplatesMgr","systemPropertiesMgr","$timeout",function(a,b,c,d,e,f,g,h,i,j){function k(){a.vmtFilter.has="",a.vmtStateFilter.failed=!0,a.vmtStateFilter.inProgress=!0,a.vmtStateFilter.deletedMasters=!0}function l(){a.vmtPublicFilter.name="",a.vmtPublicFilter.path="",a.vmtPublicFilter["64bits"]=!0,a.vmtPublicFilter["32bits"]=!0,a.vmtPublicFilter.ostype=""}function m(){var b={};if(b.path=a.vmtPublicFilter.path?a.vmtPublicFilter.path:"",a.vmtPublicFilter.name&&(b.name=a.vmtPublicFilter.name),a.vmtPublicFilter.ostype){var c=[];a.vmtPublicFilter["32bits"]&&c.push(a.vmtPublicFilter.ostype),a.vmtPublicFilter["64bits"]&&c.push(a.vmtPublicFilter.ostype+"_64"),b.ostype=c.join()}else a.vmtPublicFilter["32bits"]!=a.vmtPublicFilter["64bits"]&&(b["64bits"]=a.vmtPublicFilter["64bits"]);return b}function n(){var b=["DONE"];return a.vmtStateFilter.failed&&b.push("FAILED"),a.vmtStateFilter.inProgress&&b.push("IN_PROGRESS"),a.vmtStateFilter.deletedMasters&&b.push("UNAVAILABLE"),a.vmtFilter.states=b.join(),a.vmtFilter}function o(){var b=!1;if(h.virtualMachineTemplates)for(var c=0;c<h.virtualMachineTemplates.length;c++){var d=h.virtualMachineTemplates[c];"IN_PROGRESS"==d.state&&(b=!0,h.refreshVirtualMachineTemplate(d))}b||!e.isEmptyObject(a.currentVirtualMachineTemplate)&&a.currentVirtualMachineTemplate.clientData.isMaster&&a.virtualMachineTemplateInstances&&angular.forEach(a.virtualMachineTemplateInstances,function(b){"IN_PROGRESS"==b.state&&h.getInstancesByTemplate(a.currentVirtualMachineTemplate,!0)})}function p(b){e.isEmptyObject(a.currentVirtualMachineTemplate)||h.getInstancesByTemplate(a.currentVirtualMachineTemplate,b)}a.__name="AppsLibraryTeamplatesListCtrl",a.virtualMachineTemplates=h.virtualMachineTemplates,a.currentVirtualMachineTemplate=h.currentVirtualMachineTemplate,a.virtualMachineTemplateInstances=h.virtualMachineTemplateInstances,a.currentVirtualMachineTemplateCategory=h.currentVirtualMachineTemplateCategory,a.currentDatacenter=g.currentDatacenter,a.vmtPaginationParam=d.vmtPaginator.param,a.vmtFilter={},a.vmtStateFilter={},k(),a.vmtPublicFilter={},l(),a.osTypes=[{name:f("translate")("virtualmachinestemplate.filter.input.any"),value:""},{name:"Windows",value:"WINDOWS_8"},{name:f("translate")("virtualmachinestemplate.filter.input.other"),value:"OTHER"}],a.onClearClick=function(){k(),l()};var q=function(){if(h.virtualMachineTemplates.length=0,h.setCurrentVMTemplate(null),g.currentDatacenterRepository&&g.currentDatacenterRepository.links){var b;b=a.currentDatacenter.clientData.datacenter.isPublicDatacenter?m():n(),a.currentDatacenter.clientData.hypervisorTemplate&&"remote"==a.vmtFilter.source?b.plugin=a.currentDatacenter.clientData.hypervisorTemplate:delete b.plugin,a.vmtFilter.loadingVmts=!0,a.vmtPaginationParam.limit=2*i.systemProperties.general["client.user.numberElementsPerPage"].value,h.getTemplatesByDatacenterRepository(g.currentDatacenterRepository,a.currentVirtualMachineTemplateCategory,!1,d.vmtPaginator.param,b,s,r)}else console.log("getVirtualImageByCategory() needs a currentDatacenterRepository")},r=function(){a.vmtFilter.loadingVmts=!1},s=function(b){a.vmtFilter.loadingVmts=!1,d.vmtPaginator.param.totalSize=b.totalSize};a.deleteAllowed=function(a){var b=!0;return a.id&&f("isGranted")("APPLIB_ALLOW_MODIFY")?a.shared&&!f("isGranted")("ENTERPRISE_ADMINISTER_ALL")&&(b=!1):b=!1,b},a.onDeleteTemplateConfirm=function(a){h.deleteVirtualImage(a,!1)},a.onTemplateMouseDown=function(a){h.setCurrentVMTemplate(a),a.clientData.isMaster&&p()},a.onTemplateInstanceMouseDown=function(a){h.setCurrentVMTemplateInstance(a)},a.onFilterOptionClick=function(){h.setCurrentVMTemplate(null)},a.onVmtFilterSubmit=function(){d.vmtPaginator.resetParam(),q()},a.onArchitectureChange=function(b){a.vmtPublicFilter["32bits"]||a.vmtPublicFilter["64bits"]||(a.vmtPublicFilter[b]=!0)},a.onDownloadTemplate=function(a){h.downloadVirtualMachine(a)},a.getPage=function(a){d.vmtPaginator.param.startwith=(a-1)*d.vmtPaginator.param.limit,q()},a.$watch("libraryViewTab.value",function(b){a.onClearClick(),j(function(){a.onClearClick()},100)}),a.$on("timer",function(){o()}),c.on("currentDatacenterRepository.change",function(){a.onVmtFilterSubmit()},a),c.on(["currentVirtualMachineTemplateCategory.change","virtualimage.created","virtualimage.edited","virtualimage.deleted","virtualimage.updated","template.imported"],q,a),c.on(["virtualimageinstance.edited"],function(){p(!0)},a),a.onDuplicateTemplate=function(b){var c={scope:a,popupUrl:"modules/library/templates/partials/duplicateform.html",title:f("translate")("appslibrary.templates.duplicate.form.title"),closeOnAccept:!1,acceptLabel:f("translate")("globals.accept"),cancelLabel:f("translate")("globals.cancel"),showAcceptBtn:!0,showCancelBtn:!0,infoUrl:"",popupWidth:"300px",controller:"DuplicateVirtualMachineTemplateCtrl",formName:"DuplicateVirtualMachineTemplateForm",popupData:{virtualMachineTemplate:b}};e.showPopUp(c,a)},c.on("currentDatacenter.change",function(){a.virtualMachineTemplates.length=0,e.isEmptyObject(a.currentDatacenter)||(a.currentDatacenter.clientData.datacenter.isPublicDatacenter?a.vmtPublicFilter={source:"local",path:"","public":!1,"private":!1,"64bits":!1,"32bits":!1,ostype:a.osTypes[0].value}:k())},a)}]).controller("DuplicateVirtualMachineTemplateCtrl",["$scope","$filter","uModals","gridTemplates","virtualMachineTemplatesMgr",function(a,b,c,d,e){a.__name="DuplicateVirtualMachineTemplateCtrl",a.disksGrid={data:"template.clientData.disks",columnDefs:[{field:"",width:30,displayName:"",cellTemplate:d.diskCheckboxCellTemplate},{field:"sequence",width:80,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.sequence")},{field:"path",displayName:b("translate")("virtualmachinetemplate.disks.grid.title.file"),cellTemplate:d.templateWithTooltip},{field:"diskFileSize",width:80,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.filesize"),cellTemplate:d.sizeUnitInBytesCellTemplate},{field:"hdRequired",width:80,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.hd"),cellTemplate:d.sizeUnitInBytesCellTemplate},{field:"state",width:80,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.state")}],multiSelect:!1};var f=function(){a.closePopup(),a.onVmtFilterSubmit()},g=function(){angular.forEach(a.template.clientData.disks,function(a){a.clientData.selected=!0})};a.onSubmit=function(){var d=!1;angular.forEach(a.template.clientData.disks,function(a){a.clientData.selected&&(d=!0)}),d?e.duplicateVirtualImage(a.template,a.template.clientData.newName,f):c.showAlert({scope:a,message:b("translate")("virtualmachinetemplate.duplicate.missingdisk.message"),title:b("translate")("virtualmachinetemplate.duplicate.missingdisk.title"),showCancelBtn:!1,showConfirmBtn:!0,confirmLabel:b("translate")("globals.close")})},a.onShown=function(){"instance"==a.popupData?a.template=angular.copy(e.currentVirtualMachineTemplateInstance):a.template=angular.copy(e.currentVirtualMachineTemplate),e.getVMTemplateDisks(a.template,[],!0,g)},a.onHidden=function(){}}]).controller("VirtualMachineTemplateInUseCtrl",["$scope","virtualMachineTemplatesMgr","virtualMachinesMgr","gridTemplates","$filter",function(a,b,c,d,e){a.__name="VirtualMachineTemplateInUseCtrl";var f=function(){a.template=a.popupData,a.isCloudAdmin=e("isGranted")("USERS_MANAGE_OTHER_ENTERPRISES"),c.getTemplateVirtualMachines(a.template,a.isCloudAdmin),b.getTemplateInstancesAndPersistents(a.template,a.isCloudAdmin)};a.virtualMachinesGrid={data:"template.clientData.virtualMachines",columnDefs:[{field:"name",displayName:e("translate")("servers.virtualmachine.col.name")},{field:"clientData.user.name",displayName:e("translate")("servers.virtualmachine.col.owner"),width:150},{field:"clientData.enterprise.name",displayName:e("translate")("servers.virtualmachine.col.enterprise"),width:100},{field:"state",displayName:e("translate")("servers.virtualmachine.col.state"),cellTemplate:d.stateVMStringCellTemplate,width:100}]},a.instancesAndPersistentsGrid={data:"template.clientData.instancesAndPersistents",columnDefs:[{field:"name",displayName:e("translate")("appslibrary.templateinuse.col.name")},{field:"clientData.virtualDatacenter.name",displayName:e("translate")("appslibrary.templateinuse.col.vdc"),width:100},{field:"clientData.virtualAppliance.name",displayName:e("translate")("appslibrary.templateinuse.col.vapp"),width:100},{field:"clientData.virtualMachine.name",displayName:e("translate")("appslibrary.templateinuse.col.vm"),width:100},{field:"state",displayName:e("translate")("appslibrary.templateinuse.col.state"),cellTemplate:d.stateCellTemplate,sortable:!1,width:100}]},a.onSubmit=function(){b.deleteVirtualImage(a.template,!0)},f()}]),angular.module("limits",[]).controller("HardLimitCtrl",["$scope","$filter","systemPropertiesMgr","dispatcher",function(a,b,c,d){a.__name="HardLimitCtrl";var e=function(){a.error=a.popupData.error,a.errorMessage=b("translate")("limits.hard.message"),a.showDetails=1==c.systemProperties.general["client.main.showHardInfo"].value&&"VIRTUALDATACENTER"==a.popupData.error.entityType,a.limitType="HARD",f(a.error)};a.onCancel=function(){d.dispatch("softLimits.canceled",a.popupData)},a.onShown=function(){},a.onHidden=function(){},a.onSubmit=function(){};var f=function(c){if("LIMITS_EXCEEDED"==c.code)a.errorTitle=b("translate")("limits.generic.title",{entity:c.entityName});else{var d=b("translate")("server.error."+c.code);d=="server.error."+c.code?a.errorTitle=c.code+": "+c.message:a.errorTitle=c.code+": "+d}};e()}]).controller("SoftLimitCtrl",["$scope","$filter","dispatcher","server","systemPropertiesMgr","virtualAppliancesMgr",function(a,b,c,d,e,f){a.__name="SoftLimitCtrl";var g=function(){a.error=a.popupData.error,a.errorMessage=b("translate")("limits.soft.message"),a.showDetails=1==e.systemProperties.general["client.main.showSoftInfo"].value,a.limitType="SOFT",h(a.error)};a.onShown=function(){},a.onHidden=function(){},a.onSubmit=function(){a.popupData.config?d.forceSoftLimitCall(a.popupData.config,a.popupData.successCallback):f.updatePendingCurrentVirtualMachines(!0)},a.onCancel=function(){c.dispatch("softLimits.canceled",a.popupData)};var h=function(c){if("SOFT_LIMIT_EXCEEDED"==c.code)a.errorTitle=b("translate")("limits.generic.title",{entity:c.entityName});else{var d=b("translate")("server.error."+c.code);d=="server.error."+c.code?a.errorTitle=c.code+": "+c.message:a.errorTitle=c.code+": "+d}};g()}]),angular.module("logger",[]).controller("LoggerCtrl",["$scope","loggerMgr",function(a,b){a.__name="LoggerCtrl",a.predicate="date",a.reverse=!0,a.logs=b.logs}]),angular.module("login",[]).controller("LoginCtrl",["$scope","$translate","authenticationMgr","userMgr","enterprisesMgr","commonsMgr","systemPropertiesMgr","themeMgr","navigationMgr","refreshMgr","virtualMachineTemplatesMgr","privilegesMgr","urlParametersUtils","utils","$filter","$cookies","configMgr",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(){if(c.getToken(),m.getUrlParameters(),a.language.selected=m.getLanguage(),b.use(a.language.selected),""!=c.credentials.token,void 0===p.auth){var d=m.getResetPassword();d.resetPasswordToken&&(a.resetUser.resetPasswordToken=d.resetPasswordToken,a.showResetPassword=!0),a.showLogin=!0}else a.login()}function s(a){var b=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");return b.test(a)?!0:!1}function t(){navigator.cookieEnabled||n.toastrError(o("translate")("login.alert.cookies_disabled"))}function u(){var a=q.config["config.endpoint"];n.isEmptyObject(a)?n.toastrError(o("translate")("login.alert.endpoint.empty")):s(a)||n.toastrError(o("translate")("login.alert.endpoint.invalid",{endpoint:a}))}function v(){var a=document.createElement("a");a.href=q.config["config.endpoint"],window.location.hostname!=a.hostname&&n.toastrWarning(o("translate")("login.alert.warning.cors",{endpoint:a.hostname,url:window.location.hostname}))}function w(){var a=document.createElement("a");a.href=q.config["config.endpoint"],window.location.protocol!=a.protocol&&n.toastrError(o("translate")("login.alert.endpoint.invalid_protocol",{endpoint:a.protocol,url:window.location.protocol}))}a.__name="LoginCtrl",a.credentials=c.credentials,a.languages=CONFIG["config.languages"],a.language={selected:null},a.showLogin=!1,a.hidePoweredBy=1==q.config["client.poweredby.hide"],a.captchaPublicKey=q.config["client.captcha.publickey"],a.passwordRecoveryVisible=q.config["client.password.recovery"],a.offlineModeEnabled=q.config["client.mode.offline.enabled"];var x=!1;a.refreshLanguages(),a.showForgetPassword=!1,a.forgetUser={};var y=function(){a.changeView(!1)};a.changeView=function(b){a.showForgetPassword=b,b||(a.showResetPassword=b)},a.forgetPassword=function(){c.forgetPassword(Recaptcha.get_challenge(),Recaptcha.get_response(),a.forgetUser.username,y)};try{Recaptcha.create(a.captchaPublicKey,"recaptcha_div",{theme:"red",callback:Recaptcha.focus_response_field}),a.recaptchaEnabled=!0}catch(z){a.recaptchaEnabled=!1}a.showResetPassword=!1,a.resetUser={},a.resetPassword=function(){a.resetUser.newPassword.trim()!=a.resetUser.repeatPassword.trim()?n.toastrError(o("translate")("login.alert.passwords.notiquals")):c.resetPassword(a.resetUser,y)},a.login=function(){var a=function(){c.authenticated=!0,i.setAppView("main"),j.setTimeIntervals(g.systemProperties),j.initTimer()},b=function(){l.formatUserPrivilegesList(d.user.clientData.privileges),g.getSystemProperties(a),o("isGranted")("SYSCONFIG_ALLOW_MODIFY")&&g.getLicenses(),(o("isGranted")("VDC_MANAGE_VAPP")||o("isGranted")("APPLIB_VIEW"))&&e.getDatacenterRepositories(e.userEnterprise)},m=function(){d.getPrivileges(b)},n=function(a){d.setUser(a),e.getUserEnterprise(d.user,function(a){k.getCategories(e.userEnterprise),h.loadTheme(e.userEnterprise.theme)}),f.getHypervisorTypes(),d.getRole(m)};c.login(n)},a.onLanguageChange=function(a){x=!0,b.use(a)},a.$on("translationChangeSuccess",function(a){x&&(t(),u(),v(),w()),x=!1}),r()}]),angular.module("main",["tutorials"]).controller("MainCtrl",["$scope","$rootScope","$filter","$window","$timeout","navigationMgr","systemPropertiesMgr","stepByStepMgr","userMgr","authenticationMgr","dispatcher","utils","uModals",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.__name="MainCtrl",a.systemProperties=g.systemProperties,a.userRole=i.user.clientData.role,a.tutorials=h.tutorials,a.tutorialContainer=h.tutorialContainer,a.refreshLanguages(),a.expandMenu=function(){f.expand()},a.collapseMenu=function(){f.collapse()},a.triggerResizeEvent=function(a){"width"==a.originalEvent.propertyName&&$(window).trigger("resize")},b.connectionStatusIsOnline=navigator.onLine,d.addEventListener("offline",function(){b.$apply(function(){b.connectionStatusIsOnline=!1})},!1),d.addEventListener("online",function(){b.$apply(function(){b.connectionStatusIsOnline=!0})},!1);var n=function(){m.showAlert({scope:a,message:c("translate")("tutorials.alert.back.message"),title:c("translate")("tutorials.alert.back.title"),confirmLabel:c("translate")("globals.yes"),cancelLabel:c("translate")("globals.no"),showConfirmBtn:!0,showCancelBtn:!0,confirmFn:function(){a.displayTutorials(!0)}})},o=function(){k.dispatch("tutorial.stop")},p=function(a){},q=function(a){h.refreshSteps()},r=function(b){var c=a.tutorialContainer.getCurrentStepInfo();c.actionType&&"onclick"!=c.actionType&&"ondblclick"!=c.actionType&&void 0==c.eventRegistered&&(a.$$listeners[c.actionType]||k.on(c.actionType,function(){if(c.eventRegistered=!0,h.tutorialIsRunning()){var b=c.delayBeforeNextItem?c.delayBeforeNextItem:1;e(function(){a.tutorialContainer.nextStep()},b)}},a))},s=function(){a.tutorialContainer.oncomplete(n),a.tutorialContainer.onexit(o),a.tutorialContainer.onchange(p),a.tutorialContainer.onbeforechange(q),a.tutorialContainer.onafterchange(r),h.setTutorialOptions()},t=function(){"1"==a.systemProperties.general["client.main.enableTutorials"].value&&h.loadTutorials(a.userRole,a.displayTutorials)},u=function(b,c){h.loadTutorial(a.userRole,c.file)};a.displayTutorials=function(b){l.isEmptyObject(a.tutorials)||(j.userChoices.automaticallyOpenTutorials||b)&&(s(),m.showPopUp({scope:a,controller:"TutorialsCtrl",popupUrl:"modules/main/tutorials/partials/tutorialsform.html",formName:"tutorialsForm",title:a.tutorials.popupTitle,closeOnCancel:!0,showAcceptBtn:!1,showCancelBtn:!0,cancelLabel:c("translate")("globals.close"),infoUrl:a.tutorials.moreInfoUrl,popupWidth:a.tutorials.width}))},k.on("tutorials.load",u,a),a.$on("timer",function(){h.tutorialIsRunning()&&e(function(){a.tutorialContainer.refreshCurrentElement()},200)}),a.$on("timerVM",function(){h.tutorialIsRunning()&&e(function(){a.tutorialContainer.refreshCurrentElement()},100)}),t()}]),angular.module("remoteAccess",[]).controller("RemoteAccessCtrl",["$scope","dispatcher",function(a,b){a.__name="RemoteAccessCtrl";var c=function(a,b){var c=document.getElementById("raIframe");c.src=b.url;var d=document.getElementById("raDiv");d.style.display="block"};a.unloadRemoteAccessJavaClient=function(){var a=document.getElementById("raDiv");a.style.display="none";var b=document.getElementById("raIframe");b.src=""},b.on("openRemoteAccessJavaClient",c,a)}]),angular.module("tutorials",[]).controller("TutorialsCtrl",["$scope","$sce","stepByStepMgr","authenticationMgr","dispatcher",function(a,b,c,d,e){a.tutorials=c.tutorials;var f=function(){a.tutorials.dontShowPopUp=!d.userChoices.automaticallyOpenTutorials,a.welcomeText=b.trustAsHtml(a.tutorials.welcomeText)};a.onDontShowPopUpChange=function(){d.userChoices.automaticallyOpenTutorials=!a.tutorials.dontShowPopUp,d.setUserChoicesCookie()},a.startTutorial=function(b){a.closePopup(),e.dispatch("tutorials.load",{file:b.file})},f()}]),angular.module("mainMenu",[]).controller("MainMenuCtrl",["$scope","userMgr","enterprisesMgr","authenticationMgr","configMgr","$route","systemPropertiesMgr","commonsMgr","$window","dispatcher","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){a.__name="MainMenuCtrl",a.user=b.user,a.userEnterprise=c.userEnterprise,a.versionParameter="?version="+e.UI_VERSION,a.systemProperties=g.systemProperties,a.licenses=g.licenses,a.hypervisorTypes=h.hypervisorTypes,a.returnShowUserMenu=function(){return 0!=a.systemProperties.general["client.main.disableChangePassword"].value||0!=a.systemProperties.general["client.main.allowLogout"].value},a.logout=function(){d.logout(g.getLogoutUrl())},a.returnToUrl=function(a){d.logout(g.getLogoutUrl())},a.showMenu=function(){return g.showMenu},a.activeView=f.current.$$route.controller,a.onUnlicensedClick=function(){i.location.href="#/configuration",k(function(){j.dispatch("display.licenses")})},a.$on("$routeChangeSuccess",function(b,c){
c.$$route&&(a.activeView=c.$$route.controller)})}]).controller("NotificationsCtrl",["$scope","notificationsMgr",function(a,b){a.__name="NotificationsCtrl",a.notifications=b.notifications;var c=function(){b.getNotifications()};a.onNotificationClick=function(a){b.markAsRead(a)},a.markAllAsRead=function(){b.markAllAsRead()},a.$on("timer",function(){c()}),c()}]),angular.module("costCodeCreate",[]).controller("CostCodeCreateCtrl",["$scope","costCodesMgr",function(a,b){a.__name="CostCodeCreateCtrl";var c=function(){a.closePopup()};a.onShown=function(){a.costCode={clientData:{costCodeCurrencies:{collection:[]}}},b.getCostCodeCurrencies(0)},a.onSubmit=function(){b.addCostCode(a.costCode,c)}}]),angular.module("costCodeEdit",[]).controller("CostCodeEditCtrl",["$scope","costCodesMgr",function(a,b){a.__name="CostCodeEditCtrl";var c=function(){a.closePopup()};a.onShown=function(){a.costCode=angular.copy(b.currentCostCode),a.costCode.clientData={costCodeCurrencies:{collection:[]}},b.getCostCodeCurrencies(a.costCode.id)},a.onSubmit=function(){b.editCostCode(a.costCode,c)}}]),angular.module("costcodes",["costCodeCreate","costCodeEdit"]).controller("CostCodesCtrl",["$scope","$filter","$log","costCodesMgr","systemPropertiesMgr","paginationHelper","$timeout","safeApply","dispatcher",function(a,b,c,d,e,f,g,h,i){a.systemProperties=e.systemProperties,a.costCodes=d.costCodes,a.currentCostCode=d.currentCostCode,a.ccFilter=f.costCodePaginator.filter,a.ccPaginationParam=f.costCodePaginator.param,a.sortInfo={fields:[""],directions:["asc","desc"]},a.onCcFilterSubmit=function(){f.costCodePaginator.resetParam(),a.getPage(f.costCodePaginator.param.currentPage)},a.onCcCleanFilterClick=function(){a.ccFilter.has="",l()},a.getPage=function(a){f.costCodePaginator.param.startwith=(a-1)*f.costCodePaginator.param.limit,d.setCurrentCostCode(null),l()};var j=function(a){a.selected&&d.setCurrentCostCode(a.entity)},k=function(b){f.costCodePaginator.param.totalSize=b.totalSize,g(function(){h(a)},100)},l=function(){d.getCostCodes(!1,f.costCodePaginator.param,f.costCodePaginator.filter,k)};a.gridCostCodes={data:"costCodes",sortInfo:a.sortInfo,columnDefs:[{field:"name",displayName:b("translate")("costcode.costcodes.col.name")},{field:"description",displayName:b("translate")("costcode.costcodes.col.description")}],useExternalSorting:!0,afterSelectionChange:j},a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var b=d.sortMapping[a.fields[0]],c="asc"===a.directions[0]?!0:!1;f.costCodePaginator.filter.by=b,f.costCodePaginator.filter.asc=c,l()}},!0),a.onDeleteCostCodeConfirm=function(){d.deleteCostCode(d.currentCostCode)},a.$watch("pricingTab",function(a){"costcodes"===a&&l()}),i.on(["costcode.created","costcode.edited","costcode.deleted"],function(){l()},a)}]).controller("InitialPricesGridCtrl",["$scope","$filter","pricingMgr","costCodesMgr",function(a,b,c,d){a.__name="InitialPricesGridCtrl",a.costCode.clientData.costCodeCurrencies.collection=d.costCodeCurrencies;var e='<div><input type="text" style="width: 50px;" data-ng-model="row.entity.price"> {{ row.entity.clientData.currency.symbol }}</div> ';a.gridCostCodeCurrencies={data:"costCode.clientData.costCodeCurrencies.collection",columnDefs:[{field:"clientData.currency.symbol",displayName:b("translate")("currency.create.input.code")},{field:"clientData.currency.name",displayName:b("translate")("currency.create.input.name")},{field:"price",displayName:b("translate")("pricingmodel.create.imageprices.col.newprice"),cellTemplate:e}],filterOptions:{filterText:"",useExternalFilter:!1}}}]),angular.module("currencyCreate",[]).controller("CurrencyCreateCtrl",["$scope","currenciesMgr",function(a,b){a.__name="CurrencyCreateCtrl";var c=function(){a.closePopup()};a.onShown=function(){a.currency={}},a.onSubmit=function(){b.addCurrency(a.currency,c)}}]),angular.module("currencyEdit",[]).controller("CurrencyEditCtrl",["$scope","currenciesMgr",function(a,b){a.__name="CurrencyEditCtrl";var c=function(){a.closePopup()};a.onShown=function(){a.currency=angular.copy(b.currentCurrency)},a.onSubmit=function(){b.editCurrency(a.currency,c)}}]),angular.module("currencies",["currencyCreate","currencyEdit"]).controller("CurrenciesCtrl",["$scope","$filter","$log","currenciesMgr","systemPropertiesMgr","paginationHelper","$timeout","safeApply","dispatcher",function(a,b,c,d,e,f,g,h,i){a.systemProperties=e.systemProperties,a.currencies=d.currencies,a.currentCurrency=d.currentCurrency,a.curFilter=f.curPaginator.filter,a.curPaginationParam=f.curPaginator.param,a.sortInfo={fields:[""],directions:["asc","desc"]},a.onCurFilterSubmit=function(){f.curPaginator.resetParam(),a.getPage(f.curPaginator.param.currentPage)},a.onCurCleanFilterClick=function(){a.curFilter.has="",l()},a.getPage=function(a){f.curPaginator.param.startwith=(a-1)*f.curPaginator.param.limit,d.setCurrentCurrency(null),l()};var j=function(a){a.selected&&d.setCurrentCurrency(a.entity)},k=function(b){f.curPaginator.param.totalSize=b.totalSize,g(function(){h(a)},100)},l=function(){d.getCurrencies(f.curPaginator.param,f.curPaginator.filter,k)};a.gridCurrencies={data:"currencies",sortInfo:a.sortInfo,columnDefs:[{field:"symbol",displayName:b("translate")("pricingmodel.create.imageprices.col.code")},{field:"name",displayName:b("translate")("pricingmodel.create.imageprices.col.name")}],useExternalSorting:!0,afterSelectionChange:j},a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var b=d.sortMapping[a.fields[0]],c="asc"===a.directions[0]?!0:!1;f.curPaginator.filter.by=b,f.curPaginator.filter.asc=c,l()}},!0),a.onDeleteCurrencyConfirm=function(){d.deleteCurrency(d.currentCurrency)},a.$watch("pricingTab",function(a){"currencies"===a&&l()}),i.on(["currency.created","currency.edited","currency.deleted"],function(){l()},a)}]),angular.module("enterprisesAssociation",[]).controller("EnterprisesAssociationCtrl",["$scope","pricingMgr","paginationHelper","$filter","$timeout","safeApply","utils","gridTemplates",function(a,b,c,d,e,f,g,h){a.enterprisesWithPricingModel=b.enterprisesWithPricingModel,a.enterprisesWithoutPricingModel=b.enterprisesWithoutPricingModel,a.pricingModels=b.pricingModels,a.currentPricingModel=b.currentPricingModel,a.pmFilter=c.pricingModelPaginator.filter,a.pmPaginationParam=c.pricingModelPaginator.param,a.entWithoutPaginationParam=angular.copy(c.pricingModelPaginator),a.withoutFilter=a.entWithoutPaginationParam.filter,a.entWithPaginationParam=angular.copy(c.pricingModelPaginator),a.withFilter=a.entWithPaginationParam.filter,a.gridEnterprisesWithoutPricingModel={data:"enterprisesWithoutPricingModel",columnDefs:[{field:"name",displayName:d("translate")("pricingmodel.create.imageprices.col.name")},{field:"idPricingTemplate",displayName:d("translate")("enterpriseassociations.col.pricingmodel"),cellTemplate:h.pricingModelCellTemplate}],enableRowSelection:!1},a.gridEnterprisesWithPricingModel={data:"enterprisesWithPricingModel",columnDefs:[{field:"name",displayName:d("translate")("pricingmodel.create.imageprices.col.name")},{field:"idPricingTemplate",displayName:d("translate")("enterpriseassociations.col.pricingmodel"),cellTemplate:h.pricingModelCellTemplate}],enableRowSelection:!1},a.onAllPricingModelClick=function(){a.pmFilter.has="",a.onPricingModelClick(null),a.onPmFilterSubmit()},a.onPmFilterSubmit=function(){c.pricingModelPaginator.resetParam(),a.getPage(c.pricingModelPaginator.param.currentPage)},a.onPmCleanFilterClick=function(){a.pmFilter.has="",j()},a.getPage=function(a){c.pricingModelPaginator.param.startwith=(a-1)*c.pricingModelPaginator.param.limit,b.setCurrentPricingModel(),j()};var i=function(b){c.pricingModelPaginator.param.totalSize=b.totalSize,e(function(){f(a)},100)},j=function(){b.getPricingModels(!1,c.pricingModelPaginator.param,c.pricingModelPaginator.filter,i)},k=function(a){b.setCurrentPricingModel(a),m(a),o(a)};a.changeEnterprisePricingModel=function(a){b.updateEnterprisePricingModel(a,k)},a.onPricingModelClick=function(a){k(a)},a.onFilterSubmit=function(b){b?(a.entWithPaginationParam.resetParam(),a.getEnterprisesPage(b,a.entWithPaginationParam.param.currentPage)):(a.entWithoutPaginationParam.resetParam(),a.getEnterprisesPage(b,a.entWithoutPaginationParam.param.currentPage))},a.getEnterprisesPage=function(b,c){b?(a.entWithPaginationParam.param.startwith=(c-1)*a.entWithPaginationParam.param.limit,o(a.currentPricingModel)):(a.entWithoutPaginationParam.param.startwith=(c-1)*a.entWithoutPaginationParam.param.limit,m(a.currentPricingModel))},a.onCleanFilterClick=function(b){b?(a.withFilter.has="",o(a.currentPricingModel)):(a.withoutFilter.has="",m(a.currentPricingModel))};var l=function(b){a.entWithoutPaginationParam.param.totalSize=b.totalSize,e(function(){f(a)},100)},m=function(c){var d=g.isEmptyObject(c)?0:c.id;b.getPricingModelEnterprises(!1,d,a.entWithoutPaginationParam.param,a.withoutFilter,l)},n=function(b){a.entWithoutPaginationParam.param.totalSize=b.totalSize,e(function(){f(a)},100)},o=function(c){var d=g.isEmptyObject(c)?0:c.id;b.getPricingModelEnterprises(!0,d,a.entWithPaginationParam.param,a.withFilter,n)};a.$watch("pricingTab",function(a){"enterpriseassociations"===a&&(j(),k())})}]),angular.module("pricing",["pricingModel","enterprisesAssociation","currencies","costcodes"]).controller("PricingCtrl",["$scope","pricingMgr","costCodesMgr","currenciesMgr","utils",function(a,b,c,d,e){}]),angular.module("pricingModelCreate",[]).controller("PricingModelCreateCtrl",["$scope","pricingMgr","costCodesMgr","currenciesMgr","utils","$filter",function(a,b,c,d,e,f){a.__name="CreatePricingModelCtrl",a.periods=b.periods,a.currencies=d.currencies,a.variables=["%CHARGEPERIOD%","%MINCHARGE_FORMATTED%","%MINPERIOD%","%CHARGE_FORMATTED%"],a.currencyExPattern=e.regExPattern.currencyExPattern,a.options={minimumResultsForSearch:-1};var g=0,h=function(){a.closePopup()};a.onSubmit=function(){var c=angular.copy(a.pricingModel);c.chargingPeriod=parseInt(c.chargingPeriod),b.addPricingModel(c,h)},a.onShown=function(){a.pricingModel={id:0,clientData:{currency:a.currencies[0],costCodes:c.pricingCostCodes,tiers:b.pricingTiers,enterprise:{}},links:[],chargingPeriod:a.periods[2].id,minimumCharge:a.periods[2].id,showChangesBefore:!0,description:f("translate")("pricingmodel.create.generalinfo.input.description.default_value")},a.selectedCurrency={id:a.pricingModel.clientData.currency.id},c.getPricingCostCodes(0,a.pricingModel.clientData.currency.id),b.getPricingTiers(0)},a.onSelectVariable=function(){""!=a.pricingModel.clientData.variable&&(a.pricingModel.description=a.pricingModel.description.slice(0,g)+a.pricingModel.clientData.variable+a.pricingModel.description.slice(g),a.pricingModel.clientData.variable="")},a.onCurrencyChange=function(b){var d=f("getElementByParameter")(a.currencies,{element:parseInt(b),attribute:"id"});a.pricingModel.clientData.currency=d,c.getPricingCostCodes(0,a.pricingModel.clientData.currency.id)},a.updateCursorPosition=function(){g=angular.element("#pricingModelDescription")[0].selectionStart}}]).controller("PricingModelCloneCtrl",["$scope","pricingMgr","costCodesMgr","currenciesMgr","$filter",function(a,b,c,d,e){function f(){a.closePopup()}function g(){c.getPricingCostCodes(b.currentPricingModel.id,b.currentPricingModel.clientData.currency.id,h)}function h(){b.getPricingTiers(b.currentPricingModel.id,i)}function i(){a.pricingModel=angular.copy(b.currentPricingModel),a.pricingModel.clientData.currency=e("getElementByParameter")(a.currencies,{element:a.pricingModel.clientData.currency.id,attribute:"id"}),a.pricingModel.name=a.pricingModelName,a.pricingModel.clientData.costCodes=c.pricingCostCodes,a.pricingModel.clientData.tiers=b.pricingTiers,a.pricingModel.id="0",a.pricingModel.links=[],b.addPricingModel(a.pricingModel,f)}a.__name="PricingModelCloneCtrl",a.currencies=d.currencies,a.onSubmit=function(){g()},a.onShown=function(){a.pricingModelName=b.currentPricingModel.name+" (c)"}}]),angular.module("pricingModelEdit",[]).controller("PricingModelEditCtrl",["$scope","pricingMgr","costCodesMgr","currenciesMgr","$log","$filter","utils",function(a,b,c,d,e,f,g){a.__name="EditPricingModelCtrl",a.periods=b.periods,a.currencies=d.currencies,a.variables=["%CHARGEPERIOD%","%MINCHARGE_FORMATTED%","%MINPERIOD%","%CHARGE_FORMATTED%"],a.currencyExPattern=g.regExPattern.currencyExPattern,a.options={minimumResultsForSearch:-1};var h=0,i=function(){a.closePopup()};a.onSubmit=function(){var c=angular.copy(a.pricingModel);c.chargingPeriod=parseInt(c.chargingPeriod),b.editPricingModel(c,i)},a.onShown=function(){a.pricingModel=angular.copy(b.currentPricingModel),a.selectedCurrency=angular.copy(f("getElementByParameter")(a.currencies,{element:parseInt(a.pricingModel.clientData.currency.id),attribute:"id"})),a.onCurrencyChange(a.selectedCurrency.id),c.getPricingCostCodes(a.pricingModel.id,a.pricingModel.clientData.currency.id),b.getPricingTiers(a.pricingModel.id)},a.onSelectVariable=function(){""!=a.pricingModel.clientData.variable&&(a.pricingModel.description=a.pricingModel.description.slice(0,h)+a.pricingModel.clientData.variable+a.pricingModel.description.slice(h),a.pricingModel.clientData.variable="")},a.updateCursorPosition=function(){h=angular.element("#pricingModelDescription")[0].selectionStart},a.onCurrencyChange=function(b){a.pricingModel.clientData.currency=f("getElementByParameter")(a.currencies,{element:parseInt(b),attribute:"id"})}}]),angular.module("pricingModel",["pricingModelCreate","pricingModelEdit"]).controller("PricingModelCtrl",["$scope","pricingMgr","currenciesMgr","systemPropertiesMgr","paginationHelper","safeApply","dispatcher","$log","$timeout","$filter",function(a,b,c,d,e,f,g,h,i,j){a.pricingModels=b.pricingModels,a.systemProperties=d.systemProperties,a.currentPricingModel=b.currentPricingModel,a.pmFilter=e.pricingModelPaginator.filter,a.pmPaginationParam=e.pricingModelPaginator.param,a.sortInfo={fields:[""],directions:["asc","desc"]},a.onPmFilterSubmit=function(){e.pricingModelPaginator.resetParam(),a.getPage(e.pricingModelPaginator.param.currentPage)},a.onPmCleanFilterClick=function(){a.pmFilter.has="",m()},a.getPage=function(a){e.pricingModelPaginator.param.startwith=(a-1)*e.pricingModelPaginator.param.limit,b.setCurrentPricingModel(null),m()};var k=function(a){a.selected&&b.setCurrentPricingModel(a.entity)},l=function(b){e.pricingModelPaginator.param.totalSize=b.totalSize,i(function(){f(a)},100)},m=function(){b.getPricingModels(!1,e.pricingModelPaginator.param,e.pricingModelPaginator.filter,l)};a.returnPeriodName=function(a){var c=j("getElementByParameter")(b.periods,{element:a,attribute:"id"});return c.name};a.gridPricingModels={data:"pricingModels",sortInfo:a.sortInfo,columnDefs:[{field:"name",displayName:j("translate")("pricingmodel.create.generalinfo.input.name")},{field:"clientData.currency.name",displayName:j("translate")("pricingmodel.create.generalinfo.input.currencies"),width:100},{field:"chargingPeriod",displayName:j("translate")("pricingmodel.create.generalinfo.input.chargingperiod"),sortable:!1,cellTemplate:"<p>{{returnPeriodName(row.getProperty(col.field))}}</p>"},{field:"minimumCharge",displayName:j("translate")("pricingmodel.create.generalinfo.input.minimumchargingperiod"),sortable:!1,cellTemplate:"<p>{{returnPeriodName(row.getProperty(col.field))}}</p>"},{field:"vcpu",displayName:j("translate")("pricingmodel.create.generalinfo.input.cpu"),sortable:!1},{field:"memoryGB",displayName:j("translate")("pricingmodel.create.generalinfo.input.memory"),sortable:!1},{field:"hdGB",displayName:j("translate")("pricingmodel.create.generalinfo.input.datastore"),sortable:!1},{field:"vlan",displayName:j("translate")("pricingmodel.create.generalinfo.input.vlan"),sortable:!1},{field:"publicIp",displayName:j("translate")("pricingmodel.create.generalinfo.input.publicip"),sortable:!1},{field:"layer",displayName:j("translate")("pricingmodel.create.generalinfo.input.layer"),sortable:!1},{field:"repositoryGB",displayName:j("translate")("pricingmodel.create.generalinfo.input.repository"),sortable:!1},{field:"standingChargePeriod",displayName:j("translate")("pricingmodel.create.generalinfo.input.standingcharge"),sortable:!1},{field:"minimumChargePeriod",displayName:j("translate")("pricingmodel.create.generalinfo.input.mincharge"),sortable:!1}],multiSelect:!1,useExternalSorting:!0,afterSelectionChange:k};var n={};a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var c=b.sortMapping[a.fields[0]],d="asc"===a.directions[0]?!0:!1;(n.orderBy!=c||n.asc!=d)&&(n.orderBy=c,n.asc=d,e.pricingModelPaginator.filter.by=c,e.pricingModelPaginator.filter.asc=d,m())}},!0),a.onDeletePricingModelConfirm=function(){b.deletePricingModel(b.currentPricingModel)},a.$watch("pricingTab",function(a){"pricingmodels"===a&&(c.getCurrencies(),m())}),g.on(["pricingmodel.created","pricingmodel.edited","pricingmodel.deleted"],function(){m()},a)}]).controller("ImagePricesGridCtrl",["$scope","$filter","pricingMgr","costCodesMgr",function(a,b,c,d){a.__name="ImagePricesGridCtrl",a.filter={filterText:""},a.pricingModel.clientData.costCodes=d.pricingCostCodes;var e='<div><input type="text"class="span1" data-ng-model="row.entity.price" numeric maxlength="15"> {{ pricingModel.clientData.currency.symbol }}</div> ',f='<div class="ngCellText" ng-class="col.colIndex()"><span ng-cell-text>{{ row.entity.clientData.originalPrice}} {{ pricingModel.clientData.currency.symbol }}</span></div>';a.gridImagePrices={data:"pricingModel.clientData.costCodes",columnDefs:[{field:"clientData.costCode.name",displayName:b("translate")("pricingmodel.create.imageprices.col.name"),cellFilter:"lowercase"},{field:"clientData.costCode.description",displayName:b("translate")("pricingmodel.create.imageprices.col.description")},{field:"clientData.originalPrice",displayName:b("translate")("pricingmodel.create.imageprices.col.currentprice"),cellTemplate:f},{field:"price",displayName:b("translate")("pricingmodel.create.imageprices.col.newprice"),cellTemplate:e}],filterOptions:{filterText:"",useExternalFilter:!1}},a.$watch("filter.filterText",function(b){a.gridImagePrices.filterOptions.filterText="name:"+b})}]).controller("TieredStorageGridCtrl",["$scope","$filter","pricingMgr",function(a,b,c){a.__name="TieredStorageGridCtrl",a.filter={filterText:""},a.pricingModel.clientData.tiers=c.pricingTiers;var d='<div><input type="text" class="span1"  data-ng-model="row.entity.price" numeric> {{ pricingModel.clientData.currency.symbol }}</div> ',e='<div class="ngCellText" ng-class="col.colIndex()"><span ng-cell-text>{{ row.entity.clientData.originalPrice}} {{ pricingModel.clientData.currency.symbol }}</span></div>';a.gridTieredStorage={data:"pricingModel.clientData.tiers",columnDefs:[{field:"clientData.datacenter.name",displayName:b("translate")("pricingmodel.create.tieredstorage.col.datacenter")},{field:"clientData.tier.name",displayName:b("translate")("pricingmodel.create.tieredstorage.col.tier")},{field:"clientData.originalPrice",displayName:b("translate")("pricingmodel.create.tieredstorage.col.currentprice"),cellTemplate:e},{field:"price",displayName:b("translate")("pricingmodel.create.tieredstorage.col.newprice"),cellTemplate:d}],filterOptions:{filterText:"",useExternalFilter:!1}},a.$watch("filter.filterText",function(b){a.gridTieredStorage.filterOptions.filterText="tier:"+b})}]),angular.module("user",[]).controller("UserCtrl",["$scope","userMgr","enterprisesMgr","systemPropertiesMgr","$filter",function(a,b,c,d,e){a.__name="UserCtrl",a.enterprise=c.userEnterprise,a.systemProperties=d.systemProperties;var f=function(c){c.id==b.user.id&&b.updateLoggedUser(c),a.closePopup()};a.validatePassword=function(b){var c=CryptoJS.MD5(b).toString();return c===a.user.clientData.originalPassword},a.onEditPassword=function(){a.enablePassword=!0},a.onShown=function(){a.user=angular.copy(b.user),a.enablePassword=!1,a.user.password="",a.showMoreInfo=1==a.systemProperties.dashboard["client.dashboard.allowUsersAccess"].value&&e("isGranted")("USERS_VIEW")},a.onSubmit=function(){""==a.user.password&&delete a.user.password,b.editUser(a.user,f)}}]),angular.module("persistentVirtualMachineTemplateCreate",[]).controller("PersistentVirtualMachineTemplateCreateCtrl",["$scope","virtualMachineTemplatesMgr","virtualDatacentersMgr","virtualAppliancesMgr","enterprisesMgr","tiersMgr","volumesMgr","server","utils","paginationHelper","$filter",function(a,b,c,d,e,f,g,h,i,j,k){function l(){var a;return i.isEmptyObject(c.currentVirtualDatacenter)?i.isEmptyObject(d.currentVirtualAppliance)||(a=d.currentVirtualAppliance.clientData.virtualDatacenter):a=c.currentVirtualDatacenter,a}function m(){a.storages=angular.copy(f.tiers),g.getStatefulCandidatesByVdc(a.currentVirtualDatacenter,n)}function n(b){a.statefulCandidates=angular.copy(b),angular.forEach(b,function(b){a.showStorage=!0,b.id="volume"+b.id,a.storages.push(b)})}function o(){i.isEmptyObject(a.currentVirtualDatacenter)||(a.vmtPersistentPaginatorFilter.master="master"==a.conversionType.value?"true":"false",a.vmtPersistentPaginatorFilter.states="DONE",b.getCandidateTemplatesForPersistent(a.currentVirtualDatacenter,a.vmtPersistentPaginatorParam,a.vmtPersistentPaginatorFilter,q))}function p(){b.getVMTemplateDisks(a.selectedVirtualMachineTemplate,null,!0),f.getTiersByVirtualDatacenter(a.currentVirtualDatacenter,m)}a.__name="PersistentVirtualMachineTemplateCreateCtrl",a.virtualMachineTemplates=[],a.selectedVirtualMachineTemplate,a.vmtPersistentPaginatorFilter=j.vmtPersistentPaginator.filter,a.vmtPersistentPaginatorParam=j.vmtPersistentPaginator.param,a.persistentCreateView={value:"selector"},a.conversionType={value:"master"},a.currentVirtualDatacenter;var q=function(c){j.vmtPersistentPaginator.param.totalSize=c.totalSize,a.virtualMachineTemplates=angular.copy(b.virtualMachineTemplates)};a.getPage=function(a){j.vmtPersistentPaginator.param.startwith=(a-1)*j.vmtPersistentPaginator.param.limit,o()},a.onMakePersistentFilterSubmit=function(){j.vmtPersistentPaginator.resetParam(),a.getPage(j.vmtPersistentPaginator.param.currentPage)},a.onSelectVirtualMachineTemplate=function(b){a.selectedVirtualMachineTemplate=angular.copy(b),a.persistentCreateView.value="createform",p()},a.onShown=function(){a.persistentCreateView.value="selector",a.conversionType.value="master",a.showStorage=!1,a.currentVirtualDatacenter=l(),o()},a.onSubmit=function(){},a.onHidden=function(){},a.$watch("conversionType.value",function(b){console.log("conversionType",b),a.onMakePersistentFilterSubmit()})}]).controller("PersistentVirtualMachineTemplateCreateFormCtrl",["$scope","$filter","virtualMachineTemplatesMgr","enterprisesMgr","gridTemplates",function(a,b,c,d,e){function f(){a.doNotClose.value||a.closePopup()}function g(a){var b;if(a&&a.clientData&&a.clientData.selectedStorage&&a.clientData.selectedStorage.clientData&&"volume"===a.clientData.selectedStorage.clientData.classType)var b=a.clientData.selectedStorage;return b}function h(b,c){var d=a.selectedVirtualMachineTemplate.clientData.disks;if(d)for(var e=0;e<d.length;e++){var f=d[e],h=g(f);f&&b&&h&&c&&f.clientData.id!=c.clientData.id&&h.id==b.id&&(f.clientData.selectedStorage=void 0)}}a.__name="PersistentVirtualMachineTemplateCreateFormCtrl",a.doNotClose={value:!1},a.onClickSubmit=function(){var e=b("filterSelectedClientData")(a.selectedVirtualMachineTemplate.clientData.disks);c.createPersistentVMTemplateFromVMTemplate(a.selectedVirtualMachineTemplate,d.userEnterprise,a.currentVirtualDatacenter,e,f)},a.afterSelectionChange=function(a){},a.onClickBack=function(){a.persistentCreateView.value="selector"},a.changeStorage=function(a){var b=g(a);h(b,a)};var i='<input data-ng-if="!(row.entity.clientData.selectedStorage | isEmptyObject) && row.entity.clientData.selected && row.entity.clientData.selectedStorage.clientData.classType == \'tier\'" data-ng-class="colt{{col.index}}" data-ng-model="row.entity.clientData.volumeName"type="text" maxlength="255" style="width: 100%;"/><p data-ng-if="(row.entity.clientData.selectedStorage | isEmptyObject) || !row.entity.clientData.selected || row.entity.clientData.selectedStorage.clientData.classType != \'tier\'">-</p>';a.disksGridData={data:"selectedVirtualMachineTemplate.clientData.disks",columnDefs:[{field:"",displayName:"",cellTemplate:e.selectedDiskCellTemplate,width:50,sortable:!1},{field:"sequence",displayName:b("translate")("persistentvirtualmachinetemplate.create.column.disk"),cellTemplate:e.diskDescriptionCellTemplate},{field:"",displayName:b("translate")("persistentvirtualmachinetemplate.create.column.storage"),sortable:!1,cellTemplate:e.storageCellTemplate,width:150},{field:"",displayName:b("translate")("persistentvirtualmachinetemplate.create.column.name"),sortable:!1,cellTemplate:i,width:130}],selectWithCheckboxOnly:!0,checkboxCellTemplate:e.selectedCellTemplate,checkboxHeaderTemplate:e.selectAllHeaderTemplate,enableRowSelection:!1}}]),angular.module("virtualDatacenterCreate",[]).controller("VirtualDatacenterCreateCtrl",["$scope","datacentersMgr","enterprisesMgr","virtualDatacentersMgr","systemPropertiesMgr","networksMgr","gridTemplates","utils","$filter","server","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){a.__name="CreateVirtualDatacenterCtrl",a.datacenters=b.allowedDatacenters,a.hypervisors=b.hypervisors,a.ipRegExPattern=h.regExPattern.ip,a.netmasks=f.netmasks,a.availabilityZones=b.availabilityZones,a.unitsSelector=h.unitsSelector,a.location={},a.publicHypervisor="",a.gatewayEdited=!1;var l=function(){a.closePopup()};a.getLabelByConversion=function(a){for(var b=0;b<h.unitsSelector.length;b++)if(h.unitsSelector[b].conversion==a)return h.unitsSelector[b].label},a.onDatacenterSelect=function(){if(a.location=i("getElementByParameter")(a.datacenters,{element:parseInt(a.virtualDatacenter.clientData.datacenter),attribute:"id"}),a.location.clientData.isPublicDatacenter){if(!a.gatewayEdited){var c=a.virtualDatacenter.vlan.gateway.split(".");parseInt(c[3])<5&&(a.virtualDatacenter.vlan.gateway=c[0]+"."+c[1]+"."+c[2]+".5")}b.getAvailabilityZones(a.location,function(){k(function(){angular.extend(a.virtualDatacenter.clientData.availabilityZone,a.availabilityZones[0])})});var d=j.getClientdataFromLinksByRel(a.location.links,"hypervisortype");a.publicHypervisor=d.name,a.virtualDatacenter.hypervisorType=d.id}else b.getHypervisorsByDatacenter(a.location),angular.extend(a.virtualDatacenter.clientData.availabilityZone,{}),a.gatewayEdited||(a.virtualDatacenter.vlan.gateway=e.systemProperties.network["client.network.defaultGateway"].value)},a.onSubmit=function(){a.virtualDatacenter.vlan.mask=parseInt(a.virtualDatacenter.vlan.mask),h.isEmptyObject(a.availabilityZone)||(a.virtualDatacenter.clientData.availabilityZone=a.availabilityZone),a.virtualDatacenter.ramSoftLimitInMb=a.allocationLimits.ramSoftLimitInMb*a.allocationLimits.ramUnits.conversion,a.virtualDatacenter.ramHardLimitInMb=a.allocationLimits.ramHardLimitInMb*a.allocationLimits.ramUnits.conversion,a.virtualDatacenter.cpuCountSoftLimit=a.allocationLimits.cpuCountSoftLimit,a.virtualDatacenter.cpuCountHardLimit=a.allocationLimits.cpuCountHardLimit,a.virtualDatacenter.diskSoftLimitInMb=a.allocationLimits.diskSoftLimitInMb*a.allocationLimits.hdUnits.conversion,a.virtualDatacenter.diskHardLimitInMb=a.allocationLimits.diskHardLimitInMb*a.allocationLimits.hdUnits.conversion,a.virtualDatacenter.storageSoftInMb=a.allocationLimits.storageSoftInMb*a.allocationLimits.storageUnits.conversion,a.virtualDatacenter.storageHardInMb=a.allocationLimits.storageHardInMb*a.allocationLimits.storageUnits.conversion,a.virtualDatacenter.vlansSoft=a.allocationLimits.vlansSoft,a.virtualDatacenter.vlansHard=a.allocationLimits.vlansHard,a.virtualDatacenter.publicIpsSoft=a.allocationLimits.publicIpsSoft,a.virtualDatacenter.publicIpsHard=a.allocationLimits.publicIpsHard,d.createVirtualDatacenter(a.virtualDatacenter,a.location,c.userEnterprise,l)},a.onShown=function(){b.getAllowedLocations(),a.location={},a.gatewayEdited=!1,a.staticRoute={},a.virtualDatacenter={clientData:{defaultVlan:{},privatenetwork:{},availabilityZone:{}},vlan:{dhcpOptions:{collection:[]}}},a.allocationLimits={ramSoftLimitInMb:0,ramHardLimitInMb:0,ramUnits:angular.copy(h.unitsSelector[0]),cpuCountSoftLimit:0,cpuCountHardLimit:0,diskSoftLimitInMb:0,diskHardLimitInMb:0,hdUnits:angular.copy(h.unitsSelector[1]),storageSoftInMb:0,storageHardInMb:0,storageUnits:angular.copy(h.unitsSelector[1]),vlansSoft:0,vlansHard:0,publicIpsSoft:0,publicIpsHard:0},a.virtualDatacenter.vlan.name=e.systemProperties.network["client.network.defaultName"].value,a.virtualDatacenter.vlan.mask=a.netmasks[parseInt(e.systemProperties.network["client.network.defaultNetmask"].value)].length,a.virtualDatacenter.vlan.address=e.systemProperties.network["client.network.defaultAddress"].value,a.virtualDatacenter.vlan.gateway=e.systemProperties.network["client.network.defaultGateway"].value,a.virtualDatacenter.vlan.primaryDNS=e.systemProperties.network["client.network.defaultPrimaryDNS"].value,a.virtualDatacenter.vlan.secondaryDNS=e.systemProperties.network["client.network.defaultSecondaryDNS"].value,a.virtualDatacenter.vlan.sufixDNS=e.systemProperties.network["client.network.defaultSufixDNS"].value},a.addStaticRoute=function(){a.virtualDatacenter.vlan.dhcpOptions.collection.push(angular.copy(a.staticRoute))},a.deleteRow=function(b){a.virtualDatacenter.vlan.dhcpOptions.collection.splice(b.rowIndex,1)},a.onStaticRoutesCBChange=function(){h.refreshLayout()},a.onGatewayChange=function(){a.gatewayEdited=!0},a.isInvalidStaticRoute=function(b){var c=!h.validateRegEx(a.ipRegExPattern,a.staticRoute.networkAddress)||!h.validateRegEx(a.ipRegExPattern,a.staticRoute.netmask)||!h.validateRegEx(a.ipRegExPattern,a.staticRoute.gateway);!a.virtualDatacenter.clientData.staticRoutesCB||"default"==a.networkRB||c;return c},a.onAvailabilityZoneChange=function(b){a.availabilityZone=i("getElementByParameter")(a.availabilityZones,{element:b,attribute:"name"})},a.staticRoutesGridOptions={data:"virtualDatacenter.vlan.dhcpOptions.collection",columnDefs:[{field:"id",displayName:"",width:50,headerCellTemplate:g.deleteHeaderTemplate,cellTemplate:g.deleteCellTemplate},{field:"networkAddress",displayName:i("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.netAddress")},{field:"netmask",displayName:i("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.mask")},{field:"gateway",displayName:i("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.gateway")}],multiSelect:!1}}]),angular.module("virtualDatacenterEdit",[]).controller("VirtualDatacenterEditCtrl",["$scope","datacentersMgr","virtualDatacentersMgr","commonsMgr","utils",function(a,b,c,d,e){function f(b){var c="";return angular.forEach(a.hypervisorTypes,function(a){a.name===b&&(c=a.realName)}),c}function g(){a.closePopup()}a.__name="VirtualDatacenterEditCtrl",a.virtualDatacenter={},a.unitsSelector=e.unitsSelector,a.hypervisorTypes=d.hypervisorTypes,a.getLabelByConversion=function(a){for(var b=0;b<e.unitsSelector.length;b++)if(e.unitsSelector[b].conversion==a)return e.unitsSelector[b].label},a.onSubmit=function(){a.virtualDatacenter.ramSoftLimitInMb=a.allocationLimits.ramSoftLimitInMb*a.allocationLimits.ramUnits.conversion,a.virtualDatacenter.ramHardLimitInMb=a.allocationLimits.ramHardLimitInMb*a.allocationLimits.ramUnits.conversion,a.virtualDatacenter.cpuCountSoftLimit=a.allocationLimits.cpuCountSoftLimit,a.virtualDatacenter.cpuCountHardLimit=a.allocationLimits.cpuCountHardLimit,a.virtualDatacenter.diskSoftLimitInMb=a.allocationLimits.diskSoftLimitInMb*a.allocationLimits.hdUnits.conversion,a.virtualDatacenter.diskHardLimitInMb=a.allocationLimits.diskHardLimitInMb*a.allocationLimits.hdUnits.conversion,a.virtualDatacenter.storageSoftInMb=a.allocationLimits.storageSoftInMb*a.allocationLimits.storageUnits.conversion,a.virtualDatacenter.storageHardInMb=a.allocationLimits.storageHardInMb*a.allocationLimits.storageUnits.conversion,a.virtualDatacenter.vlansSoft=a.allocationLimits.vlansSoft,a.virtualDatacenter.vlansHard=a.allocationLimits.vlansHard,a.virtualDatacenter.publicIpsSoft=a.allocationLimits.publicIpsSoft,
a.virtualDatacenter.publicIpsHard=a.allocationLimits.publicIpsHard,c.editVirtualDatacenter(a.virtualDatacenter,g)},a.onShown=function(){a.virtualDatacenter=angular.copy(c.currentVirtualDatacenter),a.hypervisorType=f(a.virtualDatacenter.hypervisorType);var b=e.formatAllocationElements(a.virtualDatacenter);a.allocationLimits={ramSoftLimitInMb:b.ramSoftLimit,ramHardLimitInMb:b.ramHardLimit,ramUnits:b.ramUnits,cpuCountSoftLimit:a.virtualDatacenter.cpuCountSoftLimit,cpuCountHardLimit:a.virtualDatacenter.cpuCountHardLimit,diskSoftLimitInMb:b.hdSoftLimit,diskHardLimitInMb:b.hdHardLimit,hdUnits:b.hdUnits,storageSoftInMb:b.storageSoftLimit,storageHardInMb:b.storageHardLimit,storageUnits:b.storageUnits,vlansSoft:a.virtualDatacenter.vlansSoft,vlansHard:a.virtualDatacenter.vlansHard,publicIpsSoft:a.virtualDatacenter.publicIpsSoft,publicIpsHard:a.virtualDatacenter.publicIpsHard,inPublic:a.virtualDatacenter.inPublic}}}]),angular.module("virtualDatacenters",["virtualDatacenterCreate","virtualDatacenterEdit","virtualAppliances","network","volumes","persistentVirtualMachineTemplates","workflow"]).controller("VirtualDatacentersCtrl",["$scope","systemPropertiesMgr","virtualAppliancesMgr","dispatcher",function(a,b,c,d){a.__name="",a.systemProperties=b.systemProperties,a.currentVirtualAppliance=c.currentVirtualAppliance,a.vdcTab={},a.goToVirtualDatacenters=function(){d.dispatch("virtualappliance.goback")}}]).controller("VirtualDatacenterListCtrl",["$scope","routeParamsHelper","$routeParams","$timeout","virtualDatacentersMgr","virtualAppliancesMgr","volumesMgr","systemPropertiesMgr","virtualMachineTemplatesMgr","enterprisesMgr","commonsMgr","refreshMgr","uModals","utils","paginationHelper","$filter","dispatcher",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(b,c){var d=p("getElementById")(a.virtualDatacenters,parseInt(b.value));a.onVirtualDatacenterClick(d)}a.__name="VirtualDatacenterListCtrl",a.currentVirtualDatacenter=e.currentVirtualDatacenter,a.virtualDatacenters=e.virtualDatacenters,a.systemProperties=h.systemProperties,a.vdcFilter=o.vdcPaginator.filter,a.vdcPaginationParam=o.vdcPaginator.param;var s=b.getParams(),t=function(){e.setCurrentVirtualDatacenter(null),v()},u=function(a){o.vdcPaginator.param.totalSize=a.totalSize,b.doAction(s,"vdc",r,!0)},v=function(){e.getVirtualDatacenters(j.userEnterprise,o.vdcPaginator.param,o.vdcPaginator.filter,u)},w=function(){e.deleteVirtualDatacenter(e.currentVirtualDatacenter)},x=function(){v()},y=function(){l.forceRefresh()},z=function(){l.forceRefresh()};a.onAllVirtualDatacenterClick=function(){a.vdcFilter.has="",a.onVirtualDatacenterClick(null),a.onVdcFilterSubmit()},a.onVdcFilterSubmit=function(){o.vdcPaginator.resetParam(),a.getPage(o.vdcPaginator.param.currentPage)},a.getPage=function(a){o.vdcPaginator.param.startwith=(a-1)*o.vdcPaginator.param.limit,e.setCurrentVirtualDatacenter(null),v()},a.onVirtualDatacenterClick=function(b){f.setCurrentVirtualAppliance(null),b&&b.vlan&&b.id==a.currentVirtualDatacenter.id&&(b.vlan=a.currentVirtualDatacenter.vlan),e.setCurrentVirtualDatacenter(b)},a.onDeleteVirtualDatacenterConfirm=function(){w()},q.on(["virtualDatacenter.created","virtualDatacenter.edited","virtualDatacenter.deleted"],v,a),a.isDropEnabled=function(a){return f.currentVirtualAppliance.clientData.virtualDatacenter.id!=a.id},a.dropAcceptListener=function(a,b,c){if(a.data("$scope").virtualAppliance){var d=a.data("$scope").virtualAppliance;return d.clientData.virtualDatacenter.id!=c.id}if(a.data("$scope").col){var e=a.data("$scope").$parent.row.entity;if(void 0!==e.clientData.virtualDatacenter)return e.clientData.virtualDatacenter.id!=c.id}return!1},a.dropVirtualDataCenterListener=function(b,c,d,h,j){var l,o;if(b.data("$scope").virtualAppliance){h.shiftKey?(l="virtualappliance.copy.confirm.message",o="virtualappliance.copy.confirm.title"):(l="virtualappliance.move.confirm.message",o="virtualappliance.move.confirm.title");var q=b.data("$scope").virtualAppliance,r=e.getVirtualDatacenterById(q.clientData.virtualDatacenter.id),s=p("getElementByParameter")(k.hypervisorTypes,{element:r.hypervisorType,attribute:"name"}),t=p("getElementByParameter")(k.hypervisorTypes,{element:d.hypervisorType,attribute:"name"});m.showAlert({scope:a,message:p("translate")(l,{vapp:q.name,vdcSrc:r.name,hypSrc:s.realName,vdcTar:d.name,hypTar:t.realName}),title:p("translate")(o),confirmLabel:p("translate")("globals.confirm"),cancelLabel:p("translate")("globals.cancel"),showConfirmBtn:!0,showCancelBtn:!0,messageType:"warning",confirmFn:function(){h.shiftKey?f.copyVirtualApplianceToVirtualDatacenter(q,d,r,x):f.moveVirtualApplianceToVirtualDatacenter(q,d,r,x)}})}else if(!n.isEmptyObject(j)){var r=e.getVirtualDatacenterById(j.data.clientData.virtualDatacenter.id);if("volume"==j.type){var u=j.data;m.showAlert({scope:a,message:p("translate")("volume.move.confirm.message",{vol:u.name,vdcSrc:r.name,vdcTar:d.name}),title:p("translate")("volume.move.confirm.title"),confirmLabel:p("translate")("globals.confirm"),cancelLabel:p("translate")("globals.cancel"),showConfirmBtn:!0,showCancelBtn:!0,messageType:"warning",confirmFn:function(){g.moveVolumeToVirtualDatacenter(u,d,u.clientData.virtualDatacenter,y)}})}else if("persistentTemplate"==j.type&&d.id!=j.data.clientData.virtualDatacenter.id){var v=j.data;m.showAlert({scope:a,message:p("translate")("persistentvirtualmachinetemplate.move.confirm.message",{persistentTemplate:v.name,vdcSrc:r.name,vdcTar:d.name}),title:p("translate")("persistentvirtualmachinetemplate.move.confirm.title"),confirmLabel:p("translate")("globals.confirm"),cancelLabel:p("translate")("globals.cancel"),showConfirmBtn:!0,showCancelBtn:!0,messageType:"warning",confirmFn:function(){i.movePersistentVMTemplateToVDC(v,d,v.clientData.virtualDatacenter,z)}})}}},t()}]).controller("VirtualDatacenterDetailCtrl",["$scope","virtualDatacentersMgr","dispatcher",function(a,b,c){function d(){a.currentVirtualDatacenter.clientData&&a.currentVirtualDatacenter.clientData.isPublic&&"virtualappliances"!=a.vdcTab.value&&"network"!=a.vdcTab.value}a.__name="VirtualDatacenterDetailCtrl",a.currentVirtualDatacenter=b.currentVirtualDatacenter,a.onTabClick=function(b){a.vdcTab.value=b},c.on("currentVirtualDatacenter.change",d,a)}]),angular.module("AddIPtoVM",[]).controller("AddIPtoVMCtrl",["$scope","$filter","networksMgr","systemPropertiesMgr","utils","server","dispatcher",function(a,b,c,d,e,f,g){function h(a){i(a)}function i(b){a.closePopup(),g.dispatch("addips.ip.to.add",{data:b})}function j(c){var d;if(c&&c.links&&c.links.length>0){var g=f.getLinkByRel(c.links,"virtualmachine");d=!e.isEmptyObject(g)&&g.title!=a.virtualMachine.name,d&&e.toastrError(b("translate")("networklist.ip.add.error.used",{ip:c.ip,virtualMachine:g.title}))}return!d}function k(b){b?j(b)&&i(b):c.createNetworkIp(a.ip,a.currentNetwork,h)}a.__name="AddIPtoVMCtrl",a.ipRegExp=e.regExPattern.ip,a.hideCreateRang=!0,a.maxRequestedIps=d.systemProperties.infrastructure["client.main.maxRequestedIps"].value,a.onShown=function(){a.ip={ipv6:a.currentNetwork.ipv6,available:!0,quarantine:!1,numips:1}},a.onSubmit=function(){a.ip.numips<=a.maxRequestedIps?c.getIpByNetwork(a.ip.ip,a.currentNetwork,k):e.toastrError(b("translate")("networklist.ip.create.maxcount.error",{maxRequestedIps:a.maxRequestedIps}))},a.onHidden=function(){}}]),angular.module("networkCreate",[]).controller("NetworkCreateCtrl",["$scope","gridTemplates","networksMgr","virtualDatacentersMgr","utils","datacentersMgr","$filter","$timeout",function(a,b,c,d,e,f,g,h){a.__name="NetworkCreateCtrl",a.editMode=!1,a.defaultNetworkEditable=!0,a.ipRegExPattern=e.regExPattern.ip,a.ipNoHostnamesRegExPattern=e.regExPattern.ipNoHostnames,a.availabilityZones=f.availabilityZones,a.currentVirtualDatacenter=d.currentVirtualDatacenter,a.defaultNetwork={selected:!1},a.onShown=function(){a.staticRoute={},a.network={type:"INTERNAL",ipv6:!1,clientData:{},dhcpOptions:{collection:[]}},a.staticRoutes=[],a.currentVirtualDatacenter.clientData.isPublic&&f.getAvailabilityZones(a.currentVirtualDatacenter.clientData.datacenter,function(){h(function(){angular.extend(a.network.clientData.availabilityZone,a.availabilityZones[0])})})},a.netmasks=c.netmasks,a.onIpv6Click=function(){h(function(){a.network.mask=a.network.ipv6?c.netmasks[11].length:c.netmasks[2].length,a.network.ipv6||(a.network.strict=!1)})},a.addStaticRoute=function(){a.staticRoutes.push(angular.copy(a.staticRoute))},a.deleteRow=function(b){a.staticRoutes.splice(b.rowIndex,1)};var i=function(){c.getPrivateNetworksByVirtualDataCenter(d.currentVirtualDatacenter),a.closePopup()},j=function(a){i()},k=function(b){a.defaultNetworkEditable&&a.defaultNetwork.selected?(a.network.links=b.links,a.network.id=b.id,d.setDefaultNetwork(a.network,d.currentVirtualDatacenter,j)):a.closePopup()};a.onSubmit=function(){a.network.dhcpOptions.collection=a.staticRoutes,"internal"===c.currentNetworkType.value?(a.network.clientData.networkRel="internalnetwork",c.createPrivateNetwork(a.network,d.currentVirtualDatacenter,k)):"public"===c.currentNetworkType.value?(a.network.clientData.networkRel="publicnetwork",c.createPublicNetwork(a.network,d.currentVirtualDatacenter,k)):"external"===c.currentNetworkType.value&&(a.network.clientData.networkRel="externalnetwork",c.createExternalNetwork(a.network,d.currentVirtualDatacenter,k))},a.onAvailabilityZoneChange=function(b){angular.extend(a.network.clientData.availabilityZone,g("getElementByParameter")(a.availabilityZones,{element:b,attribute:"name"}))},a.staticRoutesGridOptions={data:"staticRoutes",columnDefs:[{field:"id",displayName:"",width:50,headerCellTemplate:b.deleteHeaderTemplate,cellTemplate:b.deleteCellTemplate},{field:"networkAddress",displayName:g("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.netAddress")},{field:"netmask",displayName:g("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.mask")},{field:"gateway",displayName:g("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.gateway")}],multiSelect:!1},a.staticRoutesChange=function(a){a&&e.refreshLayout()}}]),angular.module("networkEdit",[]).controller("NetworkEditCtrl",["$scope","networksMgr","virtualDatacentersMgr","gridTemplates","$filter","utils",function(a,b,c,d,e,f){a.__name="NetworkEditCtrl",a.editMode=!0,a.defaultNetworkEditable=!0,a.ipRegExPattern=f.regExPattern.ip,a.netmasks=b.netmasks,a.defaultNetwork={selected:!1};var g=function(b){a.closePopup()},h=function(b){a.defaultNetworkEditable&&a.defaultNetwork.selected?c.setDefaultNetwork(a.network,c.currentVirtualDatacenter,g):a.closePopup()};a.onShown=function(){a.network=angular.copy(b.currentNetwork),a.staticRoute={},a.staticRoutes=a.network.dhcpOptions.collection,a.staticRoutesCB=a.staticRoutes.length>0,a.defaultNetwork.selected=c.currentVirtualDatacenter.vlan&&c.currentVirtualDatacenter.vlan.id==a.network.id,a.defaultNetworkEditable=!a.defaultNetwork.selected},a.onSubmit=function(){"INTERNAL"==a.network.type?b.editNetwork(a.network,h):h()},a.addStaticRoute=function(){a.network.dhcpOptions.collection.push(angular.copy(a.staticRoute))},a.deleteRow=function(b){a.network.dhcpOptions.collection.splice(b.rowIndex,1)},a.staticRoutesGridOptions={data:"staticRoutes",columnDefs:[{field:"id",displayName:"",width:50,headerCellTemplate:d.deleteHeaderTemplate,cellTemplate:d.deleteCellTemplate},{field:"networkAddress",displayName:e("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.netAddress")},{field:"netmask",displayName:e("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.mask")},{field:"gateway",displayName:e("translate")("virtualdatacenter.create.vlanstaticroutes.grid.heading.gateway")}],multiSelect:!1},a.staticRoutesChange=function(a){a&&f.refreshLayout()}}]),angular.module("firewallCreate",[]).controller("FirewallCreateCtrl",["$scope","virtualDatacentersMgr","firewallsMgr","datacentersMgr","enterprisesMgr","systemPropertiesMgr","$filter","utils","$timeout",function(a,b,c,d,e,f,g,h,i){function j(){var b=g("getElementById")(a.locations,a.currentVirtualDatacenter.id);i(h.isEmptyObject(b)?function(){a.firewall.clientData.virtualDatacenter.id=0,a.onVirtualDatacenterChange()}:function(){a.firewall.clientData.virtualDatacenter.id=a.currentVirtualDatacenter.id,a.onVirtualDatacenterChange()})}a.__name="FirewallCreateCtrl",a.editMode=!1,a.locations=d.allowedDatacenters,a.currentVirtualDatacenter=b.currentVirtualDatacenter,a.systemProperties=f.systemProperties,a.virtualDatacenters=[];var k=function(b){a.closePopup()},l=function(b){h.isEmptyObject(a.currentVirtualDatacenter)||i(function(){a.firewall.clientData.location.id=a.currentVirtualDatacenter.clientData.datacenter.id,a.onLocationChange()})},m=function(b){a.virtualDatacenters.length=0;var c={id:0,name:g("translate")("firewalls.create.select.virtualdatacenter.novdc")};a.virtualDatacenters.push(c),angular.forEach(b.collection,function(b){a.virtualDatacenters.push(b)}),j()};a.onLocationChange=function(){a.firewall.clientData.location=angular.copy(g("getElementByParameter")(a.locations,{element:parseInt(a.firewall.clientData.location.id),attribute:"id"})),b.getVirtualDataCentersByDataCenter(e.userEnterprise,a.firewall.clientData.location,m)},a.onVirtualDatacenterChange=function(){a.selectedVirtualDatacenter=g("getElementByParameter")(a.virtualDatacenters,{element:parseInt(a.firewall.clientData.virtualDatacenter.id),attribute:"id"})},a.onSubmit=function(){c.createFirewall(a.firewall,a.selectedVirtualDatacenter,k)},a.onShown=function(){a.selectedVirtualDatacenter={id:0},a.editionDisabled=!1,a.firewall=new c.Firewall,d.getAllowedLocations(l)}}]),angular.module("firewallEdit",[]).controller("FirewallEditCtrl",["$scope","virtualDatacentersMgr","firewallsMgr","datacentersMgr","enterprisesMgr","systemPropertiesMgr","$filter","$timeout",function(a,b,c,d,e,f,g,h){a.__name="FirewallEditCtrl",a.editMode=!0,a.virtualDatacenters=b.virtualDatacenters,a.locations=d.allowedDatacenters,a.systemProperties=f.systemProperties;var i=function(b){a.closePopup()},j=function(d){h(function(){a.firewall.clientData.location=g("getElementByParameter")(a.locations,{element:c.currentFirewall.clientData.location.id,attribute:"id"}),b.getVirtualDataCentersByDataCenter(e.userEnterprise,a.firewall.clientData.location,k)})},k=function(b){a.virtualDatacenters=[];var d={id:0,name:g("translate")("firewalls.create.select.virtualdatacenter.novdc")};a.virtualDatacenters.push(d),angular.forEach(b.collection,function(b){a.virtualDatacenters.push(b)}),h(function(){var b=g("getElementByParameter")(a.virtualDatacenters,{element:c.currentFirewall.clientData.virtualDatacenter.id,attribute:"id"});a.firewall.clientData.virtualDatacenter.id=b.id,a.onVirtualDatacenterChange()})};a.onVirtualDatacenterChange=function(){a.selectedVirtualDatacenter=g("getElementByParameter")(a.virtualDatacenters,{element:parseInt(a.firewall.clientData.virtualDatacenter.id),attribute:"id"})},a.onSubmit=function(){c.editFirewall(a.firewall,a.selectedVirtualDatacenter,i)},a.onShown=function(){a.firewall=angular.copy(c.currentFirewall),a.editionDisabled=g("operationIsGranted")(a.hypervisor.type,"icloudprovider")&&!g("operationIsGranted")(a.hypervisor.type,"firewall","modifyFirewallPolicy"),d.getAllowedLocations(j)}}]),angular.module("firewalls",["firewallRules","firewallCreate","firewallEdit"]).controller("FirewallsCtrl",["$scope","$timeout","firewallsMgr","virtualDatacentersMgr","systemPropertiesMgr","enterprisesMgr","datacentersMgr","paginationHelper","utils","dispatcher","$filter",function(a,b,c,d,e,f,g,h,i,j,k){a.__name="FirewallsCtrl",a.currentFirewall=c.currentFirewall,a.firewalls=c.firewalls,a.systemProperties=e.systemProperties,a.currentVirtualDatacenter=d.currentVirtualDatacenter,a.volFilter=h.volPaginator.filter,a.volPaginationParam=h.volPaginator.param,a.locations=g.allowedDatacenters,a.location={},a.hypervisor={},h.volPaginator.resetParam();var l=function(a){h.volPaginator.param.totalSize=a.totalSize,i.refreshLayout()},m=function(){a.networkTab&&"firewalls"==a.networkTab.value&&(i.isEmptyObject(a.currentVirtualDatacenter)?!i.isEmptyObject(a.firewallLocation)&&a.firewallLocation.id?c.getAvailableFirewallsByLocation(a.firewallLocation,h.volPaginator.param,h.volPaginator.filter,l):c.firewalls.length=0:c.getAvailableFirewallsByVdc(a.currentVirtualDatacenter,h.volPaginator.param,h.volPaginator.filter,l))},n=function(){m()},o=function(){c.deleteFirewall(c.currentFirewall,n)},p=function(a){a.selected&&c.setCurrentFirewall(a.entity)};a.sortInfo={fields:[""],directions:["asc","desc"]},a.firewallsGridOptions={data:"firewalls",columnDefs:[{field:"name",displayName:k("translate")("firewalls.heading.name")},{field:"providerId",displayName:k("translate")("firewalls.heading.providerid")},{field:"clientData.virtualDatacenter.name",displayName:k("translate")("firewalls.heading.vpcid")},{field:"description",displayName:k("translate")("firewalls.heading.description"),sortable:!1}],useExternalSorting:!0,sortInfo:a.sortInfo,afterSelectionChange:p,multiSelect:!1},a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var b=c.sortMapping[a.fields[0]],d="asc"===a.directions[0]?!0:!1;h.volPaginator.filter.by=b,h.volPaginator.filter.asc=d,m()}},!0),a.onLocationIdChange=function(){a.location.id&&(a.firewallLocation=k("getElementByParameter")(a.locations,{element:parseInt(a.location.id),attribute:"id"}),a.hypervisor.type=a.firewallLocation.clientData.hypervisorType,m())},a.onVolFilterSubmit=function(){h.volPaginator.resetParam(),m()},a.getPage=function(a){h.volPaginator.param.startwith=(a-1)*h.volPaginator.param.limit,m()},a.onDeleteFirewallConfirm=function(){o()},a.synchronizeFirewalls=function(){i.isEmptyObject(a.currentVirtualDatacenter)?i.isEmptyObject(a.firewallLocation)||c.synchronizeFirewallsByLocation(a.firewallLocation):c.synchronizeFirewallsByVirtualDatacenter(a.currentVirtualDatacenter)},j.on(["currentVirtualDatacenter.change","firewall.created","firewall.edited","firewall.deleted"],function(b,d){h.volPaginator.resetParam(),c.setCurrentFirewall(null),d&&d.data&&(d.data.hypervisorType?a.hypervisor.type=d.data.hypervisorType:i.isEmptyObject(d.data)&&a.firewallLocation&&(a.hypervisor.type=a.firewallLocation.clientData.hypervisorType)),d&&d.locationId?(a.location.id=d.locationId,a.onLocationIdChange()):m()},a),a.$watch("networkTab.value",function(a){"firewalls"==a&&(g.getAllowedLocations(),m())},!0)}]),angular.module("firewallRulesEdit",[]).controller("FirewallRulesEditCtrl",["$scope","firewallsMgr","configMgr","$filter","gridTemplates","utils",function(a,b,c,d,e,f){a.__name="FirewallRulesEditCtrl",a.currentFirewall=b.currentFirewall,a.ipRegExPattern=f.regExPattern.ip,a.protocols=c.config["config.protocols"],a.selectedProtocol={},a.firewallRulesTab={value:"sources"};var g=function(){a.filteredFirewallRules=d("filterFirewallRules")(a.firewallRules,a.rulesType),f.refreshLayout()},h=function(){a.closePopup()};a.onSubmit=function(){b.editFirewallRules(a.currentFirewall,a.firewallRules,h)},a.onShown=function(){a.firewallRules=angular.copy(a.currentFirewall.clientData.rules),a.firewallRule={sources:[]},a.selectedProtocol.value=a.protocols[0].value,a.onCommonProtocolChange(),a.rulesType=a.firewallRulesTab.value,g()},a.onTabClick=function(b){a.rulesType=b,a.firewallRule={},"sources"==b?a.firewallRule.sources=[]:a.firewallRule.targets=[],g()},a.onCommonProtocolChange=function(){var b=d("getElementByParameter")(a.protocols,{element:a.selectedProtocol.value,attribute:"value"});a.selectedProtocol.port=b.port,a.firewallRule.protocol=b.protocol,"ALL"==b.port?(a.firewallRule.fromPort=0,a.firewallRule.toPort=65535):"-"==b.port?(a.firewallRule.fromPort="",a.firewallRule.toPort=""):(a.firewallRule.fromPort=b.port,a.firewallRule.toPort=b.port)},a.addFirewallRule=function(){var b=angular.copy(a.firewallRule);b.clientData||(b.clientData={destination:""}),b.sources?b.sources=b.clientData.destination.split(","):b.targets=b.clientData.destination.split(","),delete b.clientData,a.firewallRules.push(angular.copy(b)),g()},a.deleteRow=function(b){var c=a.firewallRules.indexOf(b.entity);a.firewallRules.splice(c,1),g()},a.firewallInboundRulesGridOptions={data:"filteredFirewallRules",columnDefs:[{field:"id",displayName:"",width:50,headerCellTemplate:e.deleteHeaderTemplate,cellTemplate:e.deleteCellTemplate},{field:"protocol",displayName:d("translate")("firewallrules.heading.protocol")},{field:"",displayName:d("translate")("firewallrules.heading.portrange"),cellTemplate:e.portRangeCellTemplate},{field:"",displayName:d("translate")("firewallrules.edit.input.sources"),cellTemplate:e.destinationCellTemplate}],multiSelect:!1},a.firewallOutboundRulesGridOptions={data:"filteredFirewallRules",columnDefs:[{field:"id",displayName:"",width:50,headerCellTemplate:e.deleteHeaderTemplate,cellTemplate:e.deleteCellTemplate},{field:"protocol",displayName:d("translate")("firewallrules.heading.protocol")},{field:"",displayName:d("translate")("firewallrules.heading.portrange"),cellTemplate:e.portRangeCellTemplate},{field:"",displayName:d("translate")("firewallrules.edit.input.targets"),cellTemplate:e.destinationCellTemplate}],multiSelect:!1}}]),angular.module("firewallRules",["firewallRulesEdit"]).controller("FirewallRulesCtrl",["$scope","firewallsMgr","virtualDatacentersMgr","systemPropertiesMgr","utils","dispatcher","$filter","gridTemplates",function(a,b,c,d,e,f,g,h){a.__name="FirewallRulesCtrl",a.currentFirewall=b.currentFirewall,a.firewallRulesInbound=[],a.firewallRulesOutbound=[],a.firewalls=b.firewalls,a.systemProperties=d.systemProperties,a.currentVirtualDatacenter=c.currentVirtualDatacenter;var i=function(a){j()},j=function(){a.firewallRulesInbound=g("filterFirewallRules")(a.currentFirewall.clientData.rules,"sources"),a.firewallRulesOutbound=g("filterFirewallRules")(a.currentFirewall.clientData.rules,"targets"),e.refreshLayout()},k=function(){e.isEmptyObject(a.currentFirewall)||b.getFirewallRules(b.currentFirewall,i)};a.firewallInboundRulesGridOptions={data:"firewallRulesInbound",columnDefs:[{field:"protocol",displayName:g("translate")("firewallrules.heading.protocol"),width:70},{field:"",displayName:g("translate")("firewallrules.heading.portrange"),cellTemplate:h.portRangeCellTemplate,width:100},{field:"",displayName:g("translate")("firewallrules.edit.input.sources"),cellTemplate:h.destinationCellTemplate}],enableRowSelection:!1},a.firewallOutboundRulesGridOptions={data:"firewallRulesOutbound",columnDefs:[{field:"protocol",displayName:g("translate")("firewallrules.heading.protocol"),width:70},{field:"",displayName:g("translate")("firewallrules.heading.portrange"),cellTemplate:h.portRangeCellTemplate,width:100},{field:"",displayName:g("translate")("firewallrules.edit.input.targets"),cellTemplate:h.destinationCellTemplate}],enableRowSelection:!1},a.$on("timer",function(){k()}),f.on(["currentFirewall.change","firewallrules.edited"],function(){k()},a)}]),angular.module("network",["networkCreate","networkEdit","purchaseNICforVDC","firewalls","loadBalancers","ipCreate"]).controller("NetworkCtrl",["$scope","virtualDatacentersMgr","systemPropertiesMgr","$filter","dispatcher","utils",function(a,b,c,d,e,f){function g(){a.networkTab={},a.networkTab.value="internal",h()}function h(){a.currentVirtualDatacenter.clientData&&a.currentVirtualDatacenter.clientData.isPublic?a.firewallViewDisplayed=d("operationIsGranted")(a.currentVirtualDatacenter.hypervisorType,"firewall","listFirewallPolicies"):a.currentVirtualDatacenter.clientData&&!a.currentVirtualDatacenter.clientData.isPublic?a.firewallViewDisplayed="1"==a.systemProperties.general["client.main.enableFirewallForPrivateVDC"].value:a.firewallViewDisplayed=!0,a.vdcMustBeSelected=!1,f.isEmptyObject(b.currentVirtualDatacenter)&&(d("isGranted")("MANAGE_FIREWALLS")?(a.networkTab.value="firewalls",a.vdcMustBeSelected=!1):a.vdcMustBeSelected=!0),0==a.vdcMustBeSelected&&(a.privateNetworkViewDisplayed=d("operationIsGranted")(a.currentVirtualDatacenter.hypervisorType,"networking"),a.currentVirtualDatacenter.clientData&&a.currentVirtualDatacenter.clientData.isPublic?a.loadBalancersViewDisplayed=d("operationIsGranted")(a.currentVirtualDatacenter.hypervisorType,"loadbalancers"):a.currentVirtualDatacenter.clientData&&!a.currentVirtualDatacenter.clientData.isPublic?a.loadBalancersViewDisplayed="1"==a.systemProperties.general["client.main.enableLoadBalancerForPrivateVDC"].value:a.loadBalancersViewDisplayed=!1,"firewalls"!=a.networkTab.value||a.firewallViewDisplayed||(a.networkTab.value="internal"),"loadbalancers"!=a.networkTab.value||a.loadBalancersViewDisplayed||(a.networkTab.value="internal"),"external"==a.networkTab.value&&a.currentVirtualDatacenter.clientData.isPublic&&(a.networkTab.value="internal"),a.privateNetworkViewDisplayed||"internal"!=a.networkTab.value||(a.networkTab.value="public"))}a.__name="NetworkCtrl",a.currentVirtualDatacenter=b.currentVirtualDatacenter,a.firewallViewDisplayed=!0,a.privateNetworkViewDisplayed=!0,e.on("currentVirtualDatacenter.change",h,a),g()}]).controller("NetworkListCtrl",["$scope","$filter","networksMgr","virtualDatacentersMgr","enterprisesMgr","utils","paginationHelper","dispatcher",function(a,b,c,d,e,f,g,h){a.__name="NetworkListCtrl",a.networks=c.networks,a.currentNetwork=c.currentNetwork,a.currentVirtualDatacenter=d.currentVirtualDatacenter,a.ntwPaginationParam=g.ntwPaginator.param;var i=function(a){g.ntwPaginator.param.totalSize=a.totalSize},j=function(){c.setCurrentNetwork(null),f.isEmptyObject(d.currentVirtualDatacenter)?c.cleanData():"internal"==a.networkTab.value?c.getPrivateNetworksByVirtualDataCenter(d.currentVirtualDatacenter,g.ntwPaginator.param,g.ntwPaginator.filter,i):"external"==a.networkTab.value?c.getExternalNetworksByVirtualDataCenter(d.currentVirtualDatacenter,g.ntwPaginator.param,g.ntwPaginator.filter,i):"public"==a.networkTab.value&&c.getPublicNetworksByVirtualDataCenter(d.currentVirtualDatacenter,g.ntwPaginator.param,g.ntwPaginator.filter,i)};a.onNetworkClick=function(a){c.setCurrentNetwork(a)},a.onAllNetworksClick=function(){c.setCurrentNetwork(null)},a.$watch("networkTab.value",function(){j(),f.refreshLayout()}),h.on(["currentVirtualDatacenter.change","networks.edited","networks.created"],j,a),a.onDeleteNetworkConfirm=function(a){var e=function(){f.toastrSuccess(b("translate")("action.delete.success.network.text",{network:c.currentNetwork.name})),c.getPrivateNetworksByVirtualDataCenter(d.currentVirtualDatacenter)};c.deleteNetwork(c.currentNetwork,e)},a.getPage=function(a){g.ntwPaginator.param.startwith=(a-1)*g.ntwPaginator.param.limit,j()}}]).controller("NetworkGridCtrl",["$scope","networksMgr","virtualDatacentersMgr","$filter","paginationHelper","utils","dispatcher","gridTemplates",function(a,b,c,d,e,f,g,h){a.__name="NetworkGridCtrl";var i=new ngGridLayoutPlugin;a.ips=b.ips,a.currentNetwork=b.currentNetwork,a.currentVirtualDatacenter=c.currentVirtualDatacenter,a.ipFilter=e.ipPaginator.filter,a.ipPaginator=e.ipPaginator,a.sortInfo={fields:[""],directions:["asc","desc"]};var j=function(a){f.refreshLayout(),e.ipPaginator.param.totalSize=a.totalSize},k=function(a,c,d){b.getNetworkPoolInfoPurchasedByVDC(a,c,d,e.ipPaginator.param,e.ipPaginator.filter,j)},l=function(d,f){"public"==a.networkTab.value?b.getNetworkPoolInfoPurchasedByVDC(c.currentVirtualDatacenter,f,d,e.ipPaginator.param,e.ipPaginator.filter,j):b.getIpsByNetwork(d,f,e.ipPaginator.param,e.ipPaginator.filter,j)},m=function(c,d){b.setCurrentNetworkType(a.networkTab.value),"internal"==a.networkTab.value?b.getPrivateIpsByVirtualDataCenter(c,d,e.ipPaginator.param,e.ipPaginator.filter,j):"external"==a.networkTab.value?b.getExternalIpsByVirtualDataCenter(c,d,e.ipPaginator.param,e.ipPaginator.filter,j):"public"==a.networkTab.value&&k(c,d,null)},n=function(b){a.currentIp=null,f.isEmptyObject(a.currentNetwork)?f.isEmptyObject(a.currentVirtualDatacenter)||m(c.currentVirtualDatacenter,b):l(a.currentNetwork,b)};g.on(["currentVirtualDatacenter.change","currentNetwork.change","nic.purchased","networks.ips.edited"],function(){e.ipPaginator.resetParam(),n()},a),a.updateLayout=function(){i.updateGridLayout()},a.ipsGridOptions={data:"ips",plugins:[i],multiSelect:!1,afterSelectionChange:function(b){b&&b.selected?a.currentIp=b.entity:a.currentIp=null},columnDefs:[{field:"ip",displayName:d("translate")("networkgrid.heading.ipaddress")},{field:"mac",displayName:d("translate")("networkgrid.heading.mac")},{field:"networkName",displayName:d("translate")("networkgrid.heading.vlan")},{field:"clientData.virtualAppliance.name",displayName:d("translate")("networkgrid.heading.virtualappliance")},{field:"clientData.virtualMachine.name",displayName:d("translate")("networkgrid.heading.virtualmachine")}],useExternalSorting:!0,sortInfo:a.sortInfo},a.ipsPublicGridOptions={data:"ips",plugins:[i],multiSelect:!1,afterSelectionChange:function(b){b&&b.selected?a.currentIp=b.entity:a.currentIp=null},columnDefs:[{field:"ip",displayName:d("translate")("networkgrid.heading.ipaddress")},{field:"mac",displayName:d("translate")("networkgrid.heading.mac")},{field:"networkName",displayName:d("translate")("networkgrid.heading.vlan")},{field:"clientData.virtualAppliance.name",displayName:d("translate")("networkgrid.heading.virtualappliance")},{field:"clientData.virtualMachine.name",displayName:d("translate")("networkgrid.heading.virtualmachine")},{field:"ip",displayName:"-",cellTemplate:h.releaseNICForVDCTemplate,width:110}],useExternalSorting:!0,sortInfo:a.sortInfo};var o={};a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var c=b.sortMappping[a.fields[0]],d="asc"===a.directions[0]?!0:!1;(o.orderBy!=c||o.asc!=d)&&(o.orderBy=c,o.asc=d,e.ipPaginator.filter.by=c.toLowerCase(),e.ipPaginator.filter.asc=d,n())}},!0),a.onIpFilterSubmit=function(){e.ipPaginator.resetParam(),n()},a.onDeleteIpConfirm=function(){a.releaseNICFromVDC(a.currentIp)},a.releaseNICFromVDC=function(a){b.releaseNICFromVDC(a,n)},a.getPage=function(a){e.ipPaginator.param.startwith=(a-1)*e.ipPaginator.param.limit,n()},a.$on("timer",function(){n(!0)})}]),angular.module("loadBalancerCreate",["sslCertificateCreate"]).controller("LoadBalancerCreateCtrl",["$scope","virtualDatacentersMgr","loadBalancersMgr","networksMgr","commonsMgr","firewallsMgr","virtualMachinesMgr","configMgr","gridTemplates","utils","$filter",function(a,b,c,d,e,f,g,h,i,j,k){a.__name="LoadBalancerCreateCtrl",a.editMode=!1,a.currentVirtualDatacenter=b.currentVirtualDatacenter,a.subnets=d.networks,a.addresses=c.addresses;var l=function(){a.closePopup(a.popUpElement)},m=function(){},n=function(){a.addresses=k("filterAddresses")(angular.copy(c.addresses),a.loadBalancer.clientData),a.loadBalancer.clientData["public"]&&o("public"),a.loadBalancer.clientData["private"]&&o("private")},o=function(b){var c=k("getElementByParameter")(a.addresses,{element:b,attribute:"id"});c.clientData.selected=!0};a.subnetsGridOptions={data:"subnets",columnDefs:[{field:"",displayName:"",cellTemplate:i.selectedCellTemplate,width:50},{field:"id",displayName:k("translate")("loadbalancers.heading.id"),width:50},{field:"name",displayName:k("translate")("loadbalancers.heading.name")}],multiSelect:!1},a.addressesGridOptions={data:"addresses",columnDefs:[{field:"",displayName:"",cellTemplate:i.selectUpdatedCellTemplate,width:50},{field:"endpoint",displayName:k("translate")("loadbalancers.heading.name")}],multiSelect:!1},a.onItemEnabledChange=function(b){if(!b.clientData.selected){var c=!1;angular.forEach(a.addresses,function(a){a.internal==b.internal&&a.clientData.selected&&(c=!0)}),c||o(b.internal?"private":"public")}},a.onCheckboxClick=function(b,c){a.loadBalancer.clientData[b]||a.loadBalancer.clientData[c]||(a.loadBalancer.clientData[b]=!0),n()},a.onSubmit=function(){c.createLoadBalancer(angular.copy(a.loadBalancer),a.currentVirtualDatacenter,a.currentVirtualDatacenter.clientData.location,a.subnets,a.addresses,f.firewalls,l)},a.onShown=function(){a.popUpElement=a.getPopupElement(),a.loadBalancer={links:[],clientData:{"public":!0,"private":!1,nodes:[]},routingRules:{collection:[]},healthChecks:{collection:[]
}},a.hypervisorType=k("getElementByParameter")(e.hypervisorTypes,{element:a.currentVirtualDatacenter.hypervisorType,attribute:"name"}),d.getPrivateNetworksByVirtualDataCenter(a.currentVirtualDatacenter,{},{},m),k("operationIsGranted")(a.currentVirtualDatacenter.hypervisorType,"loadbalancers")?(a.algorithms=a.hypervisorType.constraints.loadbalancer_algorithms_csv.split(","),a.routingRuleProtocols=a.hypervisorType.constraints.loadbalancer_routingrules_protocols_csv.split(","),a.healthCheckProtocols=a.hypervisorType.constraints.loadbalancer_healthcheck_protocols_csv.split(","),c.getAddressesByLocation(a.currentVirtualDatacenter.clientData.location,a.hypervisorType.constraints.loadbalancer_addressess_reuse,n)):(a.algorithms=h.config["config.loadbalanceralgorithms"],a.routingRuleProtocols=h.config["config.loadbalancerroutingrulesprotocols"],a.healthCheckProtocols=h.config["config.loadbalancerhealthcheckprotocols"],c.getAddressesByLocation(a.currentVirtualDatacenter.clientData.location,h.config["config.loadbalanceraddressessreuse"],n)),c.getSslCertificatesByLocation(a.currentVirtualDatacenter.clientData.location),f.getAvailableFirewallsByVdc(a.currentVirtualDatacenter,{},{}),g.getVirtualMachinesByVirtualDatacenter(a.currentVirtualDatacenter)},a.$watch("newLoadBalancerForm.$valid",function(b){a.validForm()},!0),a.validForm=function(){a.newLoadBalancerForm&&a.newLoadBalancerForm.$valid&&(a.validExternally=a.loadBalancer.routingRules.collection.length>0&&void 0!=a.loadBalancer.name&&void 0!=a.loadBalancer.algorithm)}}]).controller("LoadBalancerRoutingRulesCtrl",["$scope","configMgr","loadBalancersMgr","gridTemplates","server","dispatcher","$filter","$timeout",function(a,b,c,d,e,f,g,h){a.__name="LoadBalancerRoutingRulesCtrl",a.protocols=b.config["config.loadbalancerprotocols"],a.selectedProtocol={},a.selectedCertificate={},a.sslCertificates=c.sslCertificates,a.deleteRow=function(b){var c=a.loadBalancer.routingRules.collection.indexOf(b.entity);a.loadBalancer.routingRules.collection.splice(c,1),a.validForm()},a.routingRulesGridOptions={data:"loadBalancer.routingRules.collection",columnDefs:[{field:"id",displayName:"",width:30,headerCellTemplate:d.deleteHeaderTemplate,cellTemplate:d.deleteCellTemplate},{field:"protocolIn",displayName:g("translate")("loadbalancers.routingrules.commons.input.protocolin")},{field:"portIn",displayName:g("translate")("loadbalancers.routingrules.commons.input.portin")},{field:"protocolOut",displayName:g("translate")("loadbalancers.routingrules.commons.input.protocolout")},{field:"portOut",displayName:g("translate")("loadbalancers.routingrules.commons.input.portout")},{field:"sslCertificate.name",displayName:g("translate")("loadbalancers.routingrules.commons.select.certificate")}],multiSelect:!1},a.onCertificateChange=function(){a.selectedCertificate=g("getElementByParameter")(a.sslCertificates,{element:a.selectedCertificate.name,attribute:"name"})},a.onCommonProtocolChange=function(){var b=g("getElementByParameter")(a.protocols,{element:a.selectedProtocol.value,attribute:"value"});a.selectedProtocol.portIn=b.port,a.selectedProtocol.portOut=b.port,a.selectedProtocol.protocolIn=b.protocol,a.selectedProtocol.protocolOut=b.protocol},a.addRoutingRule=function(){var b=angular.copy(a.selectedProtocol);if(a.selectedCertificate.links){var c=e.createLinkByRel(a.selectedCertificate.links,"self","sslcertificate");b.links=[c]}else a.selectedCertificate.name&&(b.sslCertificate=a.selectedCertificate);a.loadBalancer.routingRules.collection.push(b),a.validForm()},f.on("sslCertificate.created",function(b,c){h(function(){a.selectedCertificate=c.certificate})},a)}]).controller("LoadBalancerHealthCheckCtrl",["$scope","configMgr","gridTemplates","$filter",function(a,b,c,d){a.__name="LoadBalancerHealthCheckCtrl",a.protocols=b.config["config.loadbalancerprotocols"],a.selectedProtocol={},a.healthChecksGridOptions={data:"loadBalancer.healthChecks.collection",columnDefs:[{field:"id",displayName:"",width:50,headerCellTemplate:c.deleteHeaderTemplate,cellTemplate:c.deleteCellTemplate},{field:"name",displayName:d("translate")("loadbalancers.healthcheck.commons.input.name")},{field:"protocol",displayName:d("translate")("loadbalancers.healthcheck.commons.input.protocol")},{field:"port",displayName:d("translate")("loadbalancers.healthcheck.commons.input.port")},{field:"path",displayName:d("translate")("loadbalancers.healthcheck.commons.input.path")}],multiSelect:!1},a.deleteRow=function(b){var c=a.loadBalancer.healthChecks.collection.indexOf(b.entity);a.loadBalancer.healthChecks.collection.splice(c,1)},a.onCommonProtocolChange=function(){var b=d("getElementByParameter")(a.protocols,{element:a.selectedProtocol.value,attribute:"value"});a.selectedProtocol.protocol=b.protocol,a.selectedProtocol.port=b.port},a.addHealthCheck=function(){var b=angular.copy(a.selectedProtocol);b.intervalInMs=1e3*b.intervalInMs,b.timeoutInMs=1e3*b.timeoutInMs,a.loadBalancer.healthChecks.collection.push(b)}}]).controller("LoadBalancerFirewallsCtrl",["$scope","$filter","firewallsMgr","gridTemplates",function(a,b,c,d){a.__name="LoadBalancerFirewallsCtrl",a.firewalls=c.firewalls,a.firewallsGridOptions={data:"firewalls",columnDefs:[{field:"",displayName:"",cellTemplate:d.selectedCellTemplate,width:50},{field:"name",displayName:b("translate")("firewalls.heading.name")},{field:"providerId",displayName:b("translate")("firewalls.heading.providerid")},{field:"description",displayName:b("translate")("firewalls.heading.description"),sortable:!1}],multiSelect:!1}}]).controller("LoadBalancerNodesCtrl",["$scope","virtualMachinesMgr","safeApply","utils",function(a,b,c,d){a.__name="LoadBalancerNodesCtrl",a.virtualMachines=b.virtualMachines;var e=function(){a.loadBalancer.clientData.attachedNodesEdited=!0};a.dropVirtualMachineOnAvailableListener=function(b){if(void 0!==b.data("$scope").attachedVirtualMachine){var d=a.loadBalancer.clientData.nodes.indexOf(b.data("$scope").attachedVirtualMachine);a.loadBalancer.clientData.nodes.splice(d,1),c(a)}},a.dropVirtualMachineOnAvailableAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").attachedVirtualMachine},a.dropVirtualMachineOnAttachedListener=function(b){void 0!==b.data("$scope").virtualMachine&&(a.loadBalancer.clientData.nodes.push(b.data("$scope").virtualMachine),c(a))},a.dropVirtualMachineOnAttachedAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").virtualMachine},e()}]),angular.module("loadBalancerEdit",["sslCertificateCreate"]).controller("LoadBalancerEditCtrl",["$scope","virtualDatacentersMgr","loadBalancersMgr","networksMgr","commonsMgr","firewallsMgr","virtualMachinesMgr","configMgr","gridTemplates","utils","$filter",function(a,b,c,d,e,f,g,h,i,j,k){a.__name="LoadBalancerEditCtrl",a.editMode=!0,a.currentVirtualDatacenter=b.currentVirtualDatacenter,a.subnets=d.networks,a.addresses=c.addresses,a.firewalls=f.firewalls,a.virtualMachines=g.virtualMachines;var l=function(){a.closePopup(a.popUpElement)},m=function(){angular.forEach(a.loadBalancer.clientData.subnets,function(b){var c=k("getElementByParameter")(a.subnets,{element:b.id,attribute:"id"});c.clientData.selected=!0})},n=function(){angular.forEach(a.loadBalancer.clientData.addresses,function(b){var c=k("getElementByParameter")(a.addresses,{element:b.id,attribute:"id"});j.isEmptyObject(c)||(c.clientData.selected=!0)})},o=function(){angular.forEach(a.loadBalancer.clientData.firewalls,function(b){var c=k("getElementByParameter")(a.firewalls,{element:b.id,attribute:"id"});j.isEmptyObject(c)||(c.clientData.selected=!0)})},p=function(){a.addresses=k("filterAddresses")(angular.copy(c.addresses),a.loadBalancer.clientData),c.getLoadBalancerAddresses(a.loadBalancer,n)},q=function(){c.getLoadBalancerAttachedNodes(a.loadBalancer)},r=function(){a.validForm()};a.subnetsGridOptions={data:"subnets",columnDefs:[{field:"",displayName:"",cellTemplate:i.selectedCellTemplate,width:50},{field:"id",displayName:k("translate")("loadbalancers.heading.id"),width:50},{field:"name",displayName:k("translate")("loadbalancers.heading.name")}],multiSelect:!1},a.addressesGridOptions={data:"addresses",columnDefs:[{field:"",displayName:"",cellTemplate:i.selectedCellTemplate,width:50},{field:"endpoint",displayName:k("translate")("loadbalancers.heading.name")}],multiSelect:!1},a.onCheckboxClick=function(b,c){a.loadBalancer.clientData[b]||a.loadBalancer.clientData[c]||(a.loadBalancer.clientData[b]=!0),p()},a.onSubmit=function(){c.editLoadBalancer(angular.copy(a.loadBalancer),a.subnets,a.addresses,a.firewalls,l)},a.onShown=function(){a.popUpElement=a.getPopupElement(),a.loadBalancer=angular.copy(c.currentLoadBalancer),a.loadBalancerTab=a.popupData,a.hypervisorType=k("getElementByParameter")(e.hypervisorTypes,{element:a.currentVirtualDatacenter.hypervisorType,attribute:"name"}),k("operationIsGranted")(a.currentVirtualDatacenter.hypervisorType,"loadbalancers")?(a.algorithms=a.hypervisorType.constraints.loadbalancer_algorithms_csv.split(","),a.routingRuleProtocols=a.hypervisorType.constraints.loadbalancer_routingrules_protocols_csv.split(","),a.healthCheckProtocols=a.hypervisorType.constraints.loadbalancer_healthcheck_protocols_csv.split(","),c.getAddressesByLocation(a.currentVirtualDatacenter.clientData.location,a.hypervisorType.constraints.loadbalancer_addressess_reuse,p)):(a.algorithms=h.config["config.loadbalanceralgorithms"],a.routingRuleProtocols=h.config["config.loadbalancerroutingrulesprotocols"],a.healthCheckProtocols=h.config["config.loadbalancerhealthcheckprotocols"],c.getAddressesByLocation(a.currentVirtualDatacenter.clientData.location,h.config["config.loadbalanceraddressessreuse"],p)),d.getPrivateNetworksByVirtualDataCenter(a.currentVirtualDatacenter,{},{},m),c.getLoadBalancerRoutingRules(a.loadBalancer,r),c.getLoadBalancerHealthChecks(a.loadBalancer),c.getSslCertificatesByLocation(a.currentVirtualDatacenter.clientData.location),f.getAvailableFirewallsByVdc(a.currentVirtualDatacenter,{},{},o),g.getVirtualMachinesByVirtualDatacenter(a.currentVirtualDatacenter,q)},a.$watch("editLoadBalancerForm.$valid",function(b){a.validForm()},!0),a.validForm=function(){a.editLoadBalancerForm&&a.editLoadBalancerForm.$valid&&(a.validExternally=a.loadBalancer.clientData.routingRules.length>0&&void 0!=a.loadBalancer.name&&void 0!=a.loadBalancer.algorithm)}}]).controller("LoadBalancerEditRoutingRulesCtrl",["$scope","configMgr","loadBalancersMgr","gridTemplates","server","dispatcher","$filter","$timeout",function(a,b,c,d,e,f,g,h){a.__name="LoadBalancerEditRoutingRulesCtrl",a.protocols=b.config["config.loadbalancerprotocols"],a.selectedProtocol={},a.selectedCertificate={},a.sslCertificates=c.sslCertificates,a.filteredExistingRoutingRules;var i=function(){j(),a.validForm()},j=function(){a.filteredExistingRoutingRules=g("filterExistingObjects")(a.loadBalancer.clientData.routingRules)};a.deleteRow=function(b){if(a.loadBalancer.clientData.routingRulesEdited=!0,b.entity.links)b.entity.clientData.toBeDeleted=!0;else{var c=a.loadBalancer.clientData.routingRules.indexOf(b.entity);a.loadBalancer.clientData.routingRules.splice(c,1),a.validForm()}j()},a.routingRulesGridOptions={data:"filteredExistingRoutingRules",columnDefs:[{field:"id",displayName:"",width:30,headerCellTemplate:d.deleteHeaderTemplate,cellTemplate:d.deleteCellTemplate},{field:"protocolIn",displayName:g("translate")("loadbalancers.routingrules.commons.input.protocolin")},{field:"portIn",displayName:g("translate")("loadbalancers.routingrules.commons.input.portin")},{field:"protocolOut",displayName:g("translate")("loadbalancers.routingrules.commons.input.protocolout")},{field:"portOut",displayName:g("translate")("loadbalancers.routingrules.commons.input.portout")},{field:"sslCertificate.name",displayName:g("translate")("loadbalancers.routingrules.commons.select.certificate")}],multiSelect:!1},a.onCertificateChange=function(){a.selectedCertificate=g("getElementByParameter")(a.sslCertificates,{element:a.selectedCertificate.name,attribute:"name"})},a.onCommonProtocolChange=function(){var b=g("getElementByParameter")(a.protocols,{element:a.selectedProtocol.value,attribute:"value"});a.selectedProtocol.portIn=b.port,a.selectedProtocol.portOut=b.port,a.selectedProtocol.protocolIn=b.protocol,a.selectedProtocol.protocolOut=b.protocol},a.addRoutingRule=function(){a.loadBalancer.clientData.routingRulesEdited=!0;var b=angular.copy(a.selectedProtocol);if(a.selectedCertificate.links){var c=e.createLinkByRel(a.selectedCertificate.links,"self","sslcertificate");b.links=[c]}else a.selectedCertificate.name&&(b.sslCertificate=a.selectedCertificate);a.loadBalancer.clientData.routingRules.push(b),j(),a.validForm()},f.on("sslCertificate.created",function(b,c){h(function(){a.selectedCertificate=c.certificate})},a),i()}]).controller("LoadBalancerEditHealthCheckCtrl",["$scope","configMgr","gridTemplates","$filter",function(a,b,c,d){a.__name="LoadBalancerEditHealthCheckCtrl",a.protocols=b.config["config.loadbalancerprotocols"],a.selectedProtocol={};var e=function(){f(),a.validForm()},f=function(){a.filteredExistingHealthChecks=d("filterExistingObjects")(a.loadBalancer.clientData.healthChecks)};a.healthChecksGridOptions={data:"filteredExistingHealthChecks",columnDefs:[{field:"id",displayName:"",width:50,headerCellTemplate:c.deleteHeaderTemplate,cellTemplate:c.deleteCellTemplate},{field:"name",displayName:d("translate")("loadbalancers.healthcheck.commons.input.name")},{field:"protocol",displayName:d("translate")("loadbalancers.healthcheck.commons.input.protocol")},{field:"port",displayName:d("translate")("loadbalancers.healthcheck.commons.input.port")},{field:"path",displayName:d("translate")("loadbalancers.healthcheck.commons.input.path")}],multiSelect:!1},a.deleteRow=function(b){if(a.loadBalancer.clientData.healthChecksEdited=!0,b.entity.links)b.entity.clientData.toBeDeleted=!0;else{var c=a.loadBalancer.clientData.healthChecks.indexOf(b.entity);a.loadBalancer.clientData.healthChecks.splice(c,1)}f()},a.onCommonProtocolChange=function(){var b=d("getElementByParameter")(a.protocols,{element:a.selectedProtocol.value,attribute:"value"});a.selectedProtocol.protocol=b.protocol,a.selectedProtocol.port=b.port},a.addHealthCheck=function(){a.loadBalancer.clientData.healthChecksEdited=!0;var b=angular.copy(a.selectedProtocol);b.intervalInMs=1e3*b.intervalInMs,b.timeoutInMs=1e3*b.timeoutInMs,a.loadBalancer.clientData.healthChecks.push(b),f()},e()}]).controller("LoadBalancerEditFirewallsCtrl",["$scope","$filter","firewallsMgr","gridTemplates",function(a,b,c,d){a.__name="LoadBalancerEditFirewallsCtrl",a.firewalls=c.firewalls;var e=function(){a.validForm()};a.firewallsGridOptions={data:"firewalls",columnDefs:[{field:"",displayName:"",cellTemplate:d.selectedCellTemplate,width:50},{field:"name",displayName:b("translate")("firewalls.heading.name")},{field:"providerId",displayName:b("translate")("firewalls.heading.providerid")},{field:"description",displayName:b("translate")("firewalls.heading.description"),sortable:!1}],multiSelect:!1},e()}]).controller("LoadBalancerEditNodesCtrl",["$scope","virtualMachinesMgr","safeApply","utils",function(a,b,c,d){a.__name="LoadBalancerEditNodesCtrl",a.virtualMachines=b.virtualMachines;var e=function(){a.loadBalancer.clientData.attachedNodesEdited=!0,a.validForm()};a.dropVirtualMachineOnAvailableListener=function(b){if(void 0!==b.data("$scope").attachedVirtualMachine){var d=a.loadBalancer.clientData.nodes.indexOf(b.data("$scope").attachedVirtualMachine);a.loadBalancer.clientData.nodes.splice(d,1),c(a)}},a.dropVirtualMachineOnAvailableAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").attachedVirtualMachine},a.dropVirtualMachineOnAttachedListener=function(b){void 0!==b.data("$scope").virtualMachine&&(a.loadBalancer.clientData.nodes.push(b.data("$scope").virtualMachine),c(a))},a.dropVirtualMachineOnAttachedAcceptListener=function(a){return void 0!==a.data("$scope")&&void 0!==a.data("$scope").virtualMachine},e()}]),angular.module("loadBalancers",["loadBalancerCreate","loadBalancerEdit"]).controller("LoadBalancersCtrl",["$scope","$timeout","loadBalancersMgr","virtualDatacentersMgr","systemPropertiesMgr","enterprisesMgr","datacentersMgr","paginationHelper","utils","dispatcher","$filter",function(a,b,c,d,e,f,g,h,i,j,k){a.__name="LoadBalancersCtrl",a.currentLoadBalancer=c.currentLoadBalancer,a.loadBalancers=c.loadBalancers,a.systemProperties=e.systemProperties,a.currentVirtualDatacenter=d.currentVirtualDatacenter,a.loadBalancerFilter=h.loadBalancerPaginator.filter,a.loadBalancerPaginationParam=h.loadBalancerPaginator.param,h.loadBalancerPaginator.resetParam();var l=function(b){a.loadBalancerPaginationParam.totalSize=b.totalSize,i.refreshLayout()},m=function(){a.networkTab&&"loadbalancers"==a.networkTab.value&&(c.setCurrentLoadBalancer(null),i.isEmptyObject(a.currentVirtualDatacenter)?c.loadBalancers.length=0:c.getAvailableLoadBalancersByVdc(a.currentVirtualDatacenter,a.loadBalancerPaginationParam,a.loadBalancerFilter,l))},n=function(){m()},o=function(){c.deleteLoadBalancer(c.currentLoadBalancer,n)},p=function(a){a.selected&&c.setCurrentLoadBalancer(a.entity)};a.loadBalancersGridOptions={data:"loadBalancers",columnDefs:[{field:"name",displayName:k("translate")("loadbalancers.heading.name")},{field:"algorithm",displayName:k("translate")("loadbalancers.heading.algorithm")}],useExternalSorting:!0,afterSelectionChange:p,multiSelect:!1},a.onLoadBalancerFilterSubmit=function(){h.loadBalancerPaginator.resetParam(),m()},a.getPage=function(b){a.loadBalancerPaginationParam.startwith=(b-1)*a.loadBalancerPaginationParam.limit,m()},a.onDeleteLoadBalancerConfirm=function(){o()},a.synchronizeLoadBalancers=function(){c.synchronizeLoadBalancersByVirtualDatacenter(a.currentVirtualDatacenter)},j.on(["currentVirtualDatacenter.change","loadBalancer.created","loadBalancer.edited","loadBalancer.deleted"],function(){h.loadBalancerPaginator.resetParam(),c.setCurrentLoadBalancer(null),m()},a),a.$watch("networkTab.value",function(a){"loadbalancers"==a&&m()},!0)}]).controller("LoadBalancerDetailsCtrl",["$scope","$filter","$timeout","loadBalancersMgr","virtualDatacentersMgr","systemPropertiesMgr","dispatcher","utils",function(a,b,c,d,e,f,g,h){a.__name="LoadBalancerDetailsCtrl",a.currentLoadBalancer=d.currentLoadBalancer,a.systemProperties=f.systemProperties,a.currentVirtualDatacenter=e.currentVirtualDatacenter,a.loadBalancerDetailsTab={value:"generalinfo"},a.onTabClick=function(b){if(a.selectedTab=b,!h.isEmptyObject(a.currentLoadBalancer))switch(b){case"generalinfo":d.getLoadBalancerAddresses(d.currentLoadBalancer);break;case"routingrules":d.getLoadBalancerRoutingRules(d.currentLoadBalancer);break;case"healthchecks":d.getLoadBalancerHealthChecks(d.currentLoadBalancer);break;case"firewalls":d.getLoadBalancerFirewalls(d.currentLoadBalancer);break;case"nodes":d.getLoadBalancerAttachedNodes(d.currentLoadBalancer)}h.refreshLayout()},a.subnetsGridOptions={data:"currentLoadBalancer.clientData.subnets",columnDefs:[{field:"id",displayName:b("translate")("loadbalancers.heading.id"),width:50},{field:"name",displayName:b("translate")("loadbalancers.heading.name")}],multiSelect:!1},a.addressesGridOptions={data:"currentLoadBalancer.clientData.addresses",columnDefs:[{field:"endpoint",displayName:b("translate")("loadbalancers.heading.name")}],multiSelect:!1},a.routingRulesGridOptions={data:"currentLoadBalancer.clientData.routingRules",columnDefs:[{field:"protocolIn",displayName:b("translate")("loadbalancers.routingrules.commons.input.protocolin")},{field:"portIn",displayName:b("translate")("loadbalancers.routingrules.commons.input.portin")},{field:"protocolOut",displayName:b("translate")("loadbalancers.routingrules.commons.input.protocolout")},{field:"portOut",displayName:b("translate")("loadbalancers.routingrules.commons.input.portout")},{field:"sslCertificate.name",displayName:b("translate")("loadbalancers.routingrules.commons.select.certificate")}],multiSelect:!1},a.healthChecksGridOptions={data:"currentLoadBalancer.clientData.healthChecks",columnDefs:[{field:"protocol",displayName:b("translate")("loadbalancers.healthcheck.commons.input.protocol")},{field:"port",displayName:b("translate")("loadbalancers.healthcheck.commons.input.port")},{field:"path",displayName:b("translate")("loadbalancers.healthcheck.commons.input.path")}],multiSelect:!1},a.firewallsGridOptions={data:"currentLoadBalancer.clientData.extendedFirewalls",columnDefs:[{field:"name",displayName:b("translate")("firewalls.heading.name")},{field:"providerId",displayName:b("translate")("firewalls.heading.providerid")},{field:"description",displayName:b("translate")("firewalls.heading.description"),sortable:!1}],multiSelect:!1},a.nodesGridOptions={data:"currentLoadBalancer.clientData.nodes",columnDefs:[{field:"id",displayName:b("translate")("loadbalancers.heading.id"),width:50},{field:"name",displayName:b("translate")("loadbalancers.heading.name")}],multiSelect:!1},g.on(["currentLoadBalancer.change"],function(){a.onTabClick(a.selectedTab)},a)}]),angular.module("sslCertificateCreate",[]).controller("SslCertificateCreateCtrl",["$scope","loadBalancersMgr",function(a,b){a.__name="SslCerrificateCreateCtrl",a.sslCertificates=b.sslCertificates;var c=function(){a.closePopup()};a.onShown=function(){a.sslCertificate={}},a.onSubmit=function(){b.addSslCertificates(a.sslCertificate,c)}}]),angular.module("purchaseNICforVDC",[]).controller("PurchaseNICforVDCCtrl",["$scope","$filter","virtualDatacentersMgr","networksMgr","paginationHelper","gridTemplates","dispatcher","utils",function(a,b,c,d,e,f,g,h){a.__name="PurchaseNICforVDCCtrl";var i=new ngGridLayoutPlugin;a.ips=d.ipsToPurchase,a.ipPurchaseFilter=e.ipPurchasePaginator.filter,a.ipPurchasePaginator=e.ipPurchasePaginator.param;var j=function(b){a.currentIp=null,e.ipPurchasePaginator.param.totalSize=b.totalSize},k=function(){h.isEmptyObject(c.currentVirtualDatacenter)||d.getNetworkPoolInfoToPurchaseByVDC(c.currentVirtualDatacenter,null,e.ipPurchasePaginator.param,e.ipPurchasePaginator.filter,j)};a.purchaseNICforVDC=function(a){d.purchaseNICforVDC(a,c.currentVirtualDatacenter)};var l=function(b){b&&b.selected?a.currentIp=b.entity:a.currentIp=null};a.getPage=function(a){e.ipPurchasePaginator.param.startwith=(a-1)*e.ipPurchasePaginator.param.limit,k()},a.onCreateIpConfirm=function(){d.createPublicIp(c.currentVirtualDatacenter)},a.onDeleteIpConfirm=function(){d.deletePublicIp(c.currentVirtualDatacenter,a.currentIp)},a.onFilterSubmit=function(){e.ipPurchasePaginator.resetParam(),k()},a.synchronizeFloatingIps=function(){d.synchronizeFloatingIps(c.currentVirtualDatacenter)},a.ipsGridOptions={data:"ips",plugins:[i],columnDefs:[{field:"ip",displayName:b("translate")("networkgrid.heading.ipaddress")},{field:"networkName",displayName:b("translate")("networkgrid.heading.vlan")},{field:"ip",displayName:"-",cellTemplate:f.purchaseNICforVDCTemplate,width:100}],afterSelectionChange:l,multiSelect:!1},g.on(["publicip.created","publicip.deleted","publicip.synchronized","nic.release","currentVirtualDatacenter.change"],function(){k(),a.currentIp=null},a),k()}]).controller("PurchaseNICforVDCPopupCtrl",["$scope","$filter","virtualDatacentersMgr","networksMgr","paginationHelper","gridTemplates","dispatcher",function(a,b,c,d,e,f,g){a.__name="PurchaseNICforVDCCtrl";var h=new ngGridLayoutPlugin;a.ips=d.ipsToPurchase,a.ipPurchaseFilter=e.ipPurchasePaginator.filter,a.ipPurchasePaginator=e.ipPurchasePaginator.param,a.sortInfo={fields:[""],directions:["asc","desc"]};var i=function(){a.closePopup(a.popuElement)},j=function(b){a.currentIp=null,e.ipPurchasePaginator.param.totalSize=b.totalSize},k=function(){d.getNetworkPoolInfoToPurchaseByVDC(c.currentVirtualDatacenter,d.currentNetwork,e.ipPurchasePaginator.param,e.ipPurchasePaginator.filter,j)},l=function(b){b&&b.selected?a.currentIp=b.entity:a.currentIp=null},m=function(){a.ipToPurchasedCount==a.ipToPurchased.length?i():(d.purchaseNICforVDC(a.ipToPurchased[a.ipToPurchasedCount],c.currentVirtualDatacenter,m),a.ipToPurchasedCount++)};a.getPage=function(a){e.ipPurchasePaginator.param.startwith=(a-1)*e.ipPurchasePaginator.param.limit,k()},a.onShown=function(){a.popuElement=a.getPopupElement(),k(),a.ipToPurchased=[],a.ipToPurchasedCount=0},a.onSubmit=function(){angular.forEach(d.ipsToPurchase,function(b){b.clientData.selected&&a.ipToPurchased.push(b)}),m()},a.onCreateIpConfirm=function(){d.createPublicIp(c.currentVirtualDatacenter)},a.onDeleteIpConfirm=function(){d.deletePublicIp(c.currentVirtualDatacenter,a.currentIp)},a.onFilterSubmit=function(){e.ipPurchasePaginator.resetParam(),k()},a.ipsGridOptions={data:"ips",plugins:[h],sortInfo:a.sortInfo,columnDefs:[{field:"clientData.selected",width:50,displayName:"-",cellTemplate:f.selectedCellTemplate,sortable:!1},{field:"ip",displayName:b("translate")("networkgrid.heading.ipaddress")},{field:"networkName",displayName:b("translate")("networkgrid.heading.vlan")}],afterSelectionChange:l,useExternalSorting:!0,enableRowSelection:!1,multiSelect:!1},g.on(["publicip.created","publicip.deleted"],function(){k()},a),g.on(["softLimits.canceled"],function(){i()},a);var n={};a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var b=d.sortMappping[a.fields[0]],c="asc"===a.directions[0]?!0:!1;(n.orderBy!=b||n.asc!=c)&&(n.orderBy=b,n.asc=c,e.ipPurchasePaginator.filter.by=b,e.ipPurchasePaginator.filter.asc=c,console.log("sortInfo",n),k())}},!0)}]),angular.module("persistentDetails",[]).controller("PersistentDetailsCtrl",["$scope","$filter","virtualMachineTemplatesMgr","gridTemplates","dispatcher","utils",function(a,b,c,d,e,f){a.__name="PersistentDetailsCtrl",a.currentPersistentVMTemplate=c.currentPersistentVMTemplate,a.sequenceNotEditable=!0;var g=function(){f.isEmptyObject(a.currentPersistentVMTemplate)||c.getVMTemplateDisks(a.currentPersistentVMTemplate,null)};a.persistentDisksGrid={data:"currentPersistentVMTemplate.clientData.disks",columnDefs:[{field:"sequence",width:70,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.sequence"),cellTemplate:d.reorderSequenceCell},{field:"path",displayName:b("translate")("virtualmachinetemplate.disks.grid.title.file"),cellTemplate:d.diskFileNameCellTemplate},{field:"clientData.tier.name",width:90,displayName:b("translate")("persistentvirtualmachinetemplates.grid.header.tier"),cellTemplate:d.templateWithTooltip},{field:"clientData.diskFileSize",width:70,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.size"),cellTemplate:d.sizeUnitInBytesCellTemplate},{field:"hdRequired",width:70,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.hd"),cellTemplate:d.sizeUnitInBytesCellTemplate},{field:"state",width:60,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.state"),cellTemplate:d.stateCellTemplate},{field:"clientData.volume.name",width:90,displayName:b("translate")("virtualmachinetemplate.disks.grid.title.volume"),cellTemplate:d.templateWithTooltip},{field:"",width:25,displayName:"",cellTemplate:d.downloadCellTemplate}],multiSelect:!1,enableRowSelection:!1},e.on(["currentPersistentVMTemplate.change"],g,a)}]),angular.module("persistentVirtualMachineTemplateEdit",[]).controller("PersistentVirtualMachineTemplateEditCtrl",["$scope","virtualMachineTemplatesMgr","virtualDatacentersMgr","commonsMgr","utils","$filter",function(a,b,c,d,e,f){a.__name="PersistentVirtualMachineTemplateEditCtrl",a.template={},a.editMode=!0,a.isEditionGranted=!0,a.ramUnits=e.unitsSelector,a.ramConversion={},a.ramInput={},a.hdUnits=e.unitsSelector,a.hdConversion={},a.hdInput={},a.selectedCategory={},a.selectedDiskFormatType={},a.virtualMachineTemplatesCategories=b.virtualMachineTemplatesCategories,a.diskFormatTypes=d.diskFormatTypes,a.options={minimumResultsForSearch:-1};var g=1048576;d.getDiskFormatTypes();var h=function(){a.closePopup()};a.onShown=function(){a.template=angular.copy(b.currentPersistentVMTemplate),a.ramConversion.value=e.getUnitSelectorForMB(a.template.ramRequired).conversion,a.ramInput.value=a.template.ramRequired/a.ramConversion.value,a.hdConversion.value=e.getUnitSelectorForMB(a.template.hdRequired/g).conversion,a.hdInput.value=a.template.hdRequired/a.hdConversion.value/g,a.selectedCategory.id=a.template.clientData.category.id,a.selectedDiskFormatType.diskFormatType=a.template.diskFormatType},a.onSubmit=function(){a.template.ramRequired=a.ramInput.value*parseInt(a.ramConversion.value),a.template.hdRequired=a.hdInput.value*g*parseInt(a.hdConversion.value);var c=f("getElementByParameter")(a.virtualMachineTemplatesCategories,{element:parseInt(a.selectedCategory.id),attribute:"id"});b.editPersistentVMTemplate(a.template,c,h)}}]),angular.module("persistentVirtualMachineTemplates",["persistentVirtualMachineTemplateEdit","persistentVirtualMachineTemplateCreate","persistentDetails"]).controller("PersistentVirtualMachineTemplatesCtrl",["$scope","virtualMachineTemplatesMgr","virtualDatacentersMgr","enterprisesMgr","systemPropertiesMgr","paginationHelper","$filter","utils","gridTemplates","dispatcher",function(a,b,c,d,e,f,g,h,i,j){a.__name="PersistentVirtualMachineTemplatesCtrl",a.systemPropertiesMgr=e,a.persitentVMTemplates=b.allVirtualMachinePersistentTemplates,a.currentPersistentVMTemplate=b.currentPersistentVMTemplate,a.currentVirtualDatacenter=c.currentVirtualDatacenter,a.vmtFilter=f.vmtPaginator.filter,a.vmtPaginationParam=f.vmtPaginator.param,a.isCurrentPersistentVMTemplateEditDisabled=!0,a.isCurrentPersistentVMTemplateRemoveDisabled=!0,j.on("currentVirtualDatacenter.change",function(){f.vmtPaginator.resetParam(),l()},a);var k=function(a){f.vmtPaginator.param.totalSize=a.totalSize},l=function(a){a||b.setCurrentPersistentVMTemplate(),h.isEmptyObject(c.currentVirtualDatacenter)?b.allVirtualMachinePersistentTemplates.length=0:b.getAllPersistentVMTemplates(c.currentVirtualDatacenter,a,f.vmtPaginator.param,f.vmtPaginator.filter,k)},m=function(){l()},n=function(){b.removePersistentVMTemplate(b.currentPersistentVMTemplate,m)},o=function(){a.isCurrentPersistentVMTemplateEditDisabled=g("isEmptyORDone")(b.currentPersistentVMTemplate),a.isCurrentPersistentVMTemplateRemoveDisabled=g("isEmptyObject")(b.currentPersistentVMTemplate)},p=function(a){a.selected&&(b.setCurrentPersistentVMTemplate(a.entity),o())};a.sortInfo={fields:["name"],directions:["asc","desc"]};var q='<div ng-style="{cursor: row.cursor}" \n                            data-ui-draggable \n                            data-drag-enabled="\'VDC_MANAGE_STORAGE\' | isGranted" \n                            data-drag-revert="true" \n                            data-drag-helper="<div class=\'dragged-item\'>{{row.getProperty(\'name\')}}</div>" \n                            data-drag-object="{type:\'persistentTemplate\', data:row.entity}" \n                            ng-repeat="col in renderedColumns" \n                            ng-class="col.colIndex()" \n                            class="ngCell {{col.cellClass}}" \n                            ng-cell></div>';a.persistentVMTemplatesGridOptions={data:"persitentVMTemplates",rowTemplate:q,columnDefs:[{field:"name",displayName:g("translate")("persistentvirtualmachinetemplates.grid.header.name")},{field:"clientData.master.name",displayName:g("translate")("persistentvirtualmachinetemplates.grid.header.master")},{field:"clientData.virtualAppliance.name",displayName:g("translate")("persistentvirtualmachinetemplates.grid.header.vapp")},{field:"clientData.virtualMachine.name",displayName:g("translate")("persistentvirtualmachinetemplates.grid.header.vm")},{field:"state",displayName:g("translate")("persistentvirtualmachinetemplates.grid.header.state"),cellTemplate:i.stateCellTemplate,sortable:!1}],afterSelectionChange:p,sortInfo:a.sortInfo,multiSelect:!1},a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var c=b.persistentSortMapping[a.fields[0]],d="asc"===a.directions[0]?!0:!1;f.vmtPaginator.filter.by=c,f.vmtPaginator.filter.asc=d,l()}},!0),a.onGetPersistentTemplatesClick=function(){l()},a.onDeletePersistentVMTemplateConfirm=function(){n()},
a.onVMTFilterSubmit=function(){f.vmtPaginator.resetParam(),l()},a.getPage=function(a){f.vmtPaginator.param.startwith=(a-1)*f.vmtPaginator.param.limit,b.setCurrentPersistentVMTemplate(null),l()},j.on(["persistentTemplate.created","persistentTemplate.edited","persistentTemplate.deleted"],l,a),a.$on("timer",function(){l(!0)})}]),angular.module("virtualApplianceCreate",[]).controller("VirtualApplianceCreateCtrl",["$scope","datacentersMgr","virtualDatacentersMgr","virtualAppliancesMgr","authenticationMgr","enterprisesMgr","virtualMachinesMgr","$filter","utils",function(a,b,c,d,e,f,g,h,i){function j(){a.captureVmSection?c.getVirtualDataCentersByDataCenter(f.userEnterprise,b.currentDatacenter,l):c.getAllVirtualDatacenters(f.userEnterprise,k)}function k(b){a.virtualDatacenters=b}function l(b){a.virtualDatacenters=m(f.userEnterprise.clientData.virtualDatacenters)}function m(b){var c=[];if(b)for(var d=0;d<b.length;d++){var e=b[d];i.isEmptyObject(e)||a.currentVirtualMachine.clientData.hypervisorType!=e.hypervisorType||c.push(e)}return c}a.__name="VirtualApplianceCreateCtrl",a.editMode=!1,a.selectedVirtualDatacenter={id:null},a.automaticallyopen={selected:!1},a.currentVirtualMachine=g.currentVirtualMachine;var n,o=function(b){a.closePopup(n)};a.onSubmit=function(){var b=a.virtualDatacenter;(a.isInInfrastructure||i.isEmptyObject(b))&&(b=h("getElementById")(a.virtualDatacenters,parseInt(a.selectedVirtualDatacenter.id))),d.createVirtualAppliance(a.virtualAppliance,b,o)},a.onShown=function(){n=a.getPopupElement(),a.captureVmSection=a.popupData,a.virtualAppliance=new d.VirtualAppliance,(!h("isGranted")("VAPP_CUSTOMISE_SETTINGS")||a.captureVmSection)&&(a.virtualAppliance.clientData.automaticallyOpenVappView=!1),a.virtualDatacenter=angular.copy(c.currentVirtualDatacenter),j()},a.onHidden=function(){},a.onAutomaticOpenVappChange=function(a){e.userChoices.automaticallyOpenVappView=a,e.setUserChoicesCookie()}}]),angular.module("virtualApplianceEdit",[]).controller("VirtualApplianceEditCtrl",["$scope","virtualAppliancesMgr","virtualDatacentersMgr",function(a,b,c){a.__name="VirtualApplianceEditCtrl",a.editMode=!0;var d=function(){a.closePopup()};a.onSubmit=function(){b.editVirtualAppliance(a.virtualAppliance,d)},a.onShown=function(){a.virtualAppliance=angular.copy(b.currentVirtualAppliance),a.virtualDatacenter=a.virtualAppliance.clientData.virtualDatacenter}}]),angular.module("virtualAppliances",["virtualApplianceCreate","virtualApplianceEdit","virtualMachines"]).controller("VirtualAppliancesCtrl",["$scope","virtualAppliancesMgr",function(a,b){a.__name="VirtualAppliancesCtrl",a.currentVirtualAppliance=b.currentVirtualAppliance}]).controller("VirtualAppliancesListCtrl",["$scope","routeParamsHelper","virtualAppliancesMgr","virtualDatacentersMgr","virtualMachinesMgr","virtualMachineTemplatesMgr","layersMgr","enterprisesMgr","navigationMgr","refreshMgr","privilegesMgr","systemPropertiesMgr","pricingMgr","backupsMgr","paginationHelper","utils","$filter","uModals","dispatcher",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(b){var c=q("getElementById")(a.virtualAppliances,parseInt(b.value));a.onVirtualApplianceClick(c)}function u(){var b=!1;a.availableBackupOptions.clientData.complete&&(a.currentVirtualAppliance.clientData.defaultBackupTab="complete",b=!0),a.availableBackupOptions.clientData.filesystem&&(a.currentVirtualAppliance.clientData.defaultBackupTab="filesystem",b=!0),a.availableBackupOptions.clientData.snapshot&&(a.currentVirtualAppliance.clientData.defaultBackupTab="snapshot",b=!0),a.currentVirtualAppliance.clientData.backupEnabled=b}function v(b){c.setCurrentVirtualAppliance(b),q("isGranted")("VAPP_CUSTOMISE_SETTINGS")&&!b.clientData.virtualDatacenter.clientData.isPublic&&n.getAvailableBackupOptions(a.currentVirtualAppliance.clientData.virtualDatacenter.clientData.datacenter.id,u),"LOCKED"!=c.currentVirtualAppliance.state?j.initTimer():j.initVMTimer()}a.__name="VirtualAppliancesListCtrl",a.currentVirtualAppliance=c.currentVirtualAppliance,a.currentVirtualDatacenter=d.currentVirtualDatacenter,a.virtualAppliances=c.virtualAppliances,a.vappFilter=o.vappPaginator.filter,a.vappPaginationParam=o.vappPaginator.param,a.userCanAccess=k.userHasAtLeastOnPrivilege(["VDC_MANAGE_VAPP","VAPP_CUSTOMISE_SETTINGS","VAPP_PERFORM_ACTIONS","VAPP_DEPLOY_UNDEPLOY","MANAGE_HARD_DISKS","VAPP_STATEFUL_VIEW","VAPP_CREATE_STATEFUL","VAPP_CREATE_INSTANCE"]),a.systemProperties=l.systemProperties,a.availableBackupOptions=n.availableBackupOptions;var w=b.getParams(),x=function(){p.isEmptyObject(w)||!w.hasValidKey("vdc")?z():!p.isEmptyObject(w)&&w.hasValidKey("vapp")&&a.onGoIntoVappClick()},y=function(a){o.vappPaginator.param.totalSize=a.totalSize,b.doAction(w,"vapp",t,!0)},z=function(a){p.isEmptyObject(d.currentVirtualDatacenter)?c.getVirtualAppliancesForEnterprise(h.userEnterprise,a,o.vappPaginator.param,o.vappPaginator.filter,y):c.getVirtualAppliancesForVirtualDatacenter(d.currentVirtualDatacenter,a,o.vappPaginator.param,o.vappPaginator.filter,y)},A=function(){a.getPage(o.vappPaginator.param.currentPage)},B=function(){c.deleteVirtualAppliance(c.currentVirtualAppliance,A)},C=function(){j.initVMTimer()};a.onUndeployVirtualApplianceClick=function(){c.unDeploy(c.currentVirtualAppliance,!1,C)},a.onUpdateVirtualMachinesClick=function(){e.getVirtualMachines(!1,c.currentVirtualAppliance,c.updatePendingCurrentVirtualMachines)},a.onDeployVirtualApplianceClick=function(){var b=function(b){""!=b?r.showAlert({scope:a,message:b,title:q("translate")("virtualappliance.deploy.pricing.confirm.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:q("translate")("globals.cancel"),confirmLabel:q("translate")("globals.confirm"),confirmFn:function(){D()}}):D()};m.getVirtualAppliancePrice(c.currentVirtualAppliance,b)};var D=function(){c.deploy(c.currentVirtualAppliance,C)};a.onVappFilterSubmit=function(){o.vappPaginator.resetParam(),a.getPage(o.vappPaginator.param.currentPage)},a.getPage=function(a){o.vappPaginator.param.startwith=(a-1)*o.vappPaginator.param.limit,c.setCurrentVirtualAppliance(null),z()},a.onErrorClick=function(b,c){r.showPopUp({scope:a,controller:"VirtualAppliancesErrorsCtrl",popupUrl:"modules/virtualdatacenters/virtualappliances/partials/virtualapplianceerror.html",title:q("translate")("virtualapplianceslist.errors.title",{name:b.name}),closeOnAccept:"true",acceptLabel:q("translate")("globals.accept"),cancelLabel:q("translate")("globals.cancel"),showAcceptBtn:!0,showCancelBtn:!0,popupData:b})},a.onVirtualApplianceClick=function(a){d.getVirtualDatacenterInVirtualAppliance(a,v),e.setCurrentVirtualMachine(null)},a.onDeleteVirtualApplianceConfirm=function(){B()},a.onGoIntoVappClick=function(b){i.sectionView="virtualappliances",a.onVirtualApplianceClick(b)},s.on("currentVirtualDatacenter.change",function(){j.stopTimer(),j.initTimer(),o.vappPaginator.resetParam(),z()},a),s.on(["virtualAppliance.created","virtualAppliance.edited","virtualAppliance.deleted","virtualAppliance.moved","virtualAppliance.copied","virtualappliance.updated"],z,a),s.on("virtualAppliance.automaticOpenVapp",function(){a.onGoIntoVappClick()},a),s.on(["softLimits.canceled"],function(a,b){b.config&&"PUT"==b.config.method||c.currentVirtualAppliance&&c.currentVirtualAppliance.clientData&&c.currentVirtualAppliance.clientData.originalState&&(c.currentVirtualAppliance.state=c.currentVirtualAppliance.clientData.originalState)},a),s.on("start.vmtimer",function(){j.initVMTimer()},a),a.$on("timer",function(){z(!0)}),a.$on("timerVM",function(){z(!0)}),x()}]).controller("VirtualAppliancesErrorsCtrl",["$scope","virtualMachinesMgr","virtualAppliancesMgr",function(a,b,c){a.__name="VirtualAppliancesErrorsCtrl",a.virtualMachines=b.virtualMachines;var d=function(){var c=a.popupData;b.getVirtualMachines(!1,c)};a.virtualMachinesErrorsGridOptions={data:"virtualMachines",columnDefs:[{field:"name",displayName:"Name"},{field:"state",displayName:"State"}],multiSelect:!1},d()}]),angular.module("virtualMachineCreate",[]).controller("VirtualMachineCreateCtrl",["$scope","virtualMachinesMgr",function(a,b){a.filterOptions={filterText:"",useExternalFilter:!0},a.__name="VirtualMachineCreateCtrl",a.virtualMachineTemplates=angular.copy(b.virtualMachineTemplates),a.onAccept=function(){console.log("create virtual machine accept");$filter("selected")(a.virtualMachineTemplates)}}]),angular.module("virtualMachineDetails",[]).controller("VirtualMachineDetailsCtrl",["$scope","virtualMachinesMgr","systemPropertiesMgr","refreshMgr","virtualAppliancesMgr","commonsMgr","pricingMgr","configMgr","dispatcher","server","uModals","$filter","utils",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.__name="VirtualMachineDetailsCtrl",a.currentVirtualMachine=b.currentVirtualMachine,a.currentVirtualAppliance=e.currentVirtualAppliance,a.systemProperties=c.systemProperties,a.remoteAccessEnabled=!1;var n=function(){d.initVMTimer()},o=function(){d.initVMTimer()},p=function(){if(!m.isEmptyObject(a.currentVirtualMachine)){var b=a.currentVirtualMachine.clientData.hypervisorType?a.currentVirtualMachine.clientData.hypervisorType:a.currentVirtualAppliance.clientData.virtualDatacenter.hypervisorType;a.hypervisorType=l("getElementByParameter")(f.hypervisorTypes,{element:b,attribute:"name"}),a.hypervisorCompatible=!a.hypervisorType.constraints.extra_hard_disk||1==a.hypervisorType.constraints.extra_hard_disk,"1"==a.systemProperties.infrastructure["client.virtual.allowVMRemoteAccess"].value?"false"==a.hypervisorType.constraints.vnc_supported?a.remoteAccessEnabled="ON"==a.currentVirtualMachine.state&&l("isGranted")("VAPP_PERFORM_ACTIONS"):a.remoteAccessEnabled="ON"==a.currentVirtualMachine.state&&a.currentVirtualMachine.vdrpEnabled&&a.currentVirtualMachine.vdrpIP&&l("isGranted")("VAPP_PERFORM_ACTIONS"):a.remoteAccessEnabled=!1}},q=function(c){var d=angular.copy(a.currentVirtualMachine);m.isEmptyObject(a.currentVirtualAppliance)||(a.currentVirtualAppliance.clientData.orignalState=a.currentVirtualAppliance.state,a.currentVirtualAppliance.state="LOCKED"),b.undeployVirtualMachine(d,c,n)};a.onPlayClick=function(){b.powerOnVirtualMachine(a.currentVirtualMachine,o)},a.onPauseClick=function(){b.pauseVirtualMachine(a.currentVirtualMachine,o)},a.onStopClick=function(){b.powerOffVirtualMachine(a.currentVirtualMachine,o)},a.onResetClick=function(){b.resetVirtualMachine(a.currentVirtualMachine,o)},a.onBlockUnblockClick=function(){a.currentVirtualMachine["protected"]?b.unblockVirtualMachine(a.currentVirtualMachine,o):k.showPopUp({scope:a,controller:"BlockVirtualMachineCtrl",popupUrl:"modules/virtualdatacenters/virtualappliances/virtualmachines/details/partials/blockvirtualmachineform.html",formName:"blockVmForm",title:l("translate")("virtualmachine.details.block.title"),acceptLabel:l("translate")("globals.save"),cancelLabel:l("translate")("globals.cancel"),closeOnAccept:!1,showAcceptBtn:!0,showCancelBtn:!0})},a.onUnallocateVirtualMachineClick=function(){"CAPTURED"==a.currentVirtualMachine.type?k.showAlert({scope:a,message:l("translate")("virtualmachine.captured.undeploy.message"),title:l("translate")("virtualmachine.captured.undeploy.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:l("translate")("globals.cancel"),confirmLabel:l("translate")("globals.confirm"),confirmFn:function(){q(!0)},cancelFn:function(){}}):q(!1)},a.onAllocateVirtualMachineClick=function(){var b=function(b){""!=b?k.showAlert({scope:a,message:b,title:l("translate")("virtualappliance.deploy.pricing.confirm.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:l("translate")("globals.cancel"),confirmLabel:l("translate")("globals.confirm"),confirmFn:function(){r()}}):r()};g.getVirtualAppliancePrice(e.currentVirtualAppliance,b)};var r=function(){m.isEmptyObject(a.currentVirtualAppliance)||(a.currentVirtualAppliance.clientData.orignalState=a.currentVirtualAppliance.state,a.currentVirtualAppliance.state="LOCKED"),b.deployVirtualMachine(a.currentVirtualMachine,!1,!1,n)};a.onReleaseVirtualMachineClick=function(){b.releaseVirtualMachine(a.currentVirtualMachine)};var s=function(b){k.showAlert({scope:a,showCancelBtn:!0,cancelLabel:l("translate")("globals.close"),message:b,title:l("translate")("virtualmachine.remoteaccess.alert.title.accessinfo")})};a.onRemoteAccessClick=function(c){"XENSERVER"==a.hypervisorType.name?k.showAlert({scope:a,showCancelBtn:!0,cancelLabel:l("translate")("globals.close"),message:l("translate")("virtualmachine.remoteaccess.alert.message.notenabled"),title:l("translate")("virtualmachine.remoteaccess.alert.title.notenabled")}):"AMAZON"==a.hypervisorType.name||"AZURE"==a.hypervisorType.name?b.getRemoteAccessConnectionString(a.currentVirtualMachine,s):"HYPERV_301"==a.hypervisorType.name?b.getRemoteAccessConnectionString(a.currentVirtualMachine,function(b){a.currentVirtualMachine.clientData.remoteStringConnection=b,t(a.hypervisorType,a.currentVirtualMachine,c)}):t(a.hypervisorType,a.currentVirtualMachine,c)};var t=function(a,b,c){var d="";"VBOX"==a.name?d="lib/remoteaccess/properjavardp/properJavaRDP.html?vrdpIP="+b.vdrpIP+"&vrdpPort="+b.vdrpPort+"&vrdpKeymap="+b.vdrpKeymap+"&width=1024&height=768":"HYPERV_301"==a.name?d="lib/remoteaccess/rdpgate/rdpgate.html?proxyip="+b.vdrpIP+"&vrdpPort="+b.vdrpPort+"&rdppcb="+b.clientData.remoteStringConnection+"&width=1024&height=768&proxyssl="+h.config["rdpaccess.usesslproxy"]:(token=CryptoJS.MD5(b.vdrpIP+":"+b.vdrpPort).toString(),d="lib/remoteaccess/tightvnc/vnc.html?host="+window.location.hostname+"&port=41337&path=?token="+token+"&clip=true&autoconnect=true"),c.shiftKey?window.open(d,"_blank"):i.dispatch("openRemoteAccessJavaClient",{url:d})};i.on("currentVirtualMachine.change",p,a),i.on("virtualMachine.blocked",o,a)}]).controller("VirtualMachineSendMailCtrl",["$scope","serversMgr","virtualMachinesMgr","systemPropertiesMgr",function(a,b,c,d){a.__name="VirtualMachineSendMailCtrl",a.currentVirtualMachine=c.currentVirtualMachine,a.systemProperties=d.systemProperties;var e=function(b){a.closePopup()};a.onShown=function(){a.email={clientData:{}}},a.onSubmit=function(){b.sendEmailToVirtualMachine(a.currentVirtualMachine,a.email,e)}}]).controller("VirtualMachineDetailsGeneralCtrl",["$scope","virtualMachinesMgr","systemPropertiesMgr",function(a,b,c){a.__name="VirtualMachineDetailsGeneralCtrl",a.currentVirtualMachine=b.currentVirtualMachine,a.systemProperties=c.systemProperties}]).controller("VirtualMachineDetailsDescriptionCtrl",["$scope","virtualMachinesMgr",function(a,b){a.__name="VirtualMachineDetailsDescriptionCtrl",a.currentVirtualMachine=b.currentVirtualMachine}]).controller("VirtualMachineDetailsNetworkCtrl",["$scope","virtualMachinesMgr","$filter","dispatcher",function(a,b,c,d){a.__name="VirtualMachineDetailsNetworkCtrl",a.currentVirtualMachine=b.currentVirtualMachine,a.virtualMachineNICSGridOptions={data:"currentVirtualMachine.clientData.nics",columnDefs:[{field:"ip",displayName:c("translate")("virtualmachine.details.network.ipaddress")},{field:"mac",displayName:c("translate")("virtualmachine.details.network.mac")},{field:"clientData.network.name",displayName:c("translate")("virtualmachine.details.network.vlan")}],multiSelect:!1};var e=function(){b.getVirtualMachineNICS(a.currentVirtualMachine)};d.on("currentVirtualMachine.change",e,a),e()}]).controller("VirtualMachineDetailsStorageCtrl",["$scope","virtualMachinesMgr","$filter","dispatcher","gridTemplates",function(a,b,c,d,e){a.__name="VirtualMachineDetailsStorageCtrl",a.currentVirtualMachine=b.currentVirtualMachine,a.virtualMachineVolumesGridOptions={data:"currentVirtualMachine.clientData.virtualDisks",columnDefs:[{field:"sequence",displayName:c("translate")("virtualmachine.details.storage.attachmentorder")},{field:"name",displayName:c("translate")("virtualmachine.details.storage.name"),cellTemplate:e.primaryDiskCellTemplate},{field:"clientData.tier.name",displayName:c("translate")("virtualmachine.details.storage.tier")},{field:"clientData.sizeInMb",displayName:c("translate")("virtualmachine.details.storage.totalsize"),cellTemplate:e.sizeUnitCellTemplate},{field:"clientData.type",displayName:c("translate")("virtualmachine.details.storage.type")}],multiSelect:!1};var f=function(){b.getVirtualMachineVirtualDisks(a.currentVirtualMachine)};d.on("currentVirtualMachine.change",f,a),f()}]).controller("BlockVirtualMachineCtrl",["$scope","virtualMachinesMgr",function(a,b){a.currentVirtualMachine=b.currentVirtualMachine;var c=function(){a.closePopup()};a.onShown=function(){a.currentVirtualMachine.clientData.protectedCause=""},a.onSubmit=function(){b.blockVirtualMachine(a.currentVirtualMachine,c)}}]),angular.module("backupCreate",[]).controller("BackupCreateCtrl",["$scope","backupsMgr","virtualMachinesMgr","utils","$filter","server",function(a,b,c,d,e,f){function g(b,c){var e=b.backupOptions[c];if(a.formData[c]={timeUTC:j},console.log(c,a.formData[c].timeUTC),!d.isEmptyObject(e)&&!d.isEmptyObject(e.time)){var f=e.time.split(" ");f.length>0&&(a.formData[c].timeUTC=f[f.length-1],f.pop(),a.formData[c].timeDate=f.join(" "))}}function h(){var a,b=(new Date).getTimezoneOffset();console.log("timeoffset ",b),a=b>0?"-":"+";var c=Math.floor(Math.abs(b)/60);return 10>c&&(a+="0"),a+=c,c=Math.floor(Math.abs(b)%60),10>c&&(a+="0"),a+=c}function i(){a.backupsSelecteds.dayMonday=!1,a.backupsSelecteds.dayTuesday=!1,a.backupsSelecteds.dayWednesday=!1,a.backupsSelecteds.dayThursday=!1,a.backupsSelecteds.dayFriday=!1,a.backupsSelecteds.daySaturday=!1,a.backupsSelecteds.daySunday=!1}a.__name="BackupCreateCtrl",a.availableBackupOptions=b.availableBackupOptions,a.disks=a.virtualMachine.clientData.virtualDisks,a.currentBackup=b.currentBackup,a.backupsSelecteds=b.backupsSelecteds,a.formData={},a.timeUTCs=d.timeUTCs;var j=h();a.isBackupOptionAvailable=function(b,c){var d=!1;return angular.forEach(a.availableBackupOptions,function(a){var e=f.getLinkByRel(a.links,"backup");e.title===b&&(d=$.inArray(c,a.attributes)>-1)}),d},a.returnBackupOptionsLength=function(b){var c=0;return angular.forEach(a.availableBackupOptions,function(a){var d=f.getLinkByRel(a.links,"backup");d.title===b&&(c=a.attributes.length)}),c},a.modifyOption=function(b,c,d){if(console.log("modify:",b,c,d),b)switch(c){case"snapshot":a.currentBackup.snapshot[d]={disks:[]};break;case"filesystem":a.currentBackup.filesystem[d]={paths:[]};break;case"complete":a.currentBackup.complete[d]={disks:[]}}else switch("weekly_planned"==d&&i(),c){case"snapshot":delete a.currentBackup.snapshot[d];break;case"filesystem":delete a.currentBackup.filesystem[d];break;case"complete":delete a.currentBackup.complete[d]}},a.returnSelectedDisks=function(b){var c=[];return b&&angular.forEach(b.disks,function(b){c.push(e("getElementByParameter")(a.disks,{element:b,attribute:"id"}))}),c},a.initVars=function(c){a.virtualMachine.clientData.backupsEnabled=!0,c.backupOptions=b.currentBackup[c.type]?b.currentBackup[c.type]:{},a.backupsSelecteds.definedhour=!d.isEmptyObject(c.backupOptions.defined_hour),a.backupsSelecteds.hourly=!d.isEmptyObject(c.backupOptions.hourly),a.backupsSelecteds.daily=!d.isEmptyObject(c.backupOptions.daily),a.backupsSelecteds.weeklyplanned=!d.isEmptyObject(c.backupOptions.weekly_planned),a.backupsSelecteds.monthly=!d.isEmptyObject(c.backupOptions.monthly),a.backupsSelecteds.weeklyplanned?(a.backupsSelecteds.dayMonday=c.backupOptions.weekly_planned.monday,a.backupsSelecteds.dayTuesday=c.backupOptions.weekly_planned.tuesday,a.backupsSelecteds.dayWednesday=c.backupOptions.weekly_planned.wednesday,a.backupsSelecteds.dayThursday=c.backupOptions.weekly_planned.thursday,a.backupsSelecteds.dayFriday=c.backupOptions.weekly_planned.friday,a.backupsSelecteds.daySaturday=c.backupOptions.weekly_planned.saturday,a.backupsSelecteds.daySunday=c.backupOptions.weekly_planned.sunday):i(),g(c,"defined_hour"),g(c,"daily"),g(c,"weekly_planned"),g(c,"monthly"),a.formData.backupOptions=c.backupOptions},a.modifyOptionWeek=function(a,c,d){var e=b.currentBackup[a];e.weekly_planned||(e.weekly_planned={}),e.weekly_planned[c]=d},a.changeFormTime=function(b){var c=a.formData[b];d.isEmptyObject(c)||(a.formData.backupOptions[b].time=c.timeDate+" "+c.timeUTC)}}]).controller("SnapshotBackupCtrl",["$scope","backupsMgr","dispatcher",function(a,b,c){a.__name="SnapshotBackupCtrl",a.type="snapshot",a.initVars(a),c.on("currentBackup.change",function(){a.initVars(a)},a)}]).controller("FilesystemBackupCtrl",["$scope","backupsMgr","dispatcher",function(a,b,c){a.__name="FilesystemBackupCtrl",a.type="filesystem",a.initVars(a),c.on("currentBackup.change",function(){a.initVars(a)},a)}]).controller("CompleteBackupCtrl",["$scope","backupsMgr","dispatcher",function(a,b,c){a.__name="CompleteBackupCtrl",a.type="complete",a.initVars(a),c.on("currentBackup.change",function(){a.initVars(a)},a)}]).controller("SelectDisksCtrl",["$scope","$filter","utils","gridTemplates","virtualMachinesMgr",function(a,b,c,d,e){function f(a,b){a&&(a.disks?a.disks.length=0:a.disks=[],angular.forEach(b,function(b){a.disks.push(b.id.toString())}))}function g(){var b=[],d=a.backupOptions[a.popupData];return c.isEmptyObject(d)||(b=d.disks),b}a.__name="SelectDisksCtrl",a.disksGridData={columnDefs:[{field:"",displayName:"",cellTemplate:d.selectedCellTemplate,width:50},{field:"name",displayName:b("translate")("virtualmachine.details.storage.name"),cellTemplate:d.primaryDiskCellTemplate},{field:"clientData.tier.name",displayName:b("translate")("virtualmachine.details.storage.tier")},{field:"sizeInMb",displayName:b("translate")("virtualmachine.details.storage.totalsize"),cellTemplate:"<p>{{row.getProperty(col.field) | sizeUnit:false}}</p>"},{field:"clientData.type",displayName:b("translate")("virtualmachine.details.storage.type")}],enableRowSelection:!1,data:"disks"},a.onShown=function(){var d=g();angular.forEach(a.virtualMachine.clientData.virtualDisks,function(a){var e=b("getElementByParameter")(d,{element:a.id.toString()});a.clientData.selected=!c.isEmptyObject(e)})},a.onSubmit=function(){var c=b("filterSelectedClientData")(a.virtualMachine.clientData.virtualDisks);f(a.backupOptions[a.popupData],c),a.closePopup()},a.onHidden=function(){}}]).controller("SelectPathsCtrl",["$scope","utils",function(a,b){function c(){var c=[],d=a.backupOptions[a.popupData];return b.isEmptyObject(d)||b.isEmptyObject(d.paths)||(c=angular.copy(d.paths)),c}function d(a,b){a&&(a.paths?a.paths.length=0:a.paths=[],angular.forEach(b,function(b){a.paths.push(b)}))}a.__name="SelectPathsCtrl",a.paths=[],a.pathToAdd="",a.addPath=function(){a.pathToAdd&&a.pathToAdd.length>0&&(a.paths.push(a.pathToAdd),a.pathToAdd="")},a.removePath=function(b){var c=a.paths.indexOf(b);c>-1&&a.paths.splice(c,1)},a.onShown=function(){a.paths=c()},a.onSubmit=function(){d(a.backupOptions[a.popupData],a.paths),a.closePopup()},a.onHidden=function(){}}]).controller("LatestBackupsCtrl",["$scope","$filter","backupsMgr","uModals","utils",function(a,b,c,d,e){a.__name="LatestBackupsCtrl",a.backupResults=c.currentBackup.backupResults;var f=function(){a.$$phase||a.$apply()};a.restoreBackup=function(e){d.showAlert({scope:a,message:b("translate")("virtualmachine.edit.backup.restore.confirm.message"),title:b("translate")("virtualmachine.edit.backup.restore.confirm.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:b("translate")("globals.cancel"),confirmLabel:b("translate")("globals.confirm"),closeOnCancel:!0,confirmFn:function(){c.restoreBackup(a.virtualMachine,e,f)}})},a.isRestoreBackupEnabledByStatus=function(a){var b=!1;return a&&(b=!e.isEmptyObject(a.status)&&("done"===a.status.toLowerCase()||"completed"===a.status.toLowerCase()),b=b&&(e.isEmptyObject(a.restoreInfo)||!e.isEmptyObject(a.restoreInfo.result)&&("success"===a.restoreInfo.result.toLowerCase()||"failed"===a.restoreInfo.result.toLowerCase()))),b};var g='<div class="ngCellText" ng-class="col.colIndex()" data-ng-show="(row.entity | canBackupDoRestore) && (\'VAPP_PERFORM_ACTIONS\' | isGranted)"><a data-ng-click="restoreBackup(row.entity)">{{ \'virtualmachine.edit.backup.create.grid.button.restore\' | translate }}</a></div><div class="ngCellText" ng-class="col.colIndex()" data-ng-hide="(row.entity | canBackupDoRestore) && (\'VAPP_PERFORM_ACTIONS\' | isGranted)">{{ (\'virtualmachine.edit.backup.restore.info.\' + row.entity.restore) | translate }}</div>';a.latestBackupsGridData={columnDefs:[{field:"date",displayName:b("translate")("virtualmachine.edit.backup.create.grid.head.date"),width:150},{field:"name",displayName:b("translate")("virtualmachine.edit.backup.create.grid.head.name")},{field:"type",displayName:b("translate")("virtualmachine.edit.backup.create.grid.head.type")},{field:"size",displayName:b("translate")("virtualmachine.edit.backup.create.grid.head.size"),cellTemplate:"<p>{{row.getProperty(col.field) | sizeUnit:false}}</p>"},{field:"status",displayName:b("translate")("virtualmachine.edit.backup.create.grid.head.status")},{field:"",displayName:b("translate")("virtualmachine.edit.backup.create.grid.head.action"),cellTemplate:g}],data:"backupResults",enableRowSelection:!1}}]).controller("RestoredBackupsCtrl",["$scope","$filter","backupsMgr","utils",function(a,b,c,d){a.__name="RestoredBackupsCtrl",a.restoredBackups=b("filterByRestored")(c.currentBackup.backupResults),a.getRestoreInfoResultLabel=function(a){var c=b("translate")("backupconfiguration.restore.result.inprogress");if(a&&a.result){var e="backupconfiguration.restore.result."+a.result.toLowerCase();d.hasTranslate(e)&&(c=b("translate")(e))}return c};var e='<div class="ngCellText" ng-class="col.colIndex()">{{ getRestoreInfoResultLabel(row.entity) }}</div>';a.restoredBackupsGridData={columnDefs:[{field:"date",displayName:b("translate")("virtualmachine.edit.backup.restore.create.grid.head.date"),width:150},{field:"name",displayName:b("translate")("virtualmachine.edit.backup.create.grid.head.name")},{field:"type",displayName:b("translate")("virtualmachine.edit.backup.create.grid.head.type")},{field:"size",displayName:b("translate")("virtualmachine.edit.backup.create.grid.head.size"),cellTemplate:"<p>{{row.getProperty(col.field) | sizeUnit:false}}</p>"},{field:"result",displayName:b("translate")("virtualmachine.edit.backup.create.grid.head.status"),cellTemplate:e}],data:"restoredBackups",enableRowSelection:!1}}]),angular.module("virtualMachineEdit",["hardDisk","backupCreate","AddIPtoVM"]).controller("VirtualMachineEditCtrl",["$scope","refreshMgr","virtualMachinesMgr","virtualAppliancesMgr","virtualDatacentersMgr","networksMgr","volumesMgr","enterprisesMgr","commonsMgr","systemPropertiesMgr","backupsMgr","loadBalancersMgr","server","utils","dispatcher","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.__name="VirtualMachineEditCtrl",a.userEnterprise=h.userEnterprise,a.gateways=f.gateways,a.checkDvd={selected:!1},a.hypervisorCompatible=!1,a.hardwareProfiles=i.hardwareProfiles,a.selectedHardwareProfile={},a.ramUnitSelector={conversion:void 0},a.ramUnits=n.unitsSelector,a.selectedVirtualDisk={},a.onShown=function(){b.stopTimer(),a.popupElement=a.getPopupElement(),a.virtualMachine=angular.copy(c.currentVirtualMachine),a.virtualMachineTemplate=a.virtualMachine.clientData.virtualMachineTemplate,a.virtualAppliance=angular.copy(d.currentVirtualAppliance),a.currentVirtualAppliance=angular.copy(d.currentVirtualAppliance),a.checkDvd.selected=!n.isEmptyObject(a.virtualMachine.dvd),a.removedNics=[],a.tabsloaded={},a.virtualMachine.clientData.layerBlocked=!0;var e=n.formatSizeInMb(a.virtualMachine.ram);a.ramUnitSelector.conversion=n.unitsSelector[e.units].conversion,a.virtualMachine.ram=e.size,a.hypervisorType=p("getElementByParameter")(i.hypervisorTypes,{element:a.virtualAppliance.clientData.virtualDatacenter.hypervisorType,attribute:"name"}),a.hypervisorCompatible=!a.hypervisorType.constraints.extra_hard_disk||1==a.hypervisorType.constraints.extra_hard_disk,a.virtualAppliance.clientData.virtualDatacenter.clientData.isPublic?(a.hardwareProfileProviderId=a.virtualMachine.clientData.hardwareProfile.name,a.onHardwareProfileChange(a.hardwareProfileProviderId),a.firewallViewDisplayed=p("operationIsGranted")(a.virtualAppliance.clientData.virtualDatacenter.hypervisorType,"firewall","listFirewallPolicies")):a.firewallViewDisplayed="1"==j.systemProperties.general["client.main.enableFirewallForPrivateVDC"].value,a.virtualAppliance.clientData.virtualDatacenter.hypervisorType?a.loadBalancersViewDisplayed=p("operationIsGranted")(a.virtualAppliance.clientData.virtualDatacenter.hypervisorType,"loadbalancers"):a.loadBalancersViewDisplayed="1"==j.systemProperties.general["client.main.enableLoadBalancerForPrivateVDC"].value,a.privateNetworkViewDisplayed=p("operationIsGranted")(a.virtualAppliance.clientData.virtualDatacenter.hypervisorType,"networking"),a.monitoredEnabled=p("operationIsGranted")(a.virtualAppliance.clientData.virtualDatacenter.hypervisorType,"virtualmachinemetrics","getMeasures"),a.monitoringLevelsEnabled=p("operationIsGranted")(a.virtualAppliance.clientData.virtualDatacenter.hypervisorType,"virtualmachinemetrics","setMonitoringLevel"),c.getVirtualMachineLoadBalancers(a.virtualMachine)},a.onHidden=function(){"LOCKED"==a.virtualAppliance.state?b.initVMTimer():b.initTimer()},a.onHardwareProfileChange=function(b){if(a.selectedHardwareProfile=angular.copy(p("getElementByParameter")(a.hardwareProfiles,{element:b,attribute:"providerId"})),!n.isEmptyObject(a.selectedHardwareProfile)&&""!=a.selectedHardwareProfile.providerId){m.removeLinkByRel(a.virtualMachine.links,"hardwareprofile");var c=m.createLinkByRel(a.selectedHardwareProfile.links,"self","hardwareprofile");a.virtualMachine.links.push(c)}},a.returnHardwareProfileLabel=function(b){var c=b;return angular.forEach(a.virtualMachineTemplate.links,function(a){"hardwareprofile"==a.rel&&a.title==b&&(c+=" ("+p("translate")("virtualmachine.create.hardwareprofile.recommended")+")")}),c},a.deleteVirtualDisk=function(b,c){if(m.removeLinkByRel(a.virtualMachine.links,"disk"+b.sequence),c){switch(b.clientData.type){case p("translate")("virtualmachine.details.storage.type.harddisk"):a.virtualMachine.clientData.hardDisks.splice(a.virtualMachine.clientData.hardDisks.indexOf(b));break;case p("translate")("virtualmachine.details.storage.type.volume"):a.virtualMachine.clientData.volumes.splice(a.virtualMachine.clientData.volumes.indexOf(b))}var d=p("getElementByParameter")(a.virtualMachine.clientData.virtualDisks,{element:b.sequence,attribute:"sequence"}),e=a.virtualMachine.clientData.virtualDisks.indexOf(d);a.virtualMachine.clientData.virtualDisks.splice(e,1)}if("VOLUME"==b.clientData.virtualDiskType){var d=p("getElementByParameter")(g.volumes,{element:b.id,attribute:"id"});d&&(d.clientData.temporalState="DETACHED")}angular.copy({},a.selectedVirtualDisk)};var q=function(){o.dispatch("virtualMachine.edited"),a.closePopup(a.popupElement)},r=function(){p("isGranted")("ASSIGN_LOADBALANCERS")&&a.editedVirtualMachine.clientData.loadBalancersEnabled?(a.changedElements=0,angular.forEach(a.editedVirtualMachine.clientData.loadBalancers,function(b){b.clientData.original&&"removed"==b.clientData.action?(a.changedElements++,l.modifyLoadBalancerVirtualMachines(b,a.editedVirtualMachine,!1,s)):b.clientData.original||"added"!=b.clientData.action||(a.changedElements++,l.modifyLoadBalancerVirtualMachines(b,a.editedVirtualMachine,!0,s)),a.changedElements++,s()})):s()},s=function(){a.changedElements--,(a.changedElements<=0||isNaN(a.changedElements))&&t()},t=function(){p("isGranted")("VAPP_MANAGE_BACKUP")&&a.editedVirtualMachine.clientData.backupsEnabled?k.editVirtualMachineBackupOptions(a.editedVirtualMachine,k.currentBackup,u):u()},u=function(){p("isGranted")("USERS_ENABLE_DISABLE_VM_METRICS")&&a.editedVirtualMachine.clientData.monitoringDisplayed?(a.editedVirtualMachine.monitoringLevel=a.editedVirtualMachine.clientData.monitoringLevel,c.editVirtualMachineMonitoringMetrics(a.editedVirtualMachine,v)):x()},v=function(){a.editedVirtualMachine.clientData.originalMonitoringLevel!=a.editedVirtualMachine.clientData.monitoringLevel?c.editVirtualMachineMonitoringLevel(a.editedVirtualMachine,w):w()},w=function(){a.editedVirtualMachine.clientData.originalMonitored!=a.editedVirtualMachine.monitored?c.editVirtualMachineMonitored(a.editedVirtualMachine,x):x();
},x=function(){a.editedVirtualMachine.clientData.chefViewEnabled?c.editChefAttributes(a.editedVirtualMachine,a.editedVirtualMachine.clientData.availableChefComponents,y):y()},y=function(){"ON"!=a.editedVirtualMachine.state&&"PAUSED"!=a.editedVirtualMachine.state?(a.checkDvd.selected?n.isEmptyObject(a.editedVirtualMachine.dvd)&&(a.editedVirtualMachine.dvd={links:[]}):a.editedVirtualMachine.dvd=null,a.editedVirtualMachine.ram=a.editedVirtualMachine.ram*parseInt(a.ramUnitSelector.conversion),c.editVirtualMachine(a.editedVirtualMachine,q)):q()};a.onSubmit=function(){if(a.editedVirtualMachine=angular.copy(a.virtualMachine),"ON"==a.editedVirtualMachine.state||"PAUSED"==a.editedVirtualMachine.state)p("isGranted")("ASSIGN_FIREWALLS")&&a.editedVirtualMachine.clientData.firewallsEnabled?c.editVirtualMachineFirewalls(a.editedVirtualMachine,r):r();else{z();var b=function(){void 0!==a.editedVirtualMachine.clientData.startupScript?c.editStartupScript(a.editedVirtualMachine,d):d()},d=function(){p("isGranted")("ASSIGN_FIREWALLS")&&a.editedVirtualMachine.clientData.firewallsEnabled?c.editVirtualMachineFirewalls(a.editedVirtualMachine,t):t()},e=0,f=0,h=function(c){f++;var d=m.createLinkByRel(c.links,"edit","disk"+c.sequence);a.editedVirtualMachine.links.push(d),f===e&&b()};angular.forEach(a.editedVirtualMachine.clientData.hardDisks,function(b){if(0===b.links.length&&void 0===b.id||b.clientData.edited)if(b.clientData.edited){var c=m.getLinkByRel(a.editedVirtualMachine.links,"disk"+b.sequence);c.length=b.sizeInMb}else e++,g.createHardDisk(a.virtualAppliance.clientData.virtualDatacenter,b,h)}),0===e&&b()}};var z=function(){if(a.editedVirtualMachine.clientData.gateway.id){var b=m.createLinkByRel(a.editedVirtualMachine.clientData.gateway.links,"edit","network_configuration");if(b.href){var c=m.getLinkByRel(a.editedVirtualMachine.links,"network_configuration");n.isEmptyObject(c)||m.removeLinkByRel(a.editedVirtualMachine.links,"network_configuration"),a.editedVirtualMachine.links.push(b)}}else if(m.removeLinkByRel(a.editedVirtualMachine.links,"network_configuration"),a.editedVirtualMachine.clientData.gateway.gateway&&""!=a.editedVirtualMachine.clientData.gateway.gateway){var b=m.createLinkByRel(a.editedVirtualMachine.clientData.gateway.links,"network_configuration","network_configuration");a.editedVirtualMachine.links.push(b)}}}]).controller("VirtualMachineEditGeneralInfoCtrl",["$scope","configMgr",function(a,b){a.__name="VirtualMachineEditGeneralInfoCtrl",a.keyMaps=b.config["config.keymaps"]}]).controller("VirtualMachineEditNetworkCtrl",["$scope","networksMgr","enterprisesMgr","virtualMachinesMgr","gridTemplates","server","safeApply","paginationHelper","$timeout","$filter","dispatcher","utils",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){switch(a){case"UNMANAGED":return"application/vnd.abiquo.unmanagedip+json";case"EXTERNAL":return"application/vnd.abiquo.externalip+json";case"INTERNAL":return"application/vnd.abiquo.privateip+json";case"PUBLIC":return"application/vnd.abiquo.publicip+json"}return""}function n(){var c=f.createLinkByRel(a.currentNetwork.links,"ips","self");c.type=m(a.currentNetwork.type),c.title="newIp";var d={links:[c],available:!0,id:0,ip:j("translate")("virtualmachine.edit.network.unmanagedip"),ipv6:a.currentNetwork.ipv6,networkName:a.currentNetwork.name};b.ips.unshift(new b.IP(d,a.currentNetwork))}function o(){var c=f.getLinkByType(a.currentNetwork.links,"application/vnd.abiquo.vlan+json");a.removedNics.forEach(function(a){var d=f.getLinkByType(a.links,"application/vnd.abiquo.vlan+json");if(d.href==c.href){var e=j("getElementById")(b.ips,a.id);l.isEmptyObject(e)&&b.ips.splice(1,0,a)}})}function p(){l.isEmptyObject(a.currentNetwork)||b.getIpsByNetwork(a.currentNetwork,null,h.ipPaginator.param,h.ipPaginator.filter,t)}function q(b){if(x(b)){var c=angular.copy(b);d.addNICToVirtualMachine(a.virtualMachine,c),"public"==c.clientData.type?w(c):v(),g(a)}}a.__name="VirtualMachineEditNetworkCtrl",a.networks=b.networks,a.ips=b.ips,a.nics=a.virtualMachine.clientData.nics,a.ipPaginationParam=h.ipPaginator.param,a.currentNetwork={},a.onRemoveGatewayClick=function(){a.virtualMachine.clientData.gateway={}},a.deleteRow=function(b){f.removeLinkByRel(a.virtualMachine.links,"nic"+b.entity.sequence),a.virtualMachine.clientData.nics.splice(b.rowIndex,1);var c=j("getElementById")(a.removedNics,b.entity.id);l.isEmptyObject(c)&&a.removedNics.push(b.entity),p(),0==a.virtualMachine.clientData.nics.length&&a.onRemoveGatewayClick()};var r=function(){0==a.virtualMachine.clientData.nics.length&&d.getVirtualMachineNICS(a.virtualMachine),a.onInternalNetworksTabClick(),b.getAvailableVirtualMachineGateways(a.virtualMachine,s)},s=function(){angular.forEach(a.gateways,function(b){b.used&&i(function(){a.virtualMachine.clientData.gateway=angular.copy(b)})})};a.onAvailableIpsMouseDown=function(){"ON"==a.virtualMachine.state&&l.toastrWarning(j("translate")("virtualmachine.edit.network.availableip.warning.mv.on"))},a.getPage=function(b){h.ipPaginator.param.startwith=(b-1)*h.ipPaginator.param.limit,"public"===a.vmNetworkTab?a.onPublicNetworksTabClick():a.onNetworkClick(a.currentNetwork)};var t=function(a){n(),o(),h.ipPaginator.param.totalSize=a.totalSize},u=function(a){o(),h.ipPaginator.param.totalSize=a.totalSize},v=function(){var c=!0;if(angular.forEach(a.gateways,function(b){b.gateway==a.currentNetwork.gateway&&(c=!1)}),c){var d={gateway:a.currentNetwork.gateway,id:a.currentNetwork.id,links:[f.createLinkByRel(a.currentNetwork.links,"network_configuration","edit")]};b.gateways.push(d)}},w=function(c){var d={links:c.links,rel:"publicnetwork"};f.getByRel(d,function(c){var d=!0;if(angular.forEach(a.gateways,function(a){a.gateway==c.gateway&&(d=!1)}),d){var e={gateway:c.gateway,id:c.id,links:[f.createLinkByRel(c.links,"network_configuration","edit")]};b.gateways.push(e)}})},x=function(b){var c=!1;return angular.forEach(a.virtualMachine.clientData.nics,function(a){a.ip==b.ip&&b.ip!=j("translate")("virtualmachine.edit.network.unmanagedip")&&(c=!0)}),!c};a.onSequenceClick=function(b){var c=f.getLinkByRel(a.virtualMachine.links,"nic"+b.sequence);angular.forEach(a.nics,function(c){if(c.sequence==b.clientData.sequence){var d=f.getLinkByRel(a.virtualMachine.links,"nic"+c.sequence);c.sequence=c.clientData.sequence=b.sequence,d.rel="nic"+c.sequence}}),b.sequence=b.clientData.sequence,c.rel="nic"+b.sequence,b.clientData.sequenceEdited=!1},a.nicsGridOptions={data:"nics",columnDefs:[{field:"id",displayName:"",width:25,headerCellTemplate:e.deleteHeaderTemplate,cellTemplate:e.deleteCellTemplate},{field:"sequence",width:80,displayName:j("translate")("virtualmachine.edit.network.nic"),cellTemplate:e.reorderNicSequenceCell},{field:"ip",displayName:j("translate")("virtualmachine.edit.network.ipaddress")},{field:"mac",displayName:j("translate")("virtualmachine.edit.network.mac")},{field:"clientData.network.name",displayName:j("translate")("virtualmachine.edit.network.vlan")}],enableRowSelection:!1},a.onInternalNetworksTabClick=function(){b.ips.length=0,a.vmNetworkTab="private",b.getPrivateNetworksByVirtualDataCenter(a.virtualAppliance.clientData.virtualDatacenter)},a.onExternalNetworksTabClick=function(){b.ips.length=0,a.vmNetworkTab="external",b.getExternalNetworksByVirtualDataCenter(a.virtualAppliance.clientData.virtualDatacenter)},a.onPublicNetworksTabClick=function(){a.currentNetwork={},h.ipPaginator.param.onlyavailable=!0,b.getPublicNetworkIps(a.virtualAppliance.clientData.virtualDatacenter,h.ipPaginator.param,h.ipPaginator.filter,u)},a.onNetworkClick=function(b){a.currentNetwork=b,h.ipPaginator.param.onlyAvailable=!0,h.ipPaginator.param.free=!0,p()},a.onGatewayChange=function(){if(""!=a.virtualMachine.clientData.gateway.gateway){var b=j("getElementByParameter")(a.gateways,{element:a.virtualMachine.clientData.gateway.gateway,attribute:"gateway"});angular.extend(a.virtualMachine.clientData.gateway,b),a.virtualMachine.clientData.gateway.id||d.getVirtualMachineNetworkConfiguration(a.virtualMachine)}},a.dropIpOnListListener=function(a,b){if(void 0!==a.data("$scope").ip){var c=a.data("$scope").ip;q(c)}},a.dropIpOnAcceptListener=function(a,b){return void 0!==a.data("$scope").ip},a.$on("ngGridEventRows",function(b){g(a,a.nicsGridOptions)}),a.$on("ngGridEventData",function(a){l.refreshLayout()}),k.on("addips.ip.to.add",function(a,b){if(b&&b.data&&b.data.length>0)for(var c=0;c<b.data.length;c++)q(b.data[c]);else l.toastrWarning(j("translate")("networklist.ip.add.error.exists",{ip:b.data.ip}))},a),r()}]).controller("VirtualMachineEditFirewallsCtrl",["$scope","virtualMachinesMgr","firewallsMgr","gridTemplates","utils","server","$filter",function(a,b,c,d,e,f,g){a.__name="VirtualMachineEditFirewallsCtrl",a.firewalls=c.firewalls;var h=function(b){angular.forEach(a.virtualMachine.clientData.firewalls,function(a){angular.forEach(b.collection,function(b){a.id==b.id&&(b.clientData.selected=!0)})}),angular.extend(c.firewalls,b.collection)},i=function(b){angular.forEach(a.virtualMachine.clientData.firewalls,function(c){b.id==c.id&&a.virtualMachine.clientData.firewalls.splice(a.virtualMachine.clientData.firewalls.indexOf(c),1)})};a.onItemEnabledChange=function(b){var c=f.createLinkByRel(b.links,"edit","firewall");if(b.clientData.selected){a.virtualMachine.links.push(c);var d=f.getClientdataFromLinksByRel([c],"firewall");a.virtualMachine.clientData.firewalls.push(d)}else f.removeLinkByRel(a.virtualMachine.links,"firewall",c.title),i(b)},a.firewallsGridOptions={data:"firewalls",columnDefs:[{field:"clientData.selected",width:70,displayName:g("translate")("firewalls.heading.selected"),cellTemplate:d.selectUpdatedCellTemplate},{field:"name",displayName:g("translate")("firewalls.heading.name")},{field:"providerId",displayName:g("translate")("firewalls.heading.providerid")},{field:"clientData.virtualDatacenter.name",displayName:g("translate")("firewalls.heading.vpcid")},{field:"description",displayName:g("translate")("firewalls.heading.description"),sortable:!1}],multiSelect:!1};var j=function(){a.virtualMachine.clientData.firewallsEnabled=!0,c.getAvailableFirewallsByVdc(a.currentVirtualAppliance.clientData.virtualDatacenter,{},{},h)};j()}]).controller("VirtualMachineEditStorageCtrl",["$scope","volumesMgr","virtualMachinesMgr","systemPropertiesMgr","dispatcher","gridTemplates","utils","server","$filter","$timeout","paginationHelper",function(a,b,c,d,e,f,g,h,i,j,k){a.__name="VirtualMachineEditStorageCtrl",a.availableVolumes=b.volumes,a.systemProperties=d.systemProperties,a.volFilter=k.volPaginator.filter,k.volPaginator.resetParam();var l=function(b){b.selected&&(angular.copy(b.entity,a.selectedVirtualDisk),b.entity.clientData.type===i("translate")("virtualmachine.details.storage.type.harddisk")?a.removeAllowed=i("isGranted")("MANAGE_HARD_DISKS"):a.removeAllowed=!0)};a.onSequenceClick=function(b){0==b.clientData.sequence&&(b.clientData.sequence=1);var c=h.getLinkByRel(a.virtualMachine.links,"disk"+b.sequence);angular.forEach(a.virtualMachine.clientData.virtualDisks,function(c){if(c.sequence==b.clientData.sequence){var d=h.getLinkByRel(a.virtualMachine.links,"disk"+c.sequence);c.sequence=b.sequence,c.clientData.sequence=b.sequence,d.rel="disk"+c.sequence}}),b.sequence=b.clientData.sequence,c.rel="disk"+b.sequence,b.clientData.sequenceEdited=!1},a.storageGridOptions={data:"virtualMachine.clientData.virtualDisks",columnDefs:[{field:"sequence",width:80,displayName:i("translate")("virtualmachine.details.storage.attachmentorder"),cellTemplate:f.reorderSequenceCell},{field:"name",displayName:i("translate")("virtualmachine.details.storage.name"),cellTemplate:f.primaryDiskCellTemplate},{field:"clientData.tier.name",displayName:i("translate")("virtualmachine.details.storage.tier")},{field:"clientData.sizeInMb",displayName:i("translate")("virtualmachine.details.storage.totalsize"),cellTemplate:f.sizeUnitCellTemplate},{field:"clientData.type",displayName:i("translate")("virtualmachine.details.storage.type")}],multiSelect:!1,afterSelectionChange:l};var m=function(){b.getAvailableVolumesByVdc(a.virtualAppliance.clientData.virtualDatacenter,{},k.volPaginator.filter)},n=function(){a.virtualMachine.clientData&&a.virtualMachine.clientData.virtualDisks&&0!=a.virtualMachine.clientData.virtualDisks.length||c.getVirtualMachineVirtualDisks(a.virtualMachine)};a.dropVolumeOnListListener=function(b,c,d,e){var f=b.data("$scope");if(void 0!==f.availableVolume){var i=f.availableVolume;a.virtualMachine.clientData.volumes.push(i),a.virtualMachine.clientData.virtualDisks.push(i),i.sequence=g.returnSequence(a.virtualMachine.clientData.virtualDisks,"sequence"),i.clientData.sequence=i.sequence;var j=h.createLinkByRel(i.links,"edit","disk"+i.sequence);a.virtualMachine.links.push(j),i.clientData.temporalState="ATACHED",a.$apply()}},a.dropVolumeOnAcceptListener=function(a,b){var c=a.data("$scope");return c&&void 0!==c.availableVolume},a.onVolFilterSubmit=function(){k.volPaginator.resetParam(),m()},m(),n(),e.on(["volume.created","volume.deleted"],function(){m(),n()},a),e.on(["volume.edited"],function(b,c){var d=i("getElementById")(a.virtualMachine.clientData.virtualDisks,c.volume.id);g.isEmptyObject(d)||(angular.extend(d,c.volume),a.storageGridOptions.selectRow(0,!0))},a)}]).controller("VirtualMachineEditBackupCtrl",["$scope","backupsMgr","virtualMachinesMgr",function(a,b,c){a.__name="VirtualMachineEditBackupCtrl",a.backupOptions=b.backupOptions,a.availableBackupOptions=b.availableBackupOptions,a.backupTab={value:"snapshot"};var d=function(){a.virtualMachine.clientData&&a.tabsloaded.backup||(a.backupTab.value=a.currentVirtualAppliance.clientData.defaultBackupTab,b.getVirtualMachineBackupOptions(a.virtualMachine),e(),a.tabsloaded.backup=!0)},e=function(){a.virtualMachine.clientData&&a.virtualMachine.clientData.virtualDisks&&0!=a.virtualMachine.clientData.virtualDisks.length||c.getVirtualMachineVirtualDisks(a.virtualMachine)};d()}]).controller("VirtualMachineEditChefCtrl",["$scope","virtualMachinesMgr","safeApply","gridTemplates","$timeout","$filter","utils",function(a,b,c,d,e,f,g){a.__name="VirtualMachineEditChefCtrl",a.sortInfo={fields:["priority"],directions:["asc"]},a.updateAvailableRecipes=function(b){a.virtualMachine.clientData.filteredAvailableChefComponents=f("filterIndividualComponents")(angular.copy(a.virtualMachine.clientData.originalChefComponents),b),g.refreshLayout()},a.updateSelectedRecipes=function(b){var c=f("getElementByParameter")(a.virtualMachine.clientData.availableChefComponents,{element:b.name,attribute:"name"}),d=f("getElementByParameter")(a.virtualMachine.clientData.originalChefComponents,{element:b.name,attribute:"name"});b.selected?(b.priority=g.returnSequence(a.virtualMachine.clientData.availableChefComponents,"priority"),a.virtualMachine.clientData.availableChefComponents.push(b)):a.virtualMachine.clientData.availableChefComponents.splice(a.virtualMachine.clientData.availableChefComponents.indexOf(c),1),c.selected=b.selected,d.selected=b.selected};var h=function(b){a.virtualMachine.clientData.loadingRecipes=!1,a.virtualMachine.clientData.availableChefComponents=f("filterSelected")(angular.copy(b)),a.virtualMachine.clientData.originalChefComponents=angular.copy(b),a.updateAvailableRecipes(!1),e(function(){c(a)},5e3)},i=function(){a.virtualMachine.clientData.loadingRecipes=!0,a.virtualMachine.clientData.chefViewEnabled=!0,b.getChefAttributes(a.virtualMachine,h)},j='<div class="row-fluid span9"><input id="recipe{{row.rowIndex}}" u-checkbox type="checkbox"  data-ng-model="row.entity.selected" data-ng-change="updateSelectedRecipes(row.entity)"> <label id="recipe{{row.rowIndex}}.label" class="checkbox inline" for="recipe{{row.rowIndex}}"><span></span> </label> </div>';a.gridChefComponents={data:"virtualMachine.clientData.filteredAvailableChefComponents",filterOptions:{filterText:"",useExternalFilter:!1},columnDefs:[{field:"selected",width:60,displayName:f("translate")("virtualmachine.edit.chef.grid.heading.selected"),cellTemplate:j},{field:"clientData.type",width:80,displayName:f("translate")("virtualmachine.edit.chef.grid.heading.type")},{field:"clientData.name",width:80,displayName:f("translate")("virtualmachine.edit.chef.grid.heading.name"),cellTemplate:d.templateWithTooltip},{field:"description",displayName:f("translate")("virtualmachine.edit.chef.grid.heading.description"),cellTemplate:d.templateWithTooltip}],enableRowSelection:!1},a.onPriorityClick=function(b){angular.forEach(a.virtualMachine.clientData.availableChefComponents,function(a){a.priority==b.clientData.priority&&(a.priority=b.priority)}),b.priority=b.clientData.priority,b.clientData.edited=!1},a.gridSelectedComponents={data:"virtualMachine.clientData.availableChefComponents",columnDefs:[{field:"priority",width:80,displayName:f("translate")("virtualmachine.edit.chef.grid.heading.order"),cellTemplate:d.reorderPriorityCell},{field:"clientData.type",width:80,displayName:f("translate")("virtualmachine.edit.chef.grid.heading.type")},{field:"clientData.name",width:80,displayName:f("translate")("virtualmachine.edit.chef.grid.heading.name"),cellTemplate:d.templateWithTooltip},{field:"description",displayName:f("translate")("virtualmachine.edit.chef.grid.heading.description"),cellTemplate:d.templateWithTooltip}],enableRowSelection:!1},i()}]).controller("VirtualMachineEditScriptCtrl",["$scope","virtualMachinesMgr","safeApply","$timeout","$filter",function(a,b,c,d,e){a.__name="VirtualMachineEditScriptCtrl";var f=function(){b.getStartupScript(a.virtualMachine)};f()}]).controller("VolumeDiskEditCtrl",["$scope","volumesMgr","virtualDatacentersMgr","systemPropertiesMgr",function(a,b,c,d){a.__name="VolumeDiskEditCtrl",a.totalSizes=d.getVolumeMaxSizes(),a.editMode=!0;var e=function(b){a.closePopup()};a.onShown=function(){a.volume=angular.copy(a.selectedVirtualDisk),a.volume.sizeInMB=a.volume.sizeInMB},a.onSubmit=function(){var c=angular.copy(a.volume);b.editVolume(c,e)},a.onHidden=function(){}}]).controller("VirtualMachineEditLoadBalancersCtrl",["$scope","virtualMachinesMgr","loadBalancersMgr","gridTemplates","utils","server","$filter",function(a,b,c,d,e,f,g){a.__name="VirtualMachineEditLoadBalancersCtrl",a.loadBalancers=c.loadBalancers;var h=function(b){angular.forEach(a.virtualMachine.clientData.loadBalancers,function(b){angular.forEach(a.loadBalancers,function(a){b.id==a.id&&(a.clientData.selected=!0)})})},i=function(b){angular.forEach(a.virtualMachine.clientData.loadBalancers,function(a){b.id==a.id&&(a.clientData.action="removed")})};a.onItemEnabledChange=function(b){if(b.clientData.selected){var c=g("getElementByParameter")(a.virtualMachine.clientData.loadBalancers,{element:b.id,attribute:"id"});e.isEmptyObject(c)?(b.clientData.action="added",a.virtualMachine.clientData.loadBalancers.push(b)):c.clientData.action="added"}else i(b)},a.loadBalancersGridOptions={data:"loadBalancers",columnDefs:[{field:"",width:50,displayName:"",cellTemplate:d.selectUpdatedCellTemplate},{field:"name",displayName:g("translate")("loadbalancers.details.general.name")},{field:"algorithm",displayName:g("translate")("loadbalancers.details.general.algorithm"),sortable:!1}],multiSelect:!1};var j=function(){a.virtualMachine.clientData.loadBalancersEnabled=!0,c.getAvailableLoadBalancersByVdc(a.currentVirtualAppliance.clientData.virtualDatacenter,{},{},h)};j()}]).controller("VirtualMachineEditMonitoringCtrl",["$scope","$filter","$timeout","gridTemplates","commonsMgr","monitoringMgr",function(a,b,c,d,e,f){a.__name="VirtualMachineEditMonitoringCtrl",a.monitoringLevels=f.monitoringLevels,a.metricsGridOptions={data:"virtualMachine.clientData.monitoringMetrics",columnDefs:[{field:"",displayName:"",cellTemplate:d.selectUpdatedNameCellTemplate,width:50},{field:"name",displayName:b("translate")("virtualmachine.edit.monitoring.heading.name"),cellTemplate:d.templateWithTooltip},{field:"description",displayName:b("translate")("virtualmachine.edit.monitoring.heading.description"),cellTemplate:d.templateWithTooltip},{field:"unit",width:150,displayName:b("translate")("virtualmachine.edit.monitoring.heading.unit")}],enableColumnResize:!0,multiSelect:!1};var g=function(b){a.virtualMachine.clientData.monitoringMetrics=angular.copy(b);var c=[];a.virtualMachine.metadata&&a.virtualMachine.metadata.metadata&&a.virtualMachine.metadata.metadata["monitoring-metrics"]&&(c=a.virtualMachine.metadata.metadata["monitoring-metrics"]),angular.forEach(a.virtualMachine.clientData.monitoringMetrics,function(a){a.clientData={selected:!1},angular.forEach(c,function(b){b.name==a.name&&(a.clientData.selected=!0)})})},h=function(){a.virtualMachine.clientData.monitoringDisplayed||(a.hypervisor=b("getElementByParameter")(e.hypervisorTypes,{element:a.currentVirtualAppliance.clientData.virtualDatacenter.hypervisorType,attribute:"name"}),a.virtualMachine.clientData.monitoringDisplayed=!0,f.getVirtualMachineAvailableMonitoringMetric(a.virtualMachine,g))};h()}]).controller("VirtualMachineEditVariablesCtrl",["$scope","$filter","gridTemplates",function(a,b,c){a.__name="VirtualMachineEditVariablesCtrl",a.variable={},a.addVariable=function(){a.virtualMachine.variables[a.variable.key]=a.variable.value,a.virtualMachine.clientData.variables.push(angular.copy(a.variable)),a.variable.key=a.variable.value=""},a.deleteRow=function(b){a.virtualMachine.clientData.variables.splice(b.rowIndex,1),delete a.virtualMachine.variables[b.entity.key]},a.virtualMachineVariablesGridOptions={data:"virtualMachine.clientData.variables",columnDefs:[{field:"",displayName:"",width:50,headerCellTemplate:c.deleteHeaderTemplate,cellTemplate:c.deleteCellTemplate},{field:"key",displayName:b("translate")("virtualmachine.edit.variables.grid.key")},{field:"value",displayName:b("translate")("virtualmachine.edit.variables.grid.value")}],multiSelect:!1,enableRowSelection:!1}}]),angular.module("hardDisk",[]).controller("HardDiskCtrl",["$scope","utils","virtualMachineTemplatesMgr","virtualMachinesMgr",function(a,b,c,d){a.__name="HardDiskCtrl",a.unitsSelector=b.unitsSelector,a.controllerTypes=c.controllerTypes,a.editMode=!1,a.onShown=function(){a.sizeUnit=angular.copy(b.unitsSelector[0]),a.size="",a.selectedDisk={diskControllerType:void 0,diskController:""},c.getControllerTypes()},a.validateSize=function(){parseInt(a.sizeUnit.conversion)==b.unitsSelector[0].conversion?a.limit=104857600:parseInt(a.sizeUnit.conversion)==b.unitsSelector[1].conversion?a.limit=102400:a.limit=100,a.validExternally=a.size<=a.limit},a.onHidden=function(){},a.onSubmit=function(){var c=a.size*parseInt(a.sizeUnit.conversion),e=new d.HardDisk({links:[],sizeInMb:c,sequence:b.returnSequence(a.virtualMachine.clientData.virtualDisks,"sequence"),diskControllerType:a.selectedDisk.diskControllerType,diskController:a.selectedDisk.diskController});e.clientData.clientId=(new Date).getTime(),a.virtualMachine.clientData.hardDisks.push(e),a.virtualMachine.clientData.virtualDisks.push(e),b.refreshLayout(),a.closePopup()}}]).controller("HarddiskEditCtrl",["$scope","$filter","virtualMachineTemplatesMgr","utils",function(a,b,c,d){function e(){var c={};return a.selectedVirtualDisk.id?(c.hardDisk=b("getElementByParameter")(a.virtualMachine.clientData.hardDisks,{element:a.selectedVirtualDisk.id,attribute:"id"}),c.virtualDisk=b("getElementByParameter")(a.virtualMachine.clientData.virtualDisks,{element:a.selectedVirtualDisk.id,attribute:"id"})):a.selectedVirtualDisk.clientData.clientId&&(c.hardDisk=b("getElementByParameter")(a.virtualMachine.clientData.hardDisks,{element:a.selectedVirtualDisk.clientData.clientId,attribute:"clientData.clientId"}),c.virtualDisk=b("getElementByParameter")(a.virtualMachine.clientData.virtualDisks,{element:a.selectedVirtualDisk.clientData.clientId,attribute:"clientData.clientId"})),c}a.__name="HarddiskEditCtrl",a.unitsSelector=d.unitsSelector,a.controllerTypes=c.controllerTypes,a.editMode=!0,a.onShown=function(){a.sizeUnit=angular.copy(d.getUnitSelectorForMB(a.selectedVirtualDisk.sizeInMb)),a.size=a.selectedVirtualDisk.sizeInMb/a.sizeUnit.conversion,a.selectedDisk={diskControllerType:a.selectedVirtualDisk.diskControllerType,diskController:a.selectedVirtualDisk.diskController},c.getControllerTypes()},a.onHidden=function(){};var f=function(){parseInt(a.sizeUnit.conversion)==d.unitsSelector[0].conversion?a.limit=104857600:parseInt(a.sizeUnit.conversion)==d.unitsSelector[1].conversion?a.limit=102400:a.limit=100,a.validExternally=a.size<=a.limit};a.validateSize=function(){var b=parseInt(a.size)*a.sizeUnit.conversion;a.selectedVirtualDisk.id?(a.validExternally=b>a.selectedVirtualDisk.clientData.originalSize,a.validExternally&&f()):f()},a.onSubmit=function(){var b=e();if(b.hardDisk){var c=parseInt(a.size)*a.sizeUnit.conversion;c!=b.hardDisk.sizeInMb&&(b.hardDisk.sizeInMb=parseInt(a.size)*a.sizeUnit.conversion,b.hardDisk.clientData.sizeInMb=parseInt(a.size)*a.sizeUnit.conversion,b.virtualDisk.sizeInMb=parseInt(a.size)*a.sizeUnit.conversion,b.virtualDisk.clientData.sizeInMb=parseInt(a.size)*a.sizeUnit.conversion),b.hardDisk.diskControllerType=a.selectedDisk.diskControllerType,b.hardDisk.diskController=a.selectedDisk.diskController,b.virtualDisk.diskControllerType=a.selectedDisk.diskControllerType,b.virtualDisk.diskController=a.selectedDisk.diskController,b.hardDisk.clientData.edited=b.hardDisk.id?!0:!1}a.selectedVirtualDisk.sizeInMb=b.hardDisk.sizeInMb,d.refreshLayout(),a.closePopup()}}]),angular.module("instances",[]).controller("InstancesCtrl",["$scope","virtualMachineTemplatesMgr","virtualMachinesMgr","virtualAppliancesMgr","systemPropertiesMgr","safeApply","$filter",function(a,b,c,d,e,f,g){function h(){var c=g("vmtSlaveFiltersForMaster")(b.virtualMachineTemplates,b.currentVirtualMachineTemplate.id,{});a.vmtList=angular.copy(g("orderBy")(c,"clientData.numericalCreationDate",!0)),a.vmtList.unshift(angular.copy(b.currentVirtualMachineTemplate)),a.layer=angular.copy(b.currentVirtualMachineLayer),i(a.vmtList)}function i(a){if(a&&a.length>0)for(var b=0;b<a.length;b++){var c=a[b];c.clientData.selected=c.clientData.isMaster}}a.__name="InstancesCtrl",a.vmtFilter={has:""},a.systemProperties=e.systemProperties,a.onAccept=function(){angular.forEach(a.vmtList,function(e){if(void 0!==e.clientData&&e.clientData.selected){var f=b.getTemplateFromInstance(e);c.createVirtualMachineFromTemplateForVapp(f,d.currentVirtualAppliance,a.systemProperties.infrastructure["client.virtual.allowVMRemoteAccess"].value,a.layer)}}),f(a)},a.onShow=function(){console.log("show")},a.onSubmit=function(){console.log("add vmt")},a.onCBChange=function(){console.log("changed")},h()}]).controller("InstancesCreateCtrl",["$scope","$filter","server","utils","virtualMachinesMgr","refreshMgr","safeApply","dispatcher",function(a,b,c,d,e,f,g,h){a.__name="InstancesCreateCtrl";var i=function(){a.closePopup()};a.onShown=function(){f.stopTimer(),a.vmList=angular.copy(b("vmStateFilter")(e.virtualMachines,"OFF")),a.validExternally=!1},a.onHidden=function(){f.initTimer()},a.onSubmit=function(){angular.forEach(a.vmList,function(a){void 0!==a.clientData&&a.clientData.selected&&e.createInstance(a,a.clientData.virtualMachineTemplate.name,i)}),g(a)},a.onCBChange=function(){a.validExternally=!1,a.vmList.forEach(function(b){return b.clientData.selected?void(a.validExternally=!0):void 0})},h.on("diskSelector.submit",function(c,d){var e=b("getElementById")(a.vmList,d.virtualMachine.id);e.disks=d.virtualMachine.disks,e.volumes=d.virtualMachine.volumes},a)}]),angular.module("virtualMachines",["virtualMachineCreate","virtualMachineEdit","virtualMachineDetails","instances","layerEdit","monitoring"]).controller("VirtualMachinesFilterCtrl",["$scope","$filter","utils","virtualMachineTemplatesMgr","virtualAppliancesMgr","navigationMgr","dispatcher",function(a,b,c,d,e,f,g){function h(){a.onFilterClick()}a.__name="VirtualMachinesFilterCtrl",a.currentVirtualAppliance=e.currentVirtualAppliance,a.localCurrentVirtualApplianceId=0,a.filter={categoryName:b("translate")("virtualmachinestemplate.filter.allcategories")},a.onClearClick=function(){c.emptyObject(a.filter)},a.onFilterClick=function(b){var e=angular.copy(a.filter);0==e["32bits"]&&0==e["64bits"]&&delete e["64bits"],delete e["32bits"],c.isEmptyObject(a.currentVirtualAppliance)||c.isEmptyObject(a.currentVirtualAppliance.clientData)||c.isEmptyObject(a.currentVirtualAppliance.clientData.virtualDatacenter)||d.getTemplatesByVirtualDatacenter(a.currentVirtualAppliance.clientData.virtualDatacenter,b,null,e)},a.$on("timerVM",function(){a.onFilterClick(!0)}),a.onCheckboxClick=function(b,c){a.filter[b]==a.filter[c]&&(a.filter[c]=!1)},g.on("currentVirtualAppliance.change",function(d,e){c.isEmptyObject(a.currentVirtualAppliance)||"virtualappliances"!=f.sectionView||(a.localCurrentVirtualApplianceId!=a.currentVirtualAppliance.id&&(a.localCurrentVirtualApplianceId=a.currentVirtualAppliance.id,a.currentVirtualAppliance.clientData.virtualDatacenter.isPublic?a.filter={categoryName:b("translate")("virtualmachinestemplate.filter.allcategories"),"64bits":!1,"32bits":!1,path:""}:a.filter={categoryName:b("translate")("virtualmachinestemplate.filter.allcategories")}),a.onFilterClick(e.refresh))},a),h()}]).controller("VirtualMachinesListCtrl",["$scope","virtualMachineTemplatesMgr","systemPropertiesMgr","virtualDatacentersMgr","virtualAppliancesMgr","virtualMachinesMgr","enterprisesMgr","commonsMgr","navigationMgr","monitoringMgr","utils","dispatcher","uModals","$filter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){p()}function p(){k.isEmptyObject(e.currentVirtualAppliance)||"virtualappliances"!=i.sectionView||(n("isGranted")("VDC_MANAGE_VAPP")&&e.currentVirtualAppliance.clientData.virtualDatacenter.clientData.isPublic&&h.getHardwareProfiles(e.currentVirtualAppliance.clientData.virtualDatacenter),a.hypervisor=n("getElementByParameter")(h.hypervisorTypes,{element:a.currentVirtualAppliance.clientData.virtualDatacenter.hypervisorType,attribute:"name"}),n("operationIsGranted")(a.hypervisor.name,"virtualmachinemetrics")&&j.getHypervisorMonitoringLevels(a.hypervisor))}function q(){h.getHardwareProfiles(a.currentVirtualAppliance.clientData.virtualDatacenter,r)}function r(){m.showPopUp({controller:"HardwareProfilesCtrl",scope:a,popupUrl:"modules/virtualdatacenters/virtualappliances/virtualmachines/create/partials/hardwareprofileslist.html",title:n("translate")("virtualmachine.create.hardwareprofile.title"),closeOnAccept:!1,formName:"hardwareProfileForm",acceptLabel:n("translate")("globals.accept"),cancelLabel:n("translate")("globals.cancel"),showAcceptBtn:!0,showCancelBtn:!0,infoUrl:"",popupWidth:"600"})}a.__name="VirtualMachinesListCtrl",a.systemProperties=c.systemProperties,a.currentVirtualDatacenter=d.currentVirtualDatacenter,a.currentVirtualAppliance=e.currentVirtualAppliance,a.tabSelection={},a.onTemplateDoubleclick=function(c){b.setCurrentVMTemplate(c),b.currentVirtualMachineLayer=void 0,a.currentVirtualAppliance.clientData.virtualDatacenter.clientData.isPublic?q():b.hasInstances(b.currentVirtualMachineTemplate)?(popupUrl="modules/virtualdatacenters/virtualappliances/virtualmachines/instances/partials/instancesview.html",controller="InstancesCtrl",title=n("translate")("virtualmachine.instances.title"),acceptLabel=n("translate")("globals.accept"),cancelLabel=n("translate")("globals.cancel"),showAcceptBtn=!0,showCancelBtn=!0,closeOnAccept=!0,infoUrl="",popupWidth="400px",m.showPopUp({scope:a,popupUrl:popupUrl,title:title,closeOnAccept:closeOnAccept,acceptLabel:acceptLabel,cancelLabel:cancelLabel,showAcceptBtn:showAcceptBtn,showCancelBtn:showCancelBtn,infoUrl:infoUrl,popupWidth:popupWidth,controller:controller})):f.createVirtualMachineFromTemplateForVapp(c,e.currentVirtualAppliance,a.systemProperties.infrastructure["client.virtual.allowVMRemoteAccess"].value)},l.on("currentVirtualAppliance.change",function(){p()},a),l.on("hardwareProfiles.retrieve",q,a),o()}]).controller("VirtualMachinesViewCtrl",["$scope","virtualDatacentersMgr","virtualAppliancesMgr","virtualMachinesMgr","virtualMachineTemplatesMgr","layersMgr","systemPropertiesMgr","refreshMgr","navigationMgr","configMgr","pricingMgr","eventsMgr","safeApply","server","utils","uModals","$filter","dispatcher","$timeout","gridTemplates",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){
function u(){B(!0)}function v(){o.isEmptyObject(z)||(a.onCreateLayerClick(z.title),z=null)}a.__name="VirtualMachinesViewCtrl",a.currentVirtualDatacenter=b.currentVirtualDatacenter,a.currentVirtualAppliance=c.currentVirtualAppliance,a.currentVirtualMachine=d.currentVirtualMachine,a.virtualMachines=d.virtualMachines,a.layers=f.layers,a.categories=e.virtualMachineTemplatesCategories,a.systemProperties=g.systemProperties,a.createLayer={name:""},a.userInterface=j.userInterface,a.chartsEnabled=1==j.config["client.google.charts.enabled"],a.changesDone=!1,a.canBeDeleted=!0;var w=function(){"LOCKED"!=c.currentVirtualAppliance.state&&h.initTimer()},x=function(b){angular.forEach(a.virtualMachines,function(a){"DEPLOY"==b?"NOT_ALLOCATED"==a.state&&(a.state="LOCKED"):"UNDEPLOY"==b&&(a.state="LOCKED")})};a.onBackClick=function(){h.stopTimer(),h.initTimer(),r.dispatch("virtualappliance.updated"),c.setCurrentVirtualAppliance(null),d.setCurrentVirtualMachine(null),i.sectionView="virtualdatacenters"};var y=function(){o.refreshLayout(),a.refreshedVirtualMachines=[],s(function(){a.refreshedVirtualMachines=a.virtualMachines})};a.onGridTabClick=function(){y()};var z,A=function(){o.isEmptyObject(c.currentVirtualAppliance)||c.getCurrentVirtualAppliance(w)},B=function(b,c){z=c,o.isEmptyObject(a.currentVirtualAppliance)||(d.getVirtualMachines(b,a.currentVirtualAppliance,y),f.getLayers(a.currentVirtualAppliance,v))},C=function(){h.initVMTimer()};a.onPendingTasksClick=function(){c.updatePendingTasks(c.currentVirtualAppliance),m(a)},a.onUpdateVirtualMachinesClick=function(){c.updatePendingCurrentVirtualMachines(),m(a)},a.onCreateLayerClick=function(b){q("isValidLayerName")(f.layers,b)&&(f.addLayerInVirtualAppliance(b,a.currentVirtualAppliance),a.pendingChanges=!0,m(a))},a.validateLayer=function(b){return a.isLayerValid=q("isValidLayerName")(f.layers,b),a.isLayerValid};var D=function(b){b.selected&&(b.entity.id?(a.canBeDeleted=!0,"UNKNOWN"==b.entity.state&&(a.canBeDeleted=q("isGranted")("VAPP_DELETE_UNKNOWN_VM")),d.setCurrentVirtualMachine(b.entity)):d.setCurrentVirtualMachine(null))};a.sortInfo={fields:[""],directions:["asc","desc"]},a.vmPrivateGridOptions={data:"virtualMachines",columnDefs:[{field:"label",displayName:q("translate")("virtualmachine.grid.header.nodename"),width:140},{field:"name",displayName:q("translate")("virtualmachine.grid.header.name")},{field:"cpu",displayName:q("translate")("virtualmachine.grid.header.cpu"),width:40},{field:"ram",displayName:q("translate")("virtualmachine.grid.header.ram"),width:60,cellFilter:"sizeUnit:false:0"},{field:"clientData.layer.name",displayName:q("translate")("virtualmachine.grid.header.layer"),width:100},{field:"protected",displayName:q("translate")("servers.virtualmachine.col.blocked"),cellTemplate:t.blockedVMCellTemplate,width:70},{field:"state",displayName:q("translate")("virtualmachine.grid.header.state"),cellTemplate:t.stateVMStringCellTemplate,width:120}],afterSelectionChange:D,multiSelect:!1},a.vmPublicGridOptions={data:"virtualMachines",columnDefs:[{field:"label",displayName:q("translate")("virtualmachine.grid.header.nodename"),width:140},{field:"name",displayName:q("translate")("virtualmachine.grid.header.name")},{field:"cpu",displayName:q("translate")("virtualmachine.grid.header.cpu"),width:40},{field:"ram",displayName:q("translate")("virtualmachine.grid.header.ram"),width:60,cellFilter:"sizeUnit:false:0"},{field:"protected",displayName:q("translate")("servers.virtualmachine.col.blocked"),cellTemplate:t.blockedVMCellTemplate,width:70},{field:"state",displayName:q("translate")("virtualmachine.grid.header.state"),cellTemplate:t.stateVMStringCellTemplate,width:120}],afterSelectionChange:D,multiSelect:!1},a.onDeleteLayerClick=function(a){a.links?f.deleteLayer(a):f.deleteLayerInVirtualAppliance(a)},a.moveVirtualMachineToLayer=function(b,c){c.links?(b.clientData.layer=c,d.editVirtualMachine(b)):f.createLayer(a.currentVirtualAppliance,b,c)},a.moveVirtualMachineToCategory=function(a){var b=n.getLinkByRel(a.links,"layer");o.isEmptyObject(b)||(a.links.splice(a.links.indexOf(b),1),d.editVirtualMachine(a))},a.onVirtualMachineMouseDown=function(a){a.id?d.setCurrentVirtualMachine(a):d.setCurrentVirtualMachine(null)},a.onDeleteVirtualMachineConfirm=function(a){d.removeVirtualMachine(a)},a.dropTemplateOnListAcceptListener=function(a,b){var c=a.data("$scope");if(void 0===c)return!1;if(void 0!==c.virtualMachine){var d=c.virtualMachine;return"NOT_ALLOCATED"==d.state||"OFF"==d.state}return void 0===c.virtualMachineTemplate||"DONE"!=c.virtualMachineTemplate.state&&"UNAVAILABLE"!=c.virtualMachineTemplate.state?!1:!0},a.dropTemplateOnListListener=function(b,f,g,h){void 0!==b.data("$scope").virtualMachine?a.moveVirtualMachineToCategory(b.data("$scope").virtualMachine):void 0!==b.data("$scope").virtualMachineTemplate&&(e.setCurrentVMTemplate(b.data("$scope").virtualMachineTemplate),e.currentVirtualMachineLayer=void 0,a.currentVirtualAppliance.clientData.virtualDatacenter.clientData.isPublic?r.dispatch("hardwareProfiles.retrieve"):e.hasInstances(e.currentVirtualMachineTemplate)?(popupUrl="modules/virtualdatacenters/virtualappliances/virtualmachines/instances/partials/instancesview.html",controller="InstancesCtrl",title=q("translate")("virtualmachine.instances.title"),acceptLabel=q("translate")("globals.accept"),cancelLabel=q("translate")("globals.cancel"),showAcceptBtn=!0,showCancelBtn=!0,closeOnAccept=!0,infoUrl="",popupWidth="400px",p.showPopUp({scope:a,popupUrl:popupUrl,title:title,closeOnAccept:closeOnAccept,acceptLabel:acceptLabel,cancelLabel:cancelLabel,showAcceptBtn:showAcceptBtn,showCancelBtn:showCancelBtn,infoUrl:infoUrl,popupWidth:popupWidth,controller:controller})):d.createVirtualMachineFromTemplateForVapp(b.data("$scope").virtualMachineTemplate,c.currentVirtualAppliance,a.systemProperties.infrastructure["client.virtual.allowVMRemoteAccess"].value))},a.dropVirtualMachineOnLayerAcceptListener=function(a){if("LOCKED"==c.currentVirtualAppliance.state)return!1;if(void 0===a.data("$scope"))return!1;if(void 0!==a.data("$scope").virtualMachine){var b=a.data("$scope").virtualMachine;return"NOT_ALLOCATED"==b.state||"OFF"==b.state}return void 0!==a.data("$scope").virtualMachineTemplate?!0:!1},a.dropVirtualMachineOnLayerListener=function(b,c,f){var g=f;if(void 0!==b.data("$scope").virtualMachine){var h=b.data("$scope").virtualMachine,i=n.getLinkByRel(h.links,"layer");(o.isEmptyObject(i)||g.name!=i.title)&&a.moveVirtualMachineToLayer(h,g)}else void 0!==b.data("$scope").virtualMachineTemplate&&(e.setCurrentVMTemplate(b.data("$scope").virtualMachineTemplate),e.setCurrentVMLayer(g),e.hasInstances(e.currentVirtualMachineTemplate)?(popupUrl="modules/virtualdatacenters/virtualappliances/virtualmachines/instances/partials/instancesview.html",controller="InstancesCtrl",title=q("translate")("virtualmachine.instances.title"),acceptLabel=q("translate")("globals.accept"),cancelLabel=q("translate")("globals.cancel"),showAcceptBtn=!0,showCancelBtn=!0,closeOnAccept=!0,infoUrl="",popupWidth="400px",p.showPopUp({scope:a,popupUrl:popupUrl,title:title,closeOnAccept:closeOnAccept,acceptLabel:acceptLabel,cancelLabel:cancelLabel,showAcceptBtn:showAcceptBtn,showCancelBtn:showCancelBtn,infoUrl:infoUrl,popupWidth:popupWidth,controller:controller})):d.createVirtualMachineFromTemplateForVapp(b.data("$scope").virtualMachineTemplate,a.currentVirtualAppliance,a.systemProperties.infrastructure["client.virtual.allowVMRemoteAccess"].value,g));a.pendingChanges=!0,m(a)},a.onForceRefreshClick=function(){h.forceRefresh()},a.onUndeployVirtualApplianceClick=function(){c.unDeploy(c.currentVirtualAppliance,!1,C)},a.onDeployVirtualApplianceClick=function(){var b=function(b){""!=b?p.showAlert({scope:a,message:b,title:q("translate")("virtualappliance.deploy.pricing.confirm.title"),showCancelBtn:!0,showConfirmBtn:!0,cancelLabel:q("translate")("globals.cancel"),confirmLabel:q("translate")("globals.confirm"),confirmFn:function(){E()}}):E()};k.getVirtualAppliancePrice(c.currentVirtualAppliance,b)};var E=function(){c.deploy(c.currentVirtualAppliance,C)};a.onUpdateVirtualMachinesClick=function(){c.updatePendingCurrentVirtualMachines()};var F=function(b){p.showPopUp({scope:a,controller:"VirtualMachineEventsCtrl",popupUrl:"modules/virtualdatacenters/virtualappliances/virtualmachines/partials/virtualmachineeventsform.html",formName:"vmtEventsForm",title:q("translate")("virtualmachine.ackerror.confirm.title"),closeOnCancel:!0,closeOnAccept:!0,cancelLabel:q("translate")("globals.no"),acceptLabel:q("translate")("globals.yes"),showAcceptBtn:!0,showCancelBtn:!0,popupWidth:"800",popupData:b})};a.onErrorAckClick=function(a){l.getVirtualMachineEvents(a,F)},a.virtualMachinesGridOptions={data:"virtualMachines",columnDefs:[{field:"name",displayName:"Node"},{field:"state",displayName:"Status"}],multiSelect:!1},r.on(["virtualmachine.created","virtualMachine.edited","layer.created","layer.edited","layer.deleted","virtualMachine.blocked","virtualMachine.unblocked"],function(){o.isEmptyObject(a.currentVirtualAppliance)||"virtualappliances"!=i.sectionView||(B(!1),A())},a),r.on(["currentVirtualAppliance.change"],function(b,c){c&&c.refresh||o.isEmptyObject(a.currentVirtualAppliance)||"virtualappliances"!=i.sectionView||(B(!0),A())},a),r.on(["virtualMachine.deleted"],function(b,c){if(!o.isEmptyObject(a.currentVirtualAppliance)&&"virtualappliances"==i.sectionView){var d=n.getLinkByRel(c.virtualMachine.links,"layer");B(!1,d),A()}},a),r.on(["virtualAppliance.deleted","virtualappliance.goback"],function(){a.onBackClick()},a),r.on(["instance.created"],function(){h.initVMTimer()},a),r.on(["virtualappliance.deploy.inprogress"],function(a,b){x(b.action)},a),r.on(["softLimits.canceled"],function(a,b){b.config&&"PUT"==b.config.method||B(!1)},a),r.on(["create.layer"],function(b,c){f.createLayer(a.currentVirtualAppliance,c.vm,c.layer)},a),r.on("start.vmtimer",function(){h.initVMTimer()},a),a.$on("timer",function(){"virtualappliances"==i.sectionView&&B(!1)}),a.$on("timerVM",function(){A(),B(!1)}),u()}]).controller("VirtualMachinesListTemplateCtrl",["$scope","$timeout","virtualMachineTemplatesMgr",function(a,b,c){a.__name="VirtualMachinesListTemplateCtrl",a.virtualMachineTemplates=c.virtualMachineTemplates,a.loadingTemplates=c.loadingTemplates,b(function(){a.virtualMachineTemplatesCategories=c.virtualMachineTemplatesCategories},200)}]).controller("VirtualMachinesListTemplatePersistentCtrl",["$scope","virtualMachineTemplatesMgr","virtualAppliancesMgr","navigationMgr","systemPropertiesMgr","dispatcher","utils",function(a,b,c,d,e,f,g){function h(){g.isEmptyObject(c.currentVirtualAppliance)||"virtualappliances"!=d.sectionView||b.getNotUsedPersistentVMTemplates(c.currentVirtualAppliance.clientData.virtualDatacenter)}a.__name="VirtualMachinesListTemplatePersistentCtrl",a.virtualMachinePersistentTemplates=b.notUsedVirtualMachinePersistentTemplates,a.systemProperties=e.systemProperties,f.on(["currentVirtualAppliance.change","virtualmachine.created","virtualMachine.deleted","persistentTemplate.created","repository.retrieved"],function(){h()},a),h()}]).controller("HardwareProfilesCtrl",["$scope","commonsMgr","virtualAppliancesMgr","virtualMachinesMgr","virtualMachineTemplatesMgr","$filter","server",function(a,b,c,d,e,f,g){function h(){a.closePopup()}a.__name="HardwareProfilesCtrl",a.virtualMachineTemplate=e.currentVirtualMachineTemplate,a.virtualAppliance=c.currentVirtualAppliance,a.hardwareProfiles=b.hardwareProfiles,a.onHardwareProfileChange=function(b){a.selectedHardwareProfile=f("getElementByParameter")(a.hardwareProfiles,{element:b,attribute:"providerId"})},a.returnHardwareProfileLabel=function(b){var c=b;return angular.forEach(a.virtualMachineTemplate.links,function(a){"hardwareprofile"==a.rel&&a.title==b&&(c+=" ("+f("translate")("virtualmachine.create.hardwareprofile.recommended")+")")}),c},a.onSubmit=function(){var b=angular.copy(a.virtualMachineTemplate),c=g.createLinkByRel(a.selectedHardwareProfile.links,"self","hardwareprofile");b.links.push(c),d.createVirtualMachineFromTemplateForVapp(b,a.virtualAppliance,!1,null,h)}}]).controller("VirtualMachineEventsCtrl",["$scope","eventsMgr","virtualMachinesMgr","gridTemplates","$filter",function(a,b,c,d,e){a.__name="VirtualMachineEventsCtrl",a.selectedEvent=b.currentEvent;var f=function(){a.virtualMachine=a.popupData},g=function(){a.closePopup()},h=function(a){a.selected&&b.setCurrentEvent(a.entity)};a.virtualMachineEventsGrid={data:"virtualMachine.clientData.events",columnDefs:[{field:"clientData.source",width:100,displayName:e("translate")("events.list.input.source"),cellTemplate:d.templateWithTooltip},{field:"severity",width:70,displayName:e("translate")("events.list.input.severity"),cellTemplate:d.severityCellTemplate},{field:"actionPerformed",width:200,displayName:e("translate")("events.list.input.action"),sortable:!1,cellTemplate:d.templateWithTooltip},{field:"performedBy",width:80,displayName:e("translate")("events.list.input.performedby"),cellTemplate:d.templateWithTooltip},{field:"timestamp",width:120,displayName:e("translate")("events.list.input.datetime"),cellFilter:"timestampToString:true",cellTemplate:d.templateWithTooltip},{field:"user",width:70,displayName:e("translate")("events.list.input.user"),cellTemplate:d.templateWithTooltip},{field:"stacktrace",width:150,displayName:e("translate")("events.list.input.trace"),sortable:!1,cellTemplate:d.templateWithTooltip}],afterSelectionChange:h,multiSelect:!1},a.onSubmit=function(){c.ackError(a.virtualMachine,g)},f()}]),angular.module("layerEdit",[]).controller("LayerEditCtrl",["$scope","$filter","layersMgr",function(a,b,c){a.__name="LayerEditCtrl";var d=function(){a.closePopup()};a.onShown=function(){var b=angular.fromJson(a.popupData);a.originalLayerName=b.name,a.layer=angular.copy(b)},a.validateLayer=function(d){return b("isValidLayerName")(c.layers,d,a.originalLayerName)},a.onSubmit=function(){c.editLayer(a.layer,a.originalLayerName,d)}}]),angular.module("monitoring",[]).controller("MonitoringCtrl",["$scope","virtualDatacentersMgr","virtualAppliancesMgr","virtualMachinesMgr","commonsMgr","navigationMgr","monitoringMgr","configMgr","$filter","$timeout","dispatcher","utils",function(a,b,c,d,e,f,g,h,i,j,k,l){a.__name="MonitoringCtrl",a.currentVirtualDatacenter=b.currentVirtualDatacenter,a.currentVirtualAppliance=c.currentVirtualAppliance,a.virtualMachines=d.virtualMachines,a.statistics=h.config["config.monitoringstatistics"],a.periods=h.config["config.monitoringperiods"],a.refreshFilter={},a.loadingMetrics=!0,a.metricCharts=g.metricCharts;var m={},n={},o=function(){a.loadingMetrics=!1},p=function(){a.loadingMetrics=!0;var b=0,c=[];angular.forEach(a.virtualMachines,function(d){g.getVirtualMachineAvailableMonitoringMetric(d,function(e){b++,angular.forEach(d.metadata.metadata["monitoring-metrics"],function(a){var b=!1;if(angular.forEach(c,function(c){c.name==a.name&&(b=!0)}),!b){var d=i("getElementByParameter")(e,{element:a.name,attribute:"name"});d.clientData={selected:!0},c.push(d)}}),b==a.virtualMachines.length&&(a.availableMetrics=c,j(function(){g.getVirtualApplianceMonitoringMetrics(a.virtualMachines,a.availableMetrics,!0,o)},500))})})},q=function(){var b=6e4*a.refreshFilter.refreshTimer;j.cancel(n),isNaN(b)||(n=j(function(){p(),q()},b))},r=function(){j.cancel(n)};a.onRefreshMonitoringMetrics=function(b){var c=[];angular.forEach(a.virtualMachines,function(a){a.metadata&&a.metadata.metadata["monitoring-metrics"]&&a.metadata.metadata["monitoring-metrics"].length&&angular.forEach(a.metadata.metadata["monitoring-metrics"],function(d){if(d.name==b.name){var e=angular.copy(a);e.metadata.metadata["monitoring-metrics"]=[{name:b.name}],c.push(e)}})}),g.getVirtualApplianceMonitoringMetrics(c,[b],!0)},a.onSelectedMetricChange=function(b){b.clientData&&b.clientData.selected&&a.onRefreshMonitoringMetrics(b)},a.onChangeResfreshTimer=function(){a.refreshFilter.refreshMonitoring?q():r()},k.on(["virtualappliance.virtualmachines.retrieved"],function(){l.isEmptyObject(a.currentVirtualAppliance)||"virtualappliances"!=f.sectionView||"monitoring"!=a.vmViewTab||m.id!=a.currentVirtualAppliance.id&&(m=angular.copy(a.currentVirtualAppliance),p())},a),a.$watch("vmViewTab",function(){"monitoring"==a.vmViewTab?(m=angular.copy(a.currentVirtualAppliance),a.refreshFilter={},p()):r()})}]).controller("VirtualMachineMonitoringCtrl",["$scope","virtualAppliancesMgr","virtualMachinesMgr","monitoringMgr","commonsMgr","configMgr","refreshMgr","$filter","$timeout",function(a,b,c,d,e,f,g,h,i){a.__name="VirtualMachineMonitoringCtrl",a.currentVirtualAppliance=b.currentVirtualAppliance,a.statistics=f.config["config.monitoringstatistics"],a.periods=f.config["config.monitoringperiods"],a.vmMetrics=[],a.loadingMetrics=!0,a.chartsEnabled=1==f.config["client.google.charts.enabled"];var j=function(){a.loadingMetrics=!1},k=function(b){a.availableMetrics=b,g.stopTimer(),i(function(){d.getVirtualApplianceMonitoringMetrics([a.currentVirtualMachine],a.availableMetrics,!1,j)},100)},l=function(b){a.currentVirtualMachine.clientData.charts[a.currentMetric.name]=b[0].clientData.charts[a.currentMetric.name]};a.onRefreshMonitoringMetrics=function(b){a.currentMetric=b;var c=angular.copy(a.currentVirtualMachine);c.metadata.metadata["monitoring-metrics"]=[{name:b.name}],d.getVirtualApplianceMonitoringMetrics([c],[b],!1,l)},a.onShown=function(){a.currentVirtualMachine=angular.copy(c.currentVirtualMachine),a.loadingMetrics=!0,d.getVirtualMachineAvailableMonitoringMetric(a.currentVirtualMachine,k)},a.onHidden=function(){g.initTimer()}}]),angular.module("volumeCreate",[]).controller("VolumeCreateCtrl",["$scope","volumesMgr","virtualDatacentersMgr","virtualMachineTemplatesMgr","systemPropertiesMgr","tiersMgr","$filter","$timeout",function(a,b,c,d,e,f,g,h){a.__name="VolumeCreateCtrl",a.editMode=!1,a.tiers=f.tiers,a.totalSizes=e.getVolumeMaxSizes(),a.controllerTypes=d.controllerTypes;var i=function(){a.closePopup()},j=function(){h(function(){a.volume.clientData.tier.id=a.tiers[0].id})};a.onShown=function(){a.volume=new b.Volume,a.volume.sizeInMB=a.totalSizes[0],a.volume.clientData.virtualDatacenter=angular.copy(c.currentVirtualDatacenter),f.getTiersByVirtualDatacenter(c.currentVirtualDatacenter,j),d.getControllerTypes()},a.onSubmit=function(){var c=angular.copy(a.volume);c.clientData.tier=g("getElementByParameter")(a.tiers,{element:parseInt(a.volume.clientData.tier.id),attribute:"id"}),b.createVolume(c,i)}}]).controller("VolumeIscsiCreateCtrl",["$scope","volumesMgr","virtualDatacentersMgr","userMgr","enterprisesMgr","storagePoolsMgr","datacentersMgr","$filter","utils","$timeout",function(a,b,c,d,e,f,g,h,i,j){a.__name="VolumeIscsiCreateCtrl",a.editMode=!1,a.unitsSelector=i.unitsSelector,a.enterprises=e.enterprises,a.currentStoragePool=f.currentStoragePool,a.datacenter=g.currentDatacenter;var k=function(){a.closePopup()},l=function(){j(function(){a.enterprise=h("getElementByParameter")(a.enterprises,{element:parseInt(d.user.clientData.enterprise.id),attribute:"id"}),a.volume.clientData.enterpriseId=a.enterprise.id,n()})},m=function(b){a.virtualDatacenters=b.collection,j(function(){a.virtualDatacenter={},a.volume.clientData.virtualDatacenterId=""})},n=function(){c.getVirtualDataCentersByDataCenter(a.enterprise,a.datacenter,m)};a.onEnterpriseChange=function(){a.enterprise=h("getElementByParameter")(a.enterprises,{element:parseInt(a.volume.clientData.enterpriseId),attribute:"id"}),n()},a.onVirtualDatacenterChange=function(){a.volume.clientData.virtualDatacenter=h("getElementByParameter")(a.virtualDatacenters,{element:parseInt(a.volume.clientData.virtualDatacenterId),attribute:"id"})},a.onShown=function(){a.virtualDatacenters=[],a.currentStorageDevice=a.currentStoragePool.clientData.storageDevice,a.sizeUnit=angular.copy(i.unitsSelector[0]),a.volume=new b.Volume,e.getEnterprises({},{},l)},a.onSubmit=function(){a.volume.sizeInMB=a.volume.clientData.sizeInMb*parseInt(a.sizeUnit.conversion),a.volume.connection="ip-"+a.currentStorageDevice.managementIp+":"+a.currentStorageDevice.managementPort+"-iscsi-"+a.volume.clientData.target+"-lun-"+a.volume.clientData.lun,b.createIscsiVolume(a.volume,a.volume.clientData.virtualDatacenter,a.currentStoragePool,k)}}]),angular.module("volumeDetails",[]).controller("VolumeDetailsCtrl",["$scope","$filter","volumesMgr","dispatcher","utils",function(a,b,c,d,e){a.__name="VolumeDetailsCtrl",a.currentVolume=c.currentVolume,a.volumeInitiatorMappingsGridOptions={data:"currentVolume.clientData.initiatorMappings",columnDefs:[{field:"initiatorIqn",displayName:b("translate")("volume.details.initiator.col.iqn"),width:250},{field:"targetIqn",displayName:b("translate")("volume.details.initiator.col.target")},{field:"targetLun",displayName:b("translate")("volume.details.initiator.col.lun"),width:50}],multiSelect:!1,enableRowSelection:!1},d.on("currentVolume.change",function(){e.isEmptyObject(a.currentVolume)||(c.getVolumeInitiatorMappings(a.currentVolume),e.refreshLayout())},a)}]),angular.module("volumeEdit",[]).controller("VolumeEditCtrl",["$scope","volumesMgr","virtualDatacentersMgr","virtualMachineTemplatesMgr","systemPropertiesMgr",function(a,b,c,d,e){a.__name="VolumeEditCtrl",a.totalSizes=e.getVolumeMaxSizes(),a.controllerTypes=d.controllerTypes,a.editMode=!0;var f=function(b){a.closePopup()};a.onShown=function(){a.volume=angular.copy(b.currentVolume),a.volume.sizeInMB=a.volume.sizeInMB,d.getControllerTypes()},a.onSubmit=function(){var c=angular.copy(a.volume);b.editVolume(c,f)}}]),angular.module("volumes",["volumeCreate","volumeEdit","volumeDetails"]).controller("VolumeCtrl",["$scope","$filter","volumesMgr","virtualDatacentersMgr","systemPropertiesMgr","enterprisesMgr","storagePoolsMgr","tiersMgr","navigationMgr","paginationHelper","utils","dispatcher",function(a,b,c,d,e,f,g,h,i,j,k,l){a.__name="VolumeCtrl",a.currentVolume=c.currentVolume,a.volumes=c.volumes,a.systemProperties=e.systemProperties,a.currentVirtualDatacenter=d.currentVirtualDatacenter,a.tiers=h.tiers,a.currentStoragePool=g.currentStoragePool,a.volFilter=j.volPaginator.filter,a.volPaginationParam=j.volPaginator.param,a.mainView=i.mainView,j.volPaginator.resetParam(),l.on(["currentVirtualDatacenter.change","volume.created","volume.edited","volume.deleted"],function(){j.volPaginator.resetParam(),o()},a);var m=function(){g.setCurrentStoragePool(null),o()},n=function(a){j.volPaginator.param.totalSize=a.totalSize},o=function(b){b||c.setCurrentVolume(),k.isEmptyObject(a.currentStoragePool)?k.isEmptyObject(d.currentVirtualDatacenter)?"virtualdatacenters"==i.mainView&&c.getVolumesByEnterprise(f.userEnterprise,b,j.volPaginator.param,j.volPaginator.filter,n):c.getVolumesByVdc(d.currentVirtualDatacenter,b,j.volPaginator.param,j.volPaginator.filter,n):c.getVolumesByStoragePool(a.currentStoragePool,b,j.volPaginator.param,j.volPaginator.filter,n)},p=function(){o()},q=function(){c.deleteVolume(c.currentVolume,p)},r=function(a){a.selected&&c.setCurrentVolume(a.entity)},s='<div ng-style="{cursor: row.cursor}" \n                            data-ui-draggable \n                            data-drag-enabled="(row.entity.state != \'ATTACHED\') && (row.entity.idImage | isEmptyObject)" \n                            data-drag-revert="true" \n                            data-drag-helper="<div class=\'dragged-item\'>{{row.getProperty(\'name\')}}</div>" \n                            data-drag-object="{type:\'volume\', data:row.entity}" \n                            ng-repeat="col in renderedColumns" \n                            ng-class="col.colIndex()" \n                            class="ngCell {{col.cellClass}}" \n                            ng-cell></div>';a.sortInfo={fields:[""],directions:["asc","desc"]},a.volumesGridOptions={data:"volumes",rowTemplate:s,columnDefs:[{field:"name",displayName:b("translate")("volume.col.name")},{field:"uuid",displayName:b("translate")("volume.col.realname"),visible:1==a.isInfrastructure,sortable:!1},{field:"clientData.virtualDatacenter.name",displayName:b("translate")("volume.col.vdc")},{field:"clientData.virtualAppliance.name",displayName:b("translate")("volume.col.vapp")},{field:"clientData.virtualMachine.name",displayName:b("translate")("volume.col.vm")},{field:"clientData.tier.name",displayName:b("translate")("volume.col.tier")},{field:"sizeInMB",displayName:b("translate")("volume.col.totalsize"),cellTemplate:"<p>{{row.getProperty(col.field) | sizeUnit:false}}</p>"},{field:"state",displayName:b("translate")("volume.col.state")}],useExternalSorting:!0,sortInfo:a.sortInfo,afterSelectionChange:r,multiSelect:!1},a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var b=c.sortMapping[a.fields[0]],d="asc"===a.directions[0]?!0:!1;j.volPaginator.filter.by=b,j.volPaginator.filter.asc=d,o()}},!0),a.onVolFilterSubmit=function(){j.volPaginator.resetParam(),o()},a.getPage=function(a){j.volPaginator.param.startwith=(a-1)*j.volPaginator.param.limit,o()},a.onDeleteVolumeConfirm=function(){q()},a.$on("timer",function(){o(!0)}),m()}]),angular.module("workflow",[]).controller("WorkflowCtrl",["$scope","workflowMgr","virtualDatacentersMgr","enterprisesMgr","userMgr","$timeout","gridTemplates","paginationHelper","safeApply","utils","$filter",function(a,b,c,d,e,f,g,h,i,j,k){a.__name="WorkflowCtrl",a.workflows=b.workflows,a.enterprises=d.enterprises,a.currentVirtualDatacenter=c.currentVirtualDatacenter,a.selectedWorkflows=[],a.wfFilter=h.wfPaginator.filter,a.wfPaginationParam=h.wfPaginator.param,a.selectedEnterprise={id:d.userEnterprise.id,links:d.userEnterprise.links};var l=function(){f(function(){angular.extend(a.selectedEnterprise,d.userEnterprise)},100)};k("isGranted")("USERS_MANAGE_OTHER_ENTERPRISES")?d.getEnterprises(null,null,l):a.enterprises=[d.userEnterprise],a.onEnterpriseChange=function(){n()};var m=function(b){h.wfPaginator.param.totalSize=b.totalSize,f(function(){i(a)},100)},n=function(c){var d=k("getElementByParameter")(a.enterprises,{element:parseInt(a.selectedEnterprise.id),attribute:"id"});!j.isEmptyObject(d)&&k("isGranted")("USERS_MANAGE_USERS")?b.getWorkflowsByEnterprise(d,c,h.wfPaginator.param,h.wfPaginator.filter,m):b.getWorkflowsByUser(e.user,c,h.wfPaginator.param,h.wfPaginator.filter,m)},o=function(){n()},p=function(){n()};a.approveAction=function(a){var c=a.entity;b.approveWorkflow(c,o)},a.rejectAction=function(a){var c=a.entity;b.rejectWorkflow(c,p)},a.sortInfo={fields:[""],directions:["asc","desc"]},a.workflowGridOptions={data:"workflows",columnDefs:[{field:"clientData.user.name",displayName:k("translate")("workflow.col.user"),sortable:!1},{field:"clientData.enterprise.name",displayName:k("translate")("workflow.col.enterprise"),sortable:!1},{field:"type",displayName:k("translate")("workflow.col.type"),sortable:!1},{field:"creationTimestamp",displayName:k("translate")("workflow.col.date"),cellFilter:"timestampToString",sortable:!1},{field:"clientData.virtualDatacenter.name",displayName:k("translate")("workflow.col.vdc"),sortable:!1},{field:"clientData.virtualAppliance.name",displayName:k("translate")("workflow.col.vapp"),sortable:!1},{field:"clientData.virtualMachine.name",displayName:k("translate")("workflow.col.vm"),sortable:!1},{field:"actions",displayName:k("translate")("workflow.col.action"),width:150,headerCellTemplate:g.noLabelHeaderTemplate,cellTemplate:g.approveRejectCellTemplate,sortable:!1}],useExternalSorting:!0,sortInfo:a.sortInfo,multiSelect:!1},a.$watch("sortInfo",function(a){if(1==a.fields.length&&""!=a.fields[0]){var c=b.sortMapping[a.fields[0]],d="asc"===a.directions[0]?!0:!1;h.wfPaginator.filter.by=c,h.wfPaginator.filter.asc=d,n()}},!0),a.onWfFilterSubmit=function(){h.wfPaginator.resetParam(),a.getPage(h.wfPaginator.param.currentPage)},a.getPage=function(a){h.wfPaginator.param.startwith=(a-1)*h.wfPaginator.param.limit,n()},a.$on("timer",function(){n(!0)}),n()}]);